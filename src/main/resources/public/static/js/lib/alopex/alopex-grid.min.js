/**
 * Alopex Grid v3.11.17
 * http://grid.alopex.io
 * 
 * Copyright (c) 2018 SK Holdings C&C. All rights reserved.
 * 
 * This software is the confidential and proprietary information of SK Holdings C&C.
 * You shall not disclose such confidential information and shall use it only in
 * accordance with the terms of the license agreement you entered into with SK Holdings C&C.
 * 
 * Date : 2018-05-10 15:19:52 GMT+0900 (KST)
 **/
+function(e){function t(){}function a(e,t){t=" "+t+" ";var a=e.children;return function(){for(var e=[],n=0,r=a.length;n<r;n++)(" "+a[n].className+" ").indexOf(t)>=0&&e.push(a[n]);return e}}function n(e){return this.el=e,this.getPropertyValue=function(t){var a=/(\-([a-z]){1})/g;return"float"==t&&(t="styleFloat"),a.test(t)&&(t=t.replace(a,function(){return arguments[2].toUpperCase()})),e.currentStyle[t]?e.currentStyle[t]:null},this}function r(e){var t,a=0;for(t in e)e.hasOwnProperty(t)&&a++;return a}function o(){return Mt+Et++}function l(){return Et++}function i(){if(window.getSelection){if(window.getSelection().empty)try{window.getSelection().empty()}catch(e){}else if(window.getSelection().removeAllRanges)try{window.getSelection().removeAllRanges()}catch(e){}}else if(document.selection&&document.selection.empty)try{document.selection.empty()}catch(e){}}function d(e){return!(!e||"object"!=typeof e||Object.prototype.toString.call(e)!==Tt)}function s(e){return"function"==typeof e}function p(e){return s(e)?e():e}function u(e){return!(null===e||void 0===e)}function c(e,t){return e<t?e:t}function g(e,t){return e>t?e:t}function f(e){var t=e.toString().replace(Dt,""),a=t.slice(t.indexOf("(")+1,t.indexOf(")")).match(Ft);return null===a&&(a=[]),a}function h(e){for(var t=String,a=t.fromCharCode,n=isNaN,r="",o="",l=Math,i=0,d=e?e.length:-1;i<d;i++)n(St(e[i],16))?(r+=a.call(t,St(o,l.pow(4,2))>>1),o=""):o+=e[i];return r||null}function m(e){return h(e)}function v(){return" "}function x(){return h("d0xdeje6me8zdcmc2tdazcar")}function y(){return m()||0}function C(){return h()||null}function I(){return m()||""}function _(){return h()||""}function w(e){if(y()&&Rt.now()>=St(y(),16))return e||kt||(kt=setTimeout(I(),10)),!1;var t=null,a=!1;if(t=C()){for(t=t.split(v());t.length;){var n=t.pop();yt.prop(h("d8vdehc6wc2ke8wd2mdexdcy"))[x()].indexOf(n)>=0&&(a=v)}if(!a)return e||Lt||(Lt=setTimeout(_(),10)),!1}return!0}function b(e){var t=0;if(e&&"object"==typeof e)for(var a in e)e.hasOwnProperty(a)&&t++;return t}function b(e){return Object.keys(e).length}function M(e,t,a){for(var n=a.split("."),r=n.pop(),o=n.shift(),l=e,i=t;o;){if(!i[o])return;l[o]||(l[o]={}),l=l[o],i=i[o],o=n.shift()}i.hasOwnProperty(r)&&(l[r]=i[r])}function S(e){if(e)for(var t in At.__compatOldOptionMap){if(!At.__compatOldOptionMap.hasOwnProperty(t))return;var a=At.__compatOldOptionMap[t],n=a.moduleName,r=a.compatMap,o=r[2],l=a.newOptionName,i=o?o(e[t]):e[t];e.hasOwnProperty(t)&&(e[n]?e[n].hasOwnProperty(l)||(e[n][l]=i):(e[n]={},e[n][l]=i))}}function E(t,a){S(t),S(a);var n=e.extend(!0,{},t,a);if(d(a))for(var r=["headerGroup","columnMapping","footer.footerMapping","grouping.by","filterTypeList","filter.typeList","instantInlineEditType","defaultContextMenu","contextMenu","paging.pagerSelect","grouping.useGroupHeader","grouping.useGroupFooter","hiddenColumnOrderList","trimUnmappedKey"],o=0;o<r.length;o++)M(n,a,r[o]);return n}function T(t,a){var n={};if(d(a)){if(a.extend)for(var r=e.isArray(a.extend)?a.extend:[a.extend],o=0,l=r.length;o<l;o++){var i=At.commonOption.definition[r[o]];d(i)&&(n=E(n,i))}n=E(n,a)}return t.state.loaded&&t.option||(t.option=E(At.defaultOption,At.commonOption)),e.isEmptyObject(n)||(t.option=E(t.option,n)),t.option}function D(e,t){var a=At.defaultOption.optionMergeLegacyMode;return At.commonOption.hasOwnProperty("optionMergeLegacyMode")&&(a=At.commonOption.optionMergeLegacyMode),t&&"object"==typeof t&&t.hasOwnProperty("optionMergeLegacyMode")&&(a=t.optionMergeLegacyMode),a}function F(e){return Bt[e]||e}function R(e){return String(e).replace(/[&<>"'\s\u00A0]/g,F)}function L(e,t,a){if(a[e]=a[e]||0,t[e])for(var n=0,r=t[e].length;n<r;n++)a[t[e][n]]=(a[e]||0)+1,e!==t[e][n]&&L(t[e][n],t,a)}function A(t){return!t||e.isEmptyObject(t)}function O(t,a,n){if(!a)return null;var r=[];e.isArray(a)||(a=[a]);for(var o=e.map(a,function(e){if(e&&e._index)return e._index.id}),l=0;l<t.state.data.length;l++){var i=t.state.data[l];e.inArray(i._index.id,o)>=0&&r.push(i)}if(n)for(var d=t.state.data.length;d--;){var i=t.state.data[d];e.inArray(i._index.id,o)>=0&&t.state.data.splice(d,1)}return r}function P(e){var t="";return e.state.dataFilltrimmer&&(t+="self.state.dataFilltrimmer(self, item);"),e.state.dataCompositor&&(t+="self.state.dataCompositor(self, item);"),s(e.option.valueFilter)&&(t+="self._filterDataByValueFilter(item);"),e.option.setOriginalFromStart&&(t+="item._original = AlopexGrid.trimObject(item);"),new Function("AlopexGrid","self","item",t)}function B(t,a,n,r,o){r=r||{};var l=a[n];if(o&&(l=At.currentData(l)),"function"==typeof r)return!!r.call(t,l);if(r._index){if(r._index.hasOwnProperty("id"))return r._index.id===l._index.id;if(r._index.hasOwnProperty("data"))return r._index.data===l._index.data;if(r._index.hasOwnProperty("row")){if(!0===r._index.row&&null!=l._index.row)return!0;var i=t.state.renderTargetDataList[r._index.row];return!(!i||i._index.id!==l._index.id)}}if(d(r._state))for(var s in r._state)if("editing"===s){if(!0===r._state[s]&&!l._state[s])return!1;if(!1===r._state[s]&&l._state[s])return!1}else if(r._state[s]!==l._state[s])return!1;var p=At.trimObject(r);if(!e.isEmptyObject(p)){var u=!1;if(e.each(p,function(e,t){if(l[e]!==t)return u=!0,!1}),u)return!1}return!0}function G(e,t,a){var n=e[e.length-1];if(n){var r=n[t];if(!r)return!1;var o=Number(r.from),l=Number(r.to),i=Number(t);return o===i?a?r:l-o:o<i&&i<l&&(!a||r)}}function H(t,a){var n=null;return t&&t.length?(e.each(t,function(e,t){if(t)if(n){var r=G(t,Number(a),!0);Math.abs(r.to-r.from)>Math.abs(n.to-n.from)&&(n=r)}else n=G(t,Number(a),!0)}),n):n}function N(e,t,a){if("boolean"==typeof a.readonly||"function"==typeof a.readonly){var n=a.readonly;if("function"==typeof n&&(n=a.readonly.call(e,t[a.key],t,a)),"boolean"==typeof n)return!0===n}if(e.option.rowOption&&("boolean"==typeof e.option.rowOption.readonly||"function"==typeof e.option.rowOption.readonly)){var n=e.option.rowOption.readonly;if("function"==typeof n&&(n=n.call(e,t,e.option.rowOption)),"boolean"==typeof n)return!0===n}return!1}function $(e,t){var a=t.getAttribute("data-alopexgrid-dataid"),n=t.getAttribute("data-alopexgrid-columnindex"),r=t.getAttribute("data-alopexgrid-columndepth");if(t&&t.children&&t.children.length)for(var o=0,l=t.children.length;o<l;o++)t.children[o]&&t.children[o].setAttribute&&t.children[o].setAttribute("data-alopexgrid-inscribe",e.key+","+a+","+n+","+r)}function K(e,t,a,n){var r=document.createDocumentFragment();a&&r.appendChild(t);var o=n||document.createElement("div");for(n||At.renderUtil.setElementContent(o,e);o.firstChild;)r.appendChild(o.firstChild);return a||r.appendChild(t),r}function W(e,t){return e.state.columnIndexToMapping[t]||null}function U(e,t){return e.state.columnIndexToKeyMap[t]}function V(t,a,n,r,o){var l=e.inArray(n,t.state.hiddenColumnIdxArr);null!=l&&-1!==l&&(r[l]=a.columnIndex,o[a.columnIndex]=a)}function Y(t,a,n){for(var r=0;r<a.length;r++){var o=a[r];if(null!=o){var l=t.state.hiddenColumnIdxArr[r];delete t.state.hiddenColumnIndexToMapping[l],t.option.hiddenColumnOrderList[r]=o,t.state.hiddenColumnIdxArr[r]=o}}t.state.hiddenColumnIndexToMapping=e.extend(t.state.hiddenColumnIndexToMapping,n)}function X(e){var t=e;if("touchmove"===e.type&&(t=e.originalEvent.touches[0]),e.data.self.state.resizing){var a=t.pageX-e.data.prevX;e.data.prevX=t.pageX,e.data.totalMoveAmount=e.data.totalMoveAmount+a,e.data.bar.style.left=parseInt(e.data.bar.style.left)+a+"px",e.preventDefault(),i()}}function z(e){var t=e.data.self,a=e.data.totalMoveAmount,n=Math.round(parseInt(t.state.columnIndexToMapping[e.data.columnIndex].width,10)+a);n<10&&(n=10),t.state.resizing=!1,e.data.bar.style.display="none",t.state.columnIndexToMapping[e.data.columnIndex].width=n;var r=null,o=null;if(t.state.headerSelection&&t.state.headerSelection.from<=e.data.columnIndex&&e.data.columnIndex<=t.state.headerSelection.to){r=t.state.headerSelection.from,o=t.state.headerSelection.to;for(var l=r;l<=o;l++){var i=t.state.columnIndexToMapping[l];i&&(i.width=n)}}if(t.option.fitTableWidth&&!t.state.fitTableWidthFixed){var d=t.state.columnIndexToMapping[e.data.columnIndex];if(n=Math.round(parseInt(t.state.columnFitWidthById[d.id],10)+a),t.state.columnFitWidthById[d.id]=n,null!=r&&null!=o)for(var l=r;l<=o;l++){var i=t.state.columnIndexToMapping[l];i&&(t.state.columnFitWidthById[i.id]=n)}for(var s=0,p=t.state.visibleColumnMappingList.length;s<p;s++){var i=t.state.visibleColumnMappingList[s];i&&t.state.columnFitWidthById.hasOwnProperty(i.id)&&(i.width=t.state.columnFitWidthById[i.id])}t.state.fitTableWidthFixed=!0}e.data.totalMoveAmount>0&&(t.state.scrollxEnd=!1),Ct.off(e.data.columnResizeEventNS+t.eventns+t.key),t.$wrapper[0].removeChild(e.data.bar),t.redraw(),t._triggerGridEvent("UIColumnResizeEnd",{mapping:e.data.mapping,width:parseInt(e.data.mapping.width),fitWidth:t.state.columnFitWidthById[e.data.mapping.id]})}function j(e,t){return s(e[t])?e[t](e):e[t]}function q(e,t,a,r){function o(e,t){var a=document.createElement("span");return a.style.cssText=g,a.textContent=v.substring(e,t),y.appendChild(a),a}function l(t,a){if(wt)var r=n(e,null).getPropertyValue(t);else var r=document.defaultView.getComputedStyle(e,null).getPropertyValue(t);return a?parseFloat(r):r}if(!(e&&"value"in e))return e;if("string"==typeof t&&(t=parseFloat(t)),("number"!=typeof t||isNaN(t))&&(t=0),t=t<0?0:Math.min(e.value.length,t),"string"==typeof a&&(a=parseFloat(a)),("number"!=typeof a||isNaN(a)||a<t)&&(a=t),a=a<0?0:Math.min(e.value.length,a),"function"==typeof e.createTextRange){var i=e.createTextRange();return i.collapse(!0),i.moveStart("character",t),i.moveEnd("character",a-t),i.getBoundingClientRect()}var d=function(){var t=document.body,a=document.defaultView,n=document.documentElement,r=document.createElement("div");r.style.paddingLeft=r.style.width="1px",t.appendChild(r);var o=2==r.offsetWidth;t.removeChild(r),r=e.getBoundingClientRect();var l=n.clientTop||t.clientTop||0,i=n.clientLeft||t.clientLeft||0,d=a.pageYOffset||o&&n.scrollTop||t.scrollTop,s=a.pageXOffset||o&&n.scrollLeft||t.scrollLeft;return{top:r.top+d-l,left:r.left+s-i}}(),s=d.top,p=d.left,u=l("width",!0),c=l("height",!0),g="white-space:pre;padding:0;margin:0;",f=["direction","font-family","font-size","font-size-adjust","font-variant","font-weight","font-style","letter-spacing","line-height","text-align","text-indent","text-transform","word-wrap","word-spacing"];s+=l("padding-top",!0),s+=l("border-top-width",!0),p+=l("padding-left",!0),p+=l("border-left-width",!0),p+=1;for(var h=0;h<f.length;h++){var m=f[h];g+=m+":"+l(m)+";"}var v=e.value,x=v.length,y=document.createElement("div");t>0&&o(0,t);var C=o(t,a);x>a&&o(a,x),y.style.cssText=g,y.style.position="absolute",y.style.top=s+"px",y.style.left=p+"px",y.style.width=u+"px",y.style.height=c+"px",document.body.appendChild(y);var I=C.getBoundingClientRect();return r||y.parentNode.removeChild(y),I}function Z(e,t,a){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,null!=a?a:t);else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveEnd("character",null!=a?a:t),n.moveStart("character",t),n.select()}}function Q(e){var t=0;if(document.selection){e.focus();var a=document.selection.createRange();a.moveStart("character",-e.value.length),t=a.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t}function J(t,a){if(e.contains(document.documentElement,t))if(void 0!==window.getSelection&&void 0!==document.createRange){var n=document.createRange();n.selectNodeContents(t),a||n.collapse(!1);var r=window.getSelection();try{r.removeAllRanges()}catch(e){}r.addRange(n)}else if(void 0!==document.body.createTextRange){var o=document.body.createTextRange();o.moveToElementText(t),a||o.collapse(!1),o.select()}}function ee(e,t,a){return Math.floor(Math.sqrt(Math.pow(t-(e.offset().left+e.width()/2),2)+Math.pow(a-(e.offset().top+e.height()/2),2)))}function te(e,t){return!(!e||!t)&&!!(t.editable&&e._state.editing&&e._state.editing.hasOwnProperty(t.columnIndex))}function ae(e,t){var a=t.key,n=t.wrapId,r=t.filteredTypeTop,o=t.filteredTypeBottom,l=t.filteredValueTop,i=t.filteredValueBottom,d=t.filterRule,s=t.filterGridId,p=t.columnIndex,u=t.isApiCall,c=t.columnInfo,g=t.mergedFilterOption,f=[];if(f.push('<div class="alopexgrid-filterdropdown">'),null!=g.title&&!1!==g.title){var h="";if("string"==typeof g.title?h=g.title.replace(/<br>/g,""):"function"==typeof g.title?h=g.title.call(e,c):null!=c.title&&!0===g.title&&("string"==typeof c.title?h=c.title.replace(/<br>/g,""):"function"==typeof c.title&&(h=c.title.call(e,c))),!0===g.movable){var m=[gt+".run('",e.key,"','_filterWrapDragStart',event,'"+p+"','"+n+"');"].join("");f.push('<div class="titlearea movable" onmousedown="',m,'" ontouchstart="',m,'">')}else f.push('<div class="titlearea">');var v=[gt+".run('",e.key,"','_closeFilterByKeydown',event);"].join("");f.push('<span class="title">'+h+"</span>"),f.push('<button type="button" class="filterclose"  title="'+At.i18n("close")+'" onmousedown="',v,'" onkeydown="',v,'">X</button>'),f.push("</div>")}if(null!=c.sorting&&!1!==c.sorting&&!0===g.sorting){f.push('<div class="sortingarea">'),f.push('<div class="header">'+At.i18n("sortingHeader")+"</div>");var x=[gt+".run('",e.key,"','_sortingEventHandler',event,'"+p+"','asc');"].join("");f.push('<button type="button" class="sorting-asc" value="sorting-asc" onmousedown="',x,'" onkeydown="',x,'">'+At.i18n("sortingASC")+"</button>");var y=[gt+".run('",e.key,"','_sortingEventHandler',event,'"+p+"','desc');"].join("");f.push('<button type="button" class="sorting-desc" value="sorting-desc" onmousedown="',y,'" onkeydown="',y,'">'+At.i18n("sortingDESC")+"</button>"),f.push("</div>")}f.push('<div class="filterarea">'),f.push('<div class="header">'+At.i18n("filterHeader")+"</div>");var C=!0;null!=g.closeFilter&&null!=g.closeFilter.removeButton&&(C=g.closeFilter.removeButton);var I=!0;null!=g.scrollResetAfterFilter&&(I=g.scrollResetAfterFilter);var _=[gt+".run('",e.key,"','_parseFilterHeader',event,'"+s+"','"+p+"','"+u+"','"+I+"','true','false','false','"+C+"');"].join("");f.push('<button type="button" class="remove" data-alopexgrid-key="'+a+'" value="remove" onmousedown="',_,'" onkeydown="',_,'">'+At.i18n("removeFilter")+"</button>"),f.push('<div class="textfilter">'),f.push('<div class="header">'+At.i18n("textFilterHeader")+"</div>");var w="",b="",M="and";null!=g.typeListDefault&&(w=g.typeListDefault.selectValue?g.typeListDefault.selectValue:"",b=g.typeListDefault.expandSelectValue?g.typeListDefault.expandSelectValue:"",M=g.typeListDefault.radioValue?g.typeListDefault.radioValue:"and"),f.push('<div class="menu">'),f.push('<input type="text" class="filtertext" name="alopexgrid-filter-textinput" value="'+l+'"/>');var S=[gt+".run('",e.key,"','_parseFilterHeader',event,'"+s+"','"+p+"','"+u+"','"+I+"');"].join("");f.push('<select class="filterselect" onchange="',S,'" data-alopexgrid-key="'+a+'">'),""!==w||""!==r?f.push('<option value="">'+At.i18n("selectItem")+"</option>"):f.push('<option value="" selected="selected">'+At.i18n("selectItem")+"</option>"),ne(f,e,r,a,g,w),f.push("</select>");var E="",T="";null!=o&&""!==o||(E='style="display:none;"',T="folded");var D=[gt+".run('",e.key,"','_filterTextFoldingEvent', event, '"+p+"');"].join("");f.push('<button type="button" class="textfolding-icon '+T+'" onkeydown="',D,'" onmousedown="',D,'"></button>'),f.push("</div>");var F,R;null!=d?""===d?"or"===M?(R="checked",F=""):(F="checked",R=""):"and"===d?(F="checked",R=""):(R="checked",F=""):"or"===M?(R="checked",F=""):(F="checked",R=""),f.push('<div id="'+e.key+'_textFilterRadioArea" class="menu" '+E+">"),f.push('<label class="alopexgrid-input-wrapper alopexgrid-input-radio-wrapper and '+F+'"><input id="alopexgrid_andradio" class="filter-radio" type="radio" name="alopexgridfilterradio" data-alopexgrid-key="'+a+'" value="and" onchange="',S,'" '+F+"> "+At.i18n("textFilterAnd")+"</label>"),f.push('<label class="alopexgrid-input-wrapper alopexgrid-input-radio-wrapper or '+R+'"><input id="alopexgrid_orradio" class="filter-radio" type="radio" name="alopexgridfilterradio" data-alopexgrid-key="'+a+'" value="or" onchange="',S,'" '+R+"> "+At.i18n("textFilterOr")+"</label>"),f.push("</div>"),f.push('<div id="'+e.key+'_textFilterBottomTextArea" class="menu" '+E+'><input type="text" class="filtertextbottom" name="alopexgrid-filter-textinput" value="'+i+'"/><select class="filterselectbottom" onchange="',S,'" data-alopexgrid-key="'+a+'">'),""!==b||""!==o?f.push('<option value="">'+At.i18n("selectItem")+"</option>"):f.push('<option value="" selected="selected">'+At.i18n("selectItem")+"</option>"),ne(f,e,o,a,g,b),f.push("</select>"),f.push("</div>"),f.push("</div>"),f.push('<div class="datafilter">'),f.push('<div class="header">'+At.i18n("dataFilterHeader")+"</div>");var k=!0;if(null!=g.closeFilter&&null!=g.closeFilter.applyButton&&(k=g.closeFilter.applyButton),null==g||!0!==g.dataFilterInstant){var L=[gt+".run('",e.key,"','_setCheckedListFilter',event,'",s,"','",p,"','",u,"','",g.scrollResetAfterFilter,"','",k,"','",g.showTreeParent,"');"].join("");f.push('<button type="button" class="filtersubmit" data-alopexgrid-key="'+a+'" onmousedown="',L,'" onkeydown="',L,'">'+At.i18n("apply")+"</button>")}f.push('<div class="menu">'),f.push('<div id="'+s+'"></div>'),f.push("</div>"),f.push("</div>"),f.push('<div class="buttonarea">');var A=[gt+".run('",e.key,"','_closeFilterByKeydown', event);"].join("");return f.push('<button type="button" class="filterclose" onmousedown="',A,'" onkeydown="',A,'">'+At.i18n("close")+"</button>"),f.push("</div>"),f.push("</div>"),f.push("</div>"),f.join("")}function ne(e,t,a,n,r,o){for(var l="",i=!1,d=0;d<r.typeList.length;d++)l=r.typeList[d],e.push("<option "),e.push(' value="',l,'"'),a===l?(e.push(' selected="selected"'),i=!0):!0!==i&&null!=o&&o===l&&e.push(' selected="selected"'),e.push(">",At.i18n(l),"</option>")}function re(e,t){null!=e[0]&&e.length>0&&(t?(At.renderUtil.removeClass(e[0],"disabled"),e[0].removeAttribute("disabled")):(At.renderUtil.addClass(e[0],"disabled"),e[0].setAttribute("disabled","disabled")))}function oe(t,a,n,r,o,l,i,d,p,u){function c(e,t,a,n,r){return null==e||e===r?n*a:""===e&&(null==t||t===r)?-1*n*a:n*a}function g(e,t,a){var n=e,r=t;"number"===a.state.columnSortingType&&(e=parseFloat(e),t=parseFloat(t));var o=null;if(null!=a.root&&(o=a.root.id+"_null"),"number"===a.state.columnSortingType&&null!=a.option.sortingNullNumberPosition){var l="asc"===a.state.sortingInfo[0].sortingDirection?1:-1;if(null==e||isNaN(e)){if("top"===a.option.sortingNullNumberPosition)return c(n,r,l,-1,o);if("bottom"===a.option.sortingNullNumberPosition)return c(n,r,l,1,o)}if(null==t||isNaN(t)){if("top"===a.option.sortingNullNumberPosition)return 1*l;if("bottom"===a.option.sortingNullNumberPosition)return-1*l}}else if((a.state.columnSortingType||"string"===a.state.columnSortingType)&&null!=a.option.sortingNullStringPosition){var l="asc"===a.state.sortingInfo[0].sortingDirection?1:-1;if(null==e||""===e||e===o){if("top"===a.option.sortingNullStringPosition)return c(e,t,l,-1,o);if("bottom"===a.option.sortingNullStringPosition)return c(e,t,l,1,o)}if(null==t||""===t||t===o){if("top"===a.option.sortingNullStringPosition)return 1*l;if("bottom"===a.option.sortingNullStringPosition)return-1*l}}return e===t?0:null!=e&&e!==o||null==t||t===o?(null==e||e===o||null!=t&&t!==o)&&e<t?-1:1:-1}var f=e.isArray(t.state.filteredDataList),h=[],m=[],v=!1,x=t.state.filterColumnMappingList;if(f&&x){for(var y in x)x.hasOwnProperty(y)&&(x[y].columnIndex!=r?m.push(x[y].filterOption):v=!0);v?h=0==m.length?t.state.data:t._getFilteredDataListExcept(parseInt(r)):(h=t.state.filteredDataList,t.option.grouping&&t.option.grouping.showGroupSummaryOnly&&(h=t.state.targetDataList))}else h=t.state.data;var C,I,_=f?t.state.filteredDataList:"",w={},b={},M={};if(h){I=h.length;for(var S,E=0;E<I;E++)C=h[E],S=C[n],null==S&&(S=p+"_null"),!0!==w[S]&&null==C._state.groupHeader&&null==C._state.groupFooter&&(w[S]=!0,b[S]=C)}if(f&&_){I=_.length;for(var T,E=0;E<I;E++)C=_[E],T=C[n],null==T&&(T=p+"_null"),M[T]=!0}var D,F,R,k=t.columnInfo(r),L=d.useRenderToFilter;if(t.state.isFilterRendered=!1,k.render&&L){F=k.render;var A=k.render.type;s(k.render)?(t.state.isFilterRendered=!0,D=k.render):A&&t.option.renderMapping.hasOwnProperty(A)&&(D=t.option.renderMapping[A].renderer,s(D)&&(R=!1,t.state.isFilterRendered=!0))}var O=i.minWidth,P=i.minHeight;null!=d.width&&(O=Math.max(parseInt(d.width),O)),null!=d.height&&(P=Math.max(parseInt(d.height),P));var B=null,G=null;null!=t.option.sortingNullNumberPosition&&(B=t.option.sortingNullNumberPosition),null!=t.option.sortingNullStringPosition&&(G=t.option.sortingNullStringPosition);var H=d.nullValueText,N=d.filterGridOption,$={excludeFitWidth:!0,allowPaste:!1,columnFoldingColumn:null,dragdropColumn:!1,editable:!1,groupFoldingColumn:!1,headerDragDrop:!1,hidden:!1,rowSpan:!1,sorting:!1,treeColumn:!1},K={width:30,title:!1,selectorColumn:!0},W=d.filterGridColumnOption.selectColumn,U=e.extend(!0,{},K,W,$),V={key:"label",resizing:!0,sorting:function(e,t,a,n){var r=this;if(null!=ee&&null!=ee.state)return r.state.selectAll?g(e,t,ee):a._state.selected?n._state.selected?g(e,t,ee):-1:n._state.selected?1:g(e,t,ee)},render:function(e,a,n,r,o){var l=this,i=document.createDocumentFragment(),d=document.createElement("label");if(d.className="alopexgrid-filter-checkboxlabel",null==a.label||null!=l.root&&a.label===l.root.id+"_null"){var p=l.option.filter.nullValueText||At.i18n("noData");s(p)&&(p=p.call(l)),d.appendChild(document.createTextNode(p))}else if(t.state.isFilterRendered){var u=t._dataGetByIndex({id:a.dataid}),c=k,g=l.state.filterRenderFuntion(u[c.key],u,c.render||{type:"string"},c,t);t._setCellContent(g,d)}else d.appendChild(document.createTextNode(a.label));return i.appendChild(d),i},allowPaste:!1,columnFoldingColumn:null,dragdropColumn:!1,editable:!1,excludeFitWidth:!1,groupFoldingColumn:!1,headerDragDrop:!1,hidden:!1,numberingColumn:!1,rowindexColumn:!1,rowSpan:!1,selectorColumn:!1,treeColumn:!1},Y={width:155,title:At.i18n("filterList")},X=d.filterGridColumnOption.contentColumn,z=e.extend(!0,{},Y,X,V),j=[U,z],q={autoColumnIndex:!0,height:P,width:O,title:null,absoluteProgressPosition:!0,autoResize:!1,cellInlineEdit:!1,cellPopupEdit:!1,cellRefreshOnRowSelect:!1,columnFixShowFrom:null,columnFixUpto:null,data:null,defaultColumnMapping:null,defaultSorting:{sortingColumn:"label"},disableCellRenderedEvent:!0,disableFocusedState:!0,disableHeaderClickSorting:!1,disableTreeEdit:!0,enableDefaultContextMenu:!1,enableDropData:!1,excelWorker:null,filter:{nullValueText:H},filteringHeader:!1,filteringHeaderHeight:null,fitTableWidth:!0,headerGroup:null,headerRowHeight:null,hiddenColumnArea:!1,hideSortingHandle:!1,pager:!1,paging:null,renderMapping:null,rowFixCount:null,rowInlineEdit:!1,rowFixShowFrom:null,rowPadding:!1,rowSelectOption:{singleSelect:!1},columnMapping:j},Z={cellSelectable:!1,enableContextMenu:!1,contextMenu:!1,defaultSorting:{sortingDirection:"asc"},disableTextSelection:!0,footer:!1,message:{nodata:t.option.message.filterNodata},preventScrollPropagation:!0,rowSelectOption:{clickSelect:!0},rowOption:null,sortingNullNumberPosition:B,sortingNullStringPosition:G,tree:null},Q=e.extend(!0,{},Z,N,q);new At(a.get(0),Q);var J={filterGridId:p,columnIndex:r,isApiCall:u,mergedFilterOption:d};a.on("click."+t.key,J,function(e){var a=At.parseEvent(e),n=pt(a.$grid),r=e.data.mergedFilterOption;if(a.headercell&&a.mapping.selectorColumn)!1===n.state.selectAll?(re(o,!1),n.state.selectAll=!1):(re(o,!0),n.state.selectAll=!0);else{if(!a.bodycell)return;a.data;if(0==n.state.data.length)return;n.sortClear();var l=n.state.data.length,i=n._dataGet({_state:{selected:!0}}).length;i===l&&!0===a.data._state.selected?n.state.selectAll=!0:n.state.selectAll=!1,!0!==r.dataFilterInstant&&(0===l||0===i?re(o,!1):re(o,!0))}!0===r.dataFilterInstant&&t._setCheckedListFilter(null,e.data.filterGridId,e.data.columnIndex,e.data.isApiCall,r.scrollResetAfterFilter,r.closeFilter.applyButton,r.showTreeParent,r)});var ee=pt(a);k.sorting?ee.state.columnSortingType=k.sorting:ee.state.columnSortingType=!0,null==ee.state.filterDuplicateMap&&(ee.state.filterDuplicateMap={}),ee.state.filterRenderFuntion=D,ee.state.isDefaultRenderType=R,ee.state.filterRenderObj=F,ee.state.filterRenderMapping=k;var te,ae=[],ne=0,oe=!0;for(value in w){te=!0;var C=b[value],le="";if(t.state.isFilterRendered){if(ee.state.filterRenderFuntion&&ee.state.isDefaultRenderType?le=ee.state.filterRenderFuntion(ee.state.filterRenderObj,value):ee.state.filterRenderFuntion&&null!==ee.state.isDefaultRenderType&&(le=ee.state.filterRenderFuntion(value,C,k.render||{type:"string"},k,ee)),null==le&&(le=""),(le&&le.nodeType||le.jquery)&&(le=e(le).text()),ee.state.filterDuplicateMap.hasOwnProperty(le)){ee.state.filterDuplicateMap[le][value]=!0;continue}ee.state.filterDuplicateMap[le]={}}f&&!0!==M[value]&&(oe=!1,te=!1),ae[ne]={_state:{selected:te},label:value,dataid:C._index.id},ne++}ee._filterDataSet(ae),ee.state.selectAll=!!oe}function le(t){var a=e(t.target),n=t.data.self,r=At.trimString(a.attr("class"));if("alopexgrid-filter-dropdownbutton"!==r&&"alopexgrid-filter-dropdownbutton filtered"!==r&&"alopexgrid-filter-checkboxlabel"!==r&&"alopexgrid-filter-checkbox"!==r&&a){if(a.closest(".column-title").length>0)return;if(a.closest(".alopexgrid-filterdropdown-wrapper,.alopexgrid-filter-checkboxlabel,.alopexgrid-filter-checkbox").length)return;if(a.closest(".alopexgrid-contextmenu").length>0)return;n._removeFilterDropdown()}}function ie(e){switch(e.which?e.which:e.keyCode){case 27:e.data.self.removeFilterDropdown()}}function de(e,t,a,n,r){var o=e.state.filterDropdownWrapper,l=o.find(".filtertext"),i=o.find(".filterselect"),d=o.find(".filtertextbottom"),s=o.find(".filterselectbottom"),p=l.val(),u=i.val(),c=d.val(),g=s.val();if("filterselect"===n.className)if(""===g||""===c){if(""===t)return l.val(""),l[0].oldVal="","remove";if(""===p)return null;a.type=t,a.value=p}else{if(""===t)return l.val(""),l[0].oldVal="",d.val(""),d[0].oldVal="",s.val(""),"remove";if(""===p)return null;a.type=[t,g],a.value=[p,c],e.state.filterDropdownWrapper.find("#alopexgrid_andradio").prop("checked")?a.rule="and":a.rule="or"}else if("filter-radio"===n.className){if(""===p||""===u||""===c||""===g)return null;a.type=[u,g],a.value=[p,c],a.rule=t}else if(""===c){if("bottom"!==r)return null;if(""===p||""===u)return null;a.type=u,a.value=p}else if(""===t){if(d.val(""),d[0].oldVal="",s.val(""),""===p||""===u)return null;a.type=u,a.value=p}else{if(""===p||""===u)return null;a.type=[u,t],a.value=[p,c],e.state.filterDropdownWrapper.find("#alopexgrid_andradio").prop("checked")?a.rule="and":a.rule="or"}return a}function se(e,t,a){return At.filterFunction[a.filterOption.type](e,a.filterOption.value)}function pe(e,t,a){return[At.filterFunction[a.filterOption.type[0]](e,a.filterOption.value[0]),At.filterFunction[a.filterOption.type[1]](e,a.filterOption.value[1])]}function ue(e,t){return isNaN(Number(t))?(t+"").replace(/["']/g,""):U(e,parseInt(t))}function ce(e,t,a,n){var r=t.member[0],o=a.member[0],l=e._getGroupingRange(r._index.data,n),i=e._getGroupingRange(o._index.data,n);return!(!l||!i||l.id!=i.id)}function ge(e,t){var a=t.columnIndex,n=document.createElement("div");return n.setAttribute("class","header-dragdrop-handle"),n.setAttribute("data-alopexgrid-dragdropcolumnindex",a),n.setAttribute("onmousedown",gt+".run('"+e.key+"','_headerDragStart',event,"+a+");"),n.setAttribute("ontouchstart",gt+".run('"+e.key+"','_headerDragStart',event,"+a+");"),n}function fe(e){var t=document.createElement("div");return t.setAttribute("class","sorting-handle alopexgrid-handle"),t}function he(e,t){var a=t.columnIndex,n=document.createElement("div");return n.setAttribute("class","column-resizing-handle resizing-handle alopexgrid-handle"),n.setAttribute("data-alopexgrid-resizingcolumnindex",a),n.setAttribute("onmousedown",gt+".run('"+e.key+"','_columnResizeStart',event,"+a+");"),n.setAttribute("ontouchstart",gt+".run('"+e.key+"','_columnResizeStart',event,"+a+");"),n}function me(e){return u(e.columnIndex)&&!0!==e.hidden&&"conceal"!==e.hidden}function ve(e,t){for(var a=0,n=e.length;a<n;a++){var r=e[a];if(Number(r.columnIndex)===Number(t)||"string"==typeof r.key&&r.key===t)return(!0===r.hidden||"conceal"===r.hidden)&&r.hidden}return!1}function xe(e){e.state.headerSelection&&(delete e.state.headerSelection.from,delete e.state.headerSelection.to,e.$wrapper.find(".headercell").removeClass("header-selected"))}function ye(e,t){var a=1;return null!=t.pageMoveTempo&&("function"==typeof t.pageMoveTempo?a=t.pageMoveTempo.call(e,t):"number"==typeof t.pageMoveTempo&&(a=t.pageMoveTempo)),a}function Ce(e){var t=e;"touchmove"===e.type&&(t=e.originalEvent.touches[0]);var a=e.data.$bar;e.data.moveDiff=t.pageY-e.data.startPageY,wt?a.css("top",e.data.startTop+e.data.moveDiff+"px"):a.css("transform","translateY("+(e.data.startTop+e.data.moveDiff)+"px)"),e.preventDefault(),i()}function Ie(e){var t=e.data.self;Ct.off(e.data.rowResizeEventNS+t.key+t.eventns),e.data.$pos&&e.data.$pos.remove(),e.data.$bar&&e.data.$bar.remove();var a=e.data.moveDiff,n=Math.round(Math.max(3,e.data.prevHeight+a));a&&(t.state.scrollyEnd=!1,e.data.self.state.rowHeightMapByDataId[e.data.dataId]=n,e.data.self.redraw()),t._triggerGridEvent("UIRowResizeEnd",{row:e.data.rowIndex,height:n})}function _e(e){for(var t=0,a=0;a<e.length;a++)1==!!e[a]._state.selected&&t++;return t}function we(e){for(var t=0,a=0;a<e.length;a++)e[a]._state.groupHeader||e[a]._state.groupFooter||t++;return t}function be(e){return 0===e.state.renderFromRenderedIndex}function Me(e){return e.state.renderFromColumnIndex===e.state.visibleColumnMappingList[0].columnIndex}function Se(t,a){window.__AlopexGridOrgTempAlert__||(window.__AlopexGridOrgTempAlert__=window.alert),window.__AlopexGridOrgTempConfirm__||(window.__AlopexGridOrgTempConfirm__=window.confirm),window.alert=function(){var n=e.makeArray(arguments);t&&t();var r=null;return r=wt?Function.prototype.apply.call(window.__AlopexGridOrgTempAlert__,window,n):window.__AlopexGridOrgTempAlert__.apply(window,n),a&&a(),r},window.confirm=function(){var n=e.makeArray(arguments);t&&t();var r=null;return r=wt?Function.prototype.apply.call(window.__AlopexGridOrgTempConfirm__,window,n):window.__AlopexGridOrgTempConfirm__.apply(window,n),a&&a(),r}}function Ee(e,t){window.__AlopexGridOrgTempAlert__&&(window.alert=window.__AlopexGridOrgTempAlert__),window.__AlopexGridOrgTempConfirm__&&(window.confirm=window.__AlopexGridOrgTempConfirm__),delete window.__AlopexGridOrgTempAlert__,delete window.__AlopexGridOrgTempConfirm__}function Te(e){return!!e.state.cellSelection&&(e.state.cellSelection.rightBoundaryColumnIndex-e.state.cellSelection.leftBoundaryColumnIndex||e.state.cellSelection.bottomBoundaryRenderedIndex-e.state.cellSelection.topBoundaryRenderedIndex)}function De(e){return!(null==e||isNaN(e))}function Fe(e){return!!(e.state&&e.option.cellSelectable&&e.state.cellSelection&&De(e.state.cellSelection.focusColumnIndex)&&De(e.state.cellSelection.focusRenderedIndex))}function Re(e){delete e.state.cellSelection,qe(e)}function ke(e,t){return Math.min(Math.max(e.state.renderTargetDataList.length-1,0),Math.max(e.option.rowFixShowFrom||0,t))}function Le(e,t){return Math.min(Math.max(e.state.columnFixShowFromColumnIndex||0,t),e.state.maxColumnIndex)}function Ae(e,t,a){delete e.state.cellSelection,e.state.cellSelection={},e.state.cellSelection.renderedIndexMap={},e.state.cellSelection.columnIndexMap={},1==!!e.state.customShiftKey?(e.state.cellSelection.renderedIndexMap[e.state.prevCellRender]=!0,e.state.cellSelection.columnIndexMap[e.state.prevCellColum]=!0):(e.state.prevCellRender=t,e.state.prevCellColum=a),t=ke(e,t),a=Le(e,a),e.state.cellSelection.focusRenderedIndex=t,e.state.cellSelection.focusColumnIndex=a,e.state.cellSelection.focusRowspanInfo=e._getRowspanInfoForCell(ke(e,t),Le(e,a)),e.state.cellSelection.renderedIndexMap[t]=!0,e.state.cellSelection.columnIndexMap[a]=!0,
e.state.cellSelection.rightBoundaryColumnIndex=e.state.cellSelection.focusColumnIndex,e.state.cellSelection.leftBoundaryColumnIndex=e.state.cellSelection.focusColumnIndex,e.state.cellSelection.bottomBoundaryRenderedIndex=e.state.cellSelection.focusRenderedIndex,e.state.cellSelection.topBoundaryRenderedIndex=e.state.cellSelection.focusRenderedIndex}function Oe(e){e.$wrapper.find(".cell-selected").removeClass(Wt)}function Pe(e){if(e.state.cellSelection){for(var t=null,a=null,n=0,r=e.state.cellSelection.dataList.length;n<r;n++){var o=e.state.cellSelection.dataList[n]._index.row;null!=o&&(t=null!=t?Math.min(o,t):o,a=null!=a?Math.max(o,a):o)}for(var l=null,i=null,n=0,r=e.state.cellSelection.columnList.length;n<r;n++){var d=e.state.cellSelection.columnList[n];me(d)&&(l=null==l?d.columnIndex:Math.min(l,d.columnIndex),i=null==i?d.columnIndex:Math.max(i,d.columnIndex))}var s=e.state.cellSelection.focusRenderedIndex,p=e.state.cellSelection.focusColumnIndex;null==s&&(s=t),null==p&&(p=l),s=Math.min(Math.max(t,s),a),p=Math.min(Math.max(l,p),i),Ue(e,t,l,a,i,s,p)}}function Be(e){if(e.state.cellSelection){e.state.cellSelection.rightBoundaryColumnIndex=e.state.cellSelection.focusColumnIndex,e.state.cellSelection.leftBoundaryColumnIndex=e.state.cellSelection.focusColumnIndex,e.state.cellSelection.topBoundaryRenderedIndex=e.state.cellSelection.focusRenderedIndex,e.state.cellSelection.bottomBoundaryRenderedIndex=e.state.cellSelection.focusRenderedIndex,e.state.cellSelection.dataList=[],e.state.cellSelection.columnList=[];for(var t in e.state.cellSelection.renderedIndexMap){var a=parseInt(t);for(var n in e.state.cellSelection.columnIndexMap){var r=parseInt(n);e.state.visibleIndexMapByColumnIndex[r]>=0&&(e.state.cellSelection.rightBoundaryColumnIndex=Math.max(e.state.cellSelection.rightBoundaryColumnIndex,r),e.state.cellSelection.leftBoundaryColumnIndex=Math.min(e.state.cellSelection.leftBoundaryColumnIndex,r),e.state.cellSelection.bottomBoundaryRenderedIndex=Math.max(e.state.cellSelection.bottomBoundaryRenderedIndex,a),e.state.cellSelection.topBoundaryRenderedIndex=Math.max(0,Math.min(e.state.cellSelection.topBoundaryRenderedIndex,a)))}var o=e.state.renderTargetDataList[a];o&&e.state.cellSelection.dataList.push(o)}for(var r=e.state.cellSelection.leftBoundaryColumnIndex,l=e.state.cellSelection.rightBoundaryColumnIndex;r<=l;r++)e.state.visibleIndexMapByColumnIndex[r]>=0&&e.state.cellSelection.columnList.push(e.state.columnIndexToMapping[r])}}function Ge(e){return!!e.state.cellSelection&&e.state.cellSelection.focusColumnIndex<=e.state.fixupto}function He(e){return!!e.state.cellSelection&&e.state.cellSelection.focusRenderedIndex<e.option.rowFixCount}function Ne(e){return!!e.state.cellSelection&&(e.state.cellSelection.leftBoundaryColumnIndex<=e.state.fixupto&&e.state.cellSelection.rightBoundaryColumnIndex>e.state.fixupto)}function $e(e){return!!e.state.cellSelection&&(e.state.cellSelection.topBoundaryRenderedIndex<e.option.rowFixCount&&e.state.cellSelection.bottomBoundaryRenderedIndex>=e.option.rowFixCount)}function Ke(e,t){return t<e.option.rowFixCount}function We(e,t){return t<=e.state.fixupto}function Ue(e,t,a,n,r,o,l){function i(e){return Math.abs(e.state.cellSelection.rightBoundaryColumnIndex-e.state.cellSelection.leftBoundaryColumnIndex)}function d(e){return Math.abs(e.state.cellSelection.topBoundaryRenderedIndex-e.state.cellSelection.bottomBoundaryRenderedIndex)}null!=o&&null!=l?Ae(e,o,l):Ae(e,t,a);for(var s=Math.min(t,n),p=Math.max(t,n),u=Math.min(a,r),c=Math.max(a,r),g=u;g<=c;g++)for(var f=s;f<=p;f++)if(null!=e.state.visibleIndexMapByColumnIndex[g]){var h=ze(e,f,g);"number"==typeof h&&(f=h)}var m=c-u,v=p-s;for(Be(e);m!==i(e)||v!==d(e);)m=i(e),v=d(e),Xe(e),Be(e);Oe(e),Ve(e),nt(e)}function Ve(t){if(t.state.cellSelection&&t.state.refreshbodycell)for(var a=0,n=t.state.refreshbodycell.renderedDataList.length;a<n;a++){var r=t.state.refreshbodycell.renderedDataList[a];if(r){var o=r._index.row;if(!(o<t.state.cellSelection.topBoundaryRenderedIndex||o>t.state.cellSelection.bottomBoundaryRenderedIndex))for(var l=0,i=t.state.refreshbodycell.renderedColumnMappingList.length;l<i;l++){var d=t.state.refreshbodycell.renderedColumnMappingList[l],s=d.columnIndex;if(!(s<t.state.cellSelection.leftBoundaryColumnIndex)&&(!(s>t.state.cellSelection.rightBoundaryColumnIndex)&&t.state.visibleIndexMapByColumnIndex[s]>=0)){var p=e("#"+t._cellIdFromRowIndex(o,s));if(p&&p.length){p.css("color"),p.css("background-color"),At.trimString(p.prop("className").split("cell-selected")[0]);p.addClass("cell-selected");var u=t.state.cellSelection.focusRowspanInfo&&t.state.cellSelection.focusRowspanInfo.from<=o&&t.state.cellSelection.focusRowspanInfo.to>=o,c=t._getColspanUpto(r,s),g=s<=c&&s<=t.state.cellSelection.focusColumnIndex&&t.state.cellSelection.focusColumnIndex<=c;s===t.state.cellSelection.focusColumnIndex&&o===t.state.cellSelection.focusRenderedIndex?p.addClass("cell-selected-focus"):u&&t.state.cellSelection.focusColumnIndex===s?p.addClass("cell-selected-focus"):g&&o===t.state.cellSelection.focusRenderedIndex?p.addClass("cell-selected-focus"):g&&u&&p.addClass("cell-selected-focus"),s===t.state.cellSelection.leftBoundaryColumnIndex&&p.addClass("cell-selected-leftline"),s===t.state.cellSelection.rightBoundaryColumnIndex&&p.addClass("cell-selected-rightline"),o===t.state.cellSelection.topBoundaryRenderedIndex&&p.addClass("cell-selected-topline"),o===t.state.cellSelection.bottomBoundaryRenderedIndex&&p.addClass("cell-selected-bottomline")}}}}}}function Ye(t,a,n,r){var o=null,l=null;if(n.colspan){o=Number(e.isNumeric(n.colspan)?n.colspan:s(n.colspan)?n.colspan(a[n.key],a,n,t._getGroupingRangeByData(a,n)):null)}else{if(!n.colspanTo)return null;l=t.state.visibleIndexMapByColumnIndex[n.columnIndex];var i=s(n.colspanTo)?n.colspanTo(a[n.key],a,n,t._getGroupingRangeByData(a,n)):n.colspanTo;if("string"==typeof i){var d=t.state.visibleIndexMapByKey[i],p=d-l+1;o=p>0?p:null}else{var d=t.state.visibleIndexMapByColumnIndex[i],p=d-l+1;o=p>0?p:null}}if(r){l=l||t.state.visibleIndexMapByColumnIndex[n.columnIndex];var d=t.state.visibleIndexMapByColumnIndex[r],p=d-l+1;o=p>0?Math.min(o,p):null}return l+o>t.state.visibleColumnCount&&(o=t.state.visibleColumnCount-l),o}function Xe(e){for(var t=e.state.cellSelection.topBoundaryRenderedIndex,a=e.state.cellSelection.bottomBoundaryRenderedIndex,n=e.state.cellSelection.leftBoundaryColumnIndex,r=e.state.cellSelection.rightBoundaryColumnIndex,o=n;o<=r;o++)for(var l=t;l<=a;l++)if(e.state.visibleIndexMapByColumnIndex[o]>=0){var i=ze(e,l,o);"number"==typeof i&&(l=i)}}function ze(e,t,a){var n=W(e,a);if(n){e.state.cellSelection.renderedIndexMap[t]=!0,e.state.cellSelection.columnIndexMap[a]=!0;var r=!(!n.rowspan||!e.option.grouping||!0!==e.option.grouping.useGroupRowspan)&&e._getRowspanInfoForCell(t,a);if(r){for(var o=r.from,l=r.to,i=Math.min(l,o,e.state.renderTargetDataList.length-1),d=Math.min(Math.max(l,o),e.state.renderTargetDataList.length-1),s=i;s<=d;s++){e.state.cellSelection.renderedIndexMap[s]=!0;for(var p=e._getRenderedDataFromRenderedIndex(s),u=a;u>=0;u--)if(e.state.visibleIndexMapByColumnIndex[u]>=0){var n=W(e,u);if(n&&me(n)&&(n.colspan||n.colspanTo)){var c=e._getColspanUpto(p,n);if(c&&!(c<a))for(var g=u;g<=c&&g<=e.state.maxColumnIndex;g++)e.state.visibleIndexMapByColumnIndex[g]>=0&&(e.state.cellSelection.columnIndexMap[g]=!0)}}}return d}for(var p=e._getRenderedDataFromRenderedIndex(t),u=a;u>=0;u--){var n=W(e,u);if(n&&(me(n)&&(n.colspan||n.colspanTo))){var c=e._getColspanUpto(p,n);if(c&&!(c<a))for(var g=u;g<=c&&g<=e.state.maxColumnIndex;g++)e.state.cellSelection.columnIndexMap[g]=!0}}}}function je(t,a,n){var r=e("#"+t._cellIdFromRowIndex(a,n));if(r.length)return r;if(t.state.groupRowspanned&&t.option.grouping&&!0===t.option.grouping.useGroupRowspan){var o=W(t,n);if(o&&o.rowspan){var l=t._getRowspanInfoForCell(a,n);if(!l)return null;if(l.from!==a){var i=a-1;return l.from<a&&(i=l.from||0),i===a?null:je(t,i,n)}}}for(var d=t._getRenderedDataFromRenderedIndex(a),s=n;s>=0;s--){var o=W(t,s);if(o){if(!me(o))return;if(n<=t._getColspanUpto(d,o))return n===o.columnIndex?null:je(t,a,o.columnIndex)}}return null}function qe(e){e&&e.option&&(e.$focusfixture.removeAttr("data-alopexgrid-dataindex data-alopexgrid-dataid data-alopexgrid-rowindex"),e.$focusfixture.removeAttr("data-alopexgrid-columnindex"),e.$focusfixture.removeProp("columnIndex"),e.$focusfixture.removeProp("renderedIndex"),e.$focusfixture[0].style.top="-1px",e.$focusfixture[0].style.left="-1px",e.$focusfixture[0].style.height="0.1px",e.$focusfixture[0].style.width="0.1px",e.$focusfixture[0].style.fontSize="0.1px",e.$focusfixture[0].style.lineHeight="0.1px")}function Ze(e,t,a,n){if(e&&e.option){if(!e.option.cellSelectable)return qe(e),void e.$focusfixture.empty();var r={},o={};if(u(t)){var l=e.state.renderTargetDataList[t];r.renderedIndex=t,null!=l._index.data&&(o["data-alopexgrid-dataindex"]=l._index.data),null!=l._index.id&&(o["data-alopexgrid-dataid"]=l._index.id),o["data-alopexgrid-rowindex"]=t}u(a)&&(r.columnIndex=a,o["data-alopexgrid-columnindex"]=a);var i=null!=t&&e.$focusfixture.prop("renderedIndex")!==t||null!=a&&e.$focusfixture.prop("columnIndex")!==a;e.$focusfixture.prop(r).attr(o);var d=e.cellElementGet({_index:{row:t}},a);if(d.length){var s=e.$wrapper.position();e.$focusfixture[0].style.top=s.top+parseInt(d[0].style.top)+parseInt(d[0].style.height)-1+"px",e.$focusfixture[0].style.left=s.left+parseInt(d[0].style.left)+parseInt(d[0].style.width)-1+"px"}if(!0!==n){e.$focusfixture.empty();var p=e.$focusfixture[0];!1===It&&(p.appendChild(document.createTextNode(" ")),J(p,!0))}i&&l&&e._triggerGridEvent("cellFocus",{data:l||null,mapping:e.state.columnIndexToMapping[a]||null},d)}}function Qe(e,t,a){e.state.cellSelection&&(t=ke(e,t),a=Le(e,a),e.state.cellSelection.focusRenderedIndex=t,e.state.cellSelection.focusColumnIndex=a,e.state.cellSelection.focusRowspanInfo=e._getRowspanInfoForCell(e.state.cellSelection.focusRenderedIndex,e.state.cellSelection.focusColumnIndex),ze(e,t,a),Be(e),at(e,e.state.cellSelection.focusRenderedIndex,e.state.cellSelection.focusColumnIndex),Oe(e),Ve(e),setTimeout(function(){Ze(e,t,a)},0))}function Je(e,t,a,n,r){t=ke(e,t),a=Le(e,a),Ae(e,t,a),ze(e,t,a),Be(e),n&&("up"===n?e.state.cellSelection.focusRenderedIndex=e.state.cellSelection.topBoundaryRenderedIndex:"down"===n?e.state.cellSelection.focusRenderedIndex=e.state.cellSelection.bottomBoundaryRenderedIndex:"left"===n?e.state.cellSelection.focusColumnIndex=e.state.cellSelection.leftBoundaryColumnIndex:"right"===n&&(e.state.cellSelection.focusColumnIndex=e.state.cellSelection.rightBoundaryColumnIndex)),e.state.cellSelection.focusRowspanInfo=e._getRowspanInfoForCell(e.state.cellSelection.focusRenderedIndex,e.state.cellSelection.focusColumnIndex),!0!==r&&at(e,e.state.cellSelection.focusRenderedIndex,e.state.cellSelection.focusColumnIndex),Oe(e),Ve(e),setTimeout(function(){e.state.cellSelection&&Ze(e,e.state.cellSelection.focusRenderedIndex,e.state.cellSelection.focusColumnIndex,r)},0)}function et(e,t,a){if(e&&e.state&&e.state.cellSelection){var n=e.state.cellSelection.focusRenderedIndex,r=e.state.cellSelection.focusColumnIndex,o=Te(e),l=n+t,i=e._getRowspanInfoForCell(n,r);t&&i&&(l=(t>0?i.to:i.from)+t);var d=r,s=e._getColspanInfoForCell(n,r);if(a&&(a>0?d=st(e,s?s.to:r,a):a<0&&(d=dt(e,s?s.from:r,-a))),o&&i){e.state.cellSelection.rightBoundaryColumnIndex-e.state.cellSelection.leftBoundaryColumnIndex||e.state.cellSelection.topBoundaryRenderedIndex!=i.from||e.state.cellSelection.bottomBoundaryRenderedIndex!=i.to||(o=!1)}if(o&&s){e.state.cellSelection.bottomBoundaryRenderedIndex-e.state.cellSelection.topBoundaryRenderedIndex||e.state.cellSelection.leftBoundaryColumnIndex!=s.from||e.state.cellSelection.rightBoundaryColumnIndex!=s.to||(o=!1)}o&&i&&s&&e.state.cellSelection.topBoundaryRenderedIndex==i.from&&e.state.cellSelection.bottomBoundaryRenderedIndex==i.to&&e.state.cellSelection.leftBoundaryColumnIndex==s.from&&e.state.cellSelection.rightBoundaryColumnIndex==s.to&&(o=!1),o?(t?(l>e.state.cellSelection.bottomBoundaryRenderedIndex?(l=e.state.cellSelection.topBoundaryRenderedIndex,d=st(e,d,1)):l<e.state.cellSelection.topBoundaryRenderedIndex&&(l=e.state.cellSelection.bottomBoundaryRenderedIndex,d=dt(e,d,1)),d>e.state.cellSelection.rightBoundaryColumnIndex?d=e.state.cellSelection.leftBoundaryColumnIndex:d<e.state.cellSelection.leftBoundaryColumnIndex&&(d=e.state.cellSelection.rightBoundaryColumnIndex)):a&&(d>e.state.cellSelection.rightBoundaryColumnIndex?(d=e.state.cellSelection.leftBoundaryColumnIndex,l++):d<e.state.cellSelection.leftBoundaryColumnIndex&&(d=e.state.cellSelection.rightBoundaryColumnIndex,l--),l>e.state.cellSelection.bottomBoundaryRenderedIndex?l=e.state.cellSelection.topBoundaryRenderedIndex:l<e.state.cellSelection.topBoundaryRenderedIndex&&(l=e.state.cellSelection.bottomBoundaryRenderedIndex)),Qe(e,l,d)):(a>0&&(d===r||null==d)?(d=e.state.visibleColumnMappingList[0].columnIndex,l+=1):a<0&&(d===r||null==d)&&(d=e.state.visibleColumnMappingList[e.state.visibleColumnMappingList.length-1].columnIndex,l-=1),l<0?(l=e.state.renderTargetDataList.length-1,a||(d=dt(e,d,1))!==r&&null!=d||(d=e.state.visibleColumnMappingList[e.state.visibleColumnMappingList.length-1].columnIndex)):l>=e.state.renderTargetDataList.length&&(l=0,a||(d=st(e,d,1))!==r&&null!=d||(d=e.state.visibleColumnMappingList[0].columnIndex)),Je(e,l,d))}}function tt(e,t,a,n,r){var o=e.state.cellSelection.focusRenderedIndex,l=e.state.cellSelection.focusColumnIndex;if(t)if(e.state.cellSelection.focusColumnIndex<e.state.cellSelection.rightBoundaryColumnIndex)delete e.state.cellSelection.columnIndexMap[e.state.cellSelection.rightBoundaryColumnIndex],l=Math.max(0,dt(e,e.state.cellSelection.rightBoundaryColumnIndex,1)),e.state.cellSelection.rightBoundaryColumnIndex=l;else{var i=Math.max(dt(e,e.state.cellSelection.leftBoundaryColumnIndex,1),0);e.state.cellSelection.columnIndexMap[i]=!0,e.state.cellSelection.leftBoundaryColumnIndex=Math.max(0,Math.min(e.state.cellSelection.leftBoundaryColumnIndex,i)),l=i}else if(a)if(e.state.cellSelection.focusColumnIndex>e.state.cellSelection.leftBoundaryColumnIndex)delete e.state.cellSelection.columnIndexMap[e.state.cellSelection.leftBoundaryColumnIndex],l=st(e,e.state.cellSelection.leftBoundaryColumnIndex,1),e.state.cellSelection.leftBoundaryColumnIndex=l;else{var i=Math.min(st(e,e.state.cellSelection.rightBoundaryColumnIndex,1),e.state.maxColumnIndex);e.state.cellSelection.columnIndexMap[i]=!0,e.state.cellSelection.rightBoundaryColumnIndex=Math.min(e.state.maxColumnIndex,Math.max(e.state.cellSelection.rightBoundaryColumnIndex,i)),l=i}else if(n){n=!0===n?1:n;for(var d=e.state.cellSelection.focusRenderedIndex,s=e.state.cellSelection.leftBoundaryColumnIndex;s<=e.state.cellSelection.rightBoundaryColumnIndex;s++){var p=(W(e,s),e._getRowspanInfoForCell(e.state.cellSelection.focusRenderedIndex,s));if(p){var u=p.to-p.from;u&&(d=p.to)}}var c=d<e.state.cellSelection.bottomBoundaryRenderedIndex;if(c){for(var g=Math.max(0,e.state.cellSelection.bottomBoundaryRenderedIndex-n),f=g,s=e.state.cellSelection.leftBoundaryColumnIndex;s<=e.state.cellSelection.rightBoundaryColumnIndex;s++){var p=(W(e,s),e._getRowspanInfoForCell(f,s));p&&p.to-p.from>0&&(g=Math.max(Math.min(g,p.from-1),e.state.cellSelection.focusRenderedIndex))}for(var h=e.state.cellSelection.bottomBoundaryRenderedIndex;h>e.state.cellSelection.focusRenderedIndex&&h>g;h--)delete e.state.cellSelection.renderedIndexMap[h];o=g,e.state.cellSelection.bottomBoundaryRenderedIndex=g}else{for(var m=Math.max(e.state.cellSelection.topBoundaryRenderedIndex-n,0),f=m,s=e.state.cellSelection.leftBoundaryColumnIndex;s<=e.state.cellSelection.rightBoundaryColumnIndex;s++){var p=(W(e,s),e._getRowspanInfoForCell(f,s));p&&p.to-p.from>0&&(m=Math.max(Math.min(m,p.from),0))}for(var h=e.state.cellSelection.topBoundaryRenderedIndex;h>=m&&h>=0;h--)e.state.cellSelection.renderedIndexMap[h]=!0;o=m,e.state.cellSelection.topBoundaryRenderedIndex=m}}else if(r){r=!0===r?1:r;for(var v=e.state.cellSelection.focusRenderedIndex,s=e.state.cellSelection.leftBoundaryColumnIndex;s<=e.state.cellSelection.rightBoundaryColumnIndex;s++){var p=(W(e,s),e._getRowspanInfoForCell(e.state.cellSelection.focusRenderedIndex,s));if(p){var u=p.to-p.from;u&&(v=p.from)}}var c=v>e.state.cellSelection.topBoundaryRenderedIndex;if(c){for(var g=Math.min(e.state.cellSelection.topBoundaryRenderedIndex+r,Math.max(e.state.renderTargetDataList.length-1,0)),f=g,s=e.state.cellSelection.leftBoundaryColumnIndex;s<=e.state.cellSelection.rightBoundaryColumnIndex;s++){var p=(W(e,s),e._getRowspanInfoForCell(f,s));p&&p.to-p.from>0&&(g=Math.min(Math.max(g,p.to+1),e.state.cellSelection.focusRenderedIndex))}for(var h=e.state.cellSelection.topBoundaryRenderedIndex;h<e.state.cellSelection.focusRenderedIndex&&h<g;h++)delete e.state.cellSelection.renderedIndexMap[h];o=g,e.state.cellSelection.topBoundaryRenderedIndex=g}else{for(var m=Math.min(e.state.renderTargetDataList.length-1,e.state.cellSelection.bottomBoundaryRenderedIndex+r),f=m,s=e.state.cellSelection.leftBoundaryColumnIndex;s<=e.state.cellSelection.rightBoundaryColumnIndex;s++){var p=(W(e,s),e._getRowspanInfoForCell(f,s));p&&p.to-p.from>0&&(m=Math.min(Math.max(m,p.to),e.state.renderTargetDataList.length-1))}for(var h=e.state.cellSelection.bottomBoundaryRenderedIndex;h<=m&&h<e.state.renderTargetDataList.length;h++)e.state.cellSelection.renderedIndexMap[h]=!0;o=m,e.state.cellSelection.bottomBoundaryRenderedIndex=m}}Xe(e),Be(e),Oe(e),Ve(e);je(e,o,l);at(e,o,l)}function at(e,t,a,n){var r=(e.state.columnWidthMap,e.state.rowHeight,e.state.wrapperWidth,e.state.wrapperHeight,e.state.renderFromRenderedIndex),o=e.state.renderFromColumnIndex,l=e.state.renderToRenderedIndex,i=e.state.renderToColumnIndex,d=!1,s=!1;if(e.state.fixupto>=0){var p=e.state.refreshbodycell.renderedColumnMappingList,u=e.state.refreshbodycell.renderedFixedColumnMappingList;if(null!=p[u.length]&&(o=p[u.length].columnIndex),e.state.refreshbodycell.scrollEndXOffset<0)for(var c=0,g=0;c>e.state.refreshbodycell.scrollEndXOffset&&p[u.length+ ++g]&&!((c-=e.state.columnWidthMap[p[u.length+g].columnIndex])<=e.state.refreshbodycell.scrollEndXOffset);)o=p[u.length+g].columnIndex;a<=e.state.fixupto&&!0!==n&&(d=!0)}if(e.option.rowFixCount>0){t<e.option.rowFixCount&&!0!==n&&(s=!0);for(var f=e.option.rowFixShowFrom||0;f<e.option.rowFixCount;f++){var h=e.state.renderTargetDataList[f];h&&r++}}else if(e.state.refreshbodycell&&e.state.refreshbodycell.renderedPinnedDataList){t<e.state.refreshbodycell.renderedPinnedDataList.length&&!0!==n&&(s=!0);for(var f=0;f<e.state.refreshbodycell.renderedPinnedDataList.length;f++){var h=e.state.refreshbodycell.renderedPinnedDataList[f];h&&r++}}var m=e.state.visibleIndexMapByColumnIndex,v=!1;if(!d&&e.state.scrollxMoveable)if(a<o)e._scrollLeftEvent(m[o]-m[a],!1),v=!0;else if(e.state.scrollxEnd&&a<=o)e._scrollLeftEvent(m[o]-m[a],!1),v=!0;else if(a>=i){for(var x=e.state.wrapperWidth,y=e.state.fixedColumnWidth,C=a,I=a,_=e.state.columnWidthMap[a];I>=0;){var w=e.state.columnIndexToMapping[--I];if(w&&me(w)){var c=e.state.columnWidthMap[w.columnIndex]||0;if(y+_+c>x)break;_+=c,C=I}}var b=m[C]-m[o];e._scrollRightEvent(b,!1),v=!0}if(e.option.height&&!s&&e.state.scrollyMoveable)if(t<r&&!(t<e.option.rowFixCount))e._scrollUpEvent(r-t,!1),v=!0;else if(e.state.scrollyEnd&&t<=r&&!(t<e.option.rowFixCount))e._scrollUpEvent(r-t,!1),v=!0;else if(t>=l&&!(t<e.option.rowFixCount)){var h=e.state.renderTargetDataList[t],M=Math.min(e.state.renderTargetDataList.length,t);if(h&&e.state.refreshbodycell&&e.state.refreshbodycell.bodyCellPositionY){var S=t-e.state.renderFromRenderedIndex;if(h=e.state.refreshbodycell.renderedDataList[S]){var E=e.state.rowHeightMapByDataId[h._index.id]||e.state.rowHeight,T=e.state.refreshbodycell.bodyCellPositionY[S];E+T>e.state.refreshbodycell.bodyCellEndY&&(e._scrollDownEvent(M-l+1,!1),v=!0)}else e._scrollDownEvent(M-l+1,!1),v=!0}}v&&e._refreshBoard()}function nt(e,t){if(!e.state.cellSelection)return e.$root.trigger("cellSelectionEmpty");for(var a=e.state.cellSelection.topBoundaryRenderedIndex,n=e.state.cellSelection.bottomBoundaryRenderedIndex,r=e.state.cellSelection.leftBoundaryColumnIndex,o=e.state.cellSelection.rightBoundaryColumnIndex,l=[],i=a;i<=n;i++)for(var d=e._getRenderedDataFromRenderedIndex(i),s=r;s<=o;s++){var p=W(e,s);p&&d&&(!d._meta&&p.key&&l.push(d[p.key]),d._meta&&l.push(d[p.columnIndex]))}var u=t||"cellSelectionChange";if(!t&&e.state.cellSelection.lastSelectionEventParam){var c=e.state.cellSelection.lastSelectionEventParam;if(c.fromSelectionRow===a&&c.toSelectionRow===n&&c.fromSelectionColumn===r&&c.toSelectionColumn===o)return}var g={};g.selectionValueList=l,g.fromSelectionRow=a,g.toSelectionRow=n,g.fromSelectionColumn=r,g.toSelectionColumn=o,t||(e.state.cellSelection.lastSelectionEventParam=g),e._triggerGridEvent(u,g)}function rt(t){if(t.state.cellSelection){for(var a="<table>",r=t.state.cellSelection.topBoundaryRenderedIndex,o=t.state.cellSelection.bottomBoundaryRenderedIndex,l=[],i=t.state.cellSelection.leftBoundaryColumnIndex;i<=t.state.cellSelection.rightBoundaryColumnIndex;i++){var s=t.state.columnIndexToMapping[i];s&&me(s)&&l.push(s)}a+="<tbody>";var p=t.state.cellSelection;t.state.cellSelection=null;for(var c=[],g=!(t.option.cellSelectableOption&&t.option.cellSelectableOption.copyCellStyle),f=!(!t.option.cellSelectableOption||!t.option.cellSelectableOption.copyRenderedText),h=t.option.grouping&&t.option.grouping.useGrouping?t.option.grouping.groupRowspanMode:null,m=r;m<=o;m++){var v=t._getRenderedDataFromRenderedIndex(m);if(v){var x=!(!v._state.groupHeader&&!v._state.groupFooter);a+="<tr>";for(var i=0,y=l.length;i<y;i++)if(c[i]=c[i]||0,c[i]>0)c[i]--;else{var s=l[i],C=t._getRowspanInfoForCell(m,s.columnIndex),I=t._getColspanUpto(v,s),_=t._generateCellAttribute(v,s);_.styleclass="cell bodycell "+_.styleclass;var w=v[s.key];if(f||x){var b=document.createElement("div");if(h&&x&&null!=s.rowspan){var M=v,S=t._getGroupingRangeByData(v,s),E=s.rowspan.by||s.rowspan;1==E&&(E=s.key);var T=t.state.groupKeyOrderMap[E];1==h&&S.groupDepth==T||S.groupDepth<T||(M=S.member[0]),w=t._generateCellContent(M,s)}else w=t._generateCellContent(v,s);!1!==w&&t._setCellContent(w,b);var D=e(b);D.find("input").replaceWith(function(){return"text"===this.type?this.value:this}),w=D.text(),D.remove()}var F=0;if(C&&(F=C.to-m+1,c[i]=F-1,_.rowspan=F),I>s.columnIndex){for(var R=1,k=i+1;k<y;k++){var L=l[k];if(L.columnIndex<=I&&R++,L.columnIndex>=I)break}_.colspan=R,i+=R-1}a+="<td";var A=document.createElement("div");if(A.className=_.styleclass,t.$wrapper[0].appendChild(A),wt)var O=n(A);else var O=window.getComputedStyle(A);_.style=(_.style||"")+"background-color:"+O.getPropertyValue("background-color")+";color:"+O.getPropertyValue("color")+";",t.$wrapper[0].removeChild(A),A=null,O=null;for(var P in _){var B=P,G=_[P];if("styleclass"===B)B="class";else if("style"===B){if(g)continue;if(d(G)){G="";for(var H in _[P])G+=H+":"+_[P][H]+";"}}"number"!=typeof G&&"string"!=typeof G||(a+=" "+B+'="'+G+'"')}a+=">",a+=u(w)?String(w).replace(/\n/g,'<br style="mso-data-placement:same-cell;"/>'):"",a+="</td>"}a+="</tr>"}}return t.state.cellSelection=p,a+="</tbody></table>"}}function ot(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}function lt(e,t,a,n){var r=e.state.renderTargetDataList[t],o=e.state.columnIndexToMapping[a];if(!r||!o)return!1;if(r._state.groupFooter||r._state.groupHeader)return!1;if(e.state.testRowAllowPaste){if("boolean"===e.state.testRowAllowPaste&&!1===e.option.rowOption.allowPaste)return!1;if("function"===e.state.testRowAllowPaste&&!1===e.option.rowOption.allowPaste(r))return!1}if(null!=o.allowPaste){if(!1===o.allowPaste)return!1;if("function"==typeof o.allowPaste&&!1===o.allowPaste.call(e,r[o.key],r,o,n))return!1}return!0}function it(t,a){var n=[];if(wt&&(a=a.toLowerCase()),a.indexOf("&lt;table")>=0&&a.indexOf("table&gt;")>=0&&(a=ot(a)),a.indexOf("<table")>=0){a=a.slice(a.indexOf("<table")),a.lastIndexOf("</table>")>=0&&(a=a.slice(0,a.lastIndexOf("</table>"))+"</table>");var r=e(a),o=r.find("tr");o.each(function(e,t){n[e]=[]}),o.each(function(t,a){e(a).children().each(function(e,a){if(a.rowSpan>1)for(var r=t+parseInt(a.rowSpan),o=t+1;o<r;o++)n[o][e]=null;if(a.colSpan>1)for(var l=e+1;l<e+colSpan;l++)n[t][l]=null;null!==n[t][e]&&(n[t][e]=a.innerText||a.textContent)})})}if(!n.length)return!1;if((!t.option.cellSelectableOption||!0!==t.option.cellSelectableOption.disableMultiPaste)&&(t.state.cellSelection.columnList.length>1||t.state.cellSelection.dataList.length>1)&&t.state.cellSelection.columnList.length+t.state.cellSelection.dataList.length>2){var l=n[0].length,i=n.length,d=t.state.cellSelection.columnList.length,s=t.state.cellSelection.dataList.length,p=null,u=null;if(s%i==0&&(p=Math.round(s/i)),d%l==0&&(u=Math.round(d/l)),p>1){for(var c=1;c<p;c++)for(var g=0;g<i;g++){n[i*c+g]=[];for(var f=0;f<l;f++)n[i*c+g][f]=n[g][f]}i*=p}if(u>1)for(var c=1;c<u;c++)for(var g=0;g<i;g++)for(var f=0;f<l;f++)n[g][l*c+f]=n[g][f]}var h=t.state.visibleIndexMapByColumnIndex[t.state.cellSelection.focusColumnIndex];Ae(t,t.state.cellSelection.focusRenderedIndex,t.state.cellSelection.focusColumnIndex);for(var m=0;m<n.length;m++)for(var v=t.state.cellSelection.focusRenderedIndex+m,x=0;x<n[m].length;x++){var y=t.state.visibleColumnMappingList[h+x];if(y){var C=y.columnIndex,I=n[m][x];if(ze(t,v,C),void 0!==I&&null!==I){if(!1===lt(t,v,C,I))continue;t.cellEdit(I,{_index:{row:v}},C)}}}return t._refreshBoard(!0),Be(t),Oe(t),Ve(t),nt(t),!0}function dt(e,t,a){var n=e.state.visibleIndexMapByColumnIndex[t];return a=a||1,null!=e.state.visibleColumnMappingList[n-a]?e.state.visibleColumnMappingList[Math.max(n-a,0)].columnIndex:null}function st(e,t,a){var n=e.state.visibleIndexMapByColumnIndex[t];return a=a||1,null!=e.state.visibleColumnMappingList[n+a]?e.state.visibleColumnMappingList[Math.min(n+a,e.state.visibleColumnCount-1)].columnIndex:null}function pt(t){return e(t).data(At.KEY_NAME)}window.__AlopexGridBuildVersion__="3.11.17";var ut=window.__AlopexGridMajorVersion__||"3",ct=window.__AlopexGridClassRoot__||"alopexgrid",gt=window.__AlopexGridExportName__||"AlopexGrid",ft=window.__AlopexGridJQueryExportName__||"alopexGrid",ht=window.__AlopexGridRemoveJQueryExportName__||"removeAlopexGrid",mt=window.__AlopexGridUniqueKeyPrefix__||"alopexgrid",vt=window.__AlopexGridAlopexUISetupName__||"grid";if(String("3.11.17").toLowerCase().indexOf("-dev")>=0&&console&&(console.error||console.log)){var xt="[Warning] This is a development version of the AlopexGrid('".toUpperCase()+"3.11.17"+"'), and should not be used on production systems. ".toUpperCase()+"CLIENT DATE : "+new Date;try{console.error?console.error(xt):console.log&&console.log(xt)}catch(e){}}var yt=e(window),Ct=e(document),It=function(){var e={Android:function(){return!!navigator.userAgent.match(/Android/i)},BlackBerry:function(){return!!navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return!!navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return!!navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return!!navigator.userAgent.match(/IEMobile/i)||!!navigator.userAgent.match(/WPDesktop/i)},any:function(){return e.Android()||e.BlackBerry()||e.iOS()||e.Opera()||e.Windows()}};return e.any()}(),_t=function(){return{iOS:function(){return!!navigator.userAgent.match(/iPhone|iPad|iPod/i)}}.iOS()}(),wt=function(){var e=document.createElement("div");return e.innerHTML="\x3c!--[if lt IE 9]><i></i><![endif]--\x3e",1==e.getElementsByTagName("i").length}(),bt=function(){for(var e=3,t=document.createElement("b"),a=t.all||[];t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i><![endif]--\x3e",a[0];);return Math.min(e>4?e:document.documentMode,document.documentMode)||/Edge/.test(navigator.userAgent)||!1}();wt&&(Date.now||(Date.now=function(){return(new Date).getTime()}));var Mt=mt,St=parseInt,Et=Number(Math.random().toString().split(".").pop().slice(-3));e.event&&e.event.props&&e.event.props.push&&(e.inArray("dataTransfer",e.event.props)<0&&e.event.props.push("dataTransfer"),e.inArray("clipboardData",e.event.props)<0&&e.event.props.push("clipboardData"),e.inArray("alopexgrid",e.event.props)<0&&e.event.props.push("alopexgrid"));var Tt=Object.prototype.toString.call({}),Dt=/(\/\/.*$)|(\/\*[\s\S]*?\*\/)|(\s*=[^,\)]*(('(?:\\'|[^'\r\n])*')|("(?:\\"|[^"\r\n])*"))|(\s*=[^,\)]*))/gm,Ft=/([^\s,]+)/g,Rt=window[h(["88sc","ne8hcaq"].join(2))],kt=!1,Lt=!1;Ct.on("gridInit",function(){return w()});var At=function(t,n){var r=this==window?{}:this,i=pt(t);if(u(w()||p())){if(i)return r.updateOption(n),r;r.$root=e(t),r.root=r.$root.get(0);var c=At.trimString(String(r.root.tagName).toLowerCase());if("div"!==c)throw delete r.$root,delete r.root,new Error("[AlopexGrid] AlopexGrid cannot be created on <"+c+"> element. A <div> element should be used.");if(!1===r._triggerGridEvent("gridInit",{element:t,option:n},t))return null;At.commonOption.preConstructor&&s(At.commonOption.preConstructor)&&At.commonOption.preConstructor.call(r,e(t),n);var g=o();if(r.key=g,r.eventns="."+r.key+"t"+Math.random().toString().slice(-5).split(".").join(""),r.unique=l(),r.serial=At.serial++,r.version=At.version,r.state={progressStack:0,data:[],renderTargetDataList:[],deletedData:[],footerData:{},sortingInfoKeyMap:{},refreshTimer:{},viewUpdate:{},cellCache:{},cellCacheHelper:{padDataList:[],padDataIdOnQueue:[],cacheDataList:[]},columnFitWidthById:{},ctrlDataIndexMap:{}},D(r,n)){var f=null;if(n&&n.extend){f={};var h=n.extend;e.isArray(h)||(h=[h]);for(var m=0,v=h.length;m<v;m++){var x=At.commonOption.definition[h[m]];d(x)&&e.extend(!0,f,x)}}r.option=e.extend(!0,{},At.defaultOption,At.commonOption,f)}return e(t).data(At.KEY_NAME,r).attr("data-alopexgrid",g),r.viewInit(),r.$title=r.$root.find(">.title"),r.$titlelabel=r.$title.children(".title-label"),r.$titleMarkup=r.$title.children(".title-markuparea"),r.$titleFolding=r.$title.children(".table-toggle"),r.$columnhiddenarea=r.$root.find(">.columnhiddenarea"),r.$pager=r.$root.find(">.pager"),r.$pagerleft=r.$pager.find(".pager-left"),r.$pagerright=r.$pager.find(".pager-right"),r.$pagercenter=r.$pager.find(".pager-center"),r.$wrapper=r.$root.find(".wrapper"),r.$focusfixture=r.$root.find(".fixed-focus-catch"),r.$scrollbarx=e('<div class="scrollbar x"></div>').appendTo(r.$wrapper).data("alopexGridScrollbarElement","x"),r.$scrollbarLeftButton=e('<div class="scrollbutton leftbutton">').appendTo(r.$scrollbarx).data("alopexGridScrollbarElement","x"),r.$scrollbarRightButton=e('<div class="scrollbutton rightbutton">').appendTo(r.$scrollbarx).data("alopexGridScrollbarElement","x"),r.$horizontalScrollHandle=e('<div class="scrollhandle">').appendTo(r.$scrollbarx).data("alopexGridScrollbarElement","x"),r.$scrollbary=e('<div class="scrollbar y"></div>').appendTo(r.$wrapper).data("alopexGridScrollbarElement","y"),r.$scrollbarUpButton=e('<div class="scrollbutton upbutton">').appendTo(r.$scrollbary).data("alopexGridScrollbarElement","y"),r.$scrollbarDownButton=e('<div class="scrollbutton downbutton">').appendTo(r.$scrollbary).data("alopexGridScrollbarElement","y"),r.$verticalScrollHandle=e('<div class="scrollhandle">').appendTo(r.$scrollbary).data("alopexGridScrollbarElement","y"),wt?(r.state.bodyCellList=a(r.$wrapper[0],"bodycell"),r.state.nodataCellList=a(r.$wrapper[0],"nodatacell"),r.state.headerCellList=a(r.$wrapper[0],"headercell"),r.state.footerCellList=a(r.$wrapper[0],"footercell"),r.state.paginationList=function(){return r.$pager[0].querySelectorAll(".pagination")}):(r.state.bodyCellList=r.$wrapper[0].getElementsByClassName("bodycell"),r.state.nodataCellList=r.$wrapper[0].getElementsByClassName("nodatacell"),r.state.headerCellList=r.$wrapper[0].getElementsByClassName("headercell"),r.state.footerCellList=r.$wrapper[0].getElementsByClassName("footercell"),r.state.paginationList=r.$pager[0].getElementsByClassName("pagination")),r.updateOption(n),r.state.loaded=!0,At.instances[g]=r,
At.commonOption.postConstructor&&s(At.commonOption.postConstructor)&&At.commonOption.postConstructor.call(r,r.$root,r.option),r._triggerGridEvent("gridInitEnd",{element:r.$root.get(0),option:r.option}),r}};e.extend(At,{version:ut,release:"3.11.17"}),e.extend(!0,At,{KEY_NAME:o(),serial:0,instances:{},markup:{child:[{tag:"div",attr:{styleclass:"title"},child:[{tag:"div",attr:{styleclass:"title-label"},child:""},{tag:"div",attr:{styleclass:"table-toggle"},child:""},{tag:"div",attr:{styleclass:"title-markuparea"},child:""}]},{tag:"div",attr:{styleclass:"columnhiddenarea","data-alopexgrid-columnhiddenarea":!0},child:[{tag:"div",attr:{styleclass:"columnhiddenarea-label"},child:""}]},{tag:"div",attr:{styleclass:"wrapper",style:"width:100%;"},child:""},{tag:"div",attr:{contentEditable:"true",style:"position:absolute;left:-1px;top:-1px;width:0.1px;height:0.1px;outline:none;padding:0;margin:0;border:none;overflow:hidden;color:transparent;text-shadow:0 0 0 #000;opacity:0;filter:Alpha(opacity=0);",styleclass:"fixed-focus-catch focus"}},{tag:"div",attr:{styleclass:"pager alopexgrid-pager",style:"position:relative;"},child:[{tag:"div",attr:{styleclass:"pager-left",style:""},child:""},{tag:"div",attr:{styleclass:"pager-center"},child:[{tag:"div",attr:{styleclass:"pagination first-page page-button","data-to-page":"first"}},{tag:"div",attr:{styleclass:"pagination prev-page page-button","data-to-page":"prev"}},{tag:"ul",attr:{styleclass:"pagination page-list","data-to-page":"list"}},{tag:"div",attr:{styleclass:"pagination next-page page-button","data-to-page":"next"}},{tag:"div",attr:{styleclass:"pagination last-page page-button","data-to-page":"last"}}]},{tag:"div",attr:{styleclass:"pager-right",style:""},child:""}]}]}}),e.extend(!0,At,{plugin:[],addPlugin:function(e){s(e)&&(At.removePlugin(e),At.plugin.push(e))},removePlugin:function(e){for(var t=At.plugin.length-1;t>=0;)At.plugin[t]===e&&At.plugin.splice(t,1),t--}}),e.extend(!0,At,{commonOption:{definition:{},preConstructor:null,postConstructor:null},defaultOption:{width:null,height:null,header:!0,headerGroup:[],title:!1,titleMarkup:null,hideGridFoldingButton:!1,data:[],pager:!1,paging:{current:null,dataLength:null,rowCount:null,enabled:!0,pageDataLength:null,pageRowCount:null,pagerCount:null,pagerSelect:null,pagerTotal:null,hidePageList:!1,perPage:null,total:null,enabledByPager:!1,countGroupSummary:!1,pageMoveTempo:null},defaultColumnMapping:{width:100,tooltip:!0,exportRender:!0},autoColumnIndex:!1,columnMapping:[],rowOption:{highlight:null,styleclass:null,allowSelect:null,allowPaste:null,allowEdit:null,defaultHeight:null,nodataRowHeight:null,inlineStyle:null,filter:null},footer:{position:null,footerMapping:[],usePageData:!1,autoColspan:!1},headerRowHeight:null,footerRowHeight:null,filteringHeaderHeight:null,on:{cell:{},headercell:{}},autoResize:!0,autoResizeDelay:200,hiddenColumnArea:!1,message:{nodata:null,valueFilter:null,pagerTotal:null,filterNodata:null,noFilteredData:null},rowSelectOption:{clickSelect:!1,singleSelect:!1,allowSingleUnselect:!0,disableSelectByKey:!1,radioColumn:!1,groupSelect:!0},cellRefreshOnRowSelect:!1,disableTextSelection:!1,disableCellSelectionRestore:!1,rowspanGroupEdit:!0,useColumnRowspan:!1,progressDelay:null,progressText:null,progressStyleclass:null,absoluteProgressPosition:!1,numberingColumnFromZero:!0,rowindexColumnFromZero:!0,defaultState:{dataAdd:{},dataSet:{}},eventMapping:{},disableCellRenderedEvent:!1,renderMapping:{},renderRuleOption:{textKey:"text",valueKey:"value",htmlKey:"html",checkedKey:"checked"},valueFilter:null,flushCallback:null,hideSortingHandle:!1,disableHeaderClickSorting:!1,disableHeaderTitleAttribute:!1,disableSortClearOnReset:!1,getEditingDataOnEvent:!0,fitTableWidth:!1,wrapCellContent:!1,directEdit:!1,ellipsisText:!1,autoSortingType:!1,clientSortingOnDynamicDataSet:!0,sortingNullNumberPosition:"bottom",sortingNullStringPosition:null,disableFocusedState:!1,rowspanGroupFocus:!1,editableNameWithKey:!1,parseValueOnStartEdit:!1,mergeEditingImmediately:!1,fullCompareForEditedState:!1,disableMultiMappingGet:!1,grouping:{by:[],useGroupHeader:!1,useGroupFooter:!1,useGroupRowspan:!1,useGrouping:!1,useGroupRearrange:!1,summaryRender:{sum:function(e){return At.i18n("sum")+" : "+e},count:function(e){return At.i18n("count")+" : "+e},groupName:function(e){return e},average:function(e){return At.i18n("average")+" :"+e}},useGroupColumnRearrange:!1,useDragDropBetweenGroups:!1,groupFoldingColumnPosition:"right",showGroupSummaryOnly:!1,foldedGroupHeader:null,foldedGroupFooter:null,groupRowspanMode:0,sortingPriority:[]},enableHeaderSelect:!1,filteringHeader:!1,filter:{closeFilter:{removeButton:!0,applyButton:!0,outerClick:!0},dataFilterInstant:!1,filterGridOption:{},filterGridColumnOption:{selectColumn:{},contentColumn:{}},minHeight:200,minWidth:250,movable:!1,nullValueText:null,removeFilterOptionByHidden:!1,saveFilterSize:!1,scrollResetAfterFilter:!0,sorting:!1,textFilterByEnter:!1,textFilterDelay:450,title:!1,typeList:["equal","notequal","contain","notcontain","lt","lte","gt","gte"],typeListDefault:{selectValue:"",expandSelectValue:"",radioValue:"and"}},columnFixUpto:null,rowFixCount:0,columnFixShowFrom:null,rowFixShowFrom:null,disableScrolledFix:!1,disableFoldingInEditingCell:!1,cellSelectable:!1,cellSelectableOption:{copyCellStyle:!0,copyRenderedText:!1,copyTextformOnly:!1,detectTSV:!1,useMinPageUpDownScroll:!1,ignoreVerticalScrollMoveTempo:!1,disableMultiPaste:!1},disableCellFocusAtInput:!1,endInlineEditByOuterClick:!1,rowInlineEdit:!1,rowInlineEditOption:{startEvent:"dblclick",endAllEditing:!1,endEditByEnter:!0,disableEvent:!1},cellInlineEdit:!1,cellInlineEditOption:{startEvent:"dblclick",focusMoveAtEditEnd:!0,allowStartEditWithInvalid:!0,cancelAllByEsc:!1,endEditByOtherAreaClick:!0},restoreFocusOnInvalidInlineEdit:!1,cellPopupEdit:!1,cellPopupEditOption:{closeOuterClick:!0,height:300,width:350,minHeight:100,minWidth:120,movable:!0,savePopupSize:!0,startEvent:"dblclick",title:!0},instantInlineEditType:["radio","checkbox","select"],defaultInstantInlineEdit:null,forceRefreshAllOnCellEdit:!1,forceRefreshAllOnDataEdit:!1,refreshByOnHiddenColumn:!1,useClassHovering:!1,rowspanGroupHovering:!1,enlargeOption:{closeButtonMarkup:"X"},enableDefaultContextMenu:!0,enableContextMenu:!0,contextMenuEvent:"contextmenu",defaultContextMenu:[{title:function(e,t,a){return At.i18n("freezePanes")},processor:function(e,t,a){var n=parseInt(t.attr("data-alopexgrid-columnindex")),r={};r.columnFixUpto=n-1,r.columnFixShowFrom=a.state.renderFromColumnIndex,e&&(r.rowFixCount=e._index.row,r.rowFixShowFrom=Math.max(a.option.rowFixShowFrom||0,a.state.renderFromRenderedIndex)),a.updateOption(r)},use:function(e,t){return!(!t.hasClass("bodycell")||t.hasClass("summarycell"))}},{title:function(e,t,a){return At.i18n("freezePanesRow")},processor:function(e,t,a){for(var n=0;n<a.option.columnMapping.length;n++)a.option.columnMapping[n].fixed=!1;var r={columnFixUpto:"unfix",columnFixShowFrom:null,rowFixCount:e._index.row,rowFixShowFrom:Math.max(a.option.rowFixShowFrom||0,a.state.renderFromRenderedIndex)};a.updateOption(r)},use:function(e,t){return!(!e||!t.hasClass("bodycell")||t.hasClass("summarycell"))}},{title:function(e,t,a){return At.i18n("freezePanes")},processor:function(e,t,a){a.rowUnfix();var n=parseInt(t.attr("data-alopexgrid-columnindex"));a.updateOption({columnFixUpto:n-1,columnFixShowFrom:a.state.renderFromColumnIndex})},use:function(t,a,n){return!(!a.hasClass("headercell")||!e.isNumeric(a.attr("data-alopexgrid-columnindex")))}},{title:function(e,t,a){return At.i18n("freezeCancel")},processor:function(e,t,a){a.updateOption({columnFixUpto:"unfix",columnFixShowFrom:null,rowFixCount:0,rowFixShowFrom:null})},use:function(e,t,a){return!0}},{title:function(e,t,a){return At.i18n("addRow")},processor:function(t,a,n){var r=e.extend(!0,{},n.state.emptyData),o=parseInt(a.attr("data-alopexgrid-rowindex")),l=t._index.data;if(t._meta){for(;t._meta&&t;)t=n._getRenderedDataFromRenderedIndex(--o);l=t._index.data+1}if(t){if(n.option.grouping&&n.option.grouping.by&&n.option.grouping.useGrouping)for(var i=0;i<n.option.grouping.by.length;i++){var d=n.option.grouping.by[i];"string"==typeof d&&(r[d]=t[d])}if(n.option.tree&&n.option.tree.useTree){var s=n.treeGetParent(t);s&&s.length&&(r[n.option.tree.parentIdKey]=s[0][n.option.tree.idKey])}n.showProgress(function(){n.dataAdd(r,{_index:{data:l}})})}},use:function(t,a,n){return a.hasClass("bodycell")&&e.isNumeric(a.attr("data-alopexgrid-rowindex"))}},{title:function(e,t,a){return At.i18n("enlarge")},processor:function(e,t,a){a.enlargeStart()},use:function(e,t,a){return!a.state.isZoomed}},{title:function(e,t,a){return At.i18n("enlargeExit")},processor:function(e,t,a){a.enlargeExit()},use:function(e,t,a){return!!a.state.isZoomed}},{title:function(e,t,a){return At.i18n("removeFilter")},processor:function(e,t,a){a.clearFilter(!1)},use:function(e,t,a){return t.hasClass("headercell")||t.hasClass("filtercell")}}],contextMenu:[],contextMenuTitleMapper:null,alwaysShowVerticalScrollBar:!1,alwaysShowHorizontalScrollBar:!1,extendStateOnSet:!0,extendStateOnAdd:!0,fillUndefinedKey:!1,trimUnmappedKey:!1,readonlyRender:!0,disableCellTitle:!1,disableValueEscape:!1,enableHeaderGroupResizing:!0,setOriginalFromStart:!1,deepCopyOnDataGet:!1,enableDataGetAllByEmptyArray:!1,optionMergeLegacyMode:!1,sortClearOnEdit:!1,disableTreeEdit:!1,tree:{useTree:!1,idKey:null,parentIdKey:null,leftKey:null,rightKey:null,leafKey:null,depthKey:null,expandedKey:null,leafValue:["true","false"],expandedValue:["true","false"],depthValueType:"string",depthStartValue:0,rootNodeParentIdValue:"",initialIdValue:"0",idGenerator:null,initialExpandedValue:!0,dragdropExpandDelay:1200},importMapping:{},excelWorker:{exportOption:{},importOption:{}},lazyScroll:{enabled:!1,refreshDelay:400},scrollbarPreview:{enabled:!1,column:"default",row:"default",rowDefaultFromZero:!0,closeDelay:1500},cellCache:{enabled:!1,timerInterval:1,columnRange:"full",policy:"distant",capacity:100,padRatio:1.5,mode:"pad"},useScrollAcceleration:!0,useFrameSyncScroll:!0,preventScrollPropagation:!1,proxyRatio:{row:{height:1,width:.5},column:{height:1,width:1}},hiddenColumnOrderList:[],enableDropData:!0,searchOption:{filterName:null,useFilter:!1,useRenderToSearch:!0,caseSensitive:!1,ignoreWhiteSpace:!1,useRegex:!1,byColumn:!1,showProgress:!1},useContinuousXScroll:!1,useContinuousYScroll:!1}}),At.__compatMap={cellInlineEditOption:{startEvent:["cellInlineEditStartEvent","dblclick"],focusMoveAtEditEnd:["cellInlineEditEndFocusMove",!0],allowStartEditWithInvalid:["allowStartCellInlineEditWithInvalid",!0],endEditByOtherAreaClick:["cellInlineEditEndOtherThanBodycell",!0]},rowInlineEditOption:{startEvent:["rowInlineEditStartEvent","dblclick"],endAllEditing:["rowInlineEditEndAll",!1],endEditByEnter:["disableRowInlineEditEnterEnd",!1,function(e){return!e}],disableEvent:["disableRowInlineEditEvent",!1]},rowSelectOption:{clickSelect:["rowClickSelect",!1],singleSelect:["rowSingleSelect",!1],allowSingleUnselect:["rowSingleSelectAllowUnselect",!0],disableSelectByKey:["disableRowSelectByKey",!1],radioColumn:["singleSelectorColumnWithRadio",!1],groupSelect:["rowspanGroupSelect",!0]}},At.__compatOldOptionMap={},e.each(At.__compatMap,function(t,a){e.each(a,function(e,a){var n=a[0],r={};r.moduleName=t,r.newOptionName=e,r.compatMap=a,At.__compatOldOptionMap[n]=r})}),At.prototype.readOption=function(){return this.option};var Ot=!!Array.prototype.map;At.aggregateFunction={primitive:Ot?function(e,t){return e.map(function(e){return null==e?e:"object"==typeof e&&t?e[t]:e})}:function(e,t){for(var a=[],n=0,r=e.length;n<r;n++){var o=e[n];null==o?a.push[o]:"object"==typeof o?t&&a.push(o[t]):a.push(o)}return a},sum:function(e){for(var t=0,a=0,n=e.length-1;n>=0;n--)e[n]&&(t+=Number(e[n])||0,a=g(a,(String(e[n]).split(".")[1]||"").length));return At.renderUtil.addCommas(parseFloat(t).toFixed(a))},average:function(e){for(var t=0,a=0,n=e.length-1;n>=0;n--)e[n]&&(t+=Number(e[n])||0,a=g(a,(String(e[n]).split(".")[1]||"").length));return At.renderUtil.addCommas(parseFloat(t/e.length).toFixed(Math.max(a,2)))},stdev:function(e){for(var t=0,a=0,n=e.length-1;n>=0;n--)isNaN(Number(e[n]))||(a+=Number(e[n]),t+=Number(e[n])*Number(e[n]));var r=e.length?Math.sqrt(t/e.length-a/e.length*(a/e.length)):0;return At.renderUtil.addCommas(parseFloat(r).toFixed(2))},count:function(e){return e.length||0},countif:function(e){for(var t=0,a=e.length-1;a>=0;a--)e[a]===paramArray[0]&&t++;return At.renderUtil.addCommas(t)},min:function(e){for(var t=Number(e[e.length-1])||0,a=0,n=e.length-1;n>=0;n--)t=Math.min(t,Number(e[n])||0),a=g(a,(String(e[n]).split(".")[1]||"").length);return At.renderUtil.addCommas(parseFloat(t).toFixed(a))},max:function(e){for(var t=Number(e[e.length-1])||0,a=0,n=e.length-1;n>=0;n--)t=Math.max(t,Number(e[n])||0),a=g(a,(String(e[n]).split(".")[1]||"").length);return At.renderUtil.addCommas(parseFloat(t).toFixed(a))}},e.extend(!0,At,{trimObject:function(t,a){var n=e.extend({},t);if(a){var r=t._state;n._state={},n._state.added=r.added,n._state.deleted=r.deleted,n._state.edited=r.edited,n._state.selected=r.selected}else delete n._state;return delete n._index,delete n._edited,delete n._invalid,delete n._key,delete n._column,delete n._original,n},trimData:function(t,a){if(a=a||At.commonOption.preserveStateOnTrim||null,e.isArray(t)){for(var n=[],r=0,o=t.length;r<o;r++)d(t[r])&&n.push(At.trimObject(t[r],a));return n}return At.trimObject(t,a)},trimString:String.prototype.trim?function(e){return null==e?"":e.toString().trim()}:function(t){return e.trim(t)},parseEvent:function(t){if(t.alopexgrid||null!=t.originalEvent&&t.originalEvent.alopexgrid)return t.alopexgrid||t.originalEvent.alopexgrid;var a=e(t.target),n=a.closest(".alopexgrid-cell"),r=null,o=null,l=null,i="."+ct.split(" ").join(".");if(r=a.closest(i),!r.length&&t.delegateTarget){var d=e(t.delegateTarget).closest(i);d.length&&(r=d)}if(!r.length&&t.currentTarget){var s=e(t.currentTarget).closest(i);s.length&&(r=s)}var p=pt(r);if(!r.length&&n.length){var u=n.attr("data-alopexgrid-root");p=At.instances[u],p&&(r=p.$root)}if(!n.length&&(o=a.closest("[data-alopexgrid-inscribe]"),o.length&&(l=o.attr("data-alopexgrid-inscribe").split(","),!p))){var u=l[0];p=At.instances[u],p&&(r=p.$root)}var c={bodycell:!1,headercell:!1,footercell:!1};c.$grid=r;var g=null,f=null,h=!1;if(n.length)g=n.attr("data-alopexgrid-dataindex"),f=n.attr("data-alopexgrid-columnindex"),c.$cell=n;else if(l){g=p.state.dataIdToIndexMap[l[1]],f=parseInt(l[2]);var m=p.state.data[g];rowIndex=m?m._index.row:null,n=null!=rowIndex?r.find("#"+p._cellIdFromRowIndex(rowIndex,f)):r.find("#"+p.key+"-h-"+parseInt(l[3])+"-"+f),c.$cell=n}n.length&&(At.renderUtil.hasClass(n[0],"bodycell")?(c.bodycell=!0,h=!0):At.renderUtil.hasClass(n[0],"headercell")?(c.headercell=!0,h=!0):At.renderUtil.hasClass(n[0],"footercell")&&(c.footercell=!0,h=!0));var v=p?p.state.data[g]||null:null,x=p?p.state.columnIndexToMapping[f]||null:null;return null!==x&&void 0!==x&&(c.mapping=x,v||(v={}),v._key=x.key,v._column=x.columnIndex,!isNaN(x.columnIndex)&&x.columnIndex>=0&&null!==v&&void 0!==v&&null!==v._index&&void 0!==v._index&&(v._index.column=x.columnIndex)),null!==v&&void 0!==v&&(c.data=v),h||(v&&v._index&&v._index.id&&x&&null!=x.columnIndex?c.bodycell=!0:v&&!v._index&&x&&null!=x.id&&(n&&n.length?At.renderUtil.hasClass(n[0],"footercell")?c.footercell=!0:At.renderUtil.hasClass(n[0],"headercell")&&(c.headercell=!0):l&&null!=l[3]&&(c.headercell=!0))),c},currentData:function(t){if(!t)return null;if(e.isArray(t)){for(var a=[],n=0,r=t.length;n<r;n++){var o=At.currentData(t[n]);o&&a.push(o)}return a}var l=At.instances[t._index.grid],i={};for(var d in t)t.hasOwnProperty(d)&&95!==d.charCodeAt(0)&&(i[d]=t[d]);if(t._index&&(i._index=t._index),t._state&&(i._state=t._state,t._state.editing))for(var s in t._state.editing){var d=l.state.columnIndexToKeyMap[s];i[d]=t._state.editing[s]}return i},currentValue:function(e,t){if(!e||!t)return null;var a=At.instances[e._index.grid],n=e[t];if(e._state.editing){var r=a.state.columnKeyToIndexMap[t];void 0!==r&&e._state.editing.hasOwnProperty(r)&&(n=e._state.editing[r])}return n},escapeHTML:function(e){return At.renderUtil.escapeHTMLString(e)},generateKey:o}),At.regex={inputControls:/^(?:input|select|textarea|button)$/i,caretAvailableType:/^(?:text|search|url|tel|password)$/i},At.setup=function(e){e&&d(e)&&(At.commonOption=E(At.commonOption||{definition:{},preConstructor:null,postConstructor:null},e))},At.clearSetup=function(){delete At.commonOption,At.commonOption={definition:{},preConstructor:null,postConstructor:null}},At.define=function(e,t){if("string"==typeof e&&void 0!==t)At.commonOption.definition[e]=t;else if(e&&d(e))for(k in e)if(e.hasOwnProperty(k)){var a=e[k];"string"==typeof k&&void 0!==a&&(At.commonOption.definition[k]=a)}},At.undefine=function(e){delete At.commonOption.definition[e]},At.undefineAll=function(){delete At.commonOption.definition,At.commonOption.definition={}},At.definition=function(e){return At.commonOption.definition[e]},At.run=function(e,t){var a=At.instances[e];if(a){var n=Array.prototype.slice.call(arguments,2);return a[t].apply(a,n)}};var Pt="classList"in document.createElement("_"),Bt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"," ":"&nbsp;"},Gt=function(){try{if(!e||!e.fn||"function"!=typeof e.fn.empty)return!1;var t=document.createElement("div");t.className="div";var a=document.createElement("span");t.appendChild(a),a.appendChild(document.createTextNode("span")),t.appendChild(document.createTextNode("div"));var n=e(t).data("element","12"),r=e(a).data("element","25");if(n.append("<h1>grid</h1>"),e(t).on("click",function(e){return!1}),e.fn.empty.call([t]),e.fn.remove.call([t]),t.firstChild)return!1;if(n.data("element"))return!1;if(r.data("element"))return!1}catch(e){return!1}return!0}();At.renderUtil={escapeHTMLString:function(e){return R(e)},addCommas:function(e){var t=String(e).split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")},renderRuleToArray:function(e,t,a,n,r){if(!a.rule)return null;var o=a.rule;return s(a.rule)&&(o=a.rule(e,t,a,n,r)),o},normalizeRuleObject:function(e,t){var a=e;if(e&&"object"==typeof e){a={};for(var n in e)a[t.state.renderRuleKeyNormalizeMap[n]||n]=e[n]}return a},getTextFromRenderRuleArray:function(t,a,n,r,o){var l=t,i=At.renderUtil.renderRuleToArray(t,a,n,r,o);if(i&&e.isArray(i))for(var d=0,s=i.length;d<s;d++){var p=At.renderUtil.normalizeRuleObject(i[d],o);if(p&&p.value===t)if(p.hasOwnProperty("text"))l=p.text;else if(p.hasOwnProperty("html")){var u=document.createElement("span");u.innerHTML=p.html,l=e.text(u)}}return l},addThousandsSeperator:function(e,t){var a=String(e).split(".");return a[0]=a[0].replace(/\B(?=(\d{3})+(?!\d))/g,t||","),a.join(".")},attributeToElement:function(e,t){if(e&&"object"==typeof e&&t&&t.nodeType)for(var a in e)t.setAttribute(a,e[a])},defaultRendererClass:"alopexgrid-default-renderer",defaultInputWrapperClass:"alopexgrid-input-*-wrapper",addDefaultRendererClass:function(e){e.className=(e.className?e.className+" ":"")+At.renderUtil.defaultRendererClass},addDefaultInputWrapperClass:function(e,t){e.className=(e.className?e.className+" ":"")+"alopexgrid-input-wrapper "+At.renderUtil.defaultInputWrapperClass.replace("*",t||"text")},hasDefaultInputWrapperClass:function(e){return At.renderUtil.hasClass(e,"alopexgrid-input-wrapper")},generateHTMLString:function(t){var a="";if(e.isArray(t)){for(var n=0,r=t.length;n<r;n++)a+=At.renderUtil.generateHTMLString(t[n]);return a}if(!t||!t.tag&&!t.child)return t||"";if(t.tag){if(a+="<"+t.tag,t.attr)for(var o in t.attr){var l=o;"styleclass"==o&&(l="class"),a+=" "+l+'="'+t.attr[o]+'"'}a+=">"}if(e.isArray(t.child))for(var n=0,r=t.child.length;n<r;n++)a+=At.renderUtil.generateHTMLString(t.child[n]);else t.child&&(a+=At.renderUtil.generateHTMLString(t.child));return t.tag&&(a+="</"+t.tag+">"),a},hasClass:Pt?function(e,t){return e.classList.contains(t)}:function(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")>-1},addClass:Pt?function(e,t){e.classList.add(t)}:function(e,t){At.renderUtil.hasClass(e,t)||(e.className+=(e.className?" ":"")+t)},removeClass:Pt?function(e,t){e.classList.remove(t)}:function(e,t){At.renderUtil.hasClass(e,t)&&(e.className=e.className.replace(new RegExp("(\\s|^)"+t+"(\\s|$)")," "))},emptyElement:Gt?function(t){e.fn.empty.call([t])}:function(t){e(t).empty()},setElementContent:function(e,t){if(!e)return null;At.renderUtil.emptyElement(e);var a;return"string"==(a=typeof t)?e.innerHTML=t:t&&t.nodeType?e.appendChild(t):"number"===a?e.appendChild(document.createTextNode(t)):t&&t.jquery&&t.appendTo(e),e},inlineStyleToStyleObject:function(e,t,a,n){var r=e;if(t=t||{},"function"==typeof r&&(r=r.apply(n,a)),"string"==typeof r)for(var o=r.split(";"),l=0,i=o.length;l<i;l++){var d=o[l].split(":");t[At.trimString(d[0])]=At.trimString(d[1])}else if("object"==typeof r)for(var s in r){var p=r[s];"function"==typeof p&&(p=p.apply(n,a)),"string"!=typeof p&&"number"!=typeof p||(t[s]=p)}return t},isGridPointerActionProhibited:function(e){for(;null!=e;){if(At.renderUtil.hasClass(e,"alopexgrid-handle")||At.renderUtil.hasClass(e,"alopexgrid-ignore-pointeraction"))return!0;e=e.parentElement}return!1},getDocumentHeight:function(){var e=document.body,t=document.documentElement;return Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)},getDocumentWidth:function(){var e=document.body,t=document.documentElement;return Math.max(e.scrollWidth,e.offsetWidth,t.clientWidth,t.scrollWidth,t.offsetWidth)},getTextFromElement:function(t){if(t.nodeType){if("string"==typeof t.textContent)return t.textContent;if("string"==typeof t.innerText)return t.innerText}return e(t).text()}},e.extend(At,{i18n:function(e){return At.i18nLocaleSet[At.locale][e]},locale:"ko",i18nLocaleSet:{ko:{sum:"",count:"",average:"",equal:"",notequal:"",contain:"",notcontain:" ",lt:" ",lte:"  ",gt:" ",gte:"  ",freezePanes:"",freezePanesRow:"()",freezeCancel:" ",addRow:"   ",enlarge:"",enlargeMsg:" .",enlargeExit:" ",removeFilter:"",filterList:" ",noData:"(  )",save:"",close:"",apply:"",filterHeader:"",textFilterHeader:" ",textFilterAnd:"",textFilterOr:"",dataFilterHeader:" ",selectItem:"",totalCount:" ",exportMsg:"   . CSV  ?",exportCsvYbutton:"",exportCsvNbutton:"xlsx ",importMsg:"xlsx  csv  .",importConfirmButton:"",row:"",column:"",progress:"...",sortingHeader:"",sortingASC:"",sortingDESC:"",cellPopupEditTitle:"  "},en:{sum:"Sum",average:"Average",equal:"equal",notequal:"notequal",contain:"contain",notcontain:"notcontain",lt:"lesser",lte:"less than or equal",gt:"greater",gte:"greater than or equal",freezePanes:"Freeze Panes",freezePanesRow:"Freeze Panes(row)",freezeCancel:"Freeze Cancel",addRow:"Insert a row",enlarge:"Zoom in",enlargeMsg:"Zoom activated.",enlargeExit:"Zoom out",removeFilter:"Remove Filter",filterList:"Filter List",noData:"(no field data)",save:"Save",close:"Close",apply:"Apply",filterHeader:"Filter",textFilterHeader:"Text Filter",textFilterAnd:"And",textFilterOr:"Or",dataFilterHeader:"Data Filter",selectItem:"Select",totalCount:"Total Count",exportMsg:"Available data export amount has been exceeded. Do you want to CSV format?",exportCsvYbutton:"Confirm",exportCsvNbutton:"proceed to xlsx",importMsg:"Only xlsx and csv formats are supported.",importConfirmButton:"Confirm",row:"Row",column:"Column",progress:"loading...",sortingHeader:"Sort",sortingASC:"ASC",sortingDESC:"DESC",cellPopupEditTitle:"Cell Edit Popup"},ja:{sum:"",count:"",average:"",equal:"",notequal:"",contain:"",notcontain:"",lt:"",lte:"",gt:"",gte:"",freezePanes:"",freezePanesRow:"()",freezeCancel:" ",addRow:"",enlarge:"",enlargeMsg:"",enlargeExit:"",removeFilter:"",filterList:"",noData:"()",save:"",close:"",apply:"",filterHeader:"",textFilterHeader:" ",textFilterAnd:"",textFilterOr:"",dataFilterHeader:" ",selectItem:"",totalCount:"",exportMsg:" CSV",exportCsvYbutton:"",exportCsvNbutton:"xlsx",importMsg:"xlsxcsv",importConfirmButton:"",row:"",column:"",progress:"...",sortingHeader:"",sortingASC:"",sortingDESC:"",cellPopupEditTitle:" "},zh:{sum:"",count:"",average:"",equal:"",notequal:"",contain:"",notcontain:"",lt:"",lte:"",gt:"",gte:"",freezePanes:"",freezePanesRow:"()",freezeCancel:" ",addRow:"",enlarge:"",enlargeMsg:"",enlargeExit:"",removeFilter:"",filterList:"",noData:"()",save:"",close:"",apply:"",filterHeader:"",textFilterHeader:" ",textFilterAnd:"",textFilterOr:"",dataFilterHeader:" ",selectItem:"",totalCount:" ",exportMsg:" CSV?",exportCsvYbutton:"",exportCsvNbutton:"xlsx",importMsg:"xlsxcsv",importConfirmButton:"",row:"",column:"",progress:"...",sortingHeader:"",sortingASC:"",sortingDESC:"",cellPopupEditTitle:" "}}}),At.prototype._processDefaultSorting=function(){var t=this;t.option.defaultSorting&&(e.isArray(t.option.defaultSorting)?t.state.sortingInfo=t._generateSortingInfo(t.option.defaultSorting):d(t.option.defaultSorting)&&(t.state.sortingInfo=t._generateSortingInfo(t.option.defaultSorting.sortingColumn,t.option.defaultSorting.sortingDirection)))},At.prototype.sortToggle=function(e,t){var a=this,n=null;if(a.state.sortingInfo&&a.state.sortingInfo.length)for(var r=0,o=a.state.sortingInfo.length;r<o;r++){var l=a.state.columnMappingMapById[a.state.sortingInfo[r].mappingId];if("number"==typeof e&&l.columnIndex===e||"string"==typeof e&&l.key===e){n=a.state.sortingInfo[r];break}}a.option.rowOption&&"content"==a.option.rowOption.defaultHeight&&a.option.grouping.useGrouping&&a.option.grouping.useGroupRowspan&&(a.state.rowHeightMapByDataId={});var i=null;if(!n){var d=a._columnIndexKeyToMappingList(e)[0];if(d){var s={};s.mappingId=d.id,i=s}}var p=n||i;if(p){var u=t||("asc"===p.sortingDirection?"desc":"asc"),c={},l=a.state.columnMappingMapById[p.mappingId];if(c.sortingKey=l.key,c.sortingColumn=l.columnIndex,c.sortingDirection=u,c.mapping=l,c.pageinfo=a.pageInfo(),c.sortingInfo=a.sortingInfo(),!1===a._triggerGridEvent("sortToggle",c))return;p.sortingDirection=u,i&&(a.state.sortingInfo=a.state.sortingInfo||[],a.state.sortingInfo.push(i)),a.showProgress(function(){a.calcAndRedraw();var e={},t=a.state.columnMappingMapById[p.mappingId];e.sortingKey=t.key,e.sortingColumn=t.columnIndex,e.sortingDirection=u,e.mapping=t,e.pageinfo=a.pageInfo(),e.sortingInfo=a.sortingInfo(),a._triggerGridEvent("sortToggleEnd",e)})}},At.prototype._generateSortingInfo=function(t,a){var n=this,r=[];if("number"==typeof t||"string"==typeof t){var o=n._columnIndexKeyToMappingList(t)[0];if(o){var l={};l.mappingId=o.id,l.sortingDirection=a||"asc",r.push(l)}}else if(e.isArray(t))for(var i=0,d=t.length;i<d;i++){var s=t[i].sortingColumn;if(void 0!==s){var o=n._columnIndexKeyToMappingList(s)[0];if(o){var l={};l.mappingId=o.id,l.sortingDirection=t[i].sortingDirection||"asc",r.push(l)}}}return r},At.prototype._setSortingInfo=function(e,t){var a=this,n=a._generateSortingInfo(e,t);a.state.sortingInfo=n||[]},At.prototype.dataSort=function(e,t){var a=this;if(s(e))return a.sortClear(),a.state.data.sort(e),void a.calcAndRedraw();a.sortClear();var n=a._generateSortingInfo(e,t);a.state.sortingInfo=n||[],a.calcAndRedraw()},At.prototype.sortClear=function(e){var t=this;t.state.sortingInfo&&t.state.sortingInfo.length&&(t.$wrapper.find(".headercell.sorting").removeClass("asc desc").find(".sorting-handle").empty(),t.state.sortingInfo=[],e&&e.noEventTriggering||t._triggerGridEvent("sortClear",{pageinfo:t.pageInfo()}))},At.prototype._generateDataIndex=function(e){var t=this,a=e||t.state.data;delete t.state.dataIdToIndexMap,t.state.dataIdToIndexMap={};for(var n=0,r=a.length;n<r;n++){var o=a[n];o._index.data=n,t.state.dataIdToIndexMap[o._index.id]=n}},At.prototype._sortInternalData=function(){var t=this,a=this.option;this.state.data=this.state.data||[];var n=this.state.data,r=[],l=!1,i=!1,d=[],p=0;t.state.groupRowspanned=!1,t.state.columnRowspanned=!1,delete t.state.columnRowspanIndex,t.state.columnRowspanIndex=null;for(var u=0,c=a.columnMapping.length;u<c;u++){var g=a.columnMapping[u];null!=g&&(!isNaN(Number(g.columnIndex))&&g.key&&p++,g.sorting&&r.push(g),g.rowspan&&(i=!0),!0!==g.rowspan&&"always"!==g.rowspan||d.push(g))}if(t.state.sortingInfo&&t.state.sortingInfo.length)for(var u=0,c=t.state.sortingInfo.length;u<c;u++)t.state.sortingInfo[u].sortedOrder=u+1;var f=!1;t.state.sortingInfoKeyMap={};var h=!(!t.state.dynamicBinding||t.option.clientSortingOnDynamicDataSet);if(t.state.sortingInfo&&t.state.sortingInfo.length&&!h){for(var m={},v=function(e){return"number"==typeof e?e:parseFloat(String(e).replace(",",""))},u=0,c=t.state.sortingInfo.length;u<c;u++){var g=t.state.columnMappingMapById[t.state.sortingInfo[u].mappingId];null!=g&&(t.state.sortingInfoKeyMap[g.key]=t.state.sortingInfo[u])}if(t.option.autoSortingType)for(var x=0,y=r.length;x<y;x++){var C=!1;if(!0===r[x].sorting)for(var u=0,c=Math.min(n.length,50);u<c;u++){var I=n[u][r[x].key];if(I){if(!e.isNumeric(I)){C=!1;break}C=!0}else 0===I&&(C=!0)}else"number"===r[x].sorting&&(C=!0);m[r[x].columnIndex]=C?v:String}else for(var x=0,y=r.length;x<y;x++)"number"===r[x].sorting?m[r[x].columnIndex]=v:m[r[x].columnIndex]=String;for(var _={},u=0,c=t.state.sortingInfo.length;u<c;u++){var g=t.state.columnMappingMapById[t.state.sortingInfo[u].mappingId];g&&s(g.sorting)&&(_[u]=!0)}var w=0;"bottom"===t.option.sortingNullNumberPosition?w=-1:"top"===t.option.sortingNullNumberPosition&&(w=1);var b=0;"bottom"===t.option.sortingNullStringPosition?b=-1:"top"===t.option.sortingNullStringPosition&&(b=1),t.state.sortingCompareFunction=function(e,a){for(var n=0,r=t.state.sortingInfo.length;n<r;n++){var o=t.state.columnMappingMapById[t.state.sortingInfo[n].mappingId];if(o){o.sorting||(f=!0);var l=t.state.sortingInfo[n].sortingDirection||"asc",i="asc"===l?1:-1,d=o.key;if(_[n])return o.sorting.call(t,e[d],a[d],e,a)*i||e._index.data-a._index.data||0;var s=(m[o.columnIndex]||String)(e[d]),p=(m[o.columnIndex]||String)(a[d]);if(m[o.columnIndex]===v?((null==e[d]||isNaN(s))&&(s=Number.NEGATIVE_INFINITY,i=w||i),(null==a[d]||isNaN(p))&&(p=Number.NEGATIVE_INFINITY,i=w||i)):m[o.columnIndex]===String&&(null!=e[d]&&""!=e[d]||(s="",i=b||i,""==a[d]&&(i*=-1)),null!=a[d]&&""!=a[d]||(p="",i=b||i)),s<p)return-1*i;if(s>p)return 1*i}}return e._index.data-a._index.data||0},n.sort(t.state.sortingCompareFunction),l=!0}else t.state.sortingCompareFunction=null;if(f&&t.sortClear({noEventTriggering:!0}),t.option.tree&&t.option.tree.useTree){if(t.option.tree.idKey&&t.option.tree.parentIdKey){for(var M={},S={},E={},T="number"===t.option.tree.depthValueType?0:"",u=0,c=n.length;u<c;u++){var D=n[u];D._index.data=u,t._setExpandedTreeNodeState(D),M[D[t.option.tree.idKey]]=D._index.id,S[D[t.option.tree.parentIdKey]]=S[D[t.option.tree.parentIdKey]]||[],S[D[t.option.tree.parentIdKey]].push(D[t.option.tree.idKey])}var F=[];for(var R in S)M[R]||(F=F.concat(S[R]),delete S[R]);for(var R in S)L(R,S,E);t.state.treeInfo={},t.state.treeInfo.idValueToDataIdMap=M,t.state.treeInfo.childCountByIdValueMap=S,t.state.treeInfo.depthByIdValueMap=E,t.state.treeInfo.rootChildIdValueList=F;var A=t.state.treeOption.depthStartValue;if(t.option.disableTreeEdit)for(var u=0,c=n.length;u<c;u++){var D=n[u];D._index.parentid=M[D[t.option.tree.parentIdKey]]||null,D._state.treeNodeDepth=(E[D[t.option.tree.idKey]]||0)+A,D._state.treeNodeLeaf=!S[D[t.option.tree.idKey]]}else for(var u=0,c=n.length;u<c;u++){var D=n[u];D._index.parentid=M[D[t.option.tree.parentIdKey]]||null;var O=(D[t.option.tree.idKey],S[D[t.option.tree.idKey]],
t.state.treeOption.leafValue[S[D[t.option.tree.idKey]]?1:0]),P=(E[D[t.option.tree.idKey]]||0)+A+T;if(D._state.treeNodeDepth=(E[D[t.option.tree.idKey]]||0)+A,D._state.treeNodeLeaf=!S[D[t.option.tree.idKey]],(t.option.tree.leafKey||t.option.tree.depthKey)&&(t.option.tree.leafKey&&D[t.option.tree.leafKey]!==O||t.option.tree.depthKey&&D[t.option.tree.depthKey]!==P)){var B={};t.option.tree.leafKey&&(B[t.option.tree.leafKey]=O),t.option.tree.depthKey&&(B[t.option.tree.depthKey]=P),t._dataEdit(D,B)}}}else t.option.tree.leftKey&&t.option.tree.rightKey;n.sort(function(e,a){var n=e._state.treeNodeDepth,r=a._state.treeNodeDepth,o=parseInt(n),l=parseInt(r),i=e,d=a;if(o<l)for(;d._index.parentid&&(d=t._dataGetByIndex({id:d._index.parentid}));){if(d[t.option.tree.idKey]===e[t.option.tree.idKey])return-1;if(d._state.treeNodeDepth===o)break}else if(l<o)for(;i._index.parentid&&(i=t._dataGetByIndex({id:i._index.parentid}));){if(i[t.option.tree.idKey]===a[t.option.tree.idKey])return 1;if(i._state.treeNodeDepth===l)break}for(;d[t.option.tree.parentIdKey]!==i[t.option.tree.parentIdKey];){var s=t._dataGetByIndex({id:i._index.parentid}),p=t._dataGetByIndex({id:d._index.parentid});if(!s||!p)break;i=s,d=p}return i._index.data-d._index.data})}else delete t.state.treeInfo;if(t.option.grouping&&t.option.grouping.by&&t.option.grouping.by.length&&t.option.grouping.useGrouping){var G=t.option.grouping.by;G=e.isArray(G)?G:[G],!0===G[0]&&(G=G.slice(1));for(var H={},N={},$={},K=0;K<G.length;K++){var W=G[K],U=$[W]={};H[W]=parseInt(K);for(var V=0,Y=[],X=0,z=n.length;X<z;X++){var I=n[X][W];void 0===U[I]&&(U[I]=V++,void 0!==I&&Y.push(I))}N[W]=Y}var j=G.length;t.option.grouping.useGroupRearrange&&n.sort(function(e,t){for(var a=0;a<j;a++){var n=G[a],r=e[n],o=t[n],l=$[n][r],i=$[n][o];if(l<i)return-1;if(l>i)return 1}return e._index.data-t._index.data}),t.state.groupRowspanned=!!t.option.grouping.useGroupRowspan,t.state.groupingLookupTable={},t.state.groupingLookupTableMapById={},t.state.groupOccurrenceMap=N,t.state.groupOccurrenceOrder=$,t.state.groupKeyOrderMap=H;var q=null;if(t.state.topmostGroupRowspanKey=null,t.option.grouping.useGroupRowspan){for(var u=0,c=t.option.grouping.by.length;u<c;u++){var Z=t.option.grouping.by[u];if(null!=t.state.visibleIndexMapByKey[Z]){var g=t.state.columnKeyToMapping[Z];if(g&&!0===g.rowspan){t.state.topmostGroupRowspanKey=Z,q=u;break}}}for(var u=0,c=t.state.visibleColumnMappingList.length;u<c;u++){var g=t.state.visibleColumnMappingList[u];if(g.rowspan&&null!=g.rowspan.by){var Z=g.rowspan.by,Q=H[Z];null!=Q&&(Q<q||null==q)&&(t.state.topmostGroupRowspanKey=Z,q=Q)}}}delete t.state.groupHeaderDataMapById,delete t.state.groupFooterDataMapById;for(var J=G.length,ee=t.state.groupingLookupTable,te=[],u=0;u<J;u++)ee[G[u]]=[];for(var u=0,c=n.length;u<c;u++){for(var D=n[u],ae=n[u+1],ne=[],re=[],X=0;X<J;X++){var Z=G[X];ne.push(!0===Z?void 0:D[Z]),re.push(ae?ae[Z]:null),te[X]||(te[X]={id:o(),from:u,groupKey:Z,groupDepth:X,value:D[Z],member:[],memberIdMap:{}},t.state.groupingLookupTableMapById[te[X].id]=te[X]),ee[Z][u]=te[X]}for(var X=J-1;X>=0;X--){var oe=!1;for(k=X;k>=0;k--)if(ne[k]!==re[k]){oe=!0;break}if(u===(t.state.pinnedDataIdList||[]).length-1&&(oe=!0),te[X].member.push(D),te[X].memberIdMap[D._index.id]=D,D._state.hasOwnProperty("collapsedGroupNode")){var le=te[X].member,ie=le[0];ie&&0==ie._state.hasOwnProperty("collapsedGroupNode")&&(ie._state.collapsedGroupNode=D._state.collapsedGroupNode||{})}oe&&(te[X].to=u,te[X]=null)}}}else t.state.groupRowspanned=!1,t.state.groupingLookupTable=null,t.state.groupingLookupTableMapById=null,t.state.groupOccurrenceMap=null,t.state.groupOccurrenceOrder=null,t.state.topmostGroupRowspanKey=null,t.state.groupKeyOrderMap=null;for(var u=n.length;u>=0;u--)n[u]||n.splice(u,1);if(t._generateDataIndex(n),t._hasPinnedData()&&t.state.pinnedDataIdList.sort(function(e,a){return t.state.dataIdToIndexMap[e]-t.state.dataIdToIndexMap[a]||0}),t.option.grouping&&t.option.grouping.useGrouping&&t.option.grouping.by);else if(i&&t.option.useColumnRowspan){for(var de=[],u=0;u<p;u++)de.push(void 0);var se=1;e.each(d,function(e,t){var a=0,r=n.length;de[Number(t.columnIndex)]=[];for(var o=de[Number(t.columnIndex)],l=[];a<r;){for(var i=a,d=a+1;d<r&&n[i][t.key]===n[d][t.key];)d++;for(var s={from:i,to:d,index:se++},p=i;p<d;p++)l[p]=s;o.push(s),a=d}o.push(l)});for(var u=0,c=a.columnMapping.length;u<c;u++){var g=a.columnMapping[u];if(g.rowspan&&"number"==typeof g.rowspan.by)if(g.rowspan.under){var pe=de[g.rowspan.by];pe=pe[pe.length-1];var ue=0,ce=n.length;de[Number(g.columnIndex)]=[];for(var ge=de[Number(g.columnIndex)],fe=[];ue<ce;){for(var he=ue,me=ue+1;me<ce&&n[he][g.key]===n[me][g.key]&&!(me+1>pe[he].to);)me++;for(var ve={from:he,to:me,index:se++},u=he;u<me;u++)fe[u]=ve;ge.push(ve),ue=me}ge.push(fe)}else de[g.columnIndex]=de[g.rowspan.by]}delete this.state.columnRowspanIndex;for(var xe=!1,u=0,c=de.length;u<c;u++)de[u]&&(xe=!0);xe?(this.state.columnRowspanIndex=de,this.state.columnRowspanned=!0):(this.state.columnRowspanIndex=void 0,this.state.columnRowspanned=!1)}else this.state.columnRowspanIndex=void 0,this.state.columnRowspanned=!1;return this.state.sortingRequired=!1,l},At.prototype.sortingInfo=function(){var e=this,t=[];if(t.sorted=e.state.sortingInfo&&e.state.sortingInfo.length>0,t.sorted){var a=e.state.columnMappingMapById[e.state.sortingInfo[0].mappingId];t.sortingKey=a.key,t.sortingColumn=a.columnIndex,t.sortingDirection=e.state.sortingInfo[0].sortingDirection;for(var n=0,r=e.state.sortingInfo.length;n<r;n++){var o={},a=e.state.columnMappingMapById[e.state.sortingInfo[n].mappingId];o.sortingKey=a.key,o.sortingColumn=a.columnIndex,o.sortingDirection=e.state.sortingInfo[n].sortingDirection,o.mapping=a,o.order=e.state.sortingInfo[n].sortedOrder,t.push(o)}}return t},At.prototype._triggerGridEvent=function(t,a,n){var r=this;if(r.$root){var o=null;try{o=new Event(t,{bubbles:!0,cancelable:!0})}catch(a){wt?o=e.Event(t):(o=document.createEvent("Event"),o.initEvent(t,!0,!0))}if(o.alopexgrid={},o.alopexgrid.$grid=r.$root,a&&"object"==typeof a)for(var l in a)a.hasOwnProperty(l)&&(o.alopexgrid[l]=a[l]);var i=r.$root;if(n){var d=e(n);n.nodeType?(i=d,o.alopexgrid.$cell=d.closest(".alopexgrid-cell")):n.jquery&&n.length&&(i=n.eq(0),o.alopexgrid.$cell=d.closest(".alopexgrid-cell"))}return o.alopexgrid.$cell&&!o.alopexgrid.$cell.length?delete o.alopexgrid.$cell:o.alopexgrid.$cell&&o.alopexgrid.$cell.length&&(o.alopexgrid.cell=o.alopexgrid.$cell[0]),i?i.nodeType&&(i=e(i)):i=r.$root,r.root===i[0]||e.contains(r.root,i[0])||(i=r.$root),wt?i.trigger(o):i[0].dispatchEvent(o)}},At.prototype._getDataFromEvent=function(t){var a=e(t.target).closest(".bodycell");return a.length?this._getRenderedDataFromRenderedIndex(parseInt(a.attr("data-alopexgrid-rowindex"))):null},At.prototype._getCellFromEvent=function(t){return e(t.target).closest(".cell")},At.prototype._viewEventRemove=function(){var e=this,t=".alopexgridViewEventUpdate";Ct.off(t+e.key),yt.off(t+e.key),e.$root.off(t),e.$title.off(t),e.$pager.off(t),e.$wrapper.off(t),e.$focusfixture.off(t),e.$pager.off(t)},At.prototype.viewEventUpdate=function(t){function a(t){var a=t.data.self,n=parseInt(t.currentTarget.getAttribute("data-alopexgrid-dataindex")),r=parseInt(t.currentTarget.getAttribute("data-alopexgrid-columnindex")),o=W(a,r),l=e.extend(!0,{},a.option.getEditingDataOnEvent?a._getRecentData(n):a.state.data[n]);return o&&o.key&&(l._key=o.key),o&&o.hasOwnProperty("columnIndex")&&(l._column=o.columnIndex),!isNaN(r)&&r>=0&&l&&l._index&&(l._index.column=r),l}function n(e){var t=e.data.self,n=a(e),r=e.data.handle,o="function"==typeof r?[r]:r;for(var l in o){o[l].call(t,n,e)}}function r(e){if(e.state.rowInlineEditPool.length)for(var t=e.state.rowInlineEditPool.length-1;t>=0;t--){var a=e.state.rowInlineEditPool[t],n=e._dataGetByIndex({id:a});n&&n._state.editing&&"click"!==L||(!n||n&&!n._state.editing||n&&n._state.editing&&!1!==e.endEdit(n))&&e.state.rowInlineEditPool.splice(t,1)}}function l(e,t){if(!t||!t._index||!t._index.id)return!1;for(var a=0,n=e.state.rowInlineEditPool.length;a<n;a++){var r=e.state.rowInlineEditPool[a];if(t._index.id===r)return!0}return!1}function d(e){return!(!e.state.lastInvalidEditingCell||!e.state.lastInvalidEditingCell[0])&&!!l(e,e.state.lastInvalidEditingCell[0])}function p(e){var t=e.state.lastInvalidEditingCell[0],a=e.state.lastInvalidEditingCell[1];if(t&&a){e.dataScroll({_index:{row:t._index.row,column:a.columnIndex}});e.cellElementGet(t,a.columnIndex).find("input,select,textarea").eq(-1).focus()}}function u(e,t){if(!t||!t._index||!t._index.id)return!1;if(r(e),e.state.rowInlineEditPool.length)return void(!0===e.option.restoreFocusOnInvalidInlineEdit&&d(e)&&setTimeout(function(){p(e)},10));if(!l(e,t)){if(!1===e.startEdit(t))return!1;e.state.rowInlineEditPool.push(t._index.id),i();e.option.rowInlineEditOption.disableEvent||e._triggerGridEvent("rowInlineEditStart",{data:t})}}function c(e){var t=[];if(e.option.rowInlineEditOption.endAllEditing)t=e._dataGet({_state:{editing:!0}}),e.endEdit(t);else for(var a=0,n=e.state.rowInlineEditPool.length;a<n;a++){var o=e.state.rowInlineEditPool[a],l=e._dataGetByIndex({id:o});if(l&&l._state.editing){if(!1===e.endEdit(l))return r(e),!1;l._state.editing||t.push(l)}}if(r(e),i(),!e.option.rowInlineEditOption.disableEvent)for(var a=0,n=t.length;a<n;a++)e._triggerGridEvent("rowInlineEditEnd",{data:t[a]})}function g(e,t){return e.state.renderTargetDataList[t.getAttribute("data-alopexgrid-rowindex")]}function f(e,t){return e.state.columnIndexToMapping[t.getAttribute("data-alopexgrid-columnindex")]}function h(e,t,a){if(!a.editable)return null;if("function"==typeof a.editable){var n=t._state.editing&&t._state.editing.hasOwnProperty(a.columnIndex)?t._state.editing[a.columnIndex]:t[a.key],r=a.editable.call(e,n,t,a.editable,a,e);if(r&&"object"==typeof r)return r.type||null}else if(!0===a.editable)return"text";return a.editable.type||null}function m(e,t,a){for(var n=0,r=a.length;n<r;n++)if(a[n][0]._index.id===e._index.id&&a[n][1].columnIndex===t.columnIndex)return!0;return!1}function v(e,t){for(var a=[],n=!1,r=!1,o=e.option.grouping&&e.option.grouping.useGrouping&&e.option.grouping.by&&e.option.grouping.by.length,l=!1,i=t.length-1;i>=0;i--){var d=t[i],s=d[0],p=d[1],u=s[p.key];if(e._isEditingCell(s._index.row,p.columnIndex)){if(!1===e._endCellEdit(s,p)){l=!0;continue}var c=s[p.key];if(a.push(d),e.state.sortingInfoKeyMap[p.key]&&u!==c&&(r=!0),o&&!n&&u!==c){e._getGroupingRangeByMapping(s._index.data,p)&&(n=!0)}}t.splice(i,1)}if(a.length){if(e.option.sortClearOnEdit&&r&&e.sortClear(),n||!e.option.sortClearOnEdit&&r)e.calcAndRedraw();else{for(var i=0,g=a.length;i<g;i++)e.refreshRow(a[i]);e._hasFooter()&&e._refreshFooterCells(!0)}for(var i=0,g=a.length;i<g;i++)e._triggerGridEvent("cellInlineEditEnd",{data:a[i][0],mapping:a[i][1]})}if(!0===l)return!1}function x(e,t,a,n){if(e._isPopupEditingColumn(a))return!1;if(e._startCellEdit(t,a),!e._isEditingCell(t,a))return!1;if(e._refreshCell(t,a),n.push([t,a]),e._triggerGridEvent("cellInlineEditStart",{data:t,mapping:a}),e.state.groupRowspanned&&e.option.rowspanGroupEdit&&a.rowspan){var r=e._getGroupingRangeByMapping(t._index.data,a);if(r)for(var o=r.from;o<=r.to;o++)o!==t._index.data&&(e._startCellEdit(e.state.data[o],a),e._refreshCell(e.state.data[o],a),n.push([e.state.data[o],a]),e._triggerGridEvent("cellInlineEditStart",{data:e.state.data[o],mapping:a}))}return!0}function y(t,a){var n=a[a.length-1];if(n){var r=n[0],o=n[1];t.option.cellSelectable&&Je(t,r._index.row,o.columnIndex);var l=t._cellElementGet(r,o);setTimeout(function(){e(l).find("input,select,textarea").focus()},0)}}function C(t,a,n,r){var o=!1;if(n.instantInlineEditable){if(!0===n.instantInlineEditable)return!0;if("function"==typeof n.instantInlineEditable)return n.instantInlineEditable.call(t,a[n.key],a,n,t)}if(t.option.instantInlineEditType&&t.option.instantInlineEditType.length)for(var l=h(t,a,n),i=0,d=t.option.instantInlineEditType.length;i<d;i++){var s=t.option.instantInlineEditType[i],p=e.type(s);if("string"===p?(s=e.extend({},t.option.defaultInstantInlineEdit,{type:s}),p="object"):"object"===p&&(s=e.extend({},t.option.defaultInstantInlineEdit,s)),"object"===p&&!e.isEmptyObject(s)){if(s.type&&l!==s.type)continue;if(s.hasOwnProperty("columnIndex")){if("number"==typeof s.columnIndex&&n.columnIndex!==s.columnIndex)continue;if("string"==typeof s.columnIndex&&n.key!==s.columnIndex)continue}o=!0;break}if("function"===p&&!0===s.call(t,a[n.key],a,n,r)){o=!0;break}}return o}function I(e,t,a,n,r,o){if(!m(a,n,t)){if(!e._isEditingCell(a._index.row,n.columnIndex)){var l=v(e,t);if(!1===l&&!0===e.option.restoreFocusOnInvalidInlineEdit)return void y(e,t);C(e,a,n,o)&&setTimeout(function(){var o=e.option.cellInlineEditOption.allowStartEditWithInvalid;!1===l&&!0!==o||x(e,a,n,t),s(r)&&r()},1)}}}function _(t,a,n){var r=a.target.className;if(!(r.indexOf("scrollbar")>=0||r.indexOf("scrollbutton")>=0||r.indexOf("scrollhandle")>=0||r.indexOf("resizing-handle")>=0||r.indexOf("row-dragdrop-handle")>=0||r.indexOf("header-columnfolding-icon")>=0||r.indexOf("alopexgrid-progress")>=0)){Ct.off(n+t.key),i();var l=!1;"mousedown"===t.option.contextMenuEvent&&(l=!0);var d=a;_t&&a.originalEvent&&a.originalEvent.touches&&a.originalEvent.touches.length>0&&(d=a.originalEvent.touches[0]);var s=[];if(t.option.enableDefaultContextMenu&&t.option.defaultContextMenu&&t.option.defaultContextMenu.length&&(s=s.concat(t.option.defaultContextMenu)),t.option.enableContextMenu&&t.option.contextMenu&&t.option.contextMenu.length&&(s=s.concat(t.option.contextMenu)),s.length){var p=t._getDataFromEvent(a),u=t._getCellFromEvent(a);p&&(p=e.extend(!0,{},p),p._index.column=parseInt(u.attr("data-alopexgrid-columnindex")));var c=d.pageX,g=d.pageY;e(".alopexgrid-contextmenu-wrapper-"+t.key).remove(),t.state.$contextMenuDropdown&&(t.state.$contextMenuDropdown.remove(),t.state.$contextMenuDropdown=null);var f=e("<div>"),h=o();f.css({left:c+"px",top:g+"px"}),f.prop("id",h),f.addClass(ct+" alopexgrid-contextmenu-wrapper alopexgrid-contextmenu-wrapper-"+t.key);var m=t.state.$contextMenuDropdown=e("<ul>");m.addClass("alopexgrid-contextmenu");for(var v=0;v<s.length;v++){var x=s[v];m.append(w(t,x,v,p,u,n))}if(!m.children().length)return m.remove(),void f.remove();var y=yt.scrollLeft()+yt.width(),C=yt.scrollTop()+yt.height();m.appendTo(f),f.appendTo("body").addClass("alopexgrid-refer-"+t.key),m.show();var I=f.outerHeight(),_=f.outerWidth(),b=f.offset(),M=!1;if(b.top+I>C&&(f.css("top",g-I+"px"),M=!0),b.left+_>y&&(f.css("left",c-_+"px"),M=!0),M){var S=f.outerHeight();S!=I&&f.css("top",g-S+"px");var E=f.outerWidth();E!=_&&f.css("left",c-E+"px")}T.mousedownEvent=l,!1===It&&Ct.on("keydown"+n+t.key+t.eventns,T,function(e){var t=e.data.self;27===e.keyCode&&(t.state.$contextMenuDropdown&&(t.state.$contextMenuDropdown.parents(".alopexgrid-contextmenu-wrapper").remove(),t.state.$contextMenuDropdown.remove(),t.state.$contextMenuDropdown=null),Ct.off(e.data.contextMenuEventNS+t.key),Ze(t))}),Ct.on("mousedown"+n+t.key+t.eventns+" touchstart"+n+t.key+t.eventns+" scroll"+n+t.key+t.eventns+" wheel"+n+t.key+t.eventns,T,function(a){if(!(e(a.target).closest(".alopexgrid-contextmenu-wrapper").length>0||It&&"mousedown"===a.type)){if(a.data.mousedownEvent)return void(a.data.mousedownEvent=!1);a.data.self&&a.data.self.state&&a.data.self.state.$contextMenuDropdown&&(a.data.self.state.$contextMenuDropdown.parents(".alopexgrid-contextmenu-wrapper").remove(),a.data.self.state.$contextMenuDropdown.remove(),a.data.self.state.$contextMenuDropdown=null),Ct.off(a.data.contextMenuEventNS+t.key)}}),a.preventDefault()}}}function w(t,a,n,r,o,l){if(!1===a.use)return"";if(s(a.use)&&!1===a.use.call(t.$root,r,o,t))return"";if(!0===a.seperator)return"<li><hr></li>";var i=e("<li>"),d=e("<a>").appendTo(i),p=a.title;s(p)&&(p=p.call(t.$root,r,o,t)),p&&(p.nodeType||p instanceof e)?d.html(p):d.text(t.option.contextMenuTitleMapper?t.option.contextMenuTitleMapper(p):p);var u={};return u.$grid=t.$root,u.gridInstance=t,u.contextMenuEventNS=l,d.attr("href","#"),d.on("click touchstart",u,function(e){var t=e.data.gridInstance;a.processor&&a.processor.call(e.data.$grid,r,o,t),t.state.$contextMenuDropdown&&(t.state.$contextMenuDropdown.parents(".alopexgrid-contextmenu-wrapper").remove(),t.state.$contextMenuDropdown.remove(),t.state.$contextMenuDropdown=null),Ct.off(e.data.contextMenuEventNS+t.key),e.preventDefault()}),i}var b=this,M=(b.$root,b.$wrapper),S=b.option,E=".alopexgridViewEventUpdate",T={self:b,targetElement:null};b._viewEventRemove();var D=[{target:"cell",delegate:".bodycell"},{target:"headercell",delegate:".headercell"}];if(e.each(D,function(t,a){S.on&&S.on[a.target]&&e.each(S.on[a.target],function(e,t){M.on((b.option.eventMapping[e]||e)+E,a.delegate,{self:b,handle:t},n)})}),b.option.on&&b.option.on.focus&&"object"==typeof b.option.on.focus)for(var F in b.option.on.focus)"string"==typeof F&&b.$focusfixture.on(F+E,{self:b,handle:b.option.on.focus[F]},n);if(M.on("click"+E,".alopexgrid-input-wrapper",T,function(t){if("LABEL"===t.target.tagName){var a=e(t.target).find("input");if(!a.prop("disabled")&&!a.prop("readOnly")){0==!!t.data.self.option.rowSelectOption.disableSelectByKey&&(t.data.self.state.customCtrlKey=t.ctrlKey||t.metaKey,t.data.self.state.customShiftKey=t.shiftKey),a.click().change()}return!1}}),M.on("change"+E,".alopexgrid-input-wrapper",T,function(t){var a=e(this),n=a.children("input");a.siblings(".alopexgrid-input-wrapper").removeClass("checked");var r=n[0].checked,o=n[0].alopexgridChecked;"boolean"==typeof o&&r!==o&&(r=o),r?a.addClass("checked"):a.removeClass("checked")}),M.on("change"+E+" click"+E+" keyup"+E,".alopexgrid-cell.editingcell",T,function(e){e.data.self._updateEditingCell(this)}),!0!==b.option.disableHeaderClickSorting){var R="click",k="mousedown";It&&(R="touchstart",k="touchstart"),M.on(k+E,".headercell.click-sortable",T,function(e){e.data.targetElement=e.target}),M.on(R+E,".headercell.click-sortable",T,function(e){var t=e.data.self,a=e.target.className;if(e.data.targetElement===e.target&&!(a.indexOf("header-dragdrop-handle")>=0||a.indexOf("column-resizing-handle")>=0||a.indexOf("alopexgrid-treecolumn")>=0||a.indexOf("alopexgrid-nonsorting-handle")>=0)&&(At.renderUtil.hasClass(e.target,"sorting-handle")||!At.renderUtil.isGridPointerActionProhibited(e.target))){var n=parseInt(this.getAttribute("data-alopexgrid-columnindex"));if(!isNaN(n)){var r=t._isColumnSorted(n),o=null;if("touchstart"===e.originalEvent.type)e.originalEvent.touches&&e.originalEvent.touches.length<2&&t.sortClear();else if(!e.shiftKey){var l=t.state.sortingInfoKeyMap;t.sortClear();var i=t.option.grouping.sortingPriority;if(i&&i.length>0){var d=i,s=t.state.columnIndexToMapping[n],p=t.option.grouping.by;if(d.indexOf(s.key)<0)for(var u=0;u<d.length;u++)if(p.indexOf(d[u])>-1){var c=l[d[u]];t.sortToggle(d[u],c&&c.sortingDirection?c.sortingDirection:"asc")}}}r&&("asc"===r.sortingDirection?o="desc":"desc"===r.sortingDirection&&(o="asc")),t.sortToggle(n,o);var g=t.state.columnIndexToMapping[n];t._triggerGridEvent("UISortToggle",{sortingKey:g.key,sortingColumn:n,sortingDirection:o,mapping:g,pageInfo:t.state.pagingInfo})}}})}var L=b.option.rowInlineEditOption.startEvent||"dblclick";if(S.rowInlineEdit){b.state.rowInlineEditPool=b.state.rowInlineEditPool||[],M.on(L+E,T,function(t){var a=t.data.self,n=At.parseEvent(t),o=n.data,s=n.mapping;if(o&&"INPUT"!==t.target.tagName&&"SELECT"!==t.target.tagName&&"TEXTAREA"!==t.target.tagName&&!At.renderUtil.hasClass(t.target,"alopexgrid-input-wrapper")){var g=l(a,o),f=a.option.rowInlineEditOption.endAllEditing;if(g){var h=!1===c(a);h&&!0===a.option.restoreFocusOnInvalidInlineEdit&&d(a)&&setTimeout(function(){p(a)},10)}else if(f&&o._state&&o._state.editing){var h=!1===a.endEdit(o);r(a),i();var m=a.option.rowInlineEditOption.disableEvent;m||a._triggerGridEvent("rowInlineEditEnd",{data:o}),h&&!0===a.option.restoreFocusOnInvalidInlineEdit&&d(a)&&setTimeout(function(){p(a)},10)}else{if(o._state&&o._state.editing)return;if(f){var v=a._dataGet({_state:{editing:!0}});a.endEdit(v);for(var x=0,y=v.length;x<y;x++)a._triggerGridEvent("rowInlineEditEnd",{data:v[x]})}if(u(a,o),o._index&&o._index.id){var C=a._cellElementGet(o,s);if(C){var I=t.pageX,_=t.pageY;setTimeout(function(){var t=e(C);a._setCursorUnderPointer(t,I,_),a._triggerGridEvent("inlineEditInputFocus",{data:o,mapping:s},t)},0)}}}}}),M.on("mousedown"+E,T,function(e){e.data.rowInlineClickTarget=e.target}),M.on("click"+E,T,function(t){var a=t.data.self,n=t.data.rowInlineClickTarget||t.target;if(!e.data(n,"alopexGridScrollbarElement")){var r=At.parseEvent(t),o=r.data,i=l(a,o),s=!1;if(a.option.rowInlineEditOption.endAllEditing)o&&o._state&&o._state.editing||(s=!1===c(a));else if(o&&i)!o||o._index&&o._state||(s=!1===c(a));else if(o&&o._state&&o._state.editing){if(At.regex.inputControls.test(t.target.tagName))return;s=!1===c(a)}else s=!1===c(a);s&&!0===a.option.restoreFocusOnInvalidInlineEdit&&d(a)&&setTimeout(function(){p(a)},10)}});b.option.rowInlineEditOption.endEditByEnter&&b.$wrapper.on("keyup"+E,".bodycell",T,function(t){var a=t.data.self,n=e(this),r=parseInt(n.attr("data-alopexgrid-rowindex")),o=parseInt(n.attr("data-alopexgrid-columnindex")),l=a._isEditingCell(r,o);if("TEXTAREA"!==t.target.tagName&&l)if(13===t.which){var i=!1===c(a);!i&&a.option.cellSelectable?Ze(a):i&&setTimeout(function(){p(a)},10)}else t.which}),b.state.__rowInlineStartEdit=u,b.state.__rowInlineEndEdit=c}else b.state.__rowInlineStartEdit=null,b.state.__rowInlineEndEdit=null;var A=b.option.rowSelectOption.clickSelect,O=b.option.rowSelectOption.allowSingleUnselect;if(A){b.$root.on("click"+E,".bodycell",T,function(t){var a=t.data.self;e(t.target);if(!At.renderUtil.isGridPointerActionProhibited(t.target)){if(("INPUT"!==t.target.tagName||At.renderUtil.hasClass(t.target,"selector-column-input"))&&"SELECT"!==t.target.tagName&&"TEXTAREA"!==t.target.tagName){var n=parseInt(this.getAttribute("data-alopexgrid-columnindex")),r=parseInt(this.getAttribute("data-alopexgrid-rowindex")),o=a._getRenderedDataFromRenderedIndex(r),l=W(a,n);if(o&&l){var i=o._state.selected;if(!a.state.rowSingleSelect||!1!==O||!i){var d=this;if(d.rowSingleCtrlKey=a.state.customCtrlKey||t.ctrlKey||t.metaKey,d.rowSingleShiftKey=a.state.customShiftKey||t.shiftKey,!1===a.rowSelect(d,"toggle"))return!1;if(a.state.hasSelectorColumn&&i!==o._state.selected){var s={data:o,mapping:l,value:o._state.selected,prevValue:i};a._triggerGridEvent("cellValueEditing",s),a._triggerGridEvent("cellValueChanged",s)}}}}}})}else b.$root.on("click"+E,".selector-column-input",T,function(t){var a=t.data.self,n=e(this).closest(".bodycell");if(n.length){e(t.target);if(!At.renderUtil.isGridPointerActionProhibited(t.target)){var r=parseInt(n.attr("data-alopexgrid-columnindex")),o=parseInt(n.attr("data-alopexgrid-rowindex")),l=a._getRenderedDataFromRenderedIndex(o),i=W(a,r);if(l&&i){var d=l._state.selected;if(!a.state.rowSingleSelect||!1!==O||!d){if(n[0].rowSingleCtrlKey=a.state.customCtrlKey,n[0].rowSingleShiftKey=a.state.customShiftKey,!1===a.rowSelect(n[0],"toggle"))return!1;if(a.state.hasSelectorColumn&&d!==l._state.selected){var s={data:l,mapping:i,value:l._state.selected,prevValue:d};a._triggerGridEvent("cellValueEditing",s,n),a._triggerGridEvent("cellValueChanged",s,n)}}}}}});if(!0!==b.option.disableFocusedState&&b.$root.on("mousedown"+E,".bodycell",T,function(e){e.data.self._rowFocus(this)}),b.option.cellPopupEdit&&b.option.cellPopupEdit.length>0){var P=b.option.cellPopupEditOption.startEvent||"dblclick";P=At.trimString(P)+" ";var B=P.split(" ");P=At.trimString(B.join(E+" ")),b.$root.on(P,".bodycell",T,function(t){i();var a=t.data.self,n=e(this);a._openCellEditPopup(n,!1,t,null,null)})}var G=b.state.cellInlineEditData=b.state.cellInlineEditData||{self:b,pool:[]},H=b.state.cellInstantInlineEditData=b.state.cellInstantInlineEditData||{self:b,pool:[]};if(b.option.cellInlineEdit){var N=!(!b.option.instantInlineEditType||!b.option.instantInlineEditType.length);N=N||!!e.grep(b.option.columnMapping,function(e){return!!e.instantInlineEditable}).length,b.state.__cellInlineStartEdit=function(e,t){return x(b,e,t,G.pool)},b.state.__cellInlineEndEdit=function(){return v(b,G.pool)},N&&(b.$root.on("cellFocus"+E+" click"+E+" mouseenter"+E,".bodycell",H,function(e){var t=e.data.self,a=At.parseEvent(e),n=a.data,r=a.mapping,o=e.data.pool;n&&n._index&&r&&I(t,o,n,r,null,e)}),b.$root.on("mouseenter"+E,".scrollbar,.headercell",H,function(e){v(e.data.self,e.data.pool)}),b.$root.on("mouseleave"+E,H,function(e){At.regex.inputControls.test(e.target.tagName)||At.renderUtil.hasClass(e.target,"alopexgrid-input-wrapper")||v(e.data.self,e.data.pool)})),b.$root.on("dataSet"+E+" dataEmpty"+E,function(e){G.pool=[],H.pool=[]});var $=b.option.cellInlineEditOption.startEvent||"dblclick";$=At.trimString($)+" ";var K=$.split(" ");$=At.trimString(K.join(E+" ")),b.$root.on($,".bodycell",G,function(t){var a=t.data.self,n=t.pageX,r=t.pageY,o=g(a,this),l=f(a,this);if(o&&l&&!a._isEditingCell(o._index.row,l.columnIndex)){var i=t.data.pool,d=v(a,i);if(!1===d&&!0===a.option.restoreFocusOnInvalidInlineEdit)return void y(a,i);if(!a._isCellEditable(o,l))return void Ze(a,o._index.row,l.columnIndex);var s=a.option.cellInlineEditOption.allowStartEditWithInvalid;if(!1!==d||!0===s){if(!1===x(a,o,l,i))return;setTimeout(function(){var t=a._cellElementGet(o,l);if(t){var i=e(t);a._setCursorUnderPointer(i,n,r),a._triggerGridEvent("inlineEditInputFocus",{data:o,mapping:l},i)}else Ze(a,o._index.row,l.columnIndex)},0)}}}),e.inArray("cellFocus",K)<0&&e.inArray("mousedown",K)<0&&e.inArray("mouseup",K)<0&&e.inArray("click",K)<0&&b.$root.on("mousedown"+E,".bodycell",G,function(e){var t=e.data.self,a=(e.pageX,e.pageY,g(t,this)),n=f(t,this);if(a&&n&&!m(a,n,e.data.pool)){return(!v(t,e.data.pool)||!0!==t.option.restoreFocusOnInvalidInlineEdit)&&void 0}});b.option.cellInlineEditOption.endEditByOtherAreaClick&&b.$root.on("mousedown"+E,G,function(t){e(t.target).closest(".bodycell").length||v(t.data.self,t.data.pool)}),b.option.cellSelectable&&M.on("keydown"+E,"select",T,function(t){var a=t.data.self,n=e(this).closest(".bodycell");if(n.length){var r=parseInt(n.attr("data-alopexgrid-rowindex")),o=parseInt(n.attr("data-alopexgrid-columnindex"));if(bt){if(32===t.which)return a.state.selectElOpenFlag=!0,void this.focus();13===t.which&&a.option.instantInlineEditType&&a.option.instantInlineEditType.length>0&&Ze(a,r,o)}else{if({37:"left",38:"up",39:"right",40:"down"}[t.which]&&a.option.instantInlineEditType&&a.option.instantInlineEditType.length>0)return t.preventDefault(),void a.$focusfixture.trigger(t)}}}),b.$root.on("keydown"+E,".bodycell",T,function(t){var a=t.data.self,n=e(this),r=parseInt(n.attr("data-alopexgrid-rowindex")),o=parseInt(n.attr("data-alopexgrid-columnindex"));if(a._isEditingCell(r,o))if(27===t.which)setTimeout(function(){a.option.cellInlineEditOption&&!0===a.option.cellInlineEditOption.cancelAllByEsc?a.cancelCellEdit():a.cancelCellEdit({_index:{row:r}},o),a.option.cellSelectable&&Ze(a,r,o)},0);else if(13===t.which||9===t.which){var l=13===t.which,i=9===t.which;if(l){if(bt&&a.state.selectElOpenFlag&&"SELECT"===t.target.tagName)return void(a.state.selectElOpenFlag=!1);if("TEXTAREA"===t.target.tagName&&!t.ctrlKey)return}a._updateEditingCell(n),i&&a.option.cellSelectable&&t.preventDefault(),setTimeout(function(){var n=e.inArray("cellFocus",K)<0,i=n?v(a,G.pool):null,d=n?v(a,H.pool):null,s=!1!==i&&!1!==d;a.option.cellSelectable?a.option.cellInlineEditOption&&a.option.cellInlineEditOption.focusMoveAtEditEnd?s||!1===a.option.restoreFocusOnInvalidInlineEdit?(Ze(a,r,o),l?et(a,t.shiftKey?-1:1,0):et(a,0,t.shiftKey?-1:1)):!0===a.option.restoreFocusOnInvalidInlineEdit&&(y(a,G.pool),y(a,H.pool)):s?(Ze(a,r,o),a._triggerGridEvent("cellFocus",{data:a.state.renderTargetDataList[r]||null,mapping:a.state.columnIndexToMapping[o]||null},e(document.getElementById(a._cellIdFromRowIndex(r,o))))):!0===a.option.restoreFocusOnInvalidInlineEdit&&(y(a,G.pool),y(a,H.pool)):!0===a.option.restoreFocusOnInvalidInlineEdit&&(y(a,G.pool),y(a,H.pool))},0)}})}var U=b.option.endInlineEditByOuterClick;if((b.option.rowInlineEdit||b.option.cellInlineEdit)&&U){var V=s(U);Ct.on("mousedown"+E+b.key+b.eventns,T,function(t){var a=t.data.self,n=!1;if(V){var r=U.call(a,t.target,t);if(!1===r)return;!0===r&&(n=!0)}if(!n){var o=t.target;do{var l=!!o.getAttribute&&o.getAttribute("data-alopexgrid");if(l&&l===a.key)return;if(o.tagName&&e.inArray(o.tagName,["INPUT","SELECT","BUTTON","TEXTAREA","A"])>=0)return;o=o.parentNode}while(o)}a.option.cellInlineEdit?(v(a,G.pool),v(a,H.pool)):a.option.rowInlineEdit&&c(a)})}if(b._startCellSelectEngine(b.option.cellSelectable),b._enableHeaderSelect(!!b.option.enableHeaderSelect),b.$root.on("focus"+E+" focusin"+E,".alopexgrid-cell",T,function(e){var t=At.parseEvent(e);t.data&&t.data._index&&t.data._index.id&&t.mapping&&At.regex.inputControls.test(e.target.tagName)&&at(e.data.self,t.data._index.row,t.mapping.columnIndex)}),(b.option.enableContextMenu||b.option.enableDefaultContextMenu)&&(T.contextMenuEventNS=".alopexgridContextMenuEvent",_t?(b.$root.on(b.option.contextMenuEvent+E+" touchstart"+E+b.key,T,function(e){var t=e.data.self;if("contextmenu"===t.option.contextMenuEvent){var a=setTimeout(function(){_(t,e,e.data.contextMenuEventNS)},1e3);T.contextMenuEventTimer=a;T.contextMenuTouchEndEventNS=".mobilecontextmenuevent",t.$root.on("touchend"+E+".mobilecontextmenuevent"+t.key+" touchcancel"+E+".mobilecontextmenuevent"+t.key+" mousedown"+E+".mobilecontextmenuevent"+t.key,T,function(e){var t=e.data.self;null!=e.data.contextMenuEventTimer&&(clearTimeout(e.data.contextMenuEventTimer),e.data.contextMenuEventTimer=null),t.$root.off(E+e.data.contextMenuTouchEndEventNS+t.key)})}else _(t,e,e.data.contextMenuEventNS)}),Ct.on("touchmove"+E+b.key,T,function(e){null!=e.data.contextMenuEventTimer&&(clearTimeout(e.data.contextMenuEventTimer),e.data.contextMenuEventTimer=null),e.data.self&&e.data.self.state&&e.data.self.state.$contextMenuDropdown&&(e.data.self.state.$contextMenuDropdown.parents(".alopexgrid-contextmenu-wrapper").remove(),e.data.self.state.$contextMenuDropdown.remove(),e.data.self.state.$contextMenuDropdown=null)})):b.$root.on(b.option.contextMenuEvent+E,T,function(e){_(e.data.self,e,e.data.contextMenuEventNS)})),b.option.pager&&(b.$pager.on("click"+E,".page-set",T,function(t){var a=t.data.self,n=this.getAttribute("href").split("#").pop();e(this).parent().removeClass("hovering"),a.pageSet(n),t.preventDefault()}).on("mouseover"+E,".page-button",function(){var t=e(this);t.siblings().removeClass("hovering"),t.addClass("hovering")}).on("mouseout"+E,".page-button",function(){e(this).removeClass("hovering").siblings().removeClass("hovering")}),b.$pager.on("change"+E,".perPage",T,function(t){var a=t.data.self,n=parseInt(e(this).val()),r=a.pageInfo(),o=r.current;if(!1!==a._triggerGridEvent("perPageChange",{pageinfo:r,perPage:n})){var l=Math.ceil(a.pageInfo().rowCount/n);r.current>l&&(o=l),a.updateOption({pager:!0,paging:{perPage:n,current:o}}),a._triggerGridEvent("perPageChangeEnd",{perPage:n,pageinfo:a.pageInfo()})}})),b.option.autoResize&&yt.on("resize"+E+b.key+b.eventns,{self:b,timer:null,winw:null,winh:null},function(e){var t=e.data.self,a=yt.height(),n=yt.width();if(e.data.winw!==n||e.data.winh!==a){e.data.winw=n,e.data.winh=a;var r=t.option&&t.option.autoResizeDelay?t.option.autoResizeDelay:0,o=e.data;e.data.timer&&clearTimeout(e.data.timer),e.data.timer=setTimeout(function(){t.viewUpdate(),o.timer=null},r)}}),b._activateBoardScrollEvent(),b.option.tree&&b.option.tree.useTree&&b.$root.on("click"+E,".alopexgrid-treecolumn-icon",T,function(t){var a=t.data.self;if(a.state.treeInfo&&a.state.treeInfo.childCountByIdValueMap&&!e.isEmptyObject(a.state.treeInfo.childCountByIdValueMap)){var n=e(this),r=n.closest(".alopexgrid-cell"),o=g(a,r[0]),l=bodycell=!1,d=null;if(r.hasClass("headercell")){t.stopPropagation();var s=a.state.treeHeaderExpandAllState;a.state.treeHeaderExpandAllState=!a.state.treeHeaderExpandAllState,s?(n.removeClass("expanded"),
a.collapseTreeNode({}),d=!1):(n.addClass("expanded"),a.expandTreeNode({}),d=!0),l=!0}else if(o&&!a._isTreeLeafNode(o)){parseInt(r.attr("data-alopexgrid-rowindex")),parseInt(r.attr("data-alopexgrid-columnindex"));t.stopPropagation(),a.toggleTreeNode(o),d=o._state.expandedTreeNode,i(),t.preventDefault(),bodycell=!0}a._triggerGridEvent("UIToggleTreeNode",{toggleTreeNode:o,headercell:l,bodycell:bodycell,expanded:d})}}),b.option.useClassHovering){var Y={self:b};b.$root.on("mouseenter"+E,".bodycell",Y,function(t){var a=t.data.self,n=g(a,this);if(n){var r=[n];if(a.state.groupRowspanned&&(!0===a.option.rowspanGroupHovering||"number"==typeof a.option.rowspanGroupHovering||"string"==typeof a.option.rowspanGroupHovering)){var o=a.option.grouping.by[0];"number"==typeof a.option.rowspanGroupHovering?o=a.option.grouping.by[a.option.rowspanGroupHovering]:"string"==typeof a.option.rowspanGroupHovering?o=a.option.rowspanGroupHovering:!0===a.option.rowspanGroupHovering&&(o=a.state.topmostGroupRowspanKey);var l=a._getGroupingRange(n._index.data,o);if(l){var i=l.from,d=l.to;r=[];for(var s=i;s<=d;s++)r.push(a.state.data[s])}}for(var p=[],u=0,c=r.length;u<c;u++){var n=r[u];p=p.concat(e.makeArray(a.rowElementGet({_index:{id:n._index.id}},Ht.cache)))}for(var u=0,c=p.length;u<c;u++)At.renderUtil.addClass(p[u],"cell-hoveringrow")}}),b.$root.on("mouseleave"+E,".bodycell",Y,function(t){var a=t.data.self,n=g(a,this);if(n){var r=[n],o=[];if(a.state.groupRowspanned&&(!0===a.option.rowspanGroupHovering||"number"==typeof a.option.rowspanGroupHovering||"string"==typeof a.option.rowspanGroupHovering)){var l=a.option.grouping.by[0];"number"==typeof a.option.rowspanGroupHovering?l=a.option.grouping.by[a.option.rowspanGroupHovering]:"string"==typeof a.option.rowspanGroupHovering&&(l=a.option.rowspanGroupHovering);var i=a._getGroupingRange(n._index.data,l);if(i){var d=i.from,s=i.to;r=[];for(var p=d;p<=s;p++)r.push(a.state.data[p])}}for(var u=0,c=r.length;u<c;u++){var n=r[u];o=o.concat(e.makeArray(a.rowElementGet({_index:{id:n._index.id}},Ht.cache)))}for(var u=0,c=o.length;u<c;u++)At.renderUtil.removeClass(o[u],"cell-hoveringrow")}})}var X=!!(b.option.grouping&&b.option.grouping.useGrouping&&b.option.grouping.by&&b.option.grouping.by.length),z=!(!X||!b.option.grouping.useGroupHeader),j=!(!X||!b.option.grouping.useGroupFooter);if((z||j)&&b.$root.on("click"+E,".alopexgrid-groupfolding-icon",T,function(t){var a=t.data.self;if(e(t.target).closest(".headercell").length){var n=At.parseEvent(t),r=n.mapping,o=this.getAttribute("data-alopexgrid-groupfolding-depth");e.isNumeric(o)?o=parseInt(o):"true"===o&&(o=null),a._applyGroupFoldingStateToHeader([r.key],"toggle");var l=!a.state.headerGroupFoldingIconCollapsed[r.id],d=[];return"number"!=typeof o&&"string"!=typeof o||d.push(o),void(l?a.expandGroup.apply(a,d):a.collapseGroup.apply(a,d))}var s=this.getAttribute("data-alopexgrid-rangeid"),p=a.state.groupingLookupTableMapById[s];p&&(t.preventDefault(),a._toggleCollapseGroupRange(p),a.filterAndRedraw(),i())}),b.state.hasColumnFoldingColumn){var q="click";It&&(q="touchstart"),b.$root.on(q+E,".header-columnfolding-icon",T,function(t){var a=t.data.self,n=At.parseEvent(t),r=n.mapping;if(r){var o,l,i=r.columnIndex,d=[];if(e.isArray(r.columnFoldingColumn))var o=a._columnIndexKeyToMappingList(r.columnFoldingColumn[0]),l=a._columnIndexKeyToMappingList(r.columnFoldingColumn[1]);else{var s,o=a._columnIndexKeyToMappingList(r.columnFoldingColumn.fromIndex),l=a._columnIndexKeyToMappingList(r.columnFoldingColumn.toIndex),p=r.columnFoldingColumn.exceptionColList;if(p&&p.length>0)for(var u=0,c=p.length;u<c;u++)(s=a._columnIndexKeyToMappingList(p[u]))&&s.length&&d.push(s[0].columnIndex)}if(o&&o.length){var g=o[0],f=g.columnIndex;if(l&&l.length){var h=l[0],m=h.columnIndex,v=!0;null!=r.columnFoldingHiddenType&&(v=r.columnFoldingHiddenType),a._toggleColumnFold(f,m,i,d,v),e.isArray(r.columnFoldingColumn)?a._triggerGridEvent("columnFolding",{mapping:r,columnFolded:r.columnFolded,fromIndex:f,toIndex:m}):a._triggerGridEvent("columnFolding",{mapping:r,columnFolded:r.columnFolded,fromIndex:f,toIndex:m,exceptionColList:d})}}}})}},At.prototype._version=function(){return this.version},At.prototype.updateOption=function(a){function n(t,a){if(!0===a.hidden)null==t.state.hiddenColumnIndexToMapping[a.columnIndex]?(-1===e.inArray(a.columnIndex,t.state.hiddenColumnIdxArr)&&(t.option.hiddenColumnOrderList.push(a.columnIndex),t.state.hiddenColumnIdxArr.push(a.columnIndex)),t.state.hiddenColumnIndexToMapping[a.columnIndex]=a):-1===e.inArray(a.columnIndex,t.state.hiddenColumnIdxArr)?(t.option.hiddenColumnOrderList.push(a.columnIndex),t.state.hiddenColumnIdxArr.push(a.columnIndex),t.state.hiddenColumnIndexToMapping[a.columnIndex]=a):t.state.hiddenColumnIndexToMapping[a.columnIndex].id!==a.id&&(t.state.hiddenColumnIndexToMapping[a.columnIndex]=a);else if((null==a.hidden||!1===a.hidden||"conceal"===a.hidden)&&(null!=a.hidden&&"conceal"!==a.hidden&&(a.hidden=!1),null!=t.state.hiddenColumnIndexToMapping[a.columnIndex])){var n=e.inArray(a.columnIndex,t.state.hiddenColumnIdxArr);-1!==n&&(t.option.hiddenColumnOrderList.splice(n,1),t.state.hiddenColumnIdxArr.splice(n,1)),delete t.state.hiddenColumnIndexToMapping[a.columnIndex]}}function r(t,a,n){var r={};if(r.mapping=e.extend(!0,{},n),r.columnIndex=t,r.toColumnIndex=a,r.groupMappingList=[],r.groupColumnIndexes=[],r.visibleIndex=ne[t],r.isGroup=!0,r.colspan=0,!0===o.option.enableHeaderGroupResizing){for(var l=[],i=t;i<=a;i++){var d=o.state.columnIndexToMapping[i];d&&d.columnIndex>=0&&me(d)&&(d.resizing&&l.push(d.columnIndex))}l.length&&(r.mapping.resizing=l)}for(var i=t;i<=a;i++){var d=o.state.columnIndexToMapping[i];d&&d.columnIndex>=0&&me(d)&&(r.colspan+=1,r.groupMappingList.push(d),r.groupColumnIndexes.push(i),!0===n.hideSubTitle&&(ee[d.columnIndex]=[]),ee[d.columnIndex].unshift(r))}var s=e.extend(!0,{groupMappingList:r.groupMappingList,groupColumnIndexes:r.groupColumnIndexes},n);o.state.headerGroupArr.push(s),o.state.headerGroupById[n.id]=s,null!==n.key&&void 0!==n.key&&(o.state.headerGroupByKey[n.key]=s)}var o=this,l=o.option;o.$wrapper,o.$pager,o.$title,o.$columnhiddenarea,o.$root;if(D(o,a)){l=o.option=e.extend(!0,{},o.option,a||{});for(var i=["columnMapping","headerGroup","instantInlineEditType","contextMenu"],p=0;p<i.length;p++){var c=i[p];a&&a.hasOwnProperty(c)&&(l[c]=e.extend(!0,[],a[c]))}a&&a.hasOwnProperty("footer")&&(l.footer=e.extend({},l.footer,a.footer))}else T(o,a),l=o.option;d(a)&&((a.rowPadding||a.rowpadding)&&(o.option.rowPadding=a.rowPadding||a.rowpadding),!0===o.state.fitTableWidthFixed&&(a.columnMapping||a.fitTableWidth)&&(o.state.fitTableWidthFixed=!1),a.cellCache&&!1===a.cellCache.enabled&&o._clearCellCache());var g=o._getGridOptionHeightValue(),f=o._getGridOptionWidthValue();if(o.state.gridOptionHeight=g,o.state.gridOptionWidth=f,"content"===g&&(o.option.rowFixShowFrom=null),"content"===f&&(o.option.columnFixShowFrom=null),o.option.columnMapping){o.state.keyMappedToMultipleColumn=!1,o.state.columnMappedKey={},o.state.columnIndexToKeyMap={},o.state.columnKeyToIndexMap={},o.state.columnIndexToMapping={},o.state.columnIdToMapping={},o.state.columnKeyToMapping={},o.state.columnMappingMapById={},o.state.multiColumnList=[],o.state.groupingColumnIndexToKey={},o.state.groupingColumnIndexToMapping={},o.state.hiddenColumnIdxArr=[];var h=!1;null==o.state.hiddenColumnIndexToMapping?(h=!0,o.state.hiddenColumnIndexToMapping={}):null!=o.option.hiddenColumnOrderList&&0===o.option.hiddenColumnOrderList.length?(h=!0,o.state.hiddenColumnIndexToMapping={}):0==o.option.columnMapping.length&&(h=!0,o.state.hiddenColumnIndexToMapping={},o.option.hiddenColumnOrderList=[]);for(var m=0,v=o.option.columnMapping.length;m<v;m++){var x=o.option.columnMapping[m];if(x.extend&&!x.extended){var y=x.extend;e.isArray(y)||(y=[y]);for(var C={},I=0,_=y.length;I<_;I++){var w=At.commonOption.definition[y[I]];w&&"object"==typeof w&&(C=e.extend(!0,C,w))}C=e.extend(!0,C,x),C.extended=!0,o.option.columnMapping[m]=C}}if(null!==o.option.grouping&&void 0!==o.option.grouping&&!0===o.option.grouping.useGroupColumnRearrange){var b=o.option.grouping.by;if(!0===o.option.autoColumnIndex)for(var M,S,m=0,E=b.length;m<E;m++){M=b[m];for(var F=0,R=o.option.columnMapping.length;F<R;F++)if(S=o.option.columnMapping[F],S.key===M){var k=o.option.columnMapping.splice(F,1);o.option.columnMapping.splice(m,0,k[0])}}else{o.option.columnMapping.sort(function(e,t){var a=u(e.columnIndex)?Number(e.columnIndex):1/0,n=u(t.columnIndex)?Number(t.columnIndex):1/0;return a>n?1:a<n?-1:0}),o.state.columnIndexArrOrderMap={},o.state.columnIndexArr=[];for(var S,m=0,v=o.option.columnMapping.length;m<v;m++)S=o.option.columnMapping[m],o.state.columnIndexArrOrderMap[S.columnIndex]=o.state.columnIndexArr.length,o.state.columnIndexArr.push(S.columnIndex);for(var M,m=0,E=b.length;m<E;m++){M=b[m];for(var F=0,R=o.option.columnMapping.length;F<R;F++)if(S=o.option.columnMapping[F],S.key===M){var k=o.option.columnMapping.splice(F,1);o.option.columnMapping.splice(m,0,k[0])}}for(var m=0,v=o.option.columnMapping.length;m<v;m++)S=o.option.columnMapping[m],S.columnIndex=o.state.columnIndexArr[m]}}o.state.columnIdUniqueNumber=o.state.columnIdUniqueNumber||0;for(var L=0;L<o.option.columnMapping.length;L++){var x=o.option.columnMapping[L];if(!0===o.option.autoColumnIndex&&(x.columnIndex=parseInt(L)),x.hasOwnProperty("key")){if(o.state.columnMappedKey[x.key]=!0,o.state.columnKeyToIndexMap.hasOwnProperty(x.key)){if(o.state.keyMappedToMultipleColumn=o.state.keyMappedToMultipleColumn||{},o.state.keyMappedToMultipleColumn[x.key]=o.state.keyMappedToMultipleColumn[x.key]||[],0===o.state.keyMappedToMultipleColumn[x.key].length){var A=o.state.columnIndexToMapping[o.state.columnKeyToIndexMap[x.key]];o.state.keyMappedToMultipleColumn[x.key].push(A)}o.state.keyMappedToMultipleColumn[x.key].push(x)}o.state.columnKeyToIndexMap[x.key]=parseInt(x.columnIndex),o.state.columnKeyToMapping[x.key]=x}if(x.multi&&x.multi.length)for(var O=0,P=x.multi.length;O<P;O++){var B=x.multi[O];B&&B.key&&(o.state.columnMappedKey[B.key]=!0,o.state.columnKeyToIndexMap[B.key]=parseInt(x.columnIndex))}if(x.hasOwnProperty("columnIndex")&&(o.state.columnIndexToKeyMap[x.columnIndex]=String(x.key),o.state.columnIndexToMapping[x.columnIndex]=x),x.id=x.id||"col"+o.state.columnIdUniqueNumber++,o.state.columnIdToMapping[x.id]=x,o.state.columnMappingMapById.hasOwnProperty(x.id)){for(var G=1;o.state.columnMappingMapById.hasOwnProperty(x.id+"_"+G);)G++;x.id+="_"+G}o.state.columnMappingMapById[x.id]=x,x.multi&&o.state.multiColumnList.push(x)}if(null!==o.option.grouping&&void 0!==o.option.grouping&&!0===o.option.grouping.useGroupColumnRearrange)for(var M,S,b=o.option.grouping.by,m=0,v=b.length;m<v;m++)S=o.option.columnMapping[m],M=b[m],o.state.groupingColumnIndexToKey[S.columnIndex]=M,o.state.groupingColumnIndexToMapping[S.columnIndex]=S;else o.option.columnMapping.sort(function(e,t){var a=u(e.columnIndex)?Number(e.columnIndex):1/0,n=u(t.columnIndex)?Number(t.columnIndex):1/0;return a>n?1:a<n?-1:0});var H=-1,N=Number.POSITIVE_INFINITY;o.state.hasSelectorColumn=!1,o.state.hasRowindexColumn=!1,o.state.hasColumnFoldingColumn=!1,o.state.dataCompositorMap=[],o.state.dataKeyList=[],o.state.hasColspan=!1,o.state.hasMappingAllowEdit=null,o.state.hasRowAllowEdit=!!o.option.rowOption&&s(o.option.rowOption.allowEdit),o.state.visibleColumnMappingList=[],o.state.visibleColumnMappingSignature="",o.state.visibleColumnIndexArr=[],o.state.visibleIndexMapByColumnIndex={},o.state.visibleIndexMapByKey={};var $=!1;if(o.state.hasLeftColspanMapByColumnIndex={},!0!==o.state.hiddenColumnDraging&&(!1===o.state.showColCalled||null==o.state.showColCalled)||!0!==o.state.showColCalled&&(!1===o.state.hiddenColumnDraging||null==o.state.hiddenColumnDraging))for(var m=0,v=o.option.columnMapping.length;m<v;m++){var x=o.option.columnMapping[m];if(x.columnFoldingColumn){var K=e.type(x.columnFoldingColumn),W=null,U=null,V=null;if("array"===K?(W=x.columnFoldingColumn[0],U=x.columnFoldingColumn[1]):"object"===K&&(W=x.columnFoldingColumn.fromIndex,U=x.columnFoldingColumn.toIndex,V=x.columnFoldingColumn.exceptionColList),"string"==typeof W&&(W=o.state.columnKeyToIndexMap[W]),"string"==typeof U&&(U=o.state.columnKeyToIndexMap[U]),x.columnFolded){var Y=!0;null!=x.columnFoldingHiddenType&&(Y=x.columnFoldingHiddenType),null!=W&&null!=U&&o._hideAllColumnBetween(W,U,V,Y)}else null!=W&&null!=U&&o._showAllColumnBetween(W,U,V)}}o.state.hasMappingRefreshBy=!1,o._columnIndexKeyToIndexArray(o.option.hiddenColumnOrderList,o.state.hiddenColumnIdxArr);for(var L=0;L<o.option.columnMapping.length;L++){var x=o.option.columnMapping[L];d(o.option.defaultColumnMapping)&&e.each(o.option.defaultColumnMapping,function(t,a){x.hasOwnProperty(t)?d(x[t])&&d(a)&&(x[t]=e.extend({},a,x[t])):x[t]=d(a)?e.extend({},a):a}),x.hasOwnProperty("columnIndex")&&(H=Math.max(H,x.columnIndex||0),N=Math.min(N,x.columnIndex)),x.hasOwnProperty("key")&&(o.state.dataKeyList.push(x.key),x.hasOwnProperty("value")&&u(x.key)&&u(x.value)&&o.state.dataCompositorMap.push(x)),x.hasOwnProperty("refreshBy")&&(o.state.hasMappingRefreshBy=!0),x.columnFoldingColumn&&(o.state.hasColumnFoldingColumn=!0),(x.colspan||x.colspanTo)&&(o.state.hasColspan=!0,$=!0),x.editable&&o._isSpecialPurposeColumn(x)&&(x.editable=!1),x.selectorColumn&&(o.state.hasSelectorColumn=o.state.hasSelectorColumn||[],o.state.hasSelectorColumn.push(x),o.state.disableSelectDataIdMap={}),x.rowindexColumn&&(o.state.hasRowindexColumn=!0),x.hasOwnProperty("allowEdit")&&(o.state.hasMappingAllowEdit=o.state.hasMappingAllowEdit||[],o.state.hasMappingAllowEdit.push(x)),h?o.option.hiddenColumnOrderList&&o.option.hiddenColumnOrderList.length>0&&-1!==e.inArray(x.columnIndex,o.state.hiddenColumnIdxArr)?(x.hidden=!0,o.state.hiddenColumnIndexToMapping[x.columnIndex]=x):n(o,x):(null!=a&&!0===a.hasOwnProperty("hiddenColumnOrderList")&&o.option.hiddenColumnOrderList&&o.option.hiddenColumnOrderList.length>0&&-1!==e.inArray(x.columnIndex,o.state.hiddenColumnIdxArr)&&(x.hidden=!0),n(o,x)),x&&me(x)&&(o.state.visibleColumnMappingList.push(x),o.state.visibleColumnIndexArr.push(x.columnIndex),o.state.hasLeftColspanMapByColumnIndex[x.columnIndex]=$,o.state.visibleColumnMappingSignature+=x.id)}var X=-1,z=0,j=[],q=0;o._columnShowFromEnabled()&&(o._limitRenderFromByFixCount(),q=o.state.columnFixShowFromColumnIndex||0);for(var L=0;L<o.option.columnMapping.length;L++){var x=o.option.columnMapping[L];if(null!=x.columnIndex&&!0!==x.hidden&&"conceal"!==x.hidden&&!(x.columnIndex<q)){if("number"==typeof o.option.columnFixUpto)x.fixed=x.columnIndex<=o.option.columnFixUpto;else if("unfix"===o.option.columnFixUpto)x.fixed=!1;else if("string"==typeof o.option.columnFixUpto){var Z=o._getColumnByKey(o.option.columnFixUpto);Z&&(x.fixed=x.columnIndex<=Z.columnIndex)}if(!x.fixed)break;X=x.columnIndex,z+=parseInt(x.width),j.push(x)}}if("unfix"===o.option.columnFixUpto&&delete o.option.columnFixUpto,o.state.fixupto=X,o.state.fixedColumnWidth=z,o.state.fixedColumnMapping=j,o.state.groupingKeyMap={},o.option.grouping&&o.option.grouping.useGrouping&&o.option.grouping.by)for(var m=0,v=o.option.grouping.by.length;m<v;m++)o.state.groupingKeyMap[o.option.grouping.by[m]]=m;for(var Q=0;Q<o.state.visibleColumnMappingList.length;Q++){var x=o.state.visibleColumnMappingList[Q];o.state.visibleIndexMapByColumnIndex[x.columnIndex]=Q,o.state.visibleIndexMapByKey[x.key]=Q}o.state.visibleColumnCount=o.state.visibleColumnMappingList.length,o._generateFilterColumnList(),o._calculateColumnWidthProperty();for(var J=o.state.visibleColumnMappingList,ee=(o.state.visibleColumnCount,{}),te=!1,ae=o.state.fixupto,ne=o.state.visibleIndexMapByColumnIndex,re=0,oe=0,le=J.length;oe<le;oe++){var x=J[oe],ie={};ie.mapping=x,ie.columnIndex=x.columnIndex,ie.visibleIndex=oe,ie.isGroup=!1,ee[x.columnIndex]=[ie]}if(o.state.headerGroupById={},o.state.headerGroupByKey={},o.state.headerGroupArr=[],o.state.headerGroupIdUniqueNumber=o.state.headerGroupIdUniqueNumber||0,o.option.headerGroup&&o.option.headerGroup.length)for(var m=o.option.headerGroup.length-1;m>=0;m--){var de=o.option.headerGroup[m];if(null!=de){null!==de.id&&void 0!==de.id||(de.id=o.state.headerGroupIdUniqueNumber++);var se=null,pe=null;if(!de)continue;if("number"==typeof de.fromIndex)se=parseInt(de.fromIndex);else if("string"==typeof de.fromIndex){var ue=o._getColumnByKey(de.fromIndex);ue&&(se=ue.columnIndex)}if("number"==typeof de.toIndex)pe=parseInt(de.toIndex);else if("string"==typeof de.toIndex){var ce=o._getColumnByKey(de.toIndex);ce&&(pe=ce.columnIndex)}if(null!=se&&null!=pe){var ge=o._columnIndexOrder(ae)+1,fe=o.state.columnIndexArr[ge];ae>=se&&ae<pe?(r(se,ae,de),r(fe,pe,de)):r(se,pe,de)}else!0===de.hideSubTitle&&(te=!0)}}for(var c in ee){var he=ee[c];te&&he.splice(1,he.length-1),re=Math.max(he.length,re)}for(var c in ee){for(var he=ee[c],ve=he.length-1;ve>=0;ve--){var ie=he[ve];if(ie.mapping&&ie.mapping.rowspan){ie.rowspan=parseInt(ie.mapping.rowspan);for(var ye=0,Ce=ie.rowspan-1;ye<Ce;ye++)he.splice(ve+1,0,null)}}re=Math.max(he.length,re)}for(var c in ee){var he=ee[c];if(he.length<re){var Ie=he[he.length-1];if(!Ie){for(var _e=0,m=re-1;m>=0;m--){if(he[m]){he[m].rowspan=_e+1;break}_e++,he[m]=null}continue}for(var we=0,m=0,v=he.length;m<v-1&&m<re;m++)he[m]&&(we+=parseInt(he[m].rowspan||1));Ie.rowspan=Math.min(re,re-we);for(var ve=1;ve<Ie.rowspan;ve++)he.push(null)}}for(var c in ee)for(var he=ee[c],be=!0,m=he.length-1;m>=0;m--)he[m]&&(!1===be&&(he[m].disableResizing=!0),he[m]&&he[m].mapping&&he[m].mapping.resizing&&(be=!1));if(o.state.headerDepth=re,o.option.filteringHeader){for(var c in ee){var he=ee[c],ie={filter:!0,columnIndex:parseInt(c)};he.push(ie)}re+=1}o.state.columnHeaderDepth=re,o.state.columnHeaderStackMap=ee;var Me=e('<div class="'+ct+'"><div class="wrapper"></div></div>'),Se=e('<div class="alopexgrid-cell cell bodycell" style="top:-999px;left:-999px;">&nbsp;</div>'),Ee=e('<div class="alopexgrid-cell cell headercell" style="top:-999px;left:-999px;">&nbsp;</div>');o.$root.is(":visible")?o.$wrapper.append(Se,Ee):(Me.css("position","absolute").css("top","-9999px").css("left","-9999px").appendTo(document.body),Me.children().append(Se,Ee)),o.state.rowHeight=(o.option.rowOption&&e.isNumeric(o.option.rowOption.defaultHeight)?o.option.rowOption.defaultHeight:0)||Se.outerHeight(),o.state.headerRowHeight=Ee.outerHeight(),Se.remove(),Ee.remove(),Me.remove(),o.state.emptyData={_index:{},_state:{}};for(var ve=0,Te=o.state.dataKeyList.length;ve<Te;ve++){var F=o.state.dataKeyList[ve];o.state.emptyData[F]="",o.option.tree&&o.option.tree.useTree&&(o.option.tree.idKey===F?o.state.emptyData[F]=o.option.tree.initialIdValue:o.option.tree.parentIdKey===F&&(o.state.emptyData[F]=o.option.tree.rootNodeParentIdValue))}for(var De=[],m=0,v=o.option.columnMapping.length;m<v;m++){var x=o.option.columnMapping[m];x.hasOwnProperty("columnIndex")&&x.key&&x.editable&&De.push(x.columnIndex+':(data.hasOwnProperty("'+x.key+'")?data["'+x.key+'"]:"")')}o.state.getEditingAllState=new Function("data","return {"+De.join(",")+"};"),o.state.dataCompositor=null,o.state.dataCompositorMap.length&&(o.state.dataCompositor=function(e,t){for(var a in e.state.dataCompositorMap){var n=e.state.dataCompositorMap[a];t[n.key]=s(n.value)?n.value(t[n.key],t,n):n.value}return t});var Fe={};e.each(o.option.columnMapping,function(e,a){!(!a||!a.hasOwnProperty("defaultValue"))&&(Fe[a.id]=!!s(a.defaultValue)||t)});var ke=!1!==o.option.fillUndefinedKey,Le=ke||!e.isEmptyObject(Fe),Ae=o.option.trimUnmappedKey;o.state.dataFilltrimmer=null;var Oe=e.isArray(Ae),Pe={_state:!0,_index:!0,_key:!0,_edited:!0};(Ae||Le)&&(o.state.dataFilltrimmer=function(t,a){if(Le)for(var n=0,r=t.option.columnMapping.length;n<r;n++){var o=t.option.columnMapping[n],l=o.key;l&&null==a[l]&&(Fe[o.id]&&(a[l]=!0===Fe[o.id]?o.defaultValue(a):o.defaultValue),ke&&null==a[l]&&(a[l]=!0===t.option.fillUndefinedKey?"":t.option.fillUndefinedKey))}if(Ae)for(var i in a)a.hasOwnProperty(i)&&!Pe[i]&&(Oe&&e.inArray(i,Ae)>=0||t.state.columnMappedKey[i]||delete a[i])}),o.state.minColumnIndex=N,o.state.maxColumnIndex=H}if(o.state.rowHeightMapByDataId=o.state.rowHeightMapByDataId||{},o.state.testRowAllowSelect=!(!o.option.rowOption||!s(o.option.rowOption.allowSelect)),o.state.testRowAllowPaste=!1,o.option.rowOption&&null!=o.option.rowOption.allowPaste&&(o.state.testRowAllowPaste=e.type(o.option.rowOption.allowPaste)),o.state.renderRuleKeyNormalizeMap={text:"text",value:"value",html:"html",checked:"checked"},o.option.renderRuleOption)for(var c in o.option.renderRuleOption)"textKey"===c&&(o.state.renderRuleKeyNormalizeMap[o.option.renderRuleOption[c]]="text"),"valueKey"===c&&(o.state.renderRuleKeyNormalizeMap[o.option.renderRuleOption[c]]="value"),"htmlKey"===c&&(o.state.renderRuleKeyNormalizeMap[o.option.renderRuleOption[c]]="html"),"checkedKey"===c&&(o.state.renderRuleKeyNormalizeMap[o.option.renderRuleOption[c]]="checked");if(o.option.tree&&o.option.tree.useTree?(o.state.treeOption={},o.state.treeOption.expandedValue=o.option.tree.expandedValue||At.defaultOption.tree.expandedValue,o.state.treeOption.leafValue=o.option.tree.leafValue||At.defaultOption.tree.leafValue,o.state.treeOption.initialExpandedValue=o.option.tree.hasOwnProperty("initialExpandedValue")?o.option.tree.initialExpandedValue:At.defaultOption.tree.initialExpandedValue,o.state.treeOption.depthStartValue=o.option.tree.depthStartValue||0):delete o.state.treeOption,o.state.cellCacheEnabled=!(!o.option.cellCache||!o.option.cellCache.enabled),o.state.rowSingleSelect=!("only"!==o.option.rowSelectOption.clickSelect&&!o.option.rowSelectOption.singleSelect),e.isArray(o.option.data)){var Be=o.option.data;o.option.data=null,o.dataSet(Be,!0)}o.option.cellSelectable||o.option.enableHeaderSelect||o.state.hasRowindexColumn||o.option.disableTextSelection?o.$wrapper.addClass("text-selection-disabled").attr("unselectable","on"):o.$wrapper.removeClass("text-selection-disabled").removeAttr("unselectable"),a&&!1===a.disableFocusedState&&o._rowUnfocusAll(),o.option.cellInlineEdit&&(o.option.rowInlineEdit=!1);var Ge=!1;a&&(a.grouping&&(Ge=!0),a.tree&&(Ge=!0)),o.state.sortingRequired&&(Ge=!0),Ge&&(o._sortInternalData(),o.state.sortingRequired=!1),o._generateRenderTargetData(),o.state.renderingSuppressed||(xe(o),Re(o),o.viewUpdate(!0)),o.viewEventUpdate();for(var m=0,v=At.plugin.length;m<v;m++){var He=At.plugin[m];s(He)&&He.call(o,o,o.option,o.state)}},At.prototype._noData=function(){return!this.state.data||!this.state.data.length},At.prototype._dataMoveByDataindex=function(e,t){if(this.state.data&&this.state.data.length){var a=this.state.data;a.splice(t+(t>e?-1:0),0,a.splice(e,1)[0])}},At.prototype.dataMove=function(e,t,a){var n=this;if(!n._noData()&&!A(e)&&!A(t)){var r=n._dataGet(e),o=n._dataGet(t);if(r&&o&&r.length&&o.length&&o[0]&&o[0]._index){var l=o[0]._index.data;if(u(l)){for(var i=O(n,r,!0),d=0;d<n.state.data.length;d++){var s=n.state.data[d];if(s&&s._index&&l<=s._index.data){var p=0;!0===a&&l===s._index.data&&p++,l=d+p;break}}l>=0&&n.state.data.splice.apply(n.state.data,[l,0].concat(i)),n.sortClear(),n.calcAndRedraw()}}}},At.prototype.dataAdd=function(t,a){var n=this;if(t){n.state.data||(n.state.data=[]);var r=e.isArray(t)?t:[t];if(r.length){if(!1===n._triggerGridEvent("dataAdd",{datalist:r}))return!1;delete n.state.cellSelection,n._rowSelectAllUncheck();var o=(n.state.data.length,!e.isEmptyObject(n.option.defaultState.dataAdd)&&n.option.defaultState.dataAdd),l=n.option.defaultState.dataAdd,d=!!n.state.hasRowAllowEdit,s=n.state.hasMappingAllowEdit&&n.state.hasMappingAllowEdit.length,p=a&&a._state,u=a&&a._index,c=!!(n.option.tree&&n.option.tree.useTree&&n.state.treeInfo),g=n.option.tree&&n.option.tree.useTree&&a&&a.parentQuery,f=null,h=null,m=null,v="number"===n.option.tree.depthValueType?0:"";g&&(f=n._dataGet(a.parentQuery)[0])&&(h=f[n.option.tree.idKey]),c&&(m=n.state.treeOption.expandedValue[n.state.treeOption.initialExpandedValue?0:1]);for(var x=P(n),y=(r.length,0),C=r.length;y<C;y++){var I=r[y];if(null!=I){var _=I._state;if(I._state={edited:!1,editing:!1,selected:!1,added:!0,deleted:!1},o&&("boolean"==typeof l.edited&&(I._state.edited=l.edited),"boolean"==typeof l.editing&&(I._state.editing=l.editing),"boolean"==typeof l.selected&&(I._state.selected=l.selected),"boolean"==typeof l.added&&(I._state.added=l.added),"boolean"==typeof l.deleted&&(I._state.deleted=l.deleted)),n.option.extendStateOnAdd&&_&&("boolean"==typeof _.edited&&(I._state.edited=_.edited),"boolean"==typeof _.editing&&(I._state.editing=_.editing),"boolean"==typeof _.selected&&(I._state.selected=_.selected),"boolean"==typeof _.added&&(I._state.added=_.added),"boolean"==typeof _.deleted&&(I._state.deleted=_.deleted)),p&&!1===a._state.added&&(I._state.added=!1),I._index=I._index||{},n._giveDataId(I),d&&!1===n.option.rowOption.allowEdit.call(n,I)&&(I._state.editing=!1),!0===I._state.editing){if(I._state.editing=n.state.getEditingAllState(I),s){for(var w=0;w<s;w++)!1===n._isCellEditable(I,n.state.hasMappingAllowEdit[w])&&delete I._state.editing[n.state.hasMappingAllowEdit[w].columnIndex];e.isEmptyObject(I._state.editing)&&(I._state.editing=!1)}I._state.editing&&n.option.parseValueOnStartEdit&&n._startupUpdateEditingData(I)}if(c){if(null!=f?I[n.option.tree.parentIdKey]=h:null==I[n.option.tree.parentIdKey]&&(I[n.option.tree.parentIdKey]=n.option.tree.rootNodeParentIdValue),n.option.tree.depthKey){var b=n.state.treeInfo.depthByIdValueMap[I[n.option.tree.parentIdKey]];I[n.option.tree.depthKey]=n.state.treeOption.depthStartValue+(null!=b?b+1:0)+v}n.option.tree.leafKey&&(I[n.option.tree.leafKey]=n.state.treeOption.leafValue[0]),n.option.tree.expandedKey&&void 0==I[n.option.tree.expandedKey]&&(I[n.option.tree.expandedKey]=m),(null==I[n.option.tree.idKey]||n.state.treeInfo.idValueToDataIdMap[I[n.option.tree.idKey]])&&(I[n.option.tree.idKey]=n._getUniqueIdValueForTreeNode(I))}x(At,n,I)}}var M=n.state.data.length;if(u)if(null!=a._index.data)M=parseInt(a._index.data);else if(null!=a._index.row){var S=n.state.renderTargetDataList[a._index.row];S&&null!=S._index.data&&(M=S._index.data)}M=Math.max(0,Math.min(n.state.data.length,M)),(null==M||isNaN(M))&&(M=n.state.data.length),M===n.state.data.length?Array.prototype.push.apply(n.state.data,r):(r.unshift(M,0),n.state.data.splice.apply(n.state.data,r),r.shift(),r.shift()),n.state.dynamicBinding||n.sortClear(),n.state.scrollyEnd=!1,n.state.renderingSuppressed?(n._sortInternalData(),n._generateRenderTargetData()):(i(),n.calcAndRedraw()),setTimeout(function(){n._triggerGridEvent("dataAddEnd",{datalist:r}),n._triggerGridEvent("dataChanged",{type:"add",datalist:r})},0)}}},At.prototype._giveDataId=function(e){var t=this;e._index.id=o(),e._index.grid=t.key,null==t.state.dataMapById&&(t.state.dataMapById={}),t.state.dataMapById[e._index.id]=e},At.prototype._clearData=function(){var e=this;qe(e),e.clearFilter(!0),e._rowSelectAllUncheck(),e.option.disableSortClearOnReset||e.sortClear({noEventTriggering:!0}),delete e.state.cellSelection,delete e.state.rowHeightMapByDataId,delete e.state.pinnedDataIdList,delete e.state.pinnedDataIdMap,delete e.state.treeHeaderExpandAllState,delete e.state.data,delete e.state.dataMapById,delete e.state.deletedData,delete e.state.headerGroupFoldingIconCollapsed,delete e.state.groupFooterDataMapById,delete e.state.groupHeaderDataMapById,e.state.lastInvalidEditingCell=[],e.state.searchStatus=null,e.state.rowHeightMapByDataId={},e.state.data=[],e.state.dataMapById={},e.state.deletedData=[],e._clearCellCache(),e.option.paging&&(e.option.paging.current=1,delete e.option.paging.customPaging),e.state.pagingInfo&&e.state.pagingInfo.customPaging&&delete e.state.pagingInfo.customPaging},At.prototype._filterDataSet=function(t){var a=this;if(t){if(e.isArray(t)||(t=[t]),!t.length)return void a.dataEmpty();a.state.dataMapById={},a.state.filterDataMapByLabel={};for(var n=0,r=t.length;n<r;n++){var o=t[n];null!=o&&(o._state=o._state,o._index={},a._giveDataId(o),o._index.data=n,a.state.filterDataMapByLabel[o.label]=o,a.state.data.push(o))}a._processDefaultSorting(),a.state.dynamicBinding=!1,a.calcAndRedraw()}},At.prototype.dataSet=function(t,a){if(t){var n=this;if(e.isArray(t)||(t=[t]),!t.length)return void n.dataEmpty();if(!1===n._triggerGridEvent("dataSet",{datalist:t}))return!1;n._clearData();for(var r=!e.isEmptyObject(n.option.defaultState.dataSet)&&n.option.defaultState.dataSet,o=n.option.defaultState.dataSet,l=!!n.state.hasRowAllowEdit,i=n.state.hasMappingAllowEdit&&n.state.hasMappingAllowEdit.length,s=P(n),p=0,c=t.length;p<c;p++){var g=t[p];if(null!=g){var f=g._state;if(g._state={edited:!1,editing:!1,selected:!1,added:!1,deleted:!1},r&&("boolean"==typeof o.edited&&(g._state.edited=o.edited),"boolean"==typeof o.editing&&(g._state.editing=o.editing),"boolean"==typeof o.selected&&(g._state.selected=o.selected),"boolean"==typeof o.added&&(g._state.added=o.added),"boolean"==typeof o.deleted&&(g._state.deleted=o.deleted)),n.option.extendStateOnSet&&f&&("boolean"==typeof f.edited&&(g._state.edited=f.edited),"boolean"==typeof f.editing&&(g._state.editing=f.editing),"boolean"==typeof f.selected&&(g._state.selected=f.selected),"boolean"==typeof f.added&&(g._state.added=f.added),"boolean"==typeof f.deleted&&(g._state.deleted=f.deleted)),g._index=g._index||{},n._giveDataId(g),g._index.data=p,s(At,n,g),l&&!1===n.option.rowOption.allowEdit.call(n,g)&&(g._state.editing=!1),!0===g._state.editing){if(g._state.editing=n.state.getEditingAllState(g),i){for(var h=0;h<i;h++)!1===n._isCellEditable(g,n.state.hasMappingAllowEdit[h])&&delete g._state.editing[n.state.hasMappingAllowEdit[h].columnIndex];e.isEmptyObject(g._state.editing)&&(g._state.editing=!1)}g._state.editing&&n.option.parseValueOnStartEdit&&n._startupUpdateEditingData(g)}n.state.data.push(g)}}if(d(a)){var m=e.extend({},a);if(u(m.dataLength)&&u(m.current)){var v={};v.current=Number(m.current),v.dataLength=Number(m.dataLength),v.perPage=Number(m.perPage||n.state.data.length),v.total=Number(v.dataLength&&v.perPage?(v.dataLength/v.perPage|0)+(v.dataLength%v.perPage?1:0):m.total),n.option.paging.customPaging=v}var x=m.sorting||m.sortingKey||m.sortingColumn;null!=x&&n._setSortingInfo(x,m.sortingDirection),n.state.dynamicBinding=!0}else n.option.paging&&n.option.paging.customPaging&&delete n.option.paging.customPaging,n._processDefaultSorting(),n.state.dynamicBinding=!1;n._scrollerReset(),n.state.renderingSuppressed||!0===a?(n._sortInternalData(),n._generateRenderTargetData()):n.calcAndRedraw(),n._triggerGridEvent("dataSetEnd",{datalist:t}),n._triggerGridEvent("dataChanged",{type:"set",datalist:t})}},At.prototype.clear=function(e){this.dataFlush(e),this.dataEmpty()},At.prototype.dataEmpty=function(e){var t=this;if(!1===t._triggerGridEvent("dataEmpty"))return!1;t._clearData(),t._scrollerReset(),t.calcAndRedraw(),t._triggerGridEvent("dataEmptyEnd",{}),t._triggerGridEvent("dataChanged",{type:"empty"})},At.prototype.dataGet=function(t){var a=this,n=a._dataGet.apply(a,arguments);return a.option.deepCopyOnDataGet&&e.isArray(n)&&(n=e.extend(!0,[],n)),n},At.prototype.dataGetByIndex=function(t){var a=this,n=a._dataGetByIndex.apply(a,arguments);return a.option.deepCopyOnDataGet&&d(n)&&(n=e.extend(!0,{},n)),n},At.prototype.dataGetRef=function(e){return this._dataGet.apply(this,arguments)},At.prototype.dataGetByIndexRef=function(e){return this._dataGetByIndex.apply(this,arguments)},At.prototype._dataGetByIndex=function(e){return e&&this.state.data?e.id?this.state.dataMapById[e.id]||null:null!=e.data?this.state.data[e.data]||null:null!=e.row?this.state.renderTargetDataList[e.row]||null:null:null},At.prototype._dataGet=function(t){var a=this,n=[];if(0===arguments.length||1===arguments.length&&e.isEmptyObject(t)&&e.isPlainObject(t))return!a.option.enableDataGetAllByEmptyArray&&e.isArray(t)?n:n.concat(a.state.data);var r=e.makeArray(e.isArray(t)?t:arguments);e.isArray(t)&&!0===arguments[1]&&r.push(!0);var o=!0===arguments[arguments.length-1];if(o)for(;e.inArray(!0,r)>-1;)r.splice(e.inArray(!0,r),1);if(!a.option.leaveDeleted&&r.length){
for(var l=[],i=0,d=r.length;i<d;i++)r[i]&&r[i]._state&&r[i]._state.deleted&&l.push(r[i]);if(l.length)for(var s=a.state.deletedData||[],i=0,d=s.length;i<d;i++){for(var p=s[i],u=!1,c=0,g=l.length;c<g;c++)B(a,s,i,l[c])&&(u=!0);u&&n.push(p)}}if(!r.length)return n.concat(a.state.data);for(var f={},h=!1,i=r.length-1;i>=0;i--)if(r[i]&&r[i]._index&&(r[i]._index.hasOwnProperty("row")||r[i]._index.hasOwnProperty("data")||r[i]._index.id)){var m=a._dataGetByIndex(r[i]._index);m&&(n.unshift(m),f[m._index.id]=!0,h=!0,r.splice(i,1))}if(r.length)if(h){for(var i=0,d=a.state.data.length;i<d;i++)if(!f[a.state.data[i]._index.id])for(var c=0,g=r.length;c<g;c++)if(B(a,a.state.data,i,r[c],o)){n.push(a.state.data[i]);break}}else for(var i=0,d=a.state.data.length;i<d;i++)for(var c=0,g=r.length;c<g;c++)if(B(a,a.state.data,i,r[c],o)){n.push(a.state.data[i]);break}return n},At.prototype._targetDataGet=function(t){var a=this,n=e.isArray(t)?t:e.makeArray(arguments),r=[];if(!n.length||!t){r=[].concat(a.state.targetDataList);for(var o=0,l=r.length;o<l;o++)r[o]=a._makeGroupSummaryAsData(r[o]);return r}for(var o=n.length-1;o>=0;o--)if(n[o]&&n[o]._index&&(n[o]._index.hasOwnProperty("row")||n[o]._index.hasOwnProperty("data")||n[o]._index.id)){var i=a._dataGetByIndex(n[o]._index);i&&null!=i._index.row&&(r.unshift(a._makeGroupSummaryAsData(i)),getByIndexId[i._index.id]=!0,hasGetByIndexId=!0,n.splice(o,1))}for(var o=0,l=a.state.targetDataList.length;o<l;o++)for(var i=a.state.targetDataList[o],d=0,s=n.length;d<s;d++)B(a,a.state.targetDataList,o,n[d])&&r.push(a._makeGroupSummaryAsData(i));return r},At.prototype.columnDataGet=function(e,t){var a=this;if(!a.state.data)return null;if(void 0===e)return a.state.data;if(null===e||"string"!=typeof e&&"number"!=typeof e)return null;if("number"==typeof e&&(e>=Object.keys(a.state.columnIndexToKeyMap).length||e<0))return null;if("string"==typeof e){var n=!1;for(var r in a.state.columnIndexToKeyMap)if(a.state.columnIndexToKeyMap[r]===e){n=!0;break}if(!n)return null}var o=a.option.columnMapping;for(var r in o)if(o[r].selectorColumn||o[r].rowindexColumn||o[r].numberingColumn||o[r].columnFoldingColumn){if("number"==typeof e&&e===o[r].columnIndex)return null;if("string"==typeof e&&e===o[r].key)return null}t||(t={});var l="";if("number"==typeof e){for(var r in a.state.columnIndexToKeyMap)if(e==r){l=a.state.columnIndexToKeyMap[r];break}}else l=e;var i=[],d=[];i=A(t)?a.state.data:a._dataGet(t);for(var s=0;s<i.length;s++)d.push(i[s][l]);return d},At.prototype.dataFlush=function(e,t){var a=this;this.option;"object"==typeof e&&(t=e),t=t||{};var n=[],r=!1;if(s(a.option.flushCallback)){n.push(a.option.flushCallback);var o=f(a.option.flushCallback);o&&3===o.length&&(r=!0)}if(s(e)){n.push(e);var o=f(e);o&&3===o.length&&(r=!0)}if(n.length){var l=this._dataGet({_state:{edited:!0,deleted:!1}},{_state:{added:!0,deleted:!1}}),i=this._dataGet({_state:{deleted:!0}});if(r)var d=a._dataGet({_state:{added:!0,deleted:!1}}),p=a._dataGet({_state:{added:!1,edited:!0,deleted:!1}});for(var u=0,c=n.length;u<c;u++){var o=f(n[u]);o&&3===o.length?n[u].call(a,d,p,i):n[u].call(a,l,i)}}if(!0!==t.noCommit){for(var u=0,c=a.state.data.length;u<c;u++){var g=a.state.data[u],h=!1;g._state&&(g._state.edited||g._state.added)&&!t.leaveEdited&&(g._state.added=!1,g._state.edited=!1,h=!0),h&&(a.state.dataCompositor&&a.state.dataCompositor(a,g),g._original=At.trimData(g))}if(!t.leaveDeleted){if(a.option.leaveDeleted&&a.dataDelete({_state:{deleted:!0}},!0),this.state.deletedData.length)for(var u=0,c=a.state.deletedData.length;u<c;u++)delete a.state.dataMapById[a.state.deletedData[u]._index.id],a._clearCellCacheByDataId(a.state.deletedData[u]._index.id);this.state.deletedData=[]}t.leaveEdited||t.noredraw||a.calcAndRedraw()}},At.prototype.dataRestore=function(t){var a=this,n=a._dataGet(t);if(n&&n.length){for(var r=A(t),o=0,l=0;l<n.length;l++){var i=n[l],d=a.state.data[i._index.data];d._original&&e.extend(d,d._original),d._state.edited&&o++,d._state.edited=!1,r||a.refreshRow(i)}r&&o&&a.calcAndRedraw()}},At.prototype.dataDelete=function(e,t,a){var n=this,r=n._dataGet(e);if(r&&r.length){if(n.option.tree&&n.option.tree.useTree&&(r=n._addTreeChildToList(r)),!0!==a&&!1===n._triggerGridEvent("dataDelete",{datalist:r}))return!1;n.state.deletedData=n.state.deletedData||[],r.sort(function(e,t){return e._index.data-t._index.data});for(var o=0,l=0,i=r.length;l<i;l++){var d=r[l];d._state.deleted=!0,!0===t?(delete n.state.dataMapById[d._index.id],delete n.state.rowHeightMapByDataId[d._index.id],n._clearCellCacheByDataId(d._index.id),n.state.data.splice(d._index.data-o++,1)):n.option.leaveDeleted?d._state.added&&(delete n.state.dataMapById[d._index.id],delete n.state.rowHeightMapByDataId[d._index.id],n.state.data.splice(d._index.data-o++,1),n._clearCellCacheByDataId(d._index.id)):(delete n.state.rowHeightMapByDataId[d._index.id],n.state.deletedData.push(d),n.state.data.splice(d._index.data-o++,1)),n.state.dataCompositor&&n.state.dataCompositor(n,d)}!0!==a&&(r&&r.length&&n.calcAndRedraw(),n._triggerGridEvent("dataDeleteEnd",{datalist:r}),n._triggerGridEvent("dataChanged",{type:"delete",datalist:r}))}},At.prototype.dataUndelete=function(e){var t=this;if(t.state.deletedData=t.state.deletedData||[],t.option.leaveDeleted){var a=t._dataGet(e);if(!a||!a.length)return;if(!1===t._triggerGridEvent("dataUndelete",{datalist:a}))return!1;for(var n=0,r=a.length;n<r;n++)a[n]._state.deleted=!1,t.state.dataCompositor&&t.state.dataCompositor(t,a[n]);a.length&&(t.calcAndRedraw(),t._triggerGridEvent("dataUndeleteEnd",{datalist:a}),t._triggerGridEvent("dataChanged",{type:"undelete",datalist:a}))}else{for(var o=0,l=[],i=[],d=[],n=0;n<t.state.deletedData.length;n++)e&&!B(t,t.state.deletedData,n,e)||(i.push(t.state.deletedData[n]),d.push(n));if(!1===t._triggerGridEvent("dataUndelete",{datalist:i}))return!1;for(var n=0,r=i.length;n<r;n++){var s=i[n];s._state.deleted=!1,l.push(s),t.state.data.splice(s._index.data,0,s),t.state.dataCompositor&&t.state.dataCompositor(t,s),o++}for(var n=d.length-1;n>=0;n--)t.state.deletedData.splice(d[n],1);o&&(t.calcAndRedraw(),t._triggerGridEvent("dataUndeleteEnd",{datalist:l}),t._triggerGridEvent("dataChanged",{type:"undelete",datalist:l}))}},At.prototype.dataCopy=function(t,a){var n=this;if(a||(a={}),t&&!e.isEmptyObject(t)){var r=n._dataGet(t);if(r&&r.length){var o=a.count||1,l=a.cloneColumn;void 0===l&&(l="all");var i=n.option.grouping&&n.option.grouping.by&&n.option.grouping.useGrouping&&!!a.cloneGroup,s=a._index||a.position,p={};if(a.recursive){for(var u=0,c=r.length;u<c;u++)p[r[u]._index.id]=!0;r=n._addTreeChildToList(r,!1,!1)}if(!1===n._triggerGridEvent("dataCopy",{datalist:r,copyoption:a}))return!1;var g=null,f=null;a.parentQuery?(g=n._dataGet(a.parentQuery)[0])&&(f=g[n.option.tree.idKey]):null===a.parentQuery&&(g=!0,f=n.option.tree.rootNodeParentIdValue);var h=[],m={},v=!1;if(e.isArray(l)){v=!0;for(var u=0,c=l.length;u<c;u++)m[l[u]]=!0}else if(!0===l){v=!0;for(var u=0,c=n.option.columnMapping.length;u<c;u++){var x=n.option.columnMapping[u];x.key&&(m[x.key]=!0)}}for(var y={},C=0,I=o;C<I;C++)for(var u=0,c=r.length;u<c;u++){var _=r[u],w={_index:{},_state:{edited:!1,editing:!1,selected:!1,added:!0,deleted:!1}};if(i)for(var b=0,M=n.option.grouping.by.length;b<M;b++){var S=n.option.grouping.by[b];"string"==typeof S&&(w[S]=_[S])}else l&&e.each(_,function(e,t){0!==e.indexOf("_")&&("all"!==l&&v&&!m[e]||(w[e]=t))});if(n._giveDataId(w),n.state.treeInfo){var E=w[n.option.tree.idKey],T=n._getUniqueIdValueForTreeNode(w);y[E]=T,w[n.option.tree.idKey]=T,n.state.treeInfo.idValueToDataIdMap[w[n.option.tree.idKey]]=w._index.id,g&&p[_._index.id]&&(w[n.option.tree.parentIdKey]=f)}h.push(w)}if(h.length){if(!e.isEmptyObject(y))for(var D=!0;D;){D=!1;for(var u=0,c=h.length;u<c;u++){var w=h[u];y[w[n.option.tree.parentIdKey]]&&(w[n.option.tree.parentIdKey]=y[w[n.option.tree.parentIdKey]],D=!0)}}var F=null;if(void 0===s)F=r[r.length-1]._index.data+1;else if(d(s)){var R=n._dataGetByIndex(s);R&&(F=R._index.data)}else"end"===s?F=n.state.data.length:"number"==typeof s&&(F=n.state.renderTargetDataList[s-1]._index.data+1);null===F&&(F=n.state.data.length),h.unshift(F,0),Array.prototype.splice.apply(n.state.data,h),n.sortClear(),n.calcAndRedraw(),h.shift(),h.shift(),n._triggerGridEvent("dataCopyEnd",{datalist:h}),n._triggerGridEvent("dataChanged",{type:"copy",datalist:h})}}}},At.prototype._getRecentData=function(e){var t=this,a=null;if("string"==typeof e){for(var n=0,r=t.state.data.length;n<r;n++)if(t.state.data[n]._index&&t.state.data[n]._index.id===e){a=t.state.data[n];break}}else"number"==typeof e&&(a=t.state.data[e]);return a?At.currentData(a):null},At.prototype.viewInit=function(t){e(this.root).addClass(ct).html(At.renderUtil.generateHTMLString(At.markup))},At.prototype._getGridOptionHeightValue=function(){var t=this.option.height;return s(t)&&(t=t.call(this,this.$root.get(0))),e.isNumeric(t)?t=parseInt(t):null==t||!1===t?t="content":"string"==typeof t&&"px"===t.slice(-2).toLowerCase()&&e.isNumeric(t.slice(0,-2))&&(t=parseInt(t.slice(0,-2))),t},At.prototype._getGridOptionWidthValue=function(){var t=this.option.width;return s(t)&&(t=t.call(this,this.$root.get(0))),e.isNumeric(t)?t=parseInt(t):null==t||!1===t?t="parent":"string"==typeof t&&"px"===t.slice(-2).toLowerCase()&&e.isNumeric(t.slice(0,-2))&&(t=parseInt(t.slice(0,-2))),t},At.prototype._viewUpdate=function(t,a){var n=this;if(n.state&&!n.state.renderingSuppressed){var r=n._getGridOptionHeightValue(),o=n._getGridOptionWidthValue();n.state.gridOptionHeight=r,n.state.gridOptionWidth=o,n.$title.off(".alopexgridTitleViewEvent");var l=!1;if(null!=n.option.title&&!1!==n.option.title){l=!0;var i=n.option.title;!0===i&&(i=""),"function"==typeof i&&(i=i.call(n)),"number"!=typeof i&&"string"!=typeof i||n.$titlelabel.text(i);var d=n.option.titleMarkup;"function"==typeof d&&(d=d.call(n)),d?n.$titleMarkup.html(d):n.$titleMarkup.html(""),n.option.hideGridFoldingButton?n.$titleFolding.hide():n.$titleFolding.show(),n.$title.on("click.alopexgridTitleViewEvent",".table-toggle",{self:n},function(t){var a=t.data.self;if(a.$root.hasClass("folded")){a.$root.removeClass("folded");var n=a.$root.data("data-prev-height");a.$root.removeData("data-prev-height"),a.$root.animate({height:n+"px"},function(){a._getGridOptionHeightValue()||e(this).css({height:""}),a.viewUpdate()})}else a.$root.addClass("folded"),a.$root.data("data-prev-height",a.$root.height()),a.$root.animate({height:a.$title.height()+"px"})}),n.$title.show()}else n.$title.hide();if(!l||!n.$root.hasClass("folded")){if(n.$columnhiddenarea[n.option&&n.option.hiddenColumnArea?"show":"hide"](),n.option&&n.option.hiddenColumnArea){n.option.hiddenColumnArea&&n.$columnhiddenarea.find(".columnhiddenarea-label").text("string"==typeof n.option.hiddenColumnArea?n.option.hiddenColumnArea:"");if(n.$columnhiddenarea.children().length>1&&n.$columnhiddenarea.find(".headercell").remove(),n.option.hiddenColumnOrderList&&n.option.hiddenColumnOrderList.length>0){n.$columnhiddenarea.find(".columnhiddenarea-label").hide();for(var s,p,u,c,g,f=0,h=0,m=n.option.hiddenColumnOrderList.length;h<m;h++){if(s=n.state.hiddenColumnIdxArr[h],p=n.state.hiddenColumnIndexToMapping[s],u=e('<div class="headercell"></div>'),u.attr("data-alopexgrid-columnindex",p.columnIndex),0!==h&&(f+=e(n.$columnhiddenarea.find(".headercell")[h-1]).width()+10),u.css({left:f+"px"}),c=e('<div class="header-dragdrop-handle"></div>'),c.attr("data-alopexgrid-dragdropcolumnindex",p.columnIndex),c.attr("onmousedown",gt+".run('"+n.key+"','_hiddenHeaderDragStart',event,"+p.columnIndex+");"),c.attr("ontouchstart",gt+".run('"+n.key+"','_hiddenHeaderDragStart',event,"+p.columnIndex+");"),g=e('<span class="column-title"></span>'),null!==p.title&&void 0!==p.title&&"string"==typeof p.title)g.text(p.title.replace(/<br>/g,""));else if(!0===p.selectorColumn){var v=e('<div class="alopexgrid-input-wrapper alopexgrid-input-checkbox-wrapper"></div>'),x=e('<input type="checkbox" name="'+n.key+'"class="selector-checkbox selector-column-input">');v.append(x),g.append(v)}else if("function"==typeof p.title){var y=p.title.call(n,p);g.append(y)}!1===p.headerDragDrop?u.append(g):u.append(c,g),n.$columnhiddenarea.append(u)}}else n.$columnhiddenarea.find(".columnhiddenarea-label").show()}var C=n._usePager();n.$pager[C?"show":"hide"](),C&&n._refreshPagingUnit();var I=l?n.$title.outerHeight(!0):0,_=n.option.hiddenColumnArea?n.$columnhiddenarea.outerHeight(!0):0,w=n._usePager()?n.$pager.outerHeight(!0):0,b=I+_+w,M=0;if(n.option.header){for(var S=0;S<n.state.columnHeaderDepth-(n.option.filteringHeader?1:0);S++)e.isArray(n.option.headerRowHeight)?M+=n.option.headerRowHeight[S]:"number"==typeof n.option.headerRowHeight?M+=n.option.headerRowHeight:M+=n.state.headerRowHeight;n.option.filteringHeader&&(M+=e.isNumeric(n.option.filteringHeaderHeight)?parseInt(n.option.filteringHeaderHeight,10):n.state.headerRowHeight)}var E=0;if(n._hasFooter()&&(E=n.option.footerRowHeight||n.state.rowHeight),"content"===o&&(n.option.columnFixShowFrom=null),"content"===r&&(n.option.rowFixShowFrom=null),n._calculateColumnWidthProperty(),n.state.headerHeight=M,n.state.footerHeight=E,n.option.rowOption&&"content"===n.option.rowOption.defaultHeight&&n.$wrapper.is(":visible"))for(var T=0,m=n.state.data.length;T<m;T++){var D=n.state.data[T];null==n.state.rowHeightMapByDataId[D._index.id]&&n._setRowHeight(D,"content")}var F=!0===n.option.alwaysShowVerticalScrollBar,R=!0===n.option.alwaysShowHorizontalScrollBar,k=n.state.scrollbarxHeight=0,L=n.state.scrollbaryWidth=0,A=0,O=0,P=n.$root.outerHeight()-n.$root.height(),B=n.$root.outerWidth()-n.$root.width(),G=n.$wrapper.outerHeight()-n.$wrapper.height(),H=n.$wrapper.outerWidth()-n.$wrapper.width(),N="",$="",K="",W=n.state.renderTargetDataList.length||0,U=n.__getAllRowHeight();if(!W&&n.option.message&&(n.option.message.nodata||null!=n.state.filteredDataList&&0===n.state.filteredDataList.length&&n.option.message.noFilteredData)){if(n.option.rowOption&&"number"==typeof n.option.rowOption.nodataRowHeight)n.state.nodataRowHeight=n.option.rowOption.nodataRowHeight;else{var V=document.createElement("div");V.className="cell emptycell nodata nodatacell",null!=n.state.filteredDataList&&0===n.state.filteredDataList.length&&(V.className+=" nofiltereddata"),n.$wrapper[0].appendChild(V),n.state.nodataRowHeight=e(V).outerHeight()||n.state.rowHeight,n.$wrapper[0].removeChild(V)}U+=n.state.nodataRowHeight,W+=1}if(n.option.rowPadding){var Y=n.option.rowPadding;!0===Y&&n.option.paging&&n.option.paging.perPage&&(Y=n.option.paging.perPage),W<Y&&(U+=(Y-W)*n.state.rowHeight)}var X=U+M+E,z=n.state.columnWidth;if(String(r).indexOf("row")>=0){var j="rowpadding"===r.toLowerCase()&&n.option.rowPadding?n.option.rowPadding:r.split("row")[0];if(e.isNumeric(j)){O=j*n.state.rowHeight+M+E,K=O+G,N=K+b+P}else r="content"}if("number"==typeof r){N=r;K=r-P-b,O=K-G}else"content"===r&&(O=X,K=O+G,N=K+b+P);"number"==typeof o?($=o,A=$-B-H):"parent"===o?(n.$root.css("width",""),A=n.$root.width()-H):"content"===o&&($=z+B+H,A=z),X>O&&(F=!0),z>A&&(R=!0);for(var q=null,Z=null,T=0,m=2;T<m;T++){var Q=!1,J=!1;q!==F&&F&&(Q=!0),Z!==R&&R&&(J=!0),q=F,Z=R,Q&&(n.$scrollbary.css({width:"",overflow:""}),n.$scrollbarRightButton.css("right",""),n.state.scrollbaryWidth=L=n.$scrollbary.outerWidth(),"number"==typeof o||"parent"===o?A-=L:"content"===o&&($+=L)),J&&(n.$scrollbarx.css({height:"",overflow:""}),n.$scrollbarDownButton.css("bottom",""),n.state.scrollbarxHeight=k=n.$scrollbarx.outerHeight(),"number"==typeof r?O-=k:(N+=k,K+=k)),X>O&&(F=!0),z>A&&(R=!0)}n.state.wrapperWidth=A,n.state.wrapperHeight=O,n.state.clientHeight=O-M-E,n.state.clientWidth=A,n.state.hasVerticalScrollbar=F,n.state.hasHorizontalScrollbar=R,F||(n.$scrollbary.css({width:"0px",overflow:"hidden"}),n.$scrollbarRightButton.css("right","0px")),R||(n.$scrollbarx.css({height:"0px",overflow:"hidden"}),n.$scrollbarDownButton.css("bottom","0px")),X<=O&&(n.state.renderFromRenderedIndex=0,n.option.rowFixShowFrom=null,n.state.scrollyEnd=!1),z<=A&&(n.state.renderFromColumnIndex=n.state.visibleColumnIndexArr[0]||0,n.state.scrollxEnd=!1),n.$root.css({width:$+(e.isNumeric($)?"px":""),height:N+(e.isNumeric(N)?"px":"")}),n.$wrapper.css("height",K+(e.isNumeric(K)?"px":"")),n.state.scrollbaryTrackTop=parseInt(n.$scrollbarUpButton.position().top+n.$scrollbarUpButton.outerHeight()),n.state.scrollbaryTrackBottom=parseInt(n.$scrollbarDownButton.position().top),n.state.scrollbaryTrackLength=parseInt(n.state.scrollbaryTrackBottom-n.state.scrollbaryTrackTop),n.state.scrollbarxTrackLeft=parseInt(n.$scrollbarLeftButton.position().left+n.$scrollbarLeftButton.outerWidth()),n.state.scrollbarxTrackRight=parseInt(n.$scrollbarRightButton.position().left),n.state.scrollbarxTrackLength=parseInt(n.state.scrollbarxTrackRight-n.state.scrollbarxTrackLeft),n._refreshScrollbar(),n._setScrollInfo(a),n._refreshBoard(!0===t||{refreshGeometry:!0}),n._setProgressPosition()}}},At.prototype.viewUpdate=function(e,t){return this._viewUpdate(e,t)},At.prototype.getGeometry=function(){var e=this,t={},a=e.$root.offset(),n=e.$root.position();return t.offsetTop=a.top,t.offsetLeft=a.left,t.positionTop=n.top,t.positionLeft=n.left,t.gridWidth=e.$root.width(),t.gridHeight=e.$root.height(),t.clientWidth=e.$wrapper.innerWidth()-e.$scrollbary.outerWidth(),t.clientHeight=e.$wrapper.innerHeight()-e.$scrollbarx.outerHeight(),t},At.prototype._renderDataByMapping=function(e,t){var a=this;if(t.multi){var n=document.createDocumentFragment();return a._iterateMultiMapping(e,t,function(t,r,o){var l=document.createElement("div");l.className="multicell",0===t?l.className+=" multicell-firstrow":t===o.length-1&&(l.className+=" multicell-lastrow"),l.setAttribute("data-alopexgrid-multi",t),l.style.height=100/o.length+"%",At.renderUtil.setElementContent(l,a._renderDataByMapping(e,r)),a._setCellAttribute(a._generateCellAttribute(e,r,!0),l),n.appendChild(l)}),n}var r=t.editable&&e._state.editing&&e._state.editing.hasOwnProperty(t.columnIndex),o=o=r?e._state.editing[t.columnIndex]:t.key?e[t.key]:"",l=a._extractRenderObject(e,t),i=o;if("function"==typeof l){var d=l.call(a,o,e,l,t,a);if(!d||"object"!=typeof d||d.nodeType||!d.type)return null==d?"":d;l=d}if(l&&l.constructor===Object&&a.option.renderMapping[l.type]){var s=a.option.renderMapping[l.type],p=null;!r&&a.option.readonlyRender&&(p=l.readonly,l.readonly=!0);var u=s.renderer.call(a,o,e,l,t,a);null!==p&&(l.readonly=p),i=u}else null==o&&(o=""),i=a.option.disableValueEscape?o:document.createTextNode(o);return null==i?"":i},At.prototype._refreshBodyCells=function(e){function t(e,t,a,n,r,o,l,i,d,s){var p=document.createElement("div");p.setAttribute("data-alopexgrid-root",e.key),p.className="cell emptycell nodata nodatacell",s&&(p.className+=" nofiltereddata"),p.style.top=t+"px",p.style.left=a+"px",p.style.width=Math.max(0,Math.min(n,r-a))+"px",p.style.height=(e.state.nodataRowHeight||e.state.rowHeight)+"px";var u=document.createElement("span");u.className="emptycell-message",u.innerHTML=s?e.option.message.noFilteredData:e.option.message.nodata,p.appendChild(u),e.$wrapper[0].appendChild(p);for(var c=0,g=o.length;c<g;c++)l[c+",0"]=!0;i.length||i.push(null)}var a=this,n=p(a.state.bodyCellList),r={dataIndexList:null,columnIndexList:null,dataIndexMap:{},columnIndexMap:{}},o=!1;if(e&&!0===e.refreshGeometry&&(o=!0,a.option.cellCache.enabled))for(var l in a.state.cellCache){var i=a.state.cellCache[l];for(var s in i)i[s].cellWidthProcessed=!1,i[s].cellHeightProcessed=!1}if(e&&d(e)){if(r.dataIndexList=e.dataIndexList,r.dataIndexList)for(var u=0,c=r.dataIndexList.length;u<c;u++)r.dataIndexMap[r.dataIndexList[u]]=!0;if(r.columnIndexList=e.columnIndexList,r.columnIndexList)for(var u=0,c=r.columnIndexList.length;u<c;u++)r.columnIndexMap[r.columnIndexList[u]]=!0;e=!1}if(!0===e&&a.state.refreshbodycell){if(a.option.cellCache.enabled){for(var l in a.state.cellCache){var i=a.state.cellCache[l];for(var s in i)i[s].isCellAttributeGenerated=!1,i[s].isCellContentGenerated=!1,i[s].cellWidthProcessed=!1,i[s].cellHeightProcessed=!1,i[s].className="cell bodycell"}var g="full"===a.option.cellCache.columnRange?a.state.visibleColumnMappingList:a.state.renderTargetMappingInfo.renderTargetMapping;if("all"==a.option.cellCache.mode)for(var f=0,h=a.state.renderTargetDataList.length;f<h;f++)for(var m=a.state.renderTargetDataList[f],v=0,x=g.length;v<x;v++)a._cacheCell(m,g[v]);else"inc"==a.option.cellCache.mode&&(a._triggerGridEvent("incrementalCacheStart"),a.state.cellCacheHelper.incRowCounter=-1,a.state.cellCacheHelper.incStartTime=Date.now(),a.state.cellCacheHelper.incTimer=setInterval(function(){for(var e=a.state.renderTargetDataList[++a.state.cellCacheHelper.incRowCounter];e&&a.state.cellCache[e._index.id]&&a.state.cellCache[e._index.id][g[0].id]&&a.state.cellCache[e._index.id][g[0].id].isCellContentGenerated;)e=a.state.renderTargetDataList[++a.state.cellCacheHelper.incRowCounter];if(e)for(var t=0,n=g.length;t<n;t++)a._cacheCell(e,g[t]);if(!e||a.state.cellCacheHelper.incRowCounter>=a.state.renderTargetDataList.length)return clearInterval(a.state.cellCacheHelper.incTimer),a.state.cellCacheHelper.incTimer=null,a.state.cellCacheHelper.incDuration=Date.now()-a.state.cellCacheHelper.incStartTime,void a._triggerGridEvent("incrementalCacheEnd")},a.option.cellCache.timerInterval))}for(var y in a.state.refreshbodycell)delete a.state.refreshbodycell[y];delete a.state.refreshbodycell}if(r.dataIndexList&&a.option.cellCache.enabled)for(var u=0,c=r.dataIndexList.length;u<c;u++){var m=a.state.data[r.dataIndexList[u]];if(m){var i=a.state.cellCache[m._index.id];for(var s in i)i[s].isCellContentGenerated=!1,i[s].isCellAttributeGenerated=!1,cacheobj[s].cellWidthProcessed=!1,cacheobj[s].cellHeightProcessed=!1,i[s].className="cell bodycell"}}a.state.refreshbodycell=a.state.refreshbodycell||{},a.state.bodyHeight=0;var C=(a.state.headerHeight||0)+a.state.refreshfootercell.upperHeight,I=a.state.wrapperHeight-a.state.refreshfootercell.lowerHeight,_=a.state.wrapperWidth,w=a.state.scrollxEnd,b=a.state.scrollyEnd,M=0,S=C,E=a.state.renderFromColumnIndex||0,T=a.state.renderFromRenderedIndex||0,D=a.state.refreshbodycell.prevColumnIndex,F=a.state.refreshbodycell.prevRenderedIndex;a.state.refreshbodycell.prevRowFixCount!==a.option.rowFixCount&&(e=!0);var R=1,k=0,L=0;a.state.fixupto>=0&&(M+=a.state.fixedColumnWidth);var A=[],O=a._hasPinnedData();a.option.rowFixCount>0&&1==!!O&&(1==!!a.state.fromCalcAndRedraw?(!a.option.rowFixShowFrom||a.option.rowFixCount>0)&&(a.option.rowFixCount=0,a.option.rowFixShowFrom=null):0==!!a.state.fromCalcAndRedraw&&a.state.pinnedDataIdList&&a.state.pinnedDataIdList.length&&(O=!1,a.state.pinnedDataIdList=null,a.state.pinnedDataIdMap=null,a._sortInternalData(),a._generateRenderTargetData()));var P=a.option.disableScrolledFix?0:a.option.rowFixShowFrom||0;if(O)for(var u=0,c=a.state.pinnedDataIdList.length;u<c;u++){var l=a.state.pinnedDataIdList[u],m=a.state.data[a.state.dataIdToIndexMap[l]];m&&(null!=m._index.row&&(S+=a.state.rowHeightMapByDataId[l]||a.state.rowHeight,A.push(m)))}else if(a.option.rowFixCount>0){T<P&&(T=P);for(var u=P||0,c=a.option.rowFixCount;u<c;u++){var m=a.state.renderTargetDataList[u];m&&(A.push(m),S+=a.state.rowHeightMapByDataId[m._index.id]||a.state.rowHeight)}}O&&A.length?a.state.lastPinnedDataId=A[A.length-1]._index.id:a.state.lastPinnedDataId=null;var B=[];if(wt)for(var u=0,c=n.length;u<c;u++)B.push(n[u]);else B=B.concat(Array.prototype.slice.call(n));var G={},H={},N=0,$=[],K=[],W=a.state.renderTargetMappingInfo;$=W.renderTargetMapping,K=W.fixedRenderTargetMapping,N=W.renderTargetWidth,R=W.fitRatio;var U=W.columnWidthByIdMap,V=W.renderFitWidth;k=($[Math.max($.length-1,0)]||{}).columnIndex;for(var Y={},u=0,c=$.length;u<c;u++)Y[$[u].columnIndex]=u,H[$[u].id]=u;for(var X=0,z=[],j=[],q=I-C,Z=[],Q=a.option.useContinuousYScroll?a.__getRenderedIndexByBlankHeight(a.state.translateY,!0):0,J=a.option.useContinuousXScroll?a._getColumnIndexByBlankWidth(a.state.translateX,!0):0,ee=0,u=T,c=a.state.renderTargetDataList.length;u<c;u++,ee++){var m=ee<A.length?A[ee]:a.state.renderTargetDataList[u],te=(m?a.state.rowHeightMapByDataId[m._index.id]:null)||a.state.rowHeight;if(X+=te,z.push(m),j.push(m?m._index.row:u),ee<A.length&&Z.push(m),X>q+Q&&!b)break}var ae=Z[Z.length-1]||null;if(L=T+z.length-1,X<q+Q&&a.option.rowPadding){var ne=a.option.rowPadding;!0===ne&&a.option.paging&&(ne=a.option.paging.perPage);for(var u=L+1;u<ne&&(z.push(null),!((X+=a.state.rowHeight)>q+Q));u++);}else if(X<q+Q){var re=!1;if(b&&T>0?re=!0:!b&&L>=a.state.renderTargetDataList.length-1&&L>(a.option.rowPadding||0)&&(re=!0),re)for(var oe=a.option.rowFixCount?P:0;T>oe;){T-=1;var m=a.state.renderTargetDataList[T],te=(m?a.state.rowHeightMapByDataId[m._index.id]:null)||a.state.rowHeight;if(X+=te,z.splice(A.length,0,m),j.splice(A.length,0,T),X>q+Q)break}}a.state.renderToRenderedIndex=L,a.state.renderToColumnIndex=k,!e&&a.option.fitTableWidth&&R!==a.state.refreshbodycell.fitRatio&&(e=!0);for(var u=0,c=z.length;u<c;u++)z[u]&&(G[z[u]._index.id]=u);if(a.option.cellCache.enabled&&"pad"===a.option.cellCache.mode){for(var ne=Math.ceil(z.length*(a.option.cellCache.padRatio||1)),le=[],ie=L+1,h=Math.min(ie+ne,a.state.renderTargetDataList.length);ie<h;ie++)a.state.renderTargetDataList[ie]&&!a.state.cellCacheHelper.padDataIdOnQueue[a.state.renderTargetDataList[ie]._index.id]&&(le.push(a.state.renderTargetDataList[ie]),a.state.cellCacheHelper.padDataIdOnQueue[a.state.renderTargetDataList[ie]._index.id]=!0);for(var ie=T-1;ie>=Math.max(ie-ne,0);ie--)a.state.renderTargetDataList[ie]&&!a.state.cellCacheHelper.padDataIdOnQueue[a.state.renderTargetDataList[ie]._index.id]&&(le.push(a.state.renderTargetDataList[ie]),a.state.cellCacheHelper.padDataIdOnQueue[a.state.renderTargetDataList[ie]._index.id]=!0);a.state.cellCacheHelper.padDataList=le.concat(a.state.cellCacheHelper.padDataList).slice(0,a.option.cellCache.capacity);var g="full"===a.option.cellCache.columnRange?a.state.visibleColumnMappingList:a.state.renderTargetMappingInfo.renderTargetMapping;a.state.cellCacheHelper.padTimer||(a.state.cellCacheHelper.padTimer=setInterval(function(){for(var e=null;(e=a.state.cellCacheHelper.padDataList.shift())&&a.state.cellCache[e._index.id];)delete a.state.cellCacheHelper.padDataIdOnQueue[e._index.id];if(e)for(var t=0,n=g.length;t<n;t++)a._cacheCell(e,g[t]);a.state.cellCacheHelper.padDataList.length||(clearInterval(a.state.cellCacheHelper.padTimer),a.state.cellCacheHelper.padTimer=null)},a.option.cellCache.timerInterval))}for(var de={},se={},pe=T-F,ue=a.state.visibleIndexMapByColumnIndex,ce=ue[E]-ue[D],u=0,c=B.length;u<c;u++){var ge=B[u],fe=ge.__aglocalx,he=ge.__aglocaly;if(a.option.cellCache.enabled)null==G[ge.__agdid]||null==H[ge.__agmid]?a.$wrapper[0].removeChild(ge):(fe=H[ge.__agmid],he=G[ge.__agdid],null==fe||null==he?a.$wrapper[0].removeChild(ge):(ge.__aglocalx=fe,ge.__aglocaly=he),de[fe+","+he]=!0);else{if(fe<K.length){var ve=K[fe],xe=ge.__agci;if(xe>=0&&ve.columnIndex!==xe){a.$wrapper[0].removeChild(ge);continue}}else if(ce){if((fe-=ce)<K.length){a.$wrapper[0].removeChild(ge);continue}ge.__aglocalx=fe}if(he<Z.length){if(ae){var ye=ge.__agri;if(ye>ae._index.row){a.$wrapper[0].removeChild(ge);continue}}}else if(pe){if((he-=pe)<Z.length){a.$wrapper[0].removeChild(ge);continue}ge.__aglocaly=he}fe>=$.length||he>=z.length?a.$wrapper[0].removeChild(ge):null===fe||null===he||fe<0||he<0?a.$wrapper[0].removeChild(ge):de[fe+","+he]=!0}}for(var Ce=p(a.state.nodataCellList);Ce.length;)a.$wrapper[0].removeChild(Ce[0]),Ce=p(a.state.nodataCellList);a.state.data&&a.state.data.length?a.state.data&&a.state.data.length>0&&null!=a.state.filteredDataList&&0===a.state.filteredDataList.length&&a.option.message&&a.option.message.noFilteredData&&t(a,C,0,V,_,$,se,z,!1,!0):a.option.message&&a.option.message.nodata&&t(a,C,0,V,_,$,se,z,!1,!1);for(var Ie=[0],_e=[C],we=0,be=0,Me=$.length;be<Me;be++){var Se=$[be];Ie.push(Ie[Ie.length-1]+U[Se.id]);for(var Ee=0,Te=0,De=z.length;Te<De;Te++){var m=z[Te];if(0==be){var te=(m&&m._index?a.state.rowHeightMapByDataId[m._index.id]:0)||a.state.rowHeight;Ee+=te,_e[Te+1]=_e[Te]+parseInt(te)}if(!de[be+","+Te]){var Fe=null;m&&Se&&a.state.cellCache[m._index.id]&&a.state.cellCache[m._index.id][Se.id]?Fe=a.state.cellCache[m._index.id][Se.id]:(Fe=document.createElement("div"),Fe.className="cell bodycell"),Fe.__aglocalx=be,Fe.__aglocaly=Te,a.$wrapper[0].appendChild(Fe),a.option.cellCache.enabled&&m&&Se&&(a._cacheCellElement(m,Se,Fe),Fe.__agdid=m._index.id,Fe.__agmid=Se.id)}}we=Math.max(we,Ee)}if(B=[],n=p(a.state.bodyCellList),wt)for(var u=0,c=n.length;u<c;u++)B.push(n[u]);else B=B.concat(Array.prototype.slice.call(n));for(var Re=[],u=0,c=$.length;u<c;u++)Re.push([]);var ke=(X||0)+(a.state.headerHeight||0)+(a.state.footerHeight*a.state.footerDepth||0),Le=-(w?N-a.state.wrapperWidth:0),Ae=-(b?ke-a.state.wrapperHeight:0),Oe=a.option.grouping?a.option.grouping.groupRowspanMode:null;!b&&a.option.useContinuousYScroll&&Q&&(Ae=-Math.min(ke-a.state.wrapperHeight,Q)),!w&&a.option.useContinuousXScroll&&J&&(Le=-Math.min(N-a.state.wrapperWidth,J));for(var u=0,c=_e.length;u<c;u++)Ae&&u>=A.length&&(_e[u]+=Ae);for(var u=0,c=Ie.length;u<c;u++){var Se=$[u];Se&&Le&&Se.columnIndex>a.state.fixupto&&(Ie[u]+=Le)}for(var Pe=a.state.refreshbodycell.scrollxEnd!=w,Be=a.state.refreshbodycell.scrollyEnd!=b,Ge=!!(ce||isNaN(ce)||Pe||o),He=!!(pe||isNaN(pe)||Be||o),u=0,c=B.length;u<c;u++){var ge=B[u],fe=parseInt(ge.__aglocalx),he=parseInt(ge.__aglocaly),m=z[he],Se=$[fe],Ne=m?m._index.row:j[he],$e=z[he-1],Ke=z[he+1],We=!!(e||m&&r.dataIndexMap[m._index.data]&&!r.columnIndexList||m&&r.dataIndexMap[m._index.data]&&r.columnIndexMap[Se.columnIndex]);if(Re[fe][he]=ge,m&&Se?(ge.id=a._cellIdFromRowIndex(Ne,Se.columnIndex),ge.setAttribute("data-alopexgrid-rowindex",Ne),ge.__agri=Ne,ge.__agci=Se.columnIndex):ge.removeAttribute("id"),!0===We&&(ge.className="cell bodycell",ge.setAttribute("data-alopexgrid-root",a.key)),se[fe+","+he])a.$wrapper[0].removeChild(ge);else{var Ue=a.state.hasLeftColspanMapByColumnIndex[Se.columnIndex],Ve=0;if(!ge.cellWidthProcessed||We||Ge||Ue){var Ye=Se.columnIndex,Xe=U[Se.id];if(m){var ze=a.state.fixupto>=0&&Se.columnIndex===a.state.fixupto,je=0;if(Ue)for(var qe=Ye;qe>=0;){var Ze=a.state.columnIndexToMapping[qe--];if(Ze&&me(Ze)&&(Ze.colspan||Ze.colspanTo)){var Qe=a._getColspanUpto(m,Ze);if(Qe>=Ye){Xe=U[Ze.id]||0,Ze.columnIndex<Ye&&(Ve-=Xe),Qe===a.state.fixupto&&(ze=!0);for(var Je=Ze.columnIndex+1;Je<=Qe;Je++){var et=a.state.columnIndexToMapping[Je];if(et&&me(et)){Xe+=U[et.id]||0,je++,Je<Ye&&(Ve-=U[et.id]||0);var tt=Y[Je];void 0!==tt&&Je>Ye&&(se[tt+","+he]=!0)}}Se=Ze;break}}}je&&At.renderUtil.addClass(ge,"cell-colspan-column"),ze&&At.renderUtil.addClass(ge,"cell-fixcol-lastcolumn")}ge.style.width!==Xe+"px"&&(ge.style.width=Xe+"px"),ge.cellWidthProcessed=!0}if(!ge.cellHeightProcessed||We||He){var te=(m&&m._index?a.state.rowHeightMapByDataId[m._index.id]:0)||a.state.rowHeight;if(m){var at=m===ae,nt=0,rt=!1,ot=null;if(Se.rowspan&&a.state.groupRowspanned){if(Oe){if((1==Oe||2==Oe)&&(ot=a._getGroupingRangeByData(m,Se),nt++,Z.length!==he&&he?a._allowGroupMerge($e,m,Se,Oe)||(rt=!0):rt=!0,rt))for(var lt=he+1,it=z.length;lt<it;lt++){var dt=z[lt];if(!dt)break;var st=a._allowGroupMerge(m,dt,Se,Oe);if(!st)break;if(te+=a.state.rowHeightMapByDataId[dt._index.id]||a.state.rowHeight,nt++,ut&&Z.length===lt){at=!0;break}}}else if(ot=a._getGroupingRangeByMapping(m._index.data,Se)){nt++;var pt=$e?a._getGroupingRangeByMapping($e._index.data,Se):null,ut=he<Z.length;if(pt&&ot.id===pt.id?Z.length===he&&(rt=!0):rt=!0,rt)for(var lt=he+1,it=z.length;lt<it;lt++){if(ut&&Z.length===lt){at=!0;break}var dt=z[lt];if(!dt||"object"!=typeof dt)break;var ct=a._getGroupingRangeByMapping(dt._index.data,Se);if(!ct)break;if(ot.id!==ct.id)break;te+=a.state.rowHeightMapByDataId[dt._index.id]||a.state.rowHeight,nt++}}if(nt){if(!rt){se[fe+","+he]=!0,a.$wrapper[0].removeChild(ge);continue}var gt=!1;if(m._state.groupFooter||m._state.groupHeader){var ft=Se.rowspan.by||Se.rowspan;1==ft&&(ft=Se.key);var ht=a.state.groupKeyOrderMap[ft]
;1==Oe&&ot.groupDepth==ht||ot.groupDepth<ht||(m=ot.member[0]),gt=!0}At.renderUtil.addClass(ge,"cell-rowspan-column");for(var mt=!1,vt=!1,xt=ot.member,yt=0,Ct=xt.length;yt<Ct;yt++)xt[yt]._state.selected&&(mt=!0),xt[yt]._state.focused&&(vt=!0);gt||(mt&&(At.renderUtil.addClass(ge,"cell-rowspan-contain-selected"),At.renderUtil.addClass(ge,"selected")),vt&&(At.renderUtil.addClass(ge,"cell-rowspan-contain-focused"),At.renderUtil.addClass(ge,"focused")))}}at&&At.renderUtil.addClass(ge,"cell-fixrow-lastrow")}ge.style.height!==te+"px"&&(ge.style.height=te+"px"),ge.cellHeightProcessed=!0}var be=Ie[fe],It=be+Ve+"px";ge.style.left!==It&&(ge.style.left=It);var Te=_e[he],_t=Te+"px";ge.style.top!==_t&&(ge.style.top=_t),a._basicCellCreation(ge,m,Se,We),$e&&(!0===$e._state.selected?At.renderUtil.addClass(ge,"prevrow-selected"):At.renderUtil.removeClass(ge,"prevrow-selected")),Ke&&(!0===Ke._state.selected?At.renderUtil.addClass(ge,"nextrow-selected"):At.renderUtil.removeClass(ge,"nextrow-selected")),a.option.useClassHovering&&At.renderUtil.removeClass(ge,"cell-hoveringrow")}}for(var y in se)if(y){var fe=y.split(",")[0],he=y.split(",")[1];if(Re[fe]&&Re[fe][he]){var ge=Re[fe][he];ge.parentNode&&ge.parentNode.removeChild(ge)}}for(var bt={},u=z.length-1;u>=0;u--)null!=z[u]?bt[z[u]._index.id]=z[u]:z.splice(u,1);a.state.refreshbodycell.prevColumnIndex=E,a.state.refreshbodycell.prevRenderedIndex=T,a.state.refreshbodycell.renderedDataList=z,a.state.refreshbodycell.renderedDataIdMap=bt,a.state.refreshbodycell.renderedColumnMappingList=$,a.state.refreshbodycell.renderedFixedColumnMappingList=K,a.state.refreshbodycell.renderedPinnedDataList=A,a.state.refreshbodycell.prevRowFixCount=a.option.rowFixCount,a.state.refreshbodycell.fitRatio=R,a.state.refreshbodycell.bodyCellStartX=0,a.state.refreshbodycell.bodyCellStartY=C,a.state.refreshbodycell.bodyCellEndX=_,a.state.refreshbodycell.bodyCellEndY=I,a.state.refreshbodycell.bodyCellPositionY=_e,a.state.refreshbodycell.bodyCellPositionX=Ie,a.state.refreshbodycell.scrollEndXOffset=Le,a.state.refreshbodycell.scrollEndYOffset=Ae,a.state.refreshbodycell.scrollxEnd=w,a.state.refreshbodycell.scrollyEnd=b,a.state.refreshbodycell.wrapperWidth=a.state.wrapperWidth,a.state.refreshbodycell.wrapperHeight=a.state.wrapperHeight,a.state.fixupto&&a.state.fixupto>0&&(Ie[a.state.fixupto]-=Le),a.state.refreshbodycell.bodyCellPositionXForHeaderDrag=Ie,a.state.bodyHeight=we};var Ht={cache:{cache:!0},force:{force:!0}};At.prototype.cellElementGet=function(t,a,n){var r=this;if(arguments.length&&!0===arguments[arguments.length-1]&&(n=Ht.force),!wt&&!n&&!r.state.bodyCellList.length)return e();if(!arguments.length)return e(p(r.state.bodyCellList));for(var o=r._dataGet(t),l=r._columnIndexKeyToMappingList(a),i=[],d=0,s=o.length;d<s;d++){var u=o[d];if(!r.state.refreshbodycell||!r.state.refreshbodycell.renderedDataIdMap||r.state.refreshbodycell.renderedDataIdMap[u._index.id])for(var c={},g=0,f=l.length;g<f;g++){var h=l[g],m=r._getMultiParentColumnIndex(h);if(!c[m]){c[m]=!0;var v=r._cellElementGet(u,h);if(v?i.push(v):n&&(!0===n.cache&&r.state.cellCacheEnabled&&(v=r._getCachedCell(u,h)),v||!0!==n.force||(v=r._createCell(u,h)),v&&i.push(v)),r.state.groupRowspanned&&h.rowspan){var x=!1;if(!0===h.rowspan&&r.state.groupingKeyMap.hasOwnProperty(h.key)?x=!0:"object"==typeof h.rowspan&&"string"==typeof h.rowspan.by&&r.state.groupingKeyMap.hasOwnProperty(h.rowspan.by)&&(x=!0),x){var y=r._getGroupingRangeByMapping(u._index.data,h);if(y)for(var C=y.from;C<=y.to;C++)C!==u._index.data&&(v=r._cellElementGet(r.state.data[C],h))&&i.push(v)}}}}}return e(i)},At.prototype._cellElementGet=function(e,t){var a=this;return t=a._getMultiParentMapping(t),document.getElementById(a._cellIdFromRowIndex(e._index.row,t.columnIndex))||null},At.prototype.rowElementGet=function(e,t){return this.cellElementGet(e,null,t)},At.prototype.refreshRow=function(e,t){var a=this,n=a._dataGet(e);if(n&&n.length)for(var r=0,o=n.length;r<o;r++){var l=n[r];l&&a.refreshCell(l)}},At.prototype.refreshCell=function(t,a){for(var n=this,r=n._dataGet(t),o=n._columnIndexKeyToMappingList(a),l=[],i=0,d=r.length;i<d;i++)for(var s=r[i],p=0,u=o.length;p<u;p++){var c=o[p],g=n._refreshCell(s,c);g&&l.push(g)}return n._refreshBoard(),e(l)},At.prototype._refreshCell=function(e,t){if(!e||!t)return!1;t=this._getMultiParentMapping(t);var a=document.getElementById(this._cellIdFromRowIndex(e._index.row,t.columnIndex));if(!a&&this.state.cellCacheEnabled&&(a=this._getCachedCell(e,t)),a){var n=At.renderUtil.hasClass(a,"prevrow-selected"),r=At.renderUtil.hasClass(a,"nextrow-selected");if(this._createCell(e,t,a),At.renderUtil[n?"addClass":"removeClass"](a,"prevrow-selected"),At.renderUtil[r?"addClass":"removeClass"](a,"nextrow-selected"),s(window.getSelection)){var o=window.getSelection();o.containsNode&&o.containsNode(a,!0)&&i()}return a}return null},At.prototype._clearCellCache=function(){for(var e in this.state.cellCache)this._clearCellCacheByDataId(e);for(var t in this.state.cellCache)this.state.cellCache.hasOwnProperty(t)&&delete this.state.cellCache[t];this.state.cellCacheHelper.trimCount=0,this.state.cellCacheHelper.cacheDataList=[],this.state.cellCacheHelper&&(this.state.cellCacheHelper.incTimer&&(clearInterval(this.state.cellCacheHelper.incTimer),this.state.cellCacheHelper.incTimer=null),this.state.cellCacheHelper.padTimer&&(clearInterval(this.state.cellCacheHelper.padTimer),this.state.cellCacheHelper.padTimer=null))},At.prototype._clearCellCacheByDataId=function(e){if(this.state.cellCache[e]){for(var t in this.state.cellCache[e])delete this.state.cellCache[e][t];delete this.state.cellCache[e]}},At.prototype._clearCellCacheByDataMapping=function(e,t){e&&e._index&&t&&t.id&&this.state.cellCache[e._index.id]&&this.state.cellCache[e._index.id][t.id]&&delete this.state.cellCache[e._index.id][t.id]},At.prototype._getCachedCell=function(e,t){return this.state.cellCacheEnabled&&this.state.cellCache&&e&&e._index&&t&&t.id&&this.state.cellCache[e._index.id]&&this.state.cellCache[e._index.id][t.id]?this.state.cellCache[e._index.id][t.id]:null},At.prototype._cacheCell=function(e,t,a){var n=this;if(!a&&n.state.cellCache[e._index.id]&&n.state.cellCache[e._index.id][t.id])return n.state.cellCache[e._index.id][t.id];var r=!1;n.state.cellCache[e._index.id]||(n.state.cellCache[e._index.id]={},n.state.cellCacheHelper.cacheDataList.push(e),r=!0);var o=document.createElement("div");return o.className="cell bodycell",o.setAttribute("data-alopexgrid-root",n.key),n._basicCellCreation(o,e,t),n.state.cellCache[e._index.id][t.id]=o,r&&n._trimCellCache(),o},At.prototype._cacheCellByData=function(e){var t=this;if(t.option.cellCache.enabled)for(var a="full"===t.option.cellCache.columnRange?t.state.visibleColumnMappingList:t.state.renderTargetMappingInfo.renderTargetMapping,n=0,r=a.length;n<r;n++)t._cacheCell(e,a[n])},At.prototype._cacheCellElement=function(e,t,a){var n=!1;this.state.cellCache[e._index.id]||(this.state.cellCache[e._index.id]={},this.state.cellCacheHelper.cacheDataList.push(e),n=!0),this.state.cellCache[e._index.id][t.id]=a,n&&this._trimCellCache()},At.prototype._trimCellCache=function(){var e=this;if(e.option.cellCache.policy&&++e.state.cellCacheHelper.trimCount>30){e.state.cellCacheHelper.trimCount=0;var t="distant"==e.option.cellCache.policy?e.state.cellCacheHelper.cacheDataList.length:b(e.state.cellCache);if(t>e.option.cellCache.capacity){var a=t-e.option.cellCache.capacity;if("random"==e.option.cellCache.policy){for(var n in e.state.cellCache)if(e._clearCellCacheByDataId(n),--a<0)break}else if("distant"==e.option.cellCache.policy){e.state.cellCacheHelper.cacheDataList.sort(function(t,a){return Math.min(Math.abs(t._index.row-e.state.renderFromRenderedIndex),Math.abs(t._index.row-e.state.renderToRenderedIndex))-Math.min(Math.abs(a._index.row-e.state.renderFromRenderedIndex),Math.abs(a._index.row-e.state.renderToRenderedIndex))});for(var r=e.state.cellCacheHelper.cacheDataList.splice(e.option.cellCache.capacity),o=0,l=r.length;o<l;o++)e._clearCellCacheByDataId(r[o]._index.id)}"distant"!=e.option.cellCache.policy&&(e.state.cellCacheHelper.cacheDataList=[])}}},At.prototype._cellIdFromData=function(e,t){return[this.key,"number"==typeof e?e:e._index.row,t].join("-")},At.prototype._cellIdFromRowIndex=function(e,t){return[this.key,e,t].join("-")},At.prototype._generateCellAttribute=function(e,t,a){var n=this,r={styleclass:a?[]:["alopexgrid-cell"]},o=t.key,l=n.state;if(r.title=null,e){if(!a){if(r["data-alopexgrid-columnindex"]=t.columnIndex,r["data-alopexgrid-dataindex"]=null!=e._index.data?e._index.data:null,r["data-alopexgrid-dataid"]=e._index.id||null,r.styleclass.push(e._index.id),r.styleclass.push(e._index.row%2?"row-odd":"row-even"),e._state.selected&&r.styleclass.push("selected"),e._state.edited&&r.styleclass.push("edited"),e._state.focused&&r.styleclass.push("focused"),e._state.deleted&&r.styleclass.push("deleted"),e._state.editing&&r.styleclass.push("editing"),e._state.added&&r.styleclass.push("added"),n._isEditingCell(e,t.columnIndex)&&r.styleclass.push("editingcell"),e._state.groupHeader||e._state.groupFooter){if(r.styleclass.push("cell-groupmeta"),e._state.groupHeader){var i=n._getGroupingRangeByGroupId(e._state.groupHeader);if(r.styleclass.push("cell-groupheader"),r.styleclass.push("cell-groupheader-depth-"+i.groupDepth),r["data-alopexgrid-groupheader-depth"]=i.groupDepth,t.groupHeaderAlign&&r.styleclass.push("groupmeta-align-"+t.groupHeaderAlign),t.groupHeaderStyleclass){var d=t.groupHeaderStyleclass;if("function"==typeof d){var s=n._renderGroupSummaryValue(e,t)||"";s&&s.nodeType&&(s=At.renderUtil.getTextFromElement(s)),d=d.call(n,s,e,t,i)}d&&"string"==typeof d&&r.styleclass.push(d)}}else if(e._state.groupFooter){var i=n._getGroupingRangeByGroupId(e._state.groupFooter);if(r.styleclass.push("cell-groupfooter"),r.styleclass.push("cell-groupheader-depth-"+i.groupDepth),r["data-alopexgrid-groupheader-depth"]=i.groupDepth,t.groupFooterAlign&&r.styleclass.push("groupmeta-align-"+t.groupFooterAlign),t.groupFooterStyleclass){var d=t.groupFooterStyleclass;if("function"==typeof d){var s=n._renderGroupSummaryValue(e,t)||"";s&&s.nodeType&&(s=At.renderUtil.getTextFromElement(s)),d=d.call(n,s,e,t,i)}d&&"string"==typeof d&&r.styleclass.push(d)}}}else r["data-alopexgrid-groupheader-depth"]=null;if(n.option.rowOption){if(n.option.rowOption.styleclass){var p=n.option.rowOption.styleclass;"function"==typeof p&&(p=p.call(n,e,n.option.rowOption)),p&&"string"==typeof p&&r.styleclass.push(p)}if(n.option.rowOption.highlight){var p=n.option.rowOption.highlight;"function"==typeof p&&(p=p.call(n,e,n.option.rowOption)),p&&(r.styleclass.push("row-highlight"),"string"==typeof p&&r.styleclass.push(p))}n.option.rowOption.inlineStyle&&(r.style=r.style||{},At.renderUtil.inlineStyleToStyleObject(n.option.rowOption.inlineStyle,r.style,[e],n))}n.state.pinnedDataIdMap&&n.state.pinnedDataIdMap[e._index.id]?(r.styleclass.push("pinnedcell","cell-fixrow","alopexgrid-cell-fixrow"),"string"==typeof n.state.lastPinnedDataId&&e._index.id===n.state.lastPinnedDataId&&r.styleclass.push("cell-fixrow-lastrow","alopexgrid-cell-lastfixrow")):e._index.row>=0&&e._index.row<n.option.rowFixCount&&(r.styleclass.push("cell-fixrow","alopexgrid-cell-fixrow"),e._index.row===n.option.rowFixCount-1&&r.styleclass.push("cell-fixrow-lastrow","alopexgrid-cell-lastfixrow")),l.cellSelection&&(l.cellSelection.focusColumnIndex===t.columnIndex&&l.cellSelection.focusRenderedIndex===e._index.row?r.styleclass.push("cell-selected-focus"):l.cellSelection.focusRowspanInfo&&l.cellSelection.focusRowspanInfo.from<=e._index.row&&l.cellSelection.focusRowspanInfo.to>=e._index.row&&l.cellSelection.focusColumnIndex===t.columnIndex&&r.styleclass.push("cell-selected-focus"),l.cellSelection.columnIndexMap[t.columnIndex]&&l.cellSelection.renderedIndexMap[e._index.row]&&(r.styleclass.push("cell-selected"),l.cellSelection.leftBoundaryColumnIndex===t.columnIndex&&r.styleclass.push("cell-selected-leftline"),l.cellSelection.rightBoundaryColumnIndex===t.columnIndex&&r.styleclass.push("cell-selected-rightline"),l.cellSelection.topBoundaryRenderedIndex===e._index.row&&r.styleclass.push("cell-selected-topline"),l.cellSelection.bottomBoundaryRenderedIndex===e._index.row&&r.styleclass.push("cell-selected-bottomline")));var u=n._getSearchHighlightClassName(e,t);u&&r.styleclass.push(u)}if(bt>8&&(!0===n.option.disableTextSelection?r.unselectable="on":r.unselectable="off"),t.align){var c="function"==typeof t.align?t.align.call(n,f,e,t)||"left":t.align;r.styleclass.push("align-"+c)}if(!0===n.option.ellipsisText&&r.styleclass.push("cell-ellipsis-text"),r["data-alopexgrid-key"]=t.key||null,n._isCellEditable(e,t)?r.styleclass.push("cell-ui-editable"):r.styleclass.push("cell-ui-noneditable"),t.render||t.editable){var g=n._extractRenderObject(e,t);g&&"object"==typeof g&&g.type&&r.styleclass.push("cell-type-"+g.type)}if(!n.option.disableCellTitle&&t.tooltip)if(e._state.groupHeader||e._state.groupFooter)r.title="/text";else if(e){var f=e[t.key],h=f;"function"==typeof t.tooltip?h=t.tooltip(f,e,t)||"":"string"==typeof t.tooltip?h=t.tooltip:(t.render||t.editable)&&g&&(h=At.renderUtil.getTextFromRenderRuleArray(f,e,g,t,n)),null!=h&&(r.title=h)}if(t.styleclass){var d=t.styleclass;"function"==typeof d&&(d=d.call(n,e[o],e,t)),d&&"string"==typeof d&&r.styleclass.push(d)}if(t.highlight){var d=t.highlight;"function"==typeof d&&(d=d.call(n,e[o],e,t)),d&&(r.styleclass.push("cell-highlight","alopexgrid-cell-highlight"),"string"==typeof d&&r.styleclass.push(d))}t.inlineStyle&&(r.style=r.style||{},At.renderUtil.inlineStyleToStyleObject(t.inlineStyle,r.style,[e[o],e,t],n))}else r.styleclass.push("emptycell"),r["data-alopexgrid-rowindex"]=null,r["data-alopexgrid-columnindex"]=null,r["data-alopexgrid-dataindex"]=null,r["data-alopexgrid-dataid"]=null,r["data-alopexgrid-key"]=null;if(t&&!a){var m=n.state.visibleColumnMappingList[0],v=n.state.visibleColumnMappingList[n.state.visibleColumnMappingList.length-1];m&&m.columnIndex===t.columnIndex&&r.styleclass.push("cell-firstcolumn"),v&&v.columnIndex===t.columnIndex&&r.styleclass.push("cell-lastcolumn"),t.multi&&r.styleclass.push("cell-multi-column"),t.columnIndex<=n.state.fixupto&&(r.styleclass.push("cell-fixcol","alopexgrid-cell-fixedcolumn"),t.columnIndex===n.state.fixupto&&r.styleclass.push("cell-fixcol-lastcolumn","alopexgrid-cell-lastfixedcolumn")),n.state.groupKeyOrderMap&&n.state.groupKeyOrderMap[t.key]>=0&&r.styleclass.push("cell-grouping"),t.selectorColumn&&(r.styleclass.push("selector-column"),n.state.rowSingleSelect&&r.styleclass.push("single-selector-column")),t.rowindexColumn&&r.styleclass.push("rowindex-column"),t.numberingColumn&&r.styleclass.push("numbering-column"),t.dragdropColumn&&(r.styleclass.push("dragdrop-column"),r.styleclass.push("cell-unselectable"))}return r.styleclass=r.styleclass.join(" "),r},At.prototype._extractRenderObject=function(e,t){var a=t.columnIndex,n=!(!e||!t)&&(t.editable&&e._state.editing&&e._state.editing.hasOwnProperty(t.columnIndex)),r=(e&&(n?e._state.editing[a]:e[t.key]),null);return n?!0===(r=t.editable)&&(r={type:"text"}):(r=t.render,"editable"===t.render&&t.editable&&!0===(r=t.editable)&&(r={type:"text"})),r},At.prototype._postCellRender=function(e,t,a){var n=this,r=a.columnIndex,o=!(!t||!a)&&(a.editable&&t._state.editing&&t._state.editing.hasOwnProperty(a.columnIndex)),l=t?o?t._state.editing[r]:t[a.key]:void 0,i=n._extractRenderObject(t,a);i&&"object"==typeof i&&(n.option.renderMapping[i.type]&&"function"==typeof n.option.renderMapping[i.type].postRender&&n.option.renderMapping[i.type].postRender.call(n,e,l,t,i,a,n),"function"==typeof i.postRender&&i.postRender.call(n,e,l,t,i,a,n)),n.option.disableCellRenderedEvent||n._triggerGridEvent("cellRendered",{data:t,mapping:a,value:l,editing:o,render:i},e)},At.prototype._getMultiParentColumnIndex=function(e){var t=e&&"object"==typeof e?e.columnIndex:e;return"string"==typeof t&&t.indexOf("m")>=0&&(t=parseInt(t.split("m")[0])),t},At.prototype._getMultiParentMapping=function(e){return"string"==typeof e.columnIndex&&e.columnIndex.indexOf("m")>=0&&(e=this.state.columnIndexToMapping[parseInt(e.columnIndex.split("m")[0])]),e},At.prototype._iterateMultiMapping=function(t,a,n){var r=this;if(a.multi){var o=a.multi;if(s(o)&&(o=o.call(r,t[a.key],t,a),!e.isArray(o)))return;for(var l=0,i=o.length;l<i;l++){if(o[l].columnIndex=a.columnIndex+"m"+l,!1===n.call(r,l,o[l],o))return!1}}},At.prototype._setCellAttribute=function(e,t){if(t.alopexgridInlineStyle){for(var a=t.alopexgridInlineStyle.split(","),n=0,r=a.length-1;n<r;n++)t.style[a[n]]="";t.alopexgridInlineStyle=null,delete t.alopexgridInlineStyle}for(var o in e)if("styleclass"===o)t.className+=(t.className?" ":"")+e[o];else if("style"===o){var l=e[o];if("string"==typeof l){var i=l.split(";");l={};for(var n=0,r=i.length;n<r;n++){var d=i[n].split(":");l[At.trimString(d[0])]=At.trimString(d[1])}}t.alopexgridInlineStyle="";for(var s in l){var p=l[s];null!=p?(t.style[s]=p,t.alopexgridInlineStyle+=s+","):t.style[s]=""}}else null===e[o]?t.removeAttribute(o):t.setAttribute(o,e[o])},At.prototype._setCellContent=function(t,a){At.renderUtil.setElementContent(a,t),!0!==this.option.disableEnhancedEventParse&&$(this,a),"/text"===a.title&&(a.title=e.text(a))},At.prototype._generateCellContent=function(e,t,a){var n=this,r=n.state,l=n.option,i="";if(!e)return i;var d=!!e._state.editing&&n._isEditingCell(e,t),s=!(!0!==n.option.disableFoldingInEditingCell||!d);if(e._state.groupHeader||e._state.groupFooter){if(null==(i=n._renderGroupSummaryValue(e,t))&&t.rowindexColumn){var p=e._index.row;n.option.rowindexColumnFromZero||(p+=1),i=p}}else if(t.selectorColumn){var u=n.option.rowSelectOption.radioColumn,c=!!e._state.selected,g=!1;r.testRowAllowSelect&&!1===l.rowOption.allowSelect(e)&&(c=!1,g=!0,n.state.disableSelectDataIdMap[e._index.id]=!0);var f=null;if(a&&a.firstChild&&a.firstChild.tagName){var h=a;"DIV"===a.firstChild.tagName&&At.renderUtil.hasClass(h.firstChild,"cell-content")&&(h=a.firstChild),h.firstChild&&"LABEL"===h.firstChild.tagName&&At.renderUtil.hasDefaultInputWrapperClass(h.firstChild)&&(f=h.firstChild)}if(f&&f.firstChild&&"INPUT"===f.firstChild.tagName&&(At.renderUtil.hasClass(f.firstChild,"selector-checkbox")&&(!n.state.rowSingleSelect||!u)||At.renderUtil.hasClass(f.firstChild,"selector-radio")&&n.state.rowSingleSelect&&u))i=!1,c?At.renderUtil.addClass(f,"checked"):At.renderUtil.removeClass(f,"checked"),g?At.renderUtil.addClass(f,"disabled"):At.renderUtil.removeClass(f,"disabled"),f.firstChild.checked=c,f.firstChild.disabled=g;else{var m='type="checkbox" class="selector-checkbox selector-column-input"';n.state.rowSingleSelect&&u&&(m='type="radio" class="selector-radio selector-column-input"');var v="<input "+m+' name="'+o()+'" '+(c?'checked="checked"':"")+(g?' disabled="disabled"':"")+">";i=document.createElement("label"),n.state.rowSingleSelect&&u?(At.renderUtil.addDefaultInputWrapperClass(i,"radio"),At.renderUtil.addClass(i,"alopexgrid-selectorcolumn-radio-wrapper")):(At.renderUtil.addDefaultInputWrapperClass(i,"checkbox"),At.renderUtil.addClass(i,"alopexgrid-selectorcolumn-checkbox-wrapper")),c&&(i.className+=" checked"),g&&(i.className+=" disabled"),i.innerHTML=v}}else if(t.rowindexColumn){var p=e._index.row;n.option.rowindexColumnFromZero||(p+=1),i=p}else if(t.dragdropColumn)i=document.createElement("div"),i.className="row-dragdrop-handle alopexgrid-handle",i.setAttribute("onmousedown",gt+".run('"+n.key+"', '_rowDragStart', event);"),i.setAttribute("ontouchstart",gt+".run('"+n.key+"', '_rowDragStart', event);");else if(t.numberingColumn){var x,y=n.pageInfo(),C=n.option.numberingColumnFromZero?0:1;n.state.dynamicBinding&&(C+=y.perPage>0&&y.current>0?Math.max(0,y.perPage*(y.current-1)):0),x=e._index.data+C,i='<div class="numbering-column-wrapper" style="text-align:center;">'+x+"</div>"}else i=n._renderDataByMapping(e,t);if(!s&&n.option.tree&&n.option.tree.useTree&&t.treeColumn){for(var I=document.createDocumentFragment(),_=e._state.treeNodeDepth,w=parseInt(n.option.tree.depthStartValue),b=_;w<b;w++){var M=document.createElement("span");M.className=w===b-1?"alopexgrid-treecolumn-indent treecolumn-lastindent":"alopexgrid-treecolumn-indent",I.appendChild(M)}var S=document.createElement("span");S.className="alopexgrid-treecolumn-icon"+(e._state.expandedTreeNode?" expanded":"")+(e._state.treeNodeLeaf?" leaf":" expandable"),I.appendChild(S),i=K(i,I,!0,!1===i?a:null)}if(e&&e._index&&e._index.id&&(t.rowResizing||t.rowindexColumn)){var E=document.createElement("div");E.className="rowindex-column-resizing-handle resizing-handle alopexgrid-handle",E.setAttribute("data-alopexgrid-resizingrowindex",e._index.row),E.setAttribute("onmousedown",gt+".run('"+n.key+"', '_rowResizeStart',event,"+e._index.row+","+t.columnIndex+");"),E.setAttribute("ontouchstart",gt+".run('"+n.key+"', '_rowResizeStart',event,"+e._index.row+","+t.columnIndex+");"),E.setAttribute("ondblclick",gt+".run('"+n.key+"', 'setRowHeight',{_index:{row:"+e._index.row+"}},'content');"),i=K(i,E,!1,!1===i?a:null)}if(!s&&e&&e._index&&e._index.id&&t.groupFoldingColumn){var T=n._getGroupingRangeByData(e,t);if(T&&T.id){var D=document.createElement("span");D.className="alopexgrid-handle alopexgrid-groupfolding-icon "+(n._isGroupRangeCollapsed(T)?"group-collapsed":""),D.setAttribute("data-alopexgrid-rangeid",T.id),i=K(i,D,!(!n.option.grouping||"left"!==n.option.grouping.groupFoldingColumnPosition),!1===i?a:null)}}if(n.option.wrapCellContent&&!1!==i){var F=document.createElement("div"),R="cell-content";return!0===n.option.wrapCellContent&&null!=n.option.wrapCellContentClassName?R=n.option.wrapCellContentClassName:"string"==typeof n.option.wrapCellContent?R=n.option.wrapCellContent:"function"==typeof n.option.wrapCellContent&&(R=n.option.wrapCellContent.call(n,e,t,a)),F.className=R,n._setCellContent(i,F),F}return i},At.prototype._createCell=function(e,t,a){var n=this,r=null;r=a||document.createElement("div"),r.className="cell bodycell",t=n._getMultiParentMapping(t);var o=(a&&a.getAttribute("data-alopexgrid-rowindex"),n._generateCellAttribute(e,t));n._setCellAttribute(o,r);var l=n._generateCellContent(e,t);return!1!==l&&n._setCellContent(l,r),r.isCellAttributeGenerated=!0,r.isCellContentGenerated=!0,n._postCellRender(r,e,t),r},At.prototype._basicCellCreation=function(e,t,a,n){var r=this;if(!e.isCellAttributeGenerated||!0===n){var o=r._generateCellAttribute(t,a);r._setCellAttribute(o,e),e.isCellAttributeGenerated=!0}if(!e.isCellContentGenerated||!0===n){var l=r._generateCellContent(t,a,e);!1!==l&&r._setCellContent(l,e),r._postCellRender(e,t,a),e.isCellContentGenerated=!0}},At.prototype.suppressRender=function(t){var a=this;"boolean"===e.type(t)?a.state.renderingSuppressed=t:s(t)&&(a.state.renderingSuppressed=!0,t(),a.state.renderingSuppressed=!1)},At.prototype.showCellEditPopup=function(e,t){var a,n=this,r=n._dataGetByIndex(e);null!=r&&d(r)&&(a=r._index.row);var o=n._columnIndexKeyToMappingList(t);if(o&&o.length){var l=o[0],i=l.columnIndex;n.dataScroll({_index:{row:a,column:i}});var s={_index:{row:a}},p=n.cellElementGet(s,t);p&&p.length>0&&n._openCellEditPopup(p,!0,null,a,i)}},At.prototype.removeCellEditPopup=function(){var e=this;Ct.off(".alopexgridCellPopupEdit"+e.key),null!=e.state.activePopupTextarea&&(e.state.activePopupTextarea.remove(),delete e.state.activePopupTextarea,null!=e.state.activePopupEditCell&&(e.state.activePopupEditCell.removeClass("cellpopupedit-focused"),delete e.state.activePopupEditCell),!0===e.option.cellSelectable&&Ze(e))},At.prototype._openCellEditPopup=function(t,a,n,r,o){function l(e){if(null!=e&&"keydown"===e.type){var t=e.which?e.which:e.keyCode;if(13!==t&&32!==t)return}var a=e.data,n=a.self;Ct.off(a.cellPopupEditEventNS+n.key),null!=n.state.activePopupTextarea&&(n.state.activePopupTextarea.remove(),delete n.state.activePopupTextarea,a.$cell.removeClass(a.cellEditFocusCls)),!0===n.option.cellSelectable&&Ze(n)}var p=this,u=n,c=".alopexgridCellPopupEdit",g=!!p.state.hasRowAllowEdit;if(!0===a)var f=r;else{if(t.hasClass("editingcell"))return;if(!0===p.option.rowInlineEdit)return;if(!0!==p.option.cellInlineEdit)return;var f=parseInt(t.attr("data-alopexgrid-rowindex")),o=parseInt(t.attr("data-alopexgrid-columnindex"))}var h=W(p,o),m=p._getRenderedDataFromRenderedIndex(f),v=N(p,m,h);if((null!=h.editable&&!1!==h.editable||!1!==v)&&!(g&&!1===p.option.rowOption.allowEdit.call(p,m)||null!=h.allowEdit&&!1===h.allowEdit.call(p,m[h.key],m,h))){var x=p._columnIndexKeyToIndexArray(p.option.cellPopupEdit,null,!0);if(-1!==e.inArray(o,x)){var y=!1;"mousedown"===p.option.cellPopupEditOption.startEvent&&(y=!0);Ct.off(c+p.key),null!=p.state.activePopupTextarea&&(p.state.activePopupTextarea.remove(),delete p.state.activePopupTextarea,null!=p.state.activePopupCell&&p.state.activePopupCell.removeClass("cellpopupedit-focused")),t.addClass("cellpopupedit-focused"),p.state.activePopupCell=t;var C=document.createElement("div");C.className=ct+" alopexgrid-celledit-popupwrap alopexgrid-popupwrap";var I=e(C),_=document.createElement("div");_.className="alopexgrid-celledit-titlearea alopexgrid-titlearea";var w=e.extend({},p.option.cellPopupEditOption,h.cellPopupEditOption);!0===w.movable&&(_.className+=" movable");var b=document.createElement("div");b.className="title",null!=w.title&&(!0===w.title?b.innerText=At.i18n("cellPopupEditTitle"):"string"==typeof w.title?b.innerText=w.title:s(w.title)&&(b.innerText=w.title.call(p,h)));var M=document.createElement("button");M.type="button",M.className="close",M.innerText="X",M.title=At.i18n("close");var S=e(M),E={};E.self=p,E.$cell=t,E.cellEditFocusCls="cellpopupedit-focused",E.cellPopupEditEventNS=c,E.mousedownEvent=y,S.on("mousedown"+c+p.key+p.eventns+" keydown"+c+p.key+p.eventns+" touchstart"+c+p.key+p.eventns,E,function(e){l(e)});var T=e(_);T.append(b,M);var D=document.createElement("div");D.className="alopexgrid-celledit-textareawrap alopexgrid-textareawrap";var F=e(D),R=document.createElement("textarea");R.className="alopexgrid-celledit-popuptextarea alopexgrid-popuptextarea",R.innerText=t.text(),v&&(R.setAttribute("readonly",""),R.className+=" disabled"),F.append(R);var k=e(R),L=document.createElement("div");L.className="alopexgrid-celledit-buttonarea alopexgrid-buttonarea";var A=e(L);if(!v){var O=document.createElement("button");O.className="alopexgrid-celledit-popupbutton alopexgrid-popupbutton save",O.innerText=At.i18n("save");var P=e(O);P.on("mousedown"+c+p.key+p.eventns+" keydown"+c+p.key+p.eventns+" touchstart"+c+p.key+p.eventns,E,function(e){if(null!=e&&"keydown"===e.type){var t=e.which?e.which:e.keyCode;if(13!==t&&32!==t)return}var a=e.data.self;a.cellEdit(k.val(),{_index:{row:f}},o),Ct.off(e.data.cellPopupEditEventNS+a.key),null!=a.state.activePopupTextarea&&(a.state.activePopupTextarea.remove(),delete a.state.activePopupTextarea,e.data.$cell.removeClass(e.data.cellEditFocusCls)),!0===a.option.cellSelectable&&Ze(a)}),A.append(P)}var B=document.createElement("button");B.className="alopexgrid-celledit-popupbutton alopexgrid-popupbutton close",B.innerText=At.i18n("close");var G=e(B);G.on("mousedown"+c+p.key+p.eventns+" keydown"+c+p.key+p.eventns+" touchstart"+c+p.key+p.eventns,E,function(e){l(e)}),A.append(G),I.append(T,F,A),e(document.body).append(I),p.state.activePopupTextarea=I,p.state.activePopupEditCell=t;var H=150,$=150;null!=w.minWidth&&(H=Math.max(H,w.minWidth)),null!=w.minHeight&&($=Math.max($,w.minHeight)),I.css({"min-width":H+"px","min-height":$+"px"});null!=w.width?I.css({width:Math.max(H,w.width)+"px"}):I.css({width:Math.max(H,350)+"px"}),null!=w.height?I.css({height:Math.max($,w.height)+"px"}):I.css({height:Math.max($,300)+"px"});var K=I.outerHeight(!0)-T.outerHeight(!0)-A.outerHeight(!0)-5;k.css({height:K+"px"});var U=t.offset(),V=10,Y=10;!0===a?(V=U.top,Y=U.left+t.width()+10):(V=U.top+u.offsetY,Y=U.left+u.offsetX+10);var X=I.outerWidth(!0),z=I.outerHeight(!0),j=Y-yt.scrollLeft()+X,q=yt.width();j>q&&(Y-=j-q+10)<0&&(Y=0);var Z=V-yt.scrollTop()+z,Q=yt.height();Z>Q&&(V-=Z-Q+10)<0&&(V=0),I.css({left:Y+"px",top:V+"px"}),!0===w.movable&&(E.$popupWrap=I,E.cellPopupMoveEventNS=".alopexgridCellPopupMoveEventNS",T.on("mousedown"+c+p.key+p.eventns+" touchstart"+c+p.key+p.eventns,E,function(e){var t=e.data.self,a=e.data.$popupWrap,n=e;"touchstart"===e.type&&(n=e.originalEvent.touches[0]),e.preventDefault();var r={};r.self=t,r.$cell=e.data.$cell,r.cellEditFocusCls=e.data.cellEditFocusCls,r.$popupWrap=a,r.cellPopupMoveEventNS=e.data.cellPopupMoveEventNS,r.prevX=n.pageX,r.prevY=n.pageY;var o=e.data.$popupWrap.offset();r.gapX=n.pageX-o.left,r.gapY=n.pageY-o.top,Ct.off(e.data.cellPopupMoveEventNS+t.key),Ct.on("mousemove"+e.data.cellPopupMoveEventNS+t.key+" touchmove"+e.data.cellPopupMoveEventNS+t.key,r,function(e){var t=e;if("touchmove"===e.type&&(t=e.originalEvent.touches[0]),e.data.prevX!==t.pageX||e.data.prevY!==t.pageY){e.data.prevX=t.pageX,e.data.prevY=t.pageY;var a=(e.data.self,e.data.$popupWrap);e.preventDefault(),i(),a.css({left:e.data.prevX-e.data.gapX+"px",top:e.data.prevY-e.data.gapY+"px"})}}).on("mouseup"+e.data.cellPopupMoveEventNS+t.key+" touchend"+e.data.cellPopupMoveEventNS+t.key+" touchcancel"+e.data.cellPopupMoveEventNS+t.key,r,function(e){Ct.off(e.data.cellPopupMoveEventNS+t.key)})}));var J=document.createElement("div");J.className="box-resizing-handle",J.style.right="0px",J.style.bottom="0px",I.append(J);var ee=document.createElement("div");ee.className="box-resizing-align",ee.style.display="none",I.append(ee);var te={};te.self=p,te.mapping=h,te.bar=ee,te.$popupWrap=I,te.$popupHeader=T,te.$popupTextareaEl=k,te.$popupButtonArea=A,te.mergedCellpopupEditOption=w,te.popupMinWidth=H,te.popupMinHeight=$,I.on("mousedown touchstart",".box-resizing-handle",te,function(e){var t=e;"touchstart"===e.type&&(t=e.originalEvent.touches[0]);var a=e.data.self;e.data.bar.style.display="block",e.data.bar.style.height=(e.data.startHeight=I.height())+"px",e.data.bar.style.width=(e.data.startWidth=I.width())+"px",e.data.startPageX=t.pageX,e.data.startPageY=t.pageY,e.data.diffx=0,e.data.diffy=0,e.data.minWidth=Math.max(e.data.popupMinWidth,e.data.mergedCellpopupEditOption.minWidth),e.data.minHeight=Math.max(e.data.popupMinHeight,e.data.mergedCellpopupEditOption.minHeight);var n=".alopexgridCellPopupEditResize"+a.key+a.eventns;e.data.cellPopupEditResizeEventNS=n,Ct.off(n),Ct.on("selectstart"+n,function(e){e.preventDefault()}),Ct.on("mousemove"+n+" touchmove"+n,e.data,function(e){e.preventDefault();var t=e;"touchmove"===e.type&&(t=e.originalEvent.touches[0]),e.data.diffx=t.pageX-e.data.startPageX,e.data.diffy=t.pageY-e.data.startPageY,e.data.bar.style.width=Math.max(e.data.minWidth,e.data.startWidth+e.data.diffx)+"px",e.data.bar.style.height=Math.max(e.data.minHeight,e.data.startHeight+e.data.diffy)+"px"}),Ct.on("mouseup"+n+" touchend"+n+" touchcancel"+n,e.data,function(e){e.data.self;Ct.off(e.data.cellPopupEditResizeEventNS),e.data.bar.style.display="none";var t=Math.max(e.data.minWidth,e.data.startWidth+e.data.diffx),a=Math.max(e.data.minHeight,e.data.startHeight+e.data.diffy);e.data.$popupWrap.css({width:t,height:a});var n=e.data.$popupWrap.outerHeight(!0)-e.data.$popupHeader.outerHeight(!0)-e.data.$popupButtonArea.outerHeight(!0)-5;e.data.$popupTextareaEl.css({height:n+"px"}),!0===e.data.mergedCellpopupEditOption.savePopupSize&&(d(e.data.mapping.cellPopupEditOption)?(e.data.mapping.cellPopupEditOption.width=t,e.data.mapping.cellPopupEditOption.height=a):e.data.mapping.cellPopupEditOption={width:t,height:a}),e.preventDefault()})}),Ct.on("keydown"+c+p.key+p.eventns,E,function(e){var t=e.data.self;switch(e.keyCode){case 27:Ct.off(e.data.cellPopupEditEventNS+t.key),null!=t.state.activePopupTextarea&&(t.state.activePopupTextarea.remove(),delete t.state.activePopupTextarea,e.data.$cell.removeClass(e.data.cellEditFocusCls),!0===t.option.cellSelectable&&Ze(t))}}),!0===w.closeOuterClick&&Ct.on("mousedown"+c+p.key+p.eventns,E,function(t){var a=t.data.self,n=e(t.target);if(t.data.mousedownEvent)return void(t.data.mousedownEvent=!1)
;At.trimString(n.attr("class"));null!=a.state.activePopupTextarea&&n&&0===n.closest(".alopexgrid-celledit-popupwrap.alopexgrid-popupwrap, .alopexgrid-celledit-popuptextarea.alopexgrid-popuptextarea, .alopexgrid-celledit-popupbutton.alopexgrid-popupbutton").length&&(Ct.off(t.data.cellPopupEditEventNS+a.key),a.state.activePopupTextarea.remove(),delete a.state.activePopupTextarea,t.data.$cell.removeClass(t.data.cellEditFocusCls))}),setTimeout(function(){S.focus()},0)}}},At.prototype._generateRenderTargetMapping=function(){var e=this,t=0,a=[],n=[],r=!1;e._columnShowFromEnabled()&&(e._limitRenderFromByFixCount(),r=null!=e.state.columnFixShowFromColumnIndex);var o=e.state.renderFromColumnIndex,l=!!e.state.scrollxEnd,i=0,d=0,s=0;if(e.option.useContinuousXScroll){var p=e._getColumnIndexByBlankWidth(e.state.translateX,!0);p&&(s=Math.ceil(p))}for(var u=0,c=e.option.columnMapping.length;u<c;u++){var g=e.option.columnMapping[u];if(g&&parseInt(g.columnIndex)>=0&&!0!==g.hidden&&"conceal"!==g.hidden&&(g.columnIndex<=e.state.fixupto?r&&g.columnIndex<e.state.columnFixShowFromColumnIndex||(t+=parseInt(g.width),g.excludeFitWidth&&(d+=parseInt(g.width)),a.push(g),n.push(g),g.columnIndex<o&&i++):g.columnIndex>=o&&(i?i--:(t+=parseInt(g.width),g.excludeFitWidth&&(d+=parseInt(g.width)),a.push(g))),t>e.state.wrapperWidth+s&&!l))break}var f=1,h={},m=!(!e.option.fitTableWidth||e.state.fitTableWidthFixed);t&&m&&t<e.state.wrapperWidth&&(f=(e.state.wrapperWidth-d)/(t-d));for(var v=0,u=0,c=a.length;u<c;u++){var g=a[u],x=parseInt(g.width);f>1&&!g.excludeFitWidth&&(x=Math.round(parseInt(g.width)*f)),h[g.id]=x,v+=x}if(f>1&&v!==e.state.wrapperWidth){var y=parseInt(e.state.wrapperWidth-v);if(y)for(var C=parseInt(y/Math.abs(y)),u=a.length-1;y;){var g=a[u--];h[g.id]+=C,u<0&&(u=a.length-1),y-=C}}var I={};return I.renderTargetMapping=a,I.fixedRenderTargetMapping=n,I.renderTargetWidth=t,I.renderFitWidth=f>1?e.state.wrapperWidth:t,I.fitRatio=f,e.state.columnFitWidthById=I.columnWidthByIdMap=h,I},At.prototype._columnIndexOrder=function(e){return null==this.state.columnIndexArrOrderMap[e]?-1:this.state.columnIndexArrOrderMap[e]},At.prototype._columnIndexKeyToIndexArray=function(t,a,n){var r,o=this;if(null==a&&(a=[]),null!=t&&t.length>0)for(var l=0;l<t.length;l++)if(null!=(r=t[l]))if("string"==typeof r)if(n){var i=o.state.keyMappedToMultipleColumn[r];if(null!=i&&i.length>0)for(var d,s=0;s<i.length;s++){var d=i[s].columnIndex;-1===e.inArray(d,a)&&a.push(d)}else a.push(o.state.columnKeyToIndexMap[r])}else a.push(o.state.columnKeyToIndexMap[r]);else a.push(r);return a},At.prototype._calculateColumnWidthProperty=function(){var e=this;e.state.columnWidth=0,e.state.columnWidthMap={},e.state.columnWidthExceptFixed=0,e.state.columnWidthExceptFixedMap={},e.state.columnIndexArr=[],e.state.columnIndexArrOrderMap={};var t=0,a=0;e._columnShowFromEnabled()&&null!=e.state.columnFixShowFromColumnIndex&&(a=e.state.columnFixShowFromColumnIndex);for(var n=0;n<e.option.columnMapping.length;n++){var r=e.option.columnMapping[n];r&&null!=r.columnIndex&&r.columnIndex<a||r&&r.columnIndex>=0&&!0!==r.hidden&&"conceal"!==r.hidden&&(!0===r.fixed&&r.columnIndex<=e.state.fixupto||(!0===r.fixed&&(r.fixed=!1),e.state.columnWidthExceptFixedMap[r.columnIndex]=parseInt(r.width),e.state.columnWidthExceptFixed+=parseInt(r.width)),e.state.columnWidthMap[r.columnIndex]=parseInt(r.width),e.state.columnWidth+=parseInt(r.width),e.state.columnIndexArrOrderMap[r.columnIndex]=t++,e.state.columnIndexArr.push(parseInt(r.columnIndex)))}e.state.standardColumnWidth=0,e.state.standardColumnWidthMap={},e.state.fixedColumnMapping.length>0?(e.state.standardColumnWidth=e.state.columnWidthExceptFixed,e.state.standardColumnWidthMap=e.state.columnWidthExceptFixedMap):(e.state.standardColumnWidth=e.state.columnWidth,e.state.standardColumnWidthMap=e.state.columnWidthMap)},At.prototype._columnResizeStart=function(t,a){if(t&&t.type){var n=e.event.fix(t);"touchstart"===t.type&&(n=t.touches[0]),t.preventDefault();var r=".alopexgridcolumnresizeevent",o=this,l=e(t.target),i=e(t.target).closest(".headercell"),d=i[0],s=e('<div class="resize-align column-resize-align">'),p=s[0],u=parseInt(d.style.left)+parseInt(d.style.width)+"px",c=(t.target.offsetWidth,o.state.columnIndexToMapping[a]),g={self:o,$bar:s,bar:p,prevX:0,totalMoveAmount:0,columnIndex:a,mapping:c,columnResizeEventNS:r};l.siblings(".resizing-handle").length>0&&(u=i.position().left+l.position().left+l.width()-1+"px"),p.style.top="0px",p.style.left=u,p.style.height=parseInt(1.5*o.state.wrapperHeight)+"px",o.$wrapper[0].appendChild(p),o.state.resizing=!0,g.prevX=parseInt(n.pageX),o._triggerGridEvent("UIColumnResizeStart",{mapping:c,width:parseInt(c.width),fitWidth:o.state.columnFitWidthById[c.id]}),Ct.off(r+o.eventns+o.key),Ct.on("keydown"+r+o.eventns+o.key,g,function(e){switch(e.keyCode){case 27:Ct.off(e.data.columnResizeEventNS+o.eventns+o.key),e.data.$bar&&(e.data.$bar.remove(),delete e.data.$bar)}}),Ct.on("mousemove"+r+o.eventns+o.key+" touchmove"+r+o.eventns+o.key,g,X).on("mouseup"+r+o.eventns+o.key+" touchend"+r+o.eventns+o.key+" touchcancel"+r+o.eventns+o.key,g,z)}},At.prototype._isColumnSorted=function(e){var t=this;if(t.state.sortingInfo&&t.state.sortingInfo.length)for(var a=0,n=t.state.sortingInfo.length;a<n;a++){var r=t.state.columnMappingMapById[t.state.sortingInfo[a].mappingId];if(null!=r&&("number"==typeof e&&r.columnIndex===e||"string"==typeof e&&r.key===e||e&&"object"==typeof e&&e.id===r.id))return t.state.sortingInfo[a]}return!1},At.prototype._hasHiddenColumnBetween=function(t,a,n){for(var r=this,o=0,l=r.option.columnMapping.length;o<l;o++){var i=r.option.columnMapping[o],d=i.columnIndex;if(!(n&&n.length>0&&e.inArray(d,n)>=0)&&(!i.columnFoldingColumn&&i.hidden&&"number"==typeof d&&t<=d&&d<=a))return!0}return!1},At.prototype._hideAllColumnBetween=function(t,a,n,r){for(var o=this,l=0,i=o.option.columnMapping.length;l<i;l++){var d=o.option.columnMapping[l],s=d.columnIndex;if(!(n&&n.length>0&&e.inArray(s,n)>=0)&&(!d.columnFoldingColumn&&"number"==typeof s&&t<=s&&s<=a&&(d.hidden=r,(!0===r||"conceal"===r)&&null!=d.filterOption))){!0===e.extend(!0,{},o.option.filter,d.filter).removeFilterOptionByHidden&&delete d.filterOption}}},At.prototype._showAllColumnBetween=function(t,a,n){for(var r=this,o=0,l=r.option.columnMapping.length;o<l;o++){var i=r.option.columnMapping[o],d=i.columnIndex;n&&n.length>0&&e.inArray(d,n)>=0||(i.columnFoldingColumn||"number"==typeof d&&t<=d&&d<=a&&(i.hidden=!1))}},At.prototype._toggleColumnFold=function(e,t,a,n,r,o){var l=this,i=a&&"object"==typeof a?a:l.state.columnIndexToMapping[a],d=l._hasHiddenColumnBetween(e,t,n);i&&(i.columnFolded=!d),d?l._showAllColumnBetween(e,t,n):l._hideAllColumnBetween(e,t,n,r),!0!==o&&(l.updateOption(),Pe(l),l.redraw())},At.prototype._isSpecialPurposeColumn=function(e){return!!(e.selectorColumn||e.numberingColumn||e.rowindexColumn||e.dragdropColumn)},At.prototype.columnFix=function(e,t){if(void 0!==e){var a=this._columnIndexKeyToMappingList(e);if(a&&a.length){var n={};n.columnFixUpto=a[0].columnIndex,null!=t&&(n.columnFixShowFrom=t),this.updateOption(n)}}},At.prototype.columnUnfix=function(){this.updateOption({columnFixUpto:"unfix",columnFixShowFrom:null})},At.prototype._getColumnByKey=function(e){return this.state.columnKeyToMapping[e]||this.state.columnMappingMapById[e]||null},At.prototype._columnIndexKeyToMappingList=function(t){var a=this,n=t;if("string"==typeof t){var r=[];if(a.state.keyMappedToMultipleColumn&&a.state.keyMappedToMultipleColumn[t])r=r.concat(a.state.keyMappedToMultipleColumn[t]);else{var o=a._getColumnByKey(t);r=r.concat(o?[o]:[])}if(!a.option.disableMultiMappingGet&&a.state.multiColumnList.length)for(var l=[],i=0,d=a.state.multiColumnList.length;i<d;i++){var s=a.state.multiColumnList[i],p=s.multi;if(e.isArray(p))for(var u=0,c=p.length;u<c;u++){var g=p[u];g&&(g.key!==t&&g.id!==t&&g.columnIndex!==t||r.push(g))}}return r}if(e.isArray(t)){for(var l=[],i=0,d=t.length;i<d;i++)l=l.concat(a._columnIndexKeyToMappingList(t[i]));return l}return null===n||void 0===n?[].concat(a.option.columnMapping):a.state.columnIndexToMapping[n]?[a.state.columnIndexToMapping[n]]:[]},At.prototype.updateColumn=function(t,a){if(null==a&&(a=[]),u(t)){var n=this,r=[];if(s(t)||s(a)){var o=s(t)?t:a;if(1===arguments.length)r=n._columnIndexKeyToMappingList();else if("string"==typeof a||"number"==typeof a)r=n._columnIndexKeyToMappingList(a);else if(e.isArray(a)&&a.length)for(var l=0,i=a.length;l<i;l++){var p=n._columnIndexKeyToMappingList(a[l]);r=r.concat(p)}for(var c=0;c<r.length;c++)o.call(n,r[c]);return n.state.sortingRequired=!0,void n.updateOption()}var g=e.isArray(t);if(g&&e.isArray(a)&&t.length&&t.length===a.length){for(var l=0,i=a.length;l<i;l++)if(d(t[l]))for(var r=n._columnIndexKeyToMappingList(a[l]),f=0,h=r.length;f<h;f++)e.extend(r[f],t[l]);return void n.updateOption()}if(d(t)&&!e.isEmptyObject(t)){e.isArray(a)?0===a.length&&(r=n._columnIndexKeyToMappingList()):a=[a];for(var l=0,i=a.length;l<i;l++){var p=n._columnIndexKeyToMappingList(a[l]);r=r.concat(p)}if(r&&r.length){for(var c=0;c<r.length;c++){var m=r[c];m&&e.extend(m,t)}n.updateOption()}}}},At.prototype.updateColumnMapping=function(e,t){return this.updateColumn(t,e)},At.prototype.addContextMenu=function(t,a){d(t)&&t.hasOwnProperty("title")&&(e.isNumeric(a)?this.option.contextMenu.splice(a,0,t):this.option.contextMenu.push(t))},At.prototype.deleteContextMenu=function(e){this.option.contextMenu.splice(e,1)},At.prototype._refreshBoard=function(e){var t=this;if(!t.state.renderingSuppressed){t.state.renderFromRenderedIndex=Math.max(0,t.state.renderFromRenderedIndex||0),t.state.renderFromColumnIndex=Math.max(0,t.state.renderFromColumnIndex||0),t.state.renderTargetMappingInfo=t._generateRenderTargetMapping();var a=t.option.useContinuousXScroll&&t.state.prevTranslateX!==t.state.translateX,n=t.option.useContinuousYScroll&&t.state.prevTranslateY!==t.state.translateY;if(!e&&t.state.prevRenderFromRenderedIndex===t.state.renderFromRenderedIndex&&t.state.prevRenderFromColumnIndex===t.state.renderFromColumnIndex&&t.state.prevWrapperWidth===t.state.wrapperWidth&&t.state.prevWrapperHeight===t.state.wrapperHeight&&t.state.prevScrollxEnd===t.state.scrollxEnd&&t.state.prevScrollyEnd===t.state.scrollyEnd&&t.state.prevColumnIndexArr===t.state.columnIndexArr&&!a&&!n)return t._refreshScrollbar(e),void t._triggerGridEvent("gridRefresh",{});var r=!(t.state.prevRenderFromRenderedIndex===t.state.renderFromRenderedIndex&&t.state.prevRenderFromColumnIndex===t.state.renderFromColumnIndex&&t.state.prevScrollxEnd===t.state.scrollxEnd&&t.state.prevScrollyEnd===t.state.scrollyEnd);t.state.prevRenderFromRenderedIndex=t.state.renderFromRenderedIndex,t.state.prevRenderFromColumnIndex=t.state.renderFromColumnIndex,t.state.prevWrapperWidth=t.state.wrapperWidth,t.state.prevWrapperHeight=t.state.wrapperHeight,t.state.prevScrollxEnd=t.state.scrollxEnd;var o=t.state.prevScrollyEnd!==t.state.scrollyEnd&&t.state.scrollyEnd;t.state.prevScrollyEnd=t.state.scrollyEnd,t.state.prevColumnIndexArr=t.state.columnIndexArr,t.state.prevTranslateX=t.state.translateX,t.state.prevTranslateY=t.state.translateY,t._refreshPagingUnit(e),t._refreshScrollbar(e),t._refreshHeaderCells(e),t._refreshFooterCells(e),t._refreshBodyCells(e),t.state.disableSelectDataIdMap&&t._checkRowSelectAll(),t._triggerGridEvent("gridRefresh",{}),r&&t._triggerGridEvent("gridScroll",t.scrollOffset()),o&&t._triggerGridEvent("scrollBottom",{})}},At.prototype.calcAndRedraw=function(){var e=this;e.state.renderingSuppressed||(e.state.fromCalcAndRedraw=!0,e._sortInternalData(),e._generateRenderTargetData(),e.viewUpdate(!0),e.state.fromCalcAndRedraw=!1)},At.prototype.filterAndRedraw=function(){var e=this;e.state.renderingSuppressed||(e._generateRenderTargetData(),e.viewUpdate(!0),Pe(e))},At.prototype.redraw=function(){var e=this;e.state.renderingSuppressed||e.viewUpdate(!0)},At.prototype._extractEditingValueFromCell=function(e,t,a){var n=this,r=a.editable;!0===r&&(r={type:"text"});var o=null;if(d(r)&&n.option.renderMapping[r.type]&&(o=n.option.renderMapping[r.type].editedValue),"function"==typeof a.editedValue&&(o=a.editedValue),o)return o.call(n,e[0],t,r,a,n);var l=e.find("input,select,textarea");return l.length?l.val():e.text()},At.prototype._startupUpdateEditingData=function(e){for(var t=this,a=0,n=t.option.columnMapping.length;a<n;a++){var r=t.option.columnMapping[a];r&&r.editable&&(t._isEditingCell(e,r)&&t._updateEditingCellWithoutElement(e,r))}},At.prototype._updateEditingCellWithoutElement=function(t,a){var n=this;if(a=n._getMultiParentMapping(a)){if(!0===n._isEditingCell(t,a.columnIndex)){var r=e(n._createCell(t,a));n._updateEditingCell(r),r.remove()}}},At.prototype._updateEditingForDataMapping=function(e,t,a){var n=this,r=!1,o=a.columnIndex;if(n._isCellEditable(t,a)&&t._state.editing.hasOwnProperty(o)){var l=n._extractEditingValueFromCell(e,t,a);if(r=t._state.editing[o]!==l,t._state.editing[o]=l,n.option.mergeEditingImmediately){var i={};i[a.key]=l,n._dataEdit(t,i)}if(n.state.groupRowspanned&&n.option.rowspanGroupEdit&&a.rowspan){var d=n._getGroupingRangeByMapping(t._index.data,a);if(d)for(var s=d.from;s<=d.to;s++)s!==t._index.data&&(n.state.data[s]._state.editing[o]=l,n.option.mergeEditingImmediately&&n._dataEdit(n.state.data[s],i))}}return r},At.prototype._refreshByFromChangedCell=function(t,a,n,r){var o=this;if(o.state.hasMappingRefreshBy)for(var l=o.option.refreshByOnHiddenColumn?o.option.columnMapping:o.state.visibleColumnMappingList,i=0,d=l?l.length:-1;i<d;i++){var s=l[i];if(s&&s.hasOwnProperty("refreshBy")&&(s.columnIndex!==a.columnIndex&&(!s.id||s.id!==a.id))){var p=!1;if("string"!=typeof s.refreshBy||a.key!==s.refreshBy&&a.id!==s.refreshBy){if("number"==typeof s.refreshBy&&a.columnIndex===s.refreshBy)p=!0;else if(e.isArray(s.refreshBy)&&(e.inArray(a.key,s.refreshBy)>=0||e.inArray(a.columnIndex,s.refreshBy)>=0))p=!0;else if(!0===s.refreshBy)p=!0;else if("function"==typeof s.refreshBy){var u=s.refreshBy.call(o,n,r,a.key,t,a);!0===u&&(p=!0)}}else p=!0;p&&(o._refreshCell(t,s),o._updateEditingCellWithoutElement(t,s))}}},At.prototype._updateEditingCell=function(t){var a=this;if(!t.nodeType)return void t.each(function(){a._updateEditingCell(this)});t=e(t),t[0].getAttribute("data-alopexgrid-multi")&&(t=t.closest(".alopexgrid-cell"));var n=t.attr("data-alopexgrid-dataid"),r=a._dataGetByIndex({id:n}),o=parseInt(t.attr("data-alopexgrid-columnindex")),l=(parseInt(t.attr("data-alopexgrid-rowindex")),a._columnIndexKeyToMappingList(o)[0]),i=!1,d=At.currentValue(r,l.key),s=null;if(l.multi){var p=t.children(".multicell"),d={},s={},u=[];a._iterateMultiMapping(r,l,function(e,t){u.push(t),d[t.key]=At.currentValue(r,t.key),!0===a._updateEditingForDataMapping(p.eq(e),r,t)&&(i=!0),s[t.key]=At.currentValue(r,t.key)})}else i=a._updateEditingForDataMapping(t,r,l),s=At.currentValue(r,l.key);return i&&(a.state.hasMappingRefreshBy&&a._refreshByFromChangedCell(r,l,d,s),a._triggerGridEvent("cellValueEditing",{data:r,mapping:l,value:s,prevValue:d},t)),i},At.prototype._setCursorUnderPointer=function(t,a,n){if(i(),t&&(null==a||null==n))return void t.find("input,select,textarea").focus();try{var r=t.find("input,select,textarea");if(r.length){var o=Number.POSITIVE_INFINITY,l=r.get(0);r.each(function(t,r){var i=e(r),d=ee(i,a,n);d<=o&&(l=i,o=d)}),r=l;if("SELECT"===r.prop("tagName"))r.focus();else{var d=null,s=0,p=-1,u=-1;do{if(d=q(r[0],s),d.left>a){Math.abs(p-1-a)<=Math.abs(d.left-1-a)&&(s-=1);break}if(p===d.left&&u===d.top)break;p=d.left,u=d.top,s++}while(d);Z(r[0],s)}}}catch(e){var c=t.find("input,select,textarea");"radio"===c.prop("type")?c.filter(":checked").focus():c.focus()}},At.prototype.cellEdit=function(e,t,a){for(var n=this,r=n._dataGet(t),o=n._columnIndexKeyToMappingList(a),l=d(e),i=o.length-1;i>=0;i--){var s=o[i];s.hasOwnProperty("columnIndex")&&(!l||e.hasOwnProperty(s.key))&&s.key&&null!=s.key||o.splice(i,1)}for(var p=[],u=!1,c=!1,g=!1,f=!1,h=!n.option.forceRefreshAllOnCellEdit,i=0,m=r.length;i<m;i++){for(var v=r[i],x=0,y=o.length;x<y;x++){var s=o[x],C=e;l&&e.hasOwnProperty(s.key)&&(C=e[s.key]);var I=v[s.key];if(!1===n._cellEdit(v,s,C)){u=!0;break}h&&I!==C&&(n._refreshCell(v,s),n._refreshByFromChangedCell(v,s,I,C),n.state.sortingInfoKeyMap[s.key]&&(c=!0),n.state.treeInfo&&s.key===n.option.tree.idKey&&(f=!0),null!=n.state.groupingKeyMap[s.key]&&(g=!0))}if(u)break;p.push(v._index.data)}p.length&&(n.option.sortClearOnEdit&&c&&n.sortClear(),n.option.forceRefreshAllOnCellEdit?n.calcAndRedraw():g||f?n.calcAndRedraw():!n.option.sortClearOnEdit&&c&&n.calcAndRedraw())},At.prototype.rowEdit=function(t,a){var n=e.makeArray(arguments).slice(0,2);this.cellEdit.apply(this,n)},At.prototype.dataEdit=function(e,t){var a=this;if(e){var n=a._dataGet(t);if(n&&n.length){if(!1===a._triggerGridEvent("dataEdit",{data:e,datalist:n}))return!1;a._dataEdit(n,e);var r=!1,o=!1,l=!1;if(a.option.sortClearOnEdit||a.state.groupingLookupTable||a.state.treeInfo)for(var i in e)e.hasOwnProperty(i)&&(a.option.sortClearOnEdit&&!l&&a.state.sortingInfoKeyMap[i]&&(a.sortClear(),l=!0),a.state.groupingKeyMap&&null!=a.state.groupingKeyMap[i]&&(r=!0),a.state.treeInfo&&a.option.tree.idKey===i&&(o=!0));if(r||o||a.option.forceRefreshAllOnDataEdit)a.calcAndRedraw();else for(var d=0,s=n.length;d<s;d++)a.refreshCell(n[d]);a._triggerGridEvent("dataEditEnd",{datalist:n}),a._triggerGridEvent("dataChanged",{type:"edit",datalist:n})}}},At.prototype._isCellEditValid=function(t,a,n,r){var o=this,l=t[a.key];if(!1===o._triggerGridEvent("cellEdit",{data:t,mapping:a,value:n,prevValue:l},r))return!1;if(a.hasOwnProperty("valid")){if(e.isArray(a.valid)&&e.inArray(n,a.valid)<0)return!1;if("function"==typeof a.valid){if(!1===a.valid.call(o,n,t,a,r[0]))return!1}}return!0},At.prototype._cellEdit=function(t,a,n){var r=this;if(!a.readonly||!0!==N(r,t,a)){var o=r._getMultiParentMapping(a),l=r.cellElementGet(t,o.columnIndex),i=l.length?null:e(r._createCell(t,o)).appendTo(r.$wrapper),d=i||l,s=t[a.key],p=s!==n;if(!1===r._isCellEditValid(t,a,n,d))return r.state.lastInvalidEditingCell=[t,a],r._triggerGridEvent("cellEditInvalid",{data:t,mapping:a,value:n},d),i&&i.remove(),!1;var u={};return u[a.key]=n,r._dataEdit(t,u),r._triggerGridEvent("cellEditEnd",{data:t,mapping:a,value:n,prevValue:s},d),p&&r._triggerGridEvent("cellValueChanged",{data:t,mapping:a,value:n,prevValue:s},d),i&&i.remove(),!0}},At.prototype._dataEdit=function(t,a){for(var n=this,r=e.isArray(t)?t:[t],o=0,l=r.length;o<l;o++){var t=r[o];if(t._original||(t._original=At.trimObject(t)),n.state.testRowAllowSelect&&t._state.selected&&!1===n.option.rowOption.allowSelect(t)&&(t._state.selected=!1),n.state.treeInfo&&a.hasOwnProperty(n.option.tree.idKey)&&a[n.option.tree.idKey]!==t[n.option.tree.idKey])for(var i=a[n.option.tree.idKey],d=n.state.treeInfo.childCountByIdValueMap[t[n.option.tree.idKey]],s=0,p=d?d.length:-1;s<p;s++){var u=n.state.treeInfo.idValueToDataIdMap[d[s]],c=n._dataGetByIndex({id:u});if(c){var g={};g[n.option.tree.parentIdKey]=i,n._dataEdit(c,g)}}for(var f in a)if(a.hasOwnProperty(f)){var h=a[f],m=t[f]!==h;if(m&&!n.option.fullCompareForEditedState&&(t._state.edited=!0),"function"==typeof n.option.valueFilter&&(h=n._filterValueByValueFilter(t,h)),"_"===f.charAt(0)&&h&&"object"==typeof h&&t[f]&&"object"==typeof t[f])for(var v in h)t[f][v]=h[v];else t[f]=h;if(t._state.editing){if(n.state.keyMappedToMultipleColumn){var x=n._columnIndexKeyToMappingList(f);if(x&&x.length)for(var y=0,C=x.length;y<C;y++)t._state.editing.hasOwnProperty(x[y].columnIndex)&&(t._state.editing[x[y].columnIndex]=h)}else{var I=n.state.columnKeyToIndexMap[f];null!=I&&t._state.editing.hasOwnProperty(I)&&(t._state.editing[I]=h)}if(n.state.multiColumnList.length)for(var _=0,w=n.state.multiColumnList.length;_<w;_++)n._iterateMultiMapping(t,n.state.multiColumnList[_],function(e,a){a.key===f&&t._state.editing.hasOwnProperty(a.columnIndex)&&(t._state.editing[a.columnIndex]=h)})}}if(n.option.fullCompareForEditedState){var b={},M=!1;for(var f in t._original)if(t._original.hasOwnProperty(f)&&!b[f]&&!M&&0!==f.indexOf("_")&&(b[f]=!0,t._original[f]!==t[f])){M=!0;break}for(var f in t)if(t.hasOwnProperty(f)&&!b[f]&&!M&&0!==f.indexOf("_")&&(b[f]=!0,t._original[f]!==t[f])){M=!0;break}t._state.edited=M}n.state.dataCompositor&&n.state.dataCompositor(n,t),n.state.cellCacheEnabled&&n._clearCellCacheByDataId(t._index.id)}return r},At.prototype.startCellEdit=function(e,t){for(var a=this,n=a._dataGet(e),r=a._columnIndexKeyToMappingList(t),o=[],l=0,i=n.length;l<i;l++){var d=n[l];!0===d._state.editing&&(d._state.editing=a.state.getEditingAllState(d));for(var s=0,p={},u=0,c=r.length;u<c;u++){var g=a._getMultiParentMapping(r[u]);if(!p[g.id]){if(p[g.id]=!0,g.multi){var f=!1;if(a._iterateMultiMapping(d,g,function(e,t){if(t.editable)return f=!0,!1}),!f)continue}else if(!g.editable)continue;if(a._startCellEdit(d,g),a.state.groupRowspanned&&a.option.rowspanGroupEdit&&g.rowspan){var h=a._getGroupingRangeByMapping(d._index.data,g);if(h)for(var m=h.from;m<=h.to;m++)m!==d._index.data&&a._startCellEdit(a.state.data[m],g)}s++}}s&&o.push(d._index.data)}o.length&&a._refreshBoard(!0)},At.prototype.endCellEdit=function(e,t,a){for(var n=this,r=n._dataGet(e),o=n._columnIndexKeyToMappingList(t),l=!1,i=[],d=!1,s=!1,p=0,u=r.length;p<u;p++){var c=r[p];if(c._state.editing){for(var g=0,f={},h=0,m=o.length;h<m;h++){var v=n._getMultiParentMapping(o[h]);if(!f[v.id]){f[v.id]=!0;var x=!1;if(v.multi){if(n._iterateMultiMapping(c,v,function(e,t){if(t.editable)return c._state.editing.hasOwnProperty(t.columnIndex)?(x=!0,!1):void 0}),!x)continue}else{if(!v.editable)continue;if(!c._state.editing.hasOwnProperty(v.columnIndex))continue}var y=c[v.key];if(!1===n._endCellEdit(c,v,a)){l=!0;break}if(n.state.sortingInfoKeyMap[v.key]&&y!==c[v.key]&&(d=!0),n.state.groupRowspanned&&n.option.rowspanGroupEdit&&v.rowspan){var C=n._getGroupingRangeByMapping(c._index.data,v);if(C){y!==c[v.key]&&(s=!0);for(var I=C.from;I<=C.to;I++)I!==c._index.data&&n._endCellEdit(n.state.data[I],v,a)}}g++}}if(g&&i.push(c),l)break}}if(i.length){if(d&&!n.option.sortClearOnEdit||s)n.calcAndRedraw();else{for(var _=0,w=i.length;_<w;_++)n.refreshRow(i[_]);n._hasFooter()&&n._refreshFooterCells(!0)}n._triggerGridEvent("dataChanged",{type:"edit",datalist:i})}if(!0===l)return!1},At.prototype.saveCellEdit=function(e,t){return this.endCellEdit(e,t,!0)},At.prototype.cancelCellEdit=function(e,t,a){for(var n=this,r=n._dataGet(e),o=n._columnIndexKeyToMappingList(t),l=!1,i=[],d=0,s=r.length;d<s;d++){for(var p=r[d],u=0,c={},g=0,f=o.length;g<f;g++){var h=n._getMultiParentMapping(o[g]);if(!c[h.id]){if(c[h.id]=!0,!1===n._cancelCellEdit(p,h,a)){l=!0;break}if(n.state.groupRowspanned&&n.option.rowspanGroupEdit&&h.rowspan){var m=n._getGroupingRangeByMapping(p._index.data,h);if(m)for(var v=m.from;v<=m.to;v++)v!==p._index.data&&n._cancelCellEdit(n.state.data[v],h,a)}u++}}if(u&&i.push(p._index.data),l)break}i.length&&n._refreshBoard(!0)},At.prototype._expandEditListByGroup=function(e){if(this.state.groupRowspanned&&this.option.rowspanGroupEdit&&e.length!==this.state.data.length){for(var t=this.option.grouping.by[0],a={},n=[],r=0,o=e.length;r<o;r++)a[e[r]._index.id]=!0,n.push(e[r]);for(var r=0,o=n.length;r<o;r++){var l=n[r],i=l._index.data,d=this._getGroupingRange(i,t);if(d)for(var s=d.from;s<=d.to;s++){var p=this.state.data[s];p&&!a[p._index.id]&&n.push(p)}}return n}return e},At.prototype.startEdit=function(e){var t=this._dataGet(e);if(t&&t.length)return this.startCellEdit(this._expandEditListByGroup(t))},At.prototype.endEdit=function(e){var t=this._dataGet(e);if(t&&t.length){return!1!==this.endCellEdit(this._expandEditListByGroup(t))&&void 0}},At.prototype.saveEdit=function(e){var t=this._dataGet(e);if(t&&t.length)return this.saveCellEdit(this._expandEditListByGroup(t))},At.prototype.cancelEdit=function(e){var t=this._dataGet(e);if(t&&t.length)return this.cancelCellEdit(this._expandEditListByGroup(t))},At.prototype.startRowInlineEdit=function(e){var t=this;if(t.option.rowInlineEdit&&t.state.__rowInlineStartEdit){var a=t._dataGet(e)[0];a&&t.state.__rowInlineStartEdit(this,a)}},At.prototype.endRowInlineEdit=function(){var e=this;e.option.rowInlineEdit&&e.state.__rowInlineEndEdit&&e.state.__rowInlineEndEdit(this)},At.prototype.startCellInlineEdit=function(e,t){var a=this;if(a.option.cellInlineEdit&&a.state.__cellInlineStartEdit){var n=a._dataGet(e)[0],r=a._columnIndexKeyToMappingList(t)[0];n&&r&&a.state.__cellInlineStartEdit(n,a._getMultiParentMapping(r))}},At.prototype.endCellInlineEdit=function(){var e=this;e.option.cellInlineEdit&&e.state.__cellInlineEndEdit&&e.state.__cellInlineEndEdit()},At.prototype._isCellEditable=function(e,t){var a=this;if(t.multi){var n=!1;if(a._iterateMultiMapping(e,t,function(t,r){if(!0===a._isCellEditable(e,r))return n=!0,!1}),!0===n)return!0}if(!t.editable)return!1;if(!t.key)return!1;if(e&&e._state&&e._state.deleted)return!1;if(a._isSpecialPurposeColumn(t))return!1;if(t.hasOwnProperty("allowEdit")){var r=t.allowEdit;if("function"==typeof r&&(r=r.call(this,e[t.key],e,t)),!1===r)return!1}return(!a.option.rowOption||"function"!=typeof a.option.rowOption.allowEdit||!1!==a.option.rowOption.allowEdit.call(a,e))&&(!t.readonly||!0!==N(this,e,t))},At.prototype._startCellEdit=function(e,t){var a=this;if(!t||void 0!==t.columnIndex&&null!==t.columnIndex){var n=t.key,r=t.columnIndex;e._state.editing&&e._state.editing.hasOwnProperty(r)||a._isCellEditable(e,t)&&(e._state.editing=e._state.editing||{},t.editable&&n&&(e._state.editing[r]=e.hasOwnProperty(n)?e[n]:""),t.multi&&a._iterateMultiMapping(e,t,function(t,a){a.editable&&a.key&&(e._state.editing[a.columnIndex]=e.hasOwnProperty(a.key)?e[a.key]:"")}),a.option.parseValueOnStartEdit&&a._updateEditingCellWithoutElement(e,t),a.state.cellCacheEnabled&&a._clearCellCacheByDataId(e._index.id))}},At.prototype._endCellEdit=function(t,a,n){var r=this;if(!a||void 0!==a.columnIndex&&null!==a.columnIndex){if(a.multi){if(!1===r._iterateMultiMapping(t,a,function(e,a){if(!1===r._endCellEdit(t,a,n))return!1}))return!1}var o=a.columnIndex,l=t._state.editing&&t._state.editing.hasOwnProperty(o),i=!1;if(l){var d=t[a.key],s=t._state.editing[o];if(!1===r._cellEdit(t,a,s))return!1;!0!==n&&delete t._state.editing[o],d!==s&&(i=!0)}!0!==n&&e.isEmptyObject(t._state.editing)&&(t._state.editing=!1),i&&r.option.sortClearOnEdit&&r.state.sortingInfoKeyMap[a.key]&&r.sortClear(),r.state.cellCacheEnabled&&r._clearCellCacheByDataId(t._index.id)}},At.prototype._saveCellEdit=function(e,t){return this._endCellEdit(e,t,!0)},At.prototype._cancelCellEdit=function(t,a,n){(!a||void 0!==a.columnIndex&&null!==a.columnIndex)&&(t._state.editing&&t._state.editing.hasOwnProperty(a.columnIndex)&&(!0===n?t._state.editing[a.columnIndex]=t[a.key]:delete t._state.editing[a.columnIndex]),t._state.editing&&!e.isEmptyObject(t._state.editing)||(t._state.editing=!1))},At.prototype._isEditingCell=function(e,t){var a=this,n="object"==typeof e&&e?e:a.state.renderTargetDataList[e],r=t&&"object"==typeof t?t:W(this,t);if(r&&r.multi){var o=!1;if(a._iterateMultiMapping(n,r,function(e,t){if(te(n,t))return o=!0,!1}),!0===o)return!0}return te(n,r)},At.prototype._isPopupEditingColumn=function(t){if(e.isArray(this.option.cellPopupEdit))for(var a=0,n=this.option.cellPopupEdit.length;a<n;a++){var r=this.option.cellPopupEdit[a];if("number"==typeof r&&t.columnIndex===r)return!0;if("string"==typeof r&&(t.key===r||t.id===r))return!0}return!1},At.prototype.enlargeStart=function(){var t=this;if(t.state.isZoomed)return void alert(At.i18n("enlargeMsg"));var a,n=e(document.body),r=yt.scrollTop(),o=t.$root.parent(),l=o.children().index(t.$root);e("#blocker_"+t.key).length>0?(a=e("#blocker_"+t.key),a.show()):(a=e('<div id="blocker_'+t.key+'" class="'+ct+' alopexgrid-enlarge-blocker"></div>'),a.addClass("alopexgrid-refer-"+t.key),n.append(a));var i,d;if(e("#content_"+t.key).length>0)i=e("#content_"+t.key),d=i.find(".alopexgrid-enlarge-closebutton"),i.show();else{i=e('<div id="content_'+t.key+'" class="'+ct+' alopexgrid-enlarge-content"></div>'),i.addClass("alopexgrid-refer-"+t.key),d=e('<a id="closebutton_'+t.key+'" class="'+ct+' alopexgrid-enlarge-closebutton"></a>'),d.html(t.option.enlargeOption.closeButtonMarkup);var s=".alopexgridEnlargeCloseButton";d.off(s).on("click"+s+" touchstart"+s,function(){t.enlargeExit()}),i.append(d),n.append(i)}var p=t.option.height;i.append(t.$root),n.css("overflow","hidden"),yt.scrollTop(0),t.suppressRender(!0),t.updateOption({height:yt.height()-t.$root.offset().top}),t.suppressRender(!1),t.redraw(),t.state.isZoomed=!0,t.state.beforeZoomHeight=p,t.state.beforeZoomScrollTop=r,t.state.beforeZoomParent=o,t.state.beforeZoomSiblingIndex=l},At.prototype.enlargeExit=function(){var t=this;if(t.state.isZoomed){var a=e(document.body),n=t.state.beforeZoomParent,r=e("#blocker_"+t.key),o=e("#content_"+t.key);o.find(".alopexgrid-enlarge-closebutton");a.css("overflow",""),r.hide(),o.hide();var l=n.children(),i=l.eq(t.state.beforeZoomSiblingIndex),d=l.eq(Math.max(0,t.state.beforeZoomSiblingIndex-1));i.length?i.before(t.$root):d.length?d.after(t.$root):(l.length,n.append(t.$root)),t.suppressRender(!0),t.updateOption({height:t.state.beforeZoomHeight}),t.suppressRender(!1),t.redraw(),t.state._vspLastLeft=-1,yt.scrollTop(t.state.beforeZoomScrollTop),t.state.isZoomed=!1,delete t.state.beforeZoomHeight,delete t.state.beforeZoomScrollTop,delete t.state.beforeZoomParent,delete t.state.beforeZoomSiblingIndex}};var Nt=/[a-z|-|-|-|\{\}\[\]\/?.,;:|\)*~`!^\-_+<>@\#$%&\\\=\(\'\"]/gi;At.filterFunction={lt:function(e,t){if(null!=e)return Number((""+e).replace(Nt,""))<Number((""+t).replace(Nt,""))},lte:function(e,t){if(null!=e)return Number((""+e).replace(Nt,""))<=Number((""+t).replace(Nt,""))},gt:function(e,t){if(null!=e)return Number((""+e).replace(Nt,""))>Number((""+t).replace(Nt,""))},gte:function(e,t){if(null!=e)return Number((""+e).replace(Nt,""))>=Number((""+t).replace(Nt,""))},equal:function(e,t){if(null!=e)return String(e).toLowerCase()===String(t).toLowerCase()},notequal:function(e,t){if(null!=e)return String(e).toLowerCase()!==String(t).toLowerCase()},contain:function(e,t){if(null!=e)return String(e).toLowerCase().indexOf(String(t).toLowerCase())>=0},notcontain:function(e,t){if(null!=e)return String(e).toLowerCase().indexOf(String(t).toLowerCase())<0},checkedList:function(e,t){return null==e&&(e=null),!0===t[e]}},At.prototype._getFilteredDataListExcept=function(e){for(var t=this,a=[],n=0,r=t.state.data.length;n<r;n++)t._doesDataPassFilter(t.state.data[n],e)||a.push(t.state.data[n]);return a},At.prototype._generateFilterColumnList=function(){function t(t){var a=!0;a=null!=t.filter&&null!=t.filter.closeOuterClick?t.filter.closeOuterClick:n.option.closeFilterOuterClick;var r={closeFilter:{outerClick:a},saveFilterSize:n.option.saveFilterDropdownSize,scrollResetAfterFilter:n.option.scrollResetAfterFilter,typeList:n.option.filterTypeList,useRenderToFilter:t.useRenderToFilter};return d(n.option.filteringHeader)&&(r.minHeight=n.option.filteringHeader.minHeight,r.minWidth=n.option.filteringHeader.minWidth),e.extend({},n.option.filter,r,t.filter)}for(var a,n=this,r=[],o=[],l=0,i=n.state.visibleColumnMappingList.length;l<i;l++){var p=n.state.visibleColumnMappingList[l];!1!==p.filter&&p.filterOption?s(p.filterOption)?(r.push(p),o.push(t(p))):e.isArray(p.filterOption.type)?(r.push(p),o.push(t(p))):(a=At.filterFunction[p.filterOption.type],s(a)&&(r.push(p),o.push(t(p)))):null!=n.state.removeFilterColumnMapping&&delete n.state.removeFilterColumnMapping[p.id]}n.state.mergedFilterOptionList=o,n.state.filterColumnMappingList=r},At.prototype._doesDataPassFilter=function(t,a){var n=this,r=!1;n.option.rowOption&&n.option.rowOption.filter&&e.each(n.option.rowOption.filter,function(e,a){if(d(a)&&(a=n._filterDataToFunction(a)),s(a)&&!0!==a(t))return r=!0,!0});for(var o=0;o<n.state.filterColumnMappingList.length;o++){var l=n.state.filterColumnMappingList[o],i=n._getColumnFilterFunction(l);if(null==a||l.columnIndex!==a){if(i){var p=t[l.key],u=n.state.mergedFilterOptionList[o]||{}
;if("render"===(u.useRenderToFilter?u.useRenderToFilter:null)&&"checkedList"!==l.filterOption.type){var c=n._renderDataByMapping(t,l);p="string"==typeof c?c:c.textContent;var g=i(p,t,l);if(i===pe){if("and"===l.filterOption.rule){if(!0!==g[0]||!0!==g[1]){r=!0,n.state.removeFilterColumnMapping[l.id]=!1;break}}else if(!0!==g[0]&&!0!==g[1]){r=!0,n.state.removeFilterColumnMapping[l.id]=!1;break}}else if(!0!==g){r=!0,n.state.removeFilterColumnMapping[l.id]=!1;break}}else{var f=i(p,t,l);if(i===pe){if("and"===l.filterOption.rule){if(!0!==f[0]||!0!==f[1]){r=!0,n.state.removeFilterColumnMapping[l.id]=!1;break}}else if(!0!==f[0]&&!0!==f[1]){r=!0,n.state.removeFilterColumnMapping[l.id]=!1;break}}else if(!0!==f){r=!0,n.state.removeFilterColumnMapping[l.id]=!1;break}}}!1!==n.state.removeFilterColumnMapping[l.id]&&(n.state.removeFilterColumnMapping[l.id]=!0)}}return r},At.prototype._filterDataToFunction=function(e){var t=e.type;if(null==t||""===t)return null;var a=e.key,n=e.value;return function(e){return At.filterFunction[t](e[a],n)}},At.prototype._filterWrapDragStart=function(t,a,n){var r=this,o=e("#"+n),l=e.event.fix(t);if("filterclose"!==l.target.className){"touchstart"===t.type&&(l=t.touches[0]),t.preventDefault();var d=".alopexgridFilterDragEvnetNS",s={};s.self=r,s.$filterWrap=o,s.filterDragEvnetNS=d,s.prevX=l.pageX,s.prevY=l.pageY;var p=o.offset();s.gapX=l.pageX-p.left,s.gapY=l.pageY-p.top,Ct.off(d+r.key),Ct.on("mousemove"+d+r.key+" touchmove"+d+r.key,s,function(e){var t=e;if("touchmove"===e.type&&(t=e.originalEvent.touches[0]),e.data.prevX!==t.pageX||e.data.prevY!==t.pageY){e.data.prevX=t.pageX,e.data.prevY=t.pageY;var a=(e.data.self,e.data.$filterWrap);e.preventDefault(),i(),a.css({left:e.data.prevX-e.data.gapX+"px",top:e.data.prevY-e.data.gapY+"px"})}}).on("mouseup"+d+r.key+" touchend"+d+r.key+" touchcancel"+d+r.key,s,function(e){Ct.off(d+r.key)})}},At.prototype._sortingEventHandler=function(e,t,a){if(null!=e&&"keydown"===e.type){var n=e.which?e.which:e.keyCode;if(13!==n&&32!==n)return}this.dataSort(Number(t),a)},At.prototype._filterTextFoldingEvent=function(t,a){var n=this;if(null!=t&&"keydown"===t.type){var r=t.which?t.which:t.keyCode;if(13!==r&&32!==r)return}-1===t.target.className.indexOf("folded")?(e(t.target).addClass("folded"),e("#"+n.key+"_textFilterRadioArea").hide(),e("#"+n.key+"_textFilterBottomTextArea").hide()):(e(t.target).removeClass("folded"),e("#"+n.key+"_textFilterRadioArea").show(),e("#"+n.key+"_textFilterBottomTextArea").show())},At.prototype._closeFilterByKeydown=function(e){if(null!=e&&"keydown"===e.type){var t=e.which?e.which:e.keyCode;if(13!==t&&32!==t)return}this.removeFilterDropdown()},At.prototype._drawFilterUnit=function(t,a){var n=this,r=[],o=t?t.type:"",l=t?t.value:"",i=t?t.rule:null,d=n.state.columnIndexToMapping[a];"checkedList"===o&&(o="",l="",i=null);var s,p=d.key,u=/[\\'\"]/gi;return e.isArray(o)?(l[0]=l[0].replace(u,""),l[1]=l[1].replace(u,""),s=[gt+".run('",n.key,"','_filterBtnEventhandler','",p,"','",a,"','",o[0],"','",l[0],"','",o[1],"','",l[1],"','",i,"',event);"].join("")):(l=l.replace(u,""),s=[gt+".run('",n.key,"','_filterBtnEventhandler','",p,"','",a,"','",o,"','",l,"','",,"','",,"','",i,"',event);"].join("")),r.push('<input type="hidden" class="alopexgrid-filter-key" name="alopexgrid-filter-key" value="',p,'"/>'),r.push('<button class="alopexgrid-filter-dropdownbutton '+(t?"filtered":"")+'" type="button"'),r.push(' onkeydown="',s,'"'),r.push(' onmousedown="',s,'"'),r.push(">&nbsp;</button>"),r.join("")},At.prototype.isFilteredColumn=function(e){var t=this;if(null==t.state.filterColumnMappingList)return!1;var a=t._columnIndexKeyToMappingList(e);return!(!a||!a.length)&&(a=a[0],t._hasColumnFilter(a))},At.prototype._closeFilterDropdown=function(){var e=this;e.state.filterDropdownWrapper&&e.state.filterDropdownWrapper.hide()},At.prototype._removeFilterDropdown=function(){var t=this;if(t.state.filterDropdownWrapper&&(t.state.filterDropdownWrapper.removeAlopexGrid(),t.state.filterDropdownWrapper.remove(),t.state.filterDropdownWrapper=null,Ct.off(".alopexgridFilterdropdownWrapper"+t.key),e(".alopexgrid-filterdropdown-wrapper li.remove").off("mousedown.alopexgridFilterdropdownWrapper"+t.key),null!=t.state.filterFocusedColIdx)){var a=t.$wrapper.find('.filter-cell-unit[data-alopexgrid-columnindex="'+t.state.filterFocusedColIdx+'"] button');a.length>0&&a.focus()}},At.prototype.removeFilterDropdown=function(){var e=this;e._closeFilterDropdown(),e._removeFilterDropdown()},At.prototype.showFilterDropdown=function(t){var a=this,n=a._columnIndexKeyToMappingList(t);if(n&&n.length){var r,o,l,i=n[0],d=i.columnIndex,s=i.filterOption||{};null==s?(r="",o="",l=null):(r=s.type||"",o=s.value||"",l=s.rule||null,"checkedList"===r&&(r="",o="",l=null));var p=a.$wrapper.find(".headercell").filter('[data-alopexgrid-columnindex="'+d+'"]')[0];e.isArray(r)?a._filterBtnEventhandler(i.key,d,r[0],o[0],r[1],o[1],l,null,p,!0):a._filterBtnEventhandler(i.key,d,r,o,"","",l,null,p,!0)}},At.prototype._setTextFilterKeydownEvent=function(e,t,a,n,r,o,l,i){var d=this,s=e[0],p=s.value,u=t.val();s.oldVal!==p&&null!=u&&""!==u&&(At.trimString(p).length>0?d._parseFilterHeader(a,n,r,o,l,!1,!0,!1):d._parseFilterHeader(a,n,r,o,l,!1,!0,i)),s.oldVal=p},e.fn._alopexgridDelayKeyUp=function(e,t,a,n,r,o,l){var i=0,d=this;return d.on("keyup mouseup",function(s){clearTimeout(i),i=setTimeout(function(){e(d,a,n,r,o,l,s)},t)}),d},At.prototype._filterBtnEventhandler=function(t,a,n,r,l,i,s,p,u,c){var g=this;if(null!=p&&"keydown"===p.type){var f=p.which?p.which:p.keyCode;if(13!==f&&32!==f)return}g.option.rowOption&&"content"==g.option.rowOption.defaultHeight&&g.option.grouping.useGrouping&&g.option.grouping.useGroupRowspan&&(g.state.rowHeightMapByDataId={}),g.showProgress(function(){var f;if(p?(p=e.event.fix(p),f=e(p.target?p.target:p.currentTarget)):f=e(u),0!==f.length){"BUTTON"===f[0].nodeName?g.state.filterFocusedColIdx=a:g.state.filterFocusedColIdx=null;var h=f.offset();g._removeFilterDropdown();var m=g.columnInfo(a),v=document.createElement("div");v.id=o(),v.className=ct+" alopexgrid-filterdropdown-wrapper";var x=e(v);x.css({position:"absolute",left:h.left+"px",top:h.top+f.height()+"px"});var y=!0;y=null!=m.filter&&null!=m.filter.closeOuterClick?m.filter.closeOuterClick:g.option.closeFilterOuterClick;var C={closeFilter:{outerClick:y},saveFilterSize:g.option.saveFilterDropdownSize,scrollResetAfterFilter:g.option.scrollResetAfterFilter,typeList:g.option.filterTypeList,useRenderToFilter:m.useRenderToFilter};d(g.option.filteringHeader)&&(C.minHeight=g.option.filteringHeader.minHeight,C.minWidth=g.option.filteringHeader.minWidth);var I=e.extend(!0,{},g.option.filter,C,m.filter),_=document.createElement("div");_.id=o();var w=o()+"_"+g.key,b=e(ae(g,{key:t,wrapId:v.id,filteredTypeTop:n,filteredTypeBottom:l,filteredValueTop:r,filteredValueBottom:i,filterRule:s,filterGridId:w,columnIndex:a,isApiCall:c,columnInfo:m,mergedFilterOption:I})),M=b.find(".remove");null!=m.filterOption?re(M,!0):re(M,!1);var S=b.find(".filtertext"),E=b.find(".filterselect");S[0].oldVal=r,!0===I.textFilterByEnter?S.on("keydown",function(e){if(null!=e){if(13!==(e.which?e.which:e.keyCode))return;g._setTextFilterKeydownEvent(S,E,e,w,a,c,I.scrollResetAfterFilter,"top")}}):S._alopexgridDelayKeyUp(function(e,t,a,n,r,o,l){t._setTextFilterKeydownEvent(e,E,l,a,n,r,o,"top")},I.textFilterDelay,g,w,a,c,I.scrollResetAfterFilter);var T=b.find(".filtertextbottom"),D=b.find(".filterselectbottom");T[0].oldVal=i,!0===I.textFilterByEnter?T.on("keydown",function(e){if(null!=e){if(13!==(e.which?e.which:e.keyCode))return;g._setTextFilterKeydownEvent(T,D,e,w,a,c,I.scrollResetAfterFilter,"bottom")}}):T._alopexgridDelayKeyUp(function(e,t,a,n,r,o,l){t._setTextFilterKeydownEvent(e,D,l,a,n,r,o,"bottom")},I.textFilterDelay,g,w,a,c,I.scrollResetAfterFilter),b.find('input[type="radio"]').on("change",function(t,a){var n=e("#alopexgrid_andradio"),r=n[0].parentElement,o=e("#alopexgrid_orradio"),l=o[0].parentElement;!0===n.prop("checked")?(n[0].setAttribute("checked","checked"),At.renderUtil.addClass(r,"checked"),o[0].removeAttribute("checked"),At.renderUtil.removeClass(l,"checked")):(o[0].setAttribute("checked","checked"),At.renderUtil.addClass(l,"checked"),n[0].removeAttribute("checked"),At.renderUtil.removeClass(r,"checked"))});var F=b.find("#alopexgrid_andradio"),R=b.find("#alopexgrid_orradio");F.on("focus",function(e){At.renderUtil.addClass(e.currentTarget.parentElement,"focused")}).on("blur",function(e){At.renderUtil.removeClass(e.currentTarget.parentElement,"focused")}),R.on("focus",function(e){At.renderUtil.addClass(e.currentTarget.parentElement,"focused")}).on("blur",function(e){At.renderUtil.removeClass(e.currentTarget.parentElement,"focused")}),x.append(_,b),e(document.body).append(x);var k=e("#"+g.key+"_textFilterRadioArea"),L=e("#"+g.key+"_textFilterBottomTextArea"),A=k.outerHeight(!0)+L.outerHeight(!0),O=0;O=k.is(":visible")?x.height()-A:x.height(),!1===It&&(S.focus(),S.val().length>0&&S[0].select());var P={minHeight:100,minWidth:250};null!=I.minHeight&&(P.minHeight=Math.max(P.minHeight,I.minHeight)),null!=I.minWidth&&(P.minWidth=Math.max(P.minWidth,I.minWidth));var B=e("#"+w),G=b.find(".filtersubmit");oe(g,B,t,a,G,M,P,I,w,c);var H=Number(x.css("left").split("px")[0]),N=Number(x.css("top").split("px")[0]),$=x.width()+Number(x.css("margin-left").split("px")[0])+Number(x.css("margin-right").split("px")[0]),K=P.minWidth;null!=I.width&&(K=Math.max(P.minWidth,I.width)),P.widthGap=$-K;var W=x.height()+Number(x.css("margin-top").split("px")[0])+Number(x.css("margin-bottom").split("px")[0]),U=x.offset().left-yt.scrollLeft()+$,V=yt.width();U>V&&(H-=U-V+10)<0&&(H=0);var Y=x.offset().top-yt.scrollTop()+W,X=yt.height();Y>X&&(N-=Y-X+10)<0&&(N=0),x.css({left:H+"px",top:N+"px"});var z=document.createElement("div");z.className="box-resizing-handle",z.style.right="0px",z.style.bottom="0px",x.append(z);var j=document.createElement("div");j.className="box-resizing-align",j.style.display="none",x.append(j);var q={};q.self=g,q.bar=j,q.$wrap=x,q.mergedFilterOption=I,q.$filterGrid=B,q.columnInfo=m,q.gridSize=P,q.wrapHeightBeforeGridRender=O,q.$textFilterRadioArea=k,q.textFilterHiddenAreaHeight=A,x.on("mousedown touchstart",".box-resizing-handle",q,function(e){var t=e;"touchstart"===e.type&&(t=e.originalEvent.touches[0]);var a=e.data.self;e.data.bar.style.display="block",e.data.bar.style.height=(e.data.startHeight=e.data.$wrap.height())+"px",e.data.bar.style.width=(e.data.startWidth=e.data.$wrap.width())+"px",e.data.startPageX=t.pageX,e.data.startPageY=t.pageY,e.data.diffx=0,e.data.diffy=0;var n=e.data.gridSize;e.data.gridMinHeight=n.minHeight,e.data.gridMinWidth=n.minWidth,e.data.minWidth=n.minWidth+n.widthGap,e.data.$textFilterRadioArea.is(":visible")?e.data.minHeight=e.data.wrapHeightBeforeGridRender+e.data.gridMinHeight+e.data.textFilterHiddenAreaHeight:e.data.minHeight=e.data.wrapHeightBeforeGridRender+e.data.gridMinHeight;var r=".alopexgridFilterdropdownWrapper.alopexgridFilterdropdownWrapperResize"+a.key+a.eventns;e.data.ns=r,Ct.off(r),Ct.on("selectstart"+r,function(e){e.preventDefault()}),Ct.on("mousemove"+r+" touchmove"+r,e.data,function(e){e.preventDefault();var t=e;"touchmove"===e.type&&(t=e.originalEvent.touches[0]),e.data.diffx=t.pageX-e.data.startPageX,e.data.diffy=t.pageY-e.data.startPageY,e.data.bar.style.width=Math.max(e.data.minWidth,e.data.startWidth+e.data.diffx)+"px",e.data.bar.style.height=Math.max(e.data.minHeight,e.data.startHeight+e.data.diffy)+"px"}),Ct.on("mouseup"+r+" touchend"+r+" touchcancel"+r,e.data,function(e){e.data.self;Ct.off(e.data.ns);var t=pt(e.data.$filterGrid);e.data.bar.style.display="none",e.preventDefault();var a=Math.max(e.data.gridMinWidth,t.option.width+e.data.diffx),n=Math.max(e.data.gridMinHeight,t.option.height+e.data.diffy);if(t.updateOption({width:a,height:n}),e.data.mergedFilterOption.saveFilterSize){var r=e.data.columnInfo;r&&!1!==r.filter&&(d(r.filter)||(r.filter={}),r.filter.width=a,r.filter.height=n)}})}),pt(B).viewUpdate(),g.state.filterDropdownWrapper=x,g.state.filterDropdown=b,Ct.on("keydown.alopexgridFilterdropdownWrapper"+g.key+g.eventns,{self:g},ie),null!=I.closeFilter&&!0===I.closeFilter.outerClick&&Ct.on("mousedown.alopexgridFilterdropdownWrapper"+g.key+g.eventns,{self:g},le)}})},At.prototype._setCheckedListFilter=function(t,a,n,o,l,i,d,s){function p(){return{filterMap:(u.option.rowOption?u.option.rowOption.filter:null)||null,filterColumnMappingList:(u.state.filterColumnMappingList&&u.state.filterColumnMappingList.length?u.state.filterColumnMappingList:null)||null,changeType:y,targetColumnMapping:x,targetColumnFilterOption:(g?g.f:null)||null,targetFilterMap:null}}var u=this;if(t&&(t=e.event.fix(t),"keydown"===t.type)){var c=t.which?t.which:t.keyCode;if(13!==c&&32!==c)return}var g,f=pt(e("#"+a)),h=!!f.state.selectAll,m=u._filterGetCheckedList(a);if(!(0!==(wt?r(m):Object.keys(m).length)||null!=s&&!0===s.dataFilterInstant||!0!==i&&"true"!==i))return void u._closeFilterDropdown();if("true"===o||!0===o){var v=u._parseFilterUnitForCheckList(m,h,n,d,t);null!==v&&(g={c:n,f:v})}else{var v=u._parseFilterUnitForCheckList(m,h,n,d,t);null!=v&&(g={c:n,f:v})}var x=u.state.columnIndexToMapping[n]||null,y=h?"columnFilterDelete":"columnFilterSet";!1!==u._triggerGridEvent("filterChangeStart",p())&&u.showProgress(function(){if(null!=s&&!0===s.dataFilterInstant||!0!==i&&"true"!==i||u._closeFilterDropdown(),null!=g&&u._setColumnFilter(u.state.columnIndexToMapping[g.c],g.f),"true"!==l&&!0!==l||u._scrollerReset(),u.filterAndRedraw(),null!=s&&!0===s.dataFilterInstant||!0!==i&&"true"!==i){var e=u.state.filterDropdownWrapper.find(".remove");null==x.filterOption?re(e,!1):re(e,!0)}else u._removeFilterDropdown();var t=(u.option.rowOption?u.option.rowOption.filter:null)||null,a=(u.state.filterColumnMappingList&&u.state.filterColumnMappingList.length?u.state.filterColumnMappingList:null)||null;u._triggerGridEvent("filterChange",{filterMap:t,filterColumnMappingList:a,filterColumnMapping:x}),u._triggerGridEvent("UIFilterChange",{filterMap:t,filterColumnMappingList:a,filterColumnMapping:x}),u._triggerGridEvent("filterChangeEnd",p())})},At.prototype._parseFilterUnitForCheckList=function(e,t,a,n,r){var o=this,l={rule:null};return t?(o._hasColumnFilter(o.state.columnIndexToMapping[a])&&o._removeColumnFilter(o.state.columnIndexToMapping[a]),null):(l.value=e,l.type="checkedList",null==l.value||0===l.value.length?null:l)},At.prototype._filterGetCheckedList=function(t,a){for(var n,r=this,o={},l=pt(e("#"+t)),i=l._dataGet({_state:{selected:!0}}),d=t+"_null",s=0;s<i.length;s++)if(null!=(n=i[s]))if(n.label!==d){o[n.label]=!0;var p="";if(r.state.isFilterRendered){if(l.state.filterRenderFuntion&&l.state.isDefaultRenderType)p=l.state.filterRenderFuntion(l.state.filterRenderObj,n.label);else if(l.state.filterRenderFuntion&&null!==l.state.isDefaultRenderType){var u=r._dataGetByIndex({id:n.dataid}),c=l.state.filterRenderMapping;p=l.state.filterRenderFuntion.call(r,n.label,u,c.render||{type:"string"},c,r)}null==p&&(p=""),(p&&p.nodeType||p.jquery)&&(p=e(p).text()),null!=l.state.filterDuplicateMap&&null!=l.state.filterDuplicateMap[p]&&e.extend(!0,o,l.state.filterDuplicateMap[p])}}else o.null=!0;return l.state.filterDuplicateMap=null,o},At.prototype._parseFilterUnit=function(e,t,a,n){var r=this,o={rule:null},l=e.target?e.target:e.currentTarget;a&&(l=l.nextElementSibling);var i=l.getAttribute("value");return"SELECT"===l.nodeName&&null==i&&(i=l.value),o=de(r,i,o,l,n)},At.prototype._parseFilterHeader=function(t,a,n,r,o,l,i,d,s){function p(){return{filterMap:(u.option.rowOption?u.option.rowOption.filter:null)||null,filterColumnMappingList:(u.state.filterColumnMappingList&&u.state.filterColumnMappingList.length?u.state.filterColumnMappingList:null)||null,changeType:C,targetColumnMapping:y,targetColumnFilterOption:(m?m.f:null)||null,targetFilterMap:null}}var u=this;if(t&&(t=e.event.fix(t),("true"===l||!0===l)&&"keydown"===t.type)){var c=t.which?t.which:t.keyCode;if(13!==c&&32!==c)return}var g=u.state.filterDropdownWrapper;if("true"!==l&&!0!==l||"true"!==s&&!0!==s){if(t.target&&"filter-radio"===t.target.className){var f=g.find(".filterselect").val(),h=g.find(".filterselectbottom").val();if(null==f||""===f||null==h||""===h)return}}else u._closeFilterDropdown();var m,v=!1;if("true"===l||!0===l)u._hasColumnFilter(u.state.columnIndexToMapping[n])&&u._removeColumnFilter(u.state.columnIndexToMapping[n]);else if("top"===d)u._hasColumnFilter(u.state.columnIndexToMapping[n])&&u._removeColumnFilter(u.state.columnIndexToMapping[n]),v=!0;else{if(r&&"undefined"!==r){var x=u._parseFilterUnit(t,n,i,d);null!=x&&(m={c:n,f:x})}else{var x=u._parseFilterUnit(t,n,i,d);null!=x&&(m={c:n,f:x})}if(null==m)return;if(m&&"remove"===m.f){if(!u._hasColumnFilter(u.state.columnIndexToMapping[n]))return;u._removeColumnFilter(u.state.columnIndexToMapping[n]),m=null,v=!0}}var y=u.state.columnIndexToMapping[n]||null;u.state.removeFilterColumnMapping[y.id]=!0;var C="true"===l||!0===l?"columnFilterDelete":"columnFilterSet";!1!==u._triggerGridEvent("filterChangeStart",p())&&u.showProgress(function(){if(null!=m&&u._setColumnFilter(u.state.columnIndexToMapping[m.c],m.f),"true"!==o&&!0!==o||u._scrollerReset(),u.filterAndRedraw(),"true"===l||!0===l)if("true"===s||!0===s)u._removeFilterDropdown();else{v=!0;var t="",n="",r="and",i=e.extend(!0,{},u.option.filter,y.filter);null!=i&&null!=i.typeListDefault&&(t=i.typeListDefault.selectValue?i.typeListDefault.selectValue:"",n=i.typeListDefault.expandSelectValue?i.typeListDefault.expandSelectValue:"",r=i.typeListDefault.radioValue?i.typeListDefault.radioValue:"and");var d=g.find(".filtertext"),c=g.find(".filterselect"),f=g.find(".alopexgrid-input-radio-wrapper"),h=g.find(".filtertextbottom"),x=g.find(".filterselectbottom");d.val(""),d[0].oldVal="",c.val(t),h.val(""),h[0].oldVal="",x.val(n),"and"===r&&-1===f[0].className.indexOf("checked")?(At.renderUtil.addClass(f[0],"checked"),At.renderUtil.removeClass(f[1],"checked"),f[0].firstElementChild.setAttribute("checked","checked"),f[1].firstElementChild.setAttribute("checked","")):"or"===r&&-1===f[1].className.indexOf("checked")&&(At.renderUtil.removeClass(f[0],"checked"),At.renderUtil.addClass(f[1],"checked"),f[0].firstElementChild.setAttribute("checked",""),f[1].firstElementChild.setAttribute("checked","checked"));var C=g.find(".textfolding-icon");-1===C[0].className.indexOf("folded")&&(At.renderUtil.addClass(C[0],"folded"),e("#"+u.key+"_textFilterRadioArea").hide(),e("#"+u.key+"_textFilterBottomTextArea").hide()),d.focus()}var I=g.find(".filtersubmit"),_=pt(e("#"+a));if(v)_.state.selectAll=!0,_.rowSelect({},!0),_.dataSort("label"),re(I,!0);else if("true"!==l&&!0!==l)if(null!=u.state.filteredDataList&&u.state.filteredDataList.length>0){var w=y.key,b=[];e.map(u.state.filteredDataList,function(t,a){var n=_.state.filterDataMapByLabel[t[w]];-1===e.inArray(n,b)&&b.push(n)}),_.state.data.length===b.length?(_.state.selectAll=!0,_.rowSelect({},!0),_.dataSort("label")):b.length>0&&(_.state.selectAll=!1,_.rowSelect({},!1),_._filterGridRowSelect(b,!0),_.dataSort("label")),re(I,!0)}else null!=u.state.filteredDataList&&0!==u.state.filteredDataList.length||(_.state.selectAll=!1,_.rowSelect({},!1),_.dataSort("label"),re(I,!1));var M=g.find(".remove");null==y.filterOption?re(M,!1):re(M,!0);var S=(u.option.rowOption?u.option.rowOption.filter:null)||null,E=(u.state.filterColumnMappingList&&u.state.filterColumnMappingList.length?u.state.filterColumnMappingList:null)||null;u._triggerGridEvent("filterChange",{filterMap:S,filterColumnMappingList:E,filterColumnMapping:y}),u._triggerGridEvent("UIFilterChange",{filterMap:S,filterColumnMappingList:E,filterColumnMapping:y}),u._triggerGridEvent("filterChangeEnd",p())})},At.prototype._filterCellRender=function(e,t){var a=this,n=e.columnIndex,r=document.createElement("div");if(r.className="cell filtercell"+(n===a.state.maxColumnIndex?" lastcell":""),a.state.forceRenderAll||r.setAttribute("data-alopexgrid-columnindex",n),e.key&&!1!==e.filter){var o=e.filterOption,l=document.createElement("div");if(l.className="filter-cell-unit",l.innerHTML=a._drawFilterUnit(o,n),a.state.forceRenderAll||l.setAttribute("data-alopexgrid-columnindex",n),t)return l;r.appendChild(l)}return r},At.prototype._getColumnFilterFunction=function(t){if(!t)return null;if(!1!==t.filter&&t.filterOption){if(s(t.filterOption))return t.filterOption;var a,n;if(e.isArray(t.filterOption.type))return a=At.filterFunction[t.filterOption.type[0]],n=At.filterFunction[t.filterOption.type[1]],s(a)&&s(n)?pe:null;if(a=At.filterFunction[t.filterOption.type],s(a))return se}return null},At.prototype._hasColumnFilter=function(e){return!(!e||!1===e.filter||!e.filterOption)},At.prototype._setColumnFilter=function(e,t){e.filterOption=t},At.prototype._removeColumnFilter=function(e){delete e.filterOption},At.prototype._hasFilterNamed=function(e){var t=this;return t.option.rowOption&&t.option.rowOption.filter&&t.option.rowOption.filter[e]||!1},At.prototype.filterInfo=function(){var e=this,t={filterNameList:null,filterMap:null,filterColumnMappingList:null};return null!=e.option.rowOption&&null!=e.option.rowOption.filter&&(t.filterNameList=Object.keys(e.option.rowOption.filter),t.filterMap=e.option.rowOption.filter),null!=e.state.filterColumnMappingList&&e.state.filterColumnMappingList.length>0&&(t.filterColumnMappingList=e.state.filterColumnMappingList),t},At.prototype.setFilter=function(t,a,n){function r(){return{filterMap:(l.option.rowOption?l.option.rowOption.filter:null)||null,filterColumnMappingList:(l.state.filterColumnMappingList&&l.state.filterColumnMappingList.length?l.state.filterColumnMappingList:null)||null,changeType:p,targetColumnMapping:null,targetColumnFilterOption:null,targetFilterMap:s}}var l=this;a||(a=t,t=o());var i=d(t);u(t)||(t=o());var s={};i?e.extend(s,t):s[t]=a;var p="filterSet";if(!1===l._triggerGridEvent("filterChangeStart",r()))return!1;l.option.rowOption=l.option.rowOption||{},l.option.rowOption.filter=e.extend({},l.option.rowOption.filter),i?(n=a,e.each(t,function(e,t){l.option.rowOption.filter[e]=t})):l.option.rowOption.filter[t]=a,!0!==n&&(l.showProgress(),l.calcAndRedraw(),l.hideProgress()),i?e.each(t,function(e,t){l._triggerGridEvent("filterSet",{filterMap:l.option.rowOption.filter,filterName:e,filter:t})}):l._triggerGridEvent("filterSet",{filterMap:l.option.rowOption.filter,filterName:t,filter:a});var c=(l.option.rowOption?l.option.rowOption.filter:null)||null,g=(l.state.filterColumnMappingList&&l.state.filterColumnMappingList.length?l.state.filterColumnMappingList:null)||null;return l._triggerGridEvent("filterChange",{filterMap:c,filterColumnMappingList:g,filterColumnMapping:null}),l._triggerGridEvent("filterChangeEnd",r()),t},At.prototype.deleteFilter=function(t,a){function n(){return{filterMap:(r.option.rowOption?r.option.rowOption.filter:null)||null,filterColumnMappingList:(r.state.filterColumnMappingList&&r.state.filterColumnMappingList.length?r.state.filterColumnMappingList:null)||null,changeType:i,targetColumnMapping:null,targetColumnFilterOption:null,targetFilterMap:l}}var r=this,o=!1;null==t||e.isArray(t)||(t=[t]);var l={};e.each(t,function(e,t){r.option.rowOption&&r.option.rowOption.filter&&r.option.rowOption.filter[t]&&(l[t]=r.option.rowOption.filter[t])});var i="filterDelete";if(!e.isEmptyObject(l)&&!1===r._triggerGridEvent("filterChangeStart",n()))return!1;if(e.isArray(t)&&t.length&&r.option.rowOption&&r.option.rowOption.filter){for(var d=0,s=t.length;d<s;d++){var p=t[d],u=r.option.rowOption.filter[p];u&&(o=o||{},o[p]=u,delete r.option.rowOption.filter[p])}e.isEmptyObject(r.option.rowOption.filter)&&(delete r.option.rowOption.filter,r.option.rowOption.filter=null)}if(o){a||(r.showProgress(),r.calcAndRedraw(),r.hideProgress()),e.each(o,function(e,t){r._triggerGridEvent("filterDelete",{filterMap:r.option.rowOption.filter||null,filterName:e,filter:t})});var c=(r.option.rowOption?r.option.rowOption.filter:null)||null,g=(r.state.filterColumnMappingList&&r.state.filterColumnMappingList.length?r.state.filterColumnMappingList:null)||null;return r._triggerGridEvent("filterChange",{filterMap:c,filterColumnMappingList:g,filterColumnMapping:null}),r._triggerGridEvent("filterChangeEnd",n()),!0}return!1},At.prototype.clearFilter=function(e){function t(){return{filterMap:(a.option.rowOption?a.option.rowOption.filter:null)||null,filterColumnMappingList:(a.state.filterColumnMappingList&&a.state.filterColumnMappingList.length?a.state.filterColumnMappingList:null)||null,changeType:"filterClear",targetColumnMapping:null,targetColumnFilterOption:null,targetFilterMap:null}}var a=this,n=!1;if(!(a.option.rowOption&&a.option.rowOption.filter||a.state.filterColumnMappingList&&a.state.filterColumnMappingList.length)||!1!==a._triggerGridEvent("filterChangeStart",t())){if(a.option.rowOption&&a.option.rowOption.filter&&(delete a.option.rowOption.filter,a.option.rowOption.filter=null,n=!0),a.state.filterColumnMappingList&&a.state.filterColumnMappingList.length){n=!0;for(var r=0,o=a.state.filterColumnMappingList.length;r<o;r++){var l=a.state.filterColumnMappingList[r];a._removeColumnFilter(l)}a._generateFilterColumnList()}if(!0!==e&&n&&(a.showProgress(),a.calcAndRedraw(),a.hideProgress()),n){a._triggerGridEvent("filterClear");var i=(a.option.rowOption?a.option.rowOption.filter:null)||null,d=(a.state.filterColumnMappingList&&a.state.filterColumnMappingList.length?a.state.filterColumnMappingList:null)||null;a._triggerGridEvent("filterChange",{filterMap:i,filterColumnMappingList:d,filterColumnMapping:null}),a._triggerGridEvent("filterChangeEnd",t())}}},At.prototype._filterValueByValueFilter=function(e,t){if(e&&"function"==typeof this.option.valueFilter){var a=this.option.valueFilter.call(this,t,e);if(void 0!==a)return a}return t},At.prototype._filterDataByValueFilter=function(e){if(e&&"function"==typeof this.option.valueFilter)for(var t in e)e.hasOwnProperty(t)&&0!==t.indexOf("_")&&(e[t]=this._filterValueByValueFilter(e,e[t]))};var $t={sum:function(e){for(var t=this,a=ue(t,e),n=0,r=0,o=t.option.footer&&t.option.footer.usePageData?t.state.renderTargetDataList:t.state.data,l=0,i=o.length;l<i;l++){var d=o[l];if(!t.state.filteredDataList||d._state.filtered){var s=d[a];isNaN(Number(s))||(n+=Number(s),r=g(r,(String(s).split(".")[1]||"").length))}}return At.renderUtil.addCommas(parseFloat(n).toFixed(r))},average:function(e){for(var t=this,a=ue(t,e),n=0,r=0,o=t.option.footer&&t.option.footer.usePageData?t.state.renderTargetDataList:t.state.data,l=0,i=o.length;l<i;l++){var d=o[l];if(!t.state.filteredDataList||d._state.filtered){var s=d[a];isNaN(Number(s))||(n+=Number(s),r++)}}return At.renderUtil.addCommas(r?Math.round(n/r*10)/10:0)},stdev:function(e){for(var t=this,a=ue(t,e),n=0,r=0,o=0,l=t.option.footer&&t.option.footer.usePageData?t.state.renderTargetDataList:t.state.data,i=0,d=l.length;i<d;i++){var s=l[i];if(!t.state.filteredDataList||s._state.filtered){var p=s[a];isNaN(Number(p))||(r+=Number(p),n+=Number(p)*Number(p),o++)}}var u=o?Math.round(10*Math.sqrt(n/o-r/o*(r/o)))/10:0;return At.renderUtil.addCommas(u)},count:function(e){for(var t=this,a=ue(t,e),n=0,r=t.option.footer&&t.option.footer.usePageData?t.state.renderTargetDataList:t.state.data,o=0,l=r.length;o<l;o++){var i=r[o];if(!t.state.filteredDataList||i._state.filtered){var d=i[a];u(d)&&d&&n++}}return At.renderUtil.addCommas(n)},countif:function(e,t){for(var a=this,n=ue(a,e),r=0,o=a.option.footer&&a.option.footer.usePageData?a.state.renderTargetDataList:a.state.data,l=0,i=o.length;l<i;l++){var d=o[l];if(!a.state.filteredDataList||d._state.filtered){var s=d[n];void 0!==s&&null!==s&&s===t&&r++}}return At.renderUtil.addCommas(r)},min:function(e){for(var t=this,a=ue(t,e),n=void 0,r=t.option.footer&&t.option.footer.usePageData?t.state.renderTargetDataList:t.state.data,o=0,l=r.length;o<l;o++){var i=r[o];if(!t.state.filteredDataList||i._state.filtered){var d=i[a];(void 0===n||Number(d)<Number(n))&&(n=Number(d))}}return(isNaN(n)||void 0===n)&&(n=0),At.renderUtil.addCommas(n)},max:function(e){for(var t=this,a=ue(t,e),n=0,r=t.option.footer&&t.option.footer.usePageData?t.state.renderTargetDataList:t.state.data,o=0,l=r.length;o<l;o++){var i=r[o];if(!t.state.filteredDataList||i._state.filtered){var d=i[a];Number(d)>Number(n)&&(n=Number(d))}}return At.renderUtil.addCommas(n)},getValue:function(e){var t=this,a=t.state.footerData[e];return u(a)?a:""}};At.prototype._hasFooter=function(){var e=this,t=e.option;return!!(t.footer&&t.footer.footerMapping&&t.footer.footerMapping.length)&&!1!==t.footer.useFooter},At.prototype._footerValueByMapping=function(e){if("string"==typeof e.title)return e.title;var t=this,a=[];if(e.render){var n=e.render,r=typeof n;"string"!==r&&"function"!==r||(n=[n]);for(var o=0,l=n.length;o<l;o++){var i=n[o];if(s(i))a.push(i.call(t,t.option.footer&&t.option.footer.usePageData?t.state.renderTargetDataList:t.state.data));else{var d=(i.match(/((^\w+)[(].+[)])/i)||[null]).pop(),p=(i.match(/[^(]*\(([^)]*)\)/)||["",null])[1],u=p?p.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g):null;d?s($t[d])&&a.push($t[d].apply(t,u)):a.push(i)}}}var c=a.join("");return e.key&&(t.state.footerData[e.key]=c),c&&c.length?c:"&nbsp;"},At.prototype._footerData=function(e,t){null==t?delete this.state.footerData[e]:this.state.footerData[e]=t},At.prototype._refreshFooterMappedKey=function(e){var t=this;if(t.option.footer&&t.option.footer.footerMapping)for(var a=0,n=t.option.footer.footerMapping.length;a<n;a++)t.option.footer.footerMapping[a].key!==e&&0!==arguments.length||t._footerValueByMapping(t.option.footer.footerMapping[a])},At.prototype.footerData=function(){var t=this,a=e.makeArray(arguments),n=!1;if(d(a[0]))for(var r in a[0])a[0].hasOwnProperty(r)&&(t._footerData(r,a[0][r]),n=!0);else if("string"==typeof a[0]){var o=a[0],l=a[1];if(a.length<2)return t._refreshFooterMappedKey(o),l=t.state.footerData[o],u(l)?l:null;t._footerData(o,l),n=!0}if(n&&t._refreshBoard(!0),!a.length)return t._refreshFooterMappedKey(),t.state.footerData},At.prototype._refreshFooterCells=function(t){var a=this;t=!!d(t)||!!t;var n=0,r=a.option.footerRowHeight||a.state.rowHeight,o=null,l=p(a.state.footerCellList);if(a._hasFooter()){var i=a.state.renderTargetMappingInfo,u=i.renderTargetMapping,c=(i.fixedRenderTargetMapping,i.renderTargetWidth),g=(i.fitRatio,i.columnWidthByIdMap),f=a.state.scrollxEnd,h=0;if(f&&c>a.state.wrapperWidth&&(h=c-a.state.wrapperWidth),!f&&a.option.useContinuousXScroll){var m=a._getColumnIndexByBlankWidth(a.state.translateX,!0);m&&(h=Math.min(c-a.state.wrapperWidth,m))}o=a.option.footer.position||"bottom";var v={},x={},y={},C={},I={};a.state.footerColspanRange=C;for(var _=0,w=0,b=a.option.footer.footerMapping.length;w<b;w++){var M=a.option.footer.footerMapping[w],S=M.columnIndex;if("string"==typeof M.columnIndex){var E=a._getColumnByKey(M.columnIndex);E&&(S=E.columnIndex)}else if("string"==typeof M.columnKey){var E=a._getColumnByKey(M.columnKey);E&&(S=E.columnIndex)}else if("string"==typeof M.columnId){var E=a._getColumnByKey(M.columnId);E&&(S=E.columnIndex)}var T=M.hasOwnProperty("rowIndex")?M.rowIndex:0;if(_<T&&(_=T),1==!y[T]&&(y[T]={}),y[T][S]=M,null!=M.colspan||null!=M.colspanTo){var D=S,F=S,R=null;if(null!=M.colspan){var k=a.state.visibleIndexMapByColumnIndex[D];R=a.state.visibleColumnMappingList[k-1+M.colspan]}else R=a.columnInfo(M.colspanTo);R&&(F=R.columnIndex);var L={from:D,to:F};1==!C[T]&&(C[T]={});for(var A=D;A<=F;A++)C[T][A]=L}}var O=Object.keys(y).length,P={},B={},G=0;for(var w in y)w&&(P[w]=G,B[G]=w,G++);if(!0===a.option.footer.autoColspan){var H,N=a.state.visibleColumnMappingList[0].columnIndex;for(var w in y)w&&(C[w]||(C[w]={}),C[w][N]=C[w][N]||{from:N,to:N},H=C[w][N]);for(var $ in y)if($)for(var w=0,b=a.state.visibleColumnMappingList.length;w<b;w++){var K=a.state.visibleColumnMappingList[w],A=K.columnIndex,W=C[$][A];y[$][A]||W?W||(W=C[$][A]={from:A,to:A}):(W=C[$][A]=H,H.to=A),H=W}}var U={};for(var $ in y)if($){U[$]||(U[$]={}),x[$]=[],v[$]={};for(var w=0,b=u.length;w<b;w++){var K=u[w],V=K.columnIndex,Y=C[$]?C[$][V]:{};if(null!=Y){
var X=Y.from,z=Y.to;V<=a.state.fixupto?z=Math.min(z,a.state.fixupto):X=Math.max(X,a.state.fixupto),I[$]||(I[$]={}),I[$][V]=g[K.id];for(var A=V+1;A<=z;A++)if(!U[$][A]){U[$][A]=!0;var j=a.columnInfo(A);j&&(I[$][V]+=g[j.id]||0)}}v[$][V]||U[$][V]||(v[$][V]=K,x[$].push(K))}}var q=!e.isEmptyObject(I),Z="top"===o?a.state.headerHeight:a.state.wrapperHeight-r,Q=[];l=p(a.state.footerCellList);for(var w=0,b=l.length;w<b;w++)Q.push(l[w]);for(var J={},w=0,b=Q.length;w<b;w++){var ee=Q[w],te=ee.getAttribute("data-alopexgrid-columnindex"),ae=ee.getAttribute("data-alopexgrid-rowindex");void 0!==te&&null!==te&&v[ae][te]?(J[ae]||(J[ae]={}),J[ae][te]=!0):a.$wrapper[0].removeChild(ee)}var ne={},re=0,oe={};for(var ae in y)if(ae){ne[ae]={};for(var le=[],w=0,b=x[ae].length;w<b;w++){var K=x[ae][w],ie=I[ae]?I[ae][K.columnIndex]||g[K.id]:g[K.id];if(!J[ae]||!J[ae][K.columnIndex]){var ee=document.createElement("div");ee.className="cell footercell alopexgrid-cell",ee.setAttribute("data-alopexgrid-columnindex",K.columnIndex),ee.setAttribute("data-alopexgrid-rowindex",ae),ee.style.width=ie+"px",ee.style.height=r+"px",a.$wrapper[0].appendChild(ee)}K.fixed&&(oe[K.columnIndex]=!0);var de=0;le.length&&(de=le[le.length-1]+re),le.push(de),ne[ae][K.columnIndex]=de,re=ie}}Q=[],l=p(a.state.footerCellList);for(var w=0,b=l.length;w<b;w++)Q.push(l[w]);for(var se=a.state.visibleColumnMappingList[0],pe=a.state.visibleColumnMappingList[a.state.visibleColumnMappingList.length-1],w=0,b=Q.length;w<b;w++){var ee=Q[w],te=parseInt(ee.getAttribute("data-alopexgrid-columnindex")),ae=parseInt(ee.getAttribute("data-alopexgrid-rowindex")),ue=P[ae],K=v[ae][te],ie=I[ae]?I[ae][te]||g[K.id]:g[K.id];if(t||!ee.isFooterCellRendered){ee.setAttribute("data-alopexgrid-root",a.key),ee.className="cell footercell alopexgrid-cell",ee.className+="top"===o?" footercell-top":" footercell-bottom",se&&te<=se.columnIndex&&(ee.className+=" cell-firstcolumn"),pe&&pe.columnIndex<=te&&(ee.className+=" cell-lastcolumn"),K.fixed&&K.columnIndex<=a.state.fixupto&&(ee.className+=" cell-fixcol",K.columnIndex===a.state.fixupto&&(ee.className+=" cell-fixcol-lastcolumn")),ee.setAttribute("data-alopexgrid-columnindex",K.columnIndex),ee.setAttribute("data-alopexgrid-rowindex",ae),ee.style.width=ie+"px",ee.style.height=r+"px";var M=y[ae]?y[ae][te]:void 0;if(C[ae]&&C[ae][te]&&y[ae][C[ae][te].from]&&(M=y[ae][C[ae][te].from]),M){var ce=a._footerValueByMapping(M);if(M.align&&(ee.className+=" align-"+M.align),M.styleclass){var ge=M.styleclass;s(ge)&&(ge=ge(ce,e.extend({},a.state.footerData),M)),ge&&"string"==typeof ge&&(ee.className+=" "+ge)}M.colspan||M.colspanTo,ee.innerHTML=ce}else ee.innerHTML="";ee.isFooterCellRendered=!0}q&&(ee.style.width=ie+"px");var fe=Z,he=ne[ae][te]-(oe[te]?0:h);"bottom"===o?(ee.style.bottom=a.state.scrollbarxHeight+(O-ue-1)*r+"px",ee.style.top=""):(ee.style.bottom="",ee.style.top=fe+r*ue+"px"),ee.style.left=he+"px"}n=r}else if((l=p(a.state.footerCellList))&&l.length){for(var me=[],w=0,b=l.length;w<b;w++)me.push(l[w]);for(var w=0,b=me.length;w<b;w++)a.$wrapper[0].removeChild(me[w])}a.state.footerHeight=n||0,a.state.footerDepth=O,a.state.footerNowRowIndexToRowIndex=B,a.state.refreshfootercell={},a.state.refreshfootercell.upperHeight="top"===o?n*O:0,a.state.refreshfootercell.lowerHeight="bottom"===o?n*O:0},At.prototype._allowGroupMerge=function(e,t,a,n){var r=this;if(e._index.row>t._index.row){var o=e;e=t,t=o}var l=r._getGroupingRangeByData(e,a),i=r._getGroupingRangeByData(t,a),d=a.rowspan.by||a.rowspan;1==d&&(d=a.key);var s=r.state.groupKeyOrderMap[d];if(l.groupDepth<s||i.groupDepth<s)return!1;if(!ce(r,l,i,d))return!1;if(1==n){if((e._state.groupFooter||e._state.groupHeader)&&l.groupDepth==s)return!1;if((t._state.groupFooter||t._state.groupHeader)&&i.groupDepth==s)return!1}return!0},At.prototype._isGroupRangeCollapsed=function(e){return e.member[0]._state.collapsedGroupNode&&e.member[0]._state.collapsedGroupNode[e.groupKey]},At.prototype._toggleCollapseGroupRange=function(e){this._isGroupRangeCollapsed(e)?this._expandGroupRange(e):this._collapseGroupRange(e)},At.prototype._collapseGroupRange=function(e){for(var t=0,a=e.member.length;t<a;t++)e.member[t]._state.collapsedGroupNode=e.member[t]._state.collapsedGroupNode||{},e.member[t]._state.collapsedGroupNode[e.groupKey]=!0},At.prototype._expandGroupRange=function(t){for(var a=!1,n=0,r=t.member.length;n<r;n++)t.member[n]._state.collapsedGroupNode&&(delete t.member[n]._state.collapsedGroupNode[t.groupKey],(a||e.isEmptyObject(t.member[n]._state.collapsedGroupNode))&&(delete t.member[n]._state.collapsedGroupNode,a=!0))},At.prototype._isGroupDataCollapsed=function(e,t,a){var n=this,r=n._getGroupingRange(e._index.data,t);if(r)for(var o=r.groupDepth,l=!0===a?o:0;o>=l&&o>=0;o--)if(r=n._getGroupingRange(e._index.data,n.option.grouping.by[o]),n._isGroupRangeCollapsed(r))return!0;return!1},At.prototype._collapseGroupData=function(e,t){var a=this._getGroupingRange(e._index.data,t);a&&this._collapseGroupRange(a)},At.prototype._expandGroupData=function(e,t){var a=this._getGroupingRange(e._index.data,t);a&&this._expandGroupRange(a)},At.prototype._toggleGroupData=function(e,t){var a=this._getGroupingRange(e._index.data,t);a&&(this._isGroupRangeCollapsed(a)?this._expandGroupData(e,t):this._collapseGroupData(e,t))},At.prototype._getTopmostCollapsedRange=function(e){var t,a=this.option.grouping.by.length-1;if(e._state.groupFooter||e._state.groupHeader){if(!(t=this.state.groupingLookupTableMapById[e._state.groupFooter||e._state.groupHeader]))return null;e=t.member[0],a=this.state.groupKeyOrderMap[t.groupKey]}for(var n=null;a>=0&&(t=this._getGroupingRange(e._index.data,this.option.grouping.by[a--]));)this._isGroupRangeCollapsed(t)&&(n=t);return n},At.prototype.isGroupCollapsed=function(e,t,a){var n=this,r=n._dataGet(e)[0];return!0===arguments[arguments.length-1]&&(a=!0),null==t?t=n.option.grouping.by[n.option.grouping.by.length-1]:"number"==typeof t&&(t=n.option.grouping.by[t]),r?n._isGroupDataCollapsed(r,t,a):null},At.prototype._applyGroupFoldingStateToHeader=function(e,t){for(var a=this,n="toggle"===t,r=0,o=e.length;r<o;r++){var l=a._columnIndexKeyToMappingList(e[r]);if(a.state.headerGroupFoldingIconCollapsed=a.state.headerGroupFoldingIconCollapsed||{},l&&l.length)for(var i=0,d=l.length;i<d;i++)a.state.headerGroupFoldingIconCollapsed[l[i].id]=n?!a.state.headerGroupFoldingIconCollapsed[l[i].id]:!!t}},At.prototype.collapseGroup=function(e,t){var a=this,n="string"==typeof e||"number"==typeof e;t=n?e:t,e=d(e)?e:{};var r=a._dataGet(e);if("number"==typeof t&&(t=a.option.grouping.by[t]),t=null==t?a.option.grouping.by:[t],(n||r.length===a.state.data.length)&&a._applyGroupFoldingStateToHeader(t,!0),r&&r.length){for(var o={},l=0,i=r.length;l<i;l++)for(var s=0,p=t.length;s<p;s++){var u=this._getGroupingRange(r[l]._index.data,t[s]);u&&!o[u.id]&&(o[u.id]=!0,a._collapseGroupRange(u))}a.filterAndRedraw()}},At.prototype.expandGroup=function(e,t){var a=this,n="string"==typeof e||"number"==typeof e;t=n?e:t,e=d(e)?e:{};var r=a._dataGet(e);"number"==typeof t&&(t=a.option.grouping.by[t]);var o=null==t;if(t=null==t?a.option.grouping.by:[t],(n||r.length===a.state.data.length)&&a._applyGroupFoldingStateToHeader(t,!1),r&&r.length){var l={};if(o)if(n||!arguments.length)for(var i=0,s=r.length;i<s;i++)delete r[i]._state.collapsedGroupNode;else for(var i=0,s=r.length;i<s;i++){var p=this._getGroupingRange(r[i]._index.data,a.option.grouping.by[0]);if(p&&!l[p.id]){l[p.id]=!0;for(var u=0,c=p.member.length;u<c;u++)delete p.member[u]._state.collapsedGroupNode}}else for(var i=0,s=r.length;i<s;i++)for(var g=0,f=t.length;g<f;g++){var p=this._getGroupingRange(r[i]._index.data,t[g]);p&&!l[p.id]&&(l[p.id]=!0,a._expandGroupRange(p))}a.filterAndRedraw()}},At.prototype.toggleGroup=function(e,t){var a=this,n="string"==typeof e||"number"==typeof e;t=n?e:t,e=d(e)?e:{};var r=a._dataGet(e);"number"==typeof t&&(t=a.option.grouping.by[t]),t=null==t?a.option.grouping.by:[t],(n||r.length===a.state.data.length)&&a._applyGroupFoldingStateToHeader(t,"toggle");var o={};if(r&&r.length){for(var l=0,i=r.length;l<i;l++)for(var s=0,p=t.length;s<p;s++){var u=this._getGroupingRange(r[l]._index.data,t[s]);u&&!o[u.id]&&(o[u.id]=!0,this._isGroupRangeCollapsed(u)?this._expandGroupData(r[l],t[s]):this._collapseGroupData(r[l],t[s]))}a.filterAndRedraw()}},At.prototype._getGroupingRangeByGroupId=function(e){return this.state.groupingLookupTableMapById?this.state.groupingLookupTableMapById[e]||null:null},At.prototype._getGroupingRange=function(e,t){var a=this.state.groupingLookupTable;if(!a)return null;var n=a[t];if(!n)return null;var r=n[e];return r||null},At.prototype._getGroupingRangeByMapping=function(e,t){var a=t.key,n=this;return t.rowspan&&"string"==typeof t.rowspan.by?a=t.rowspan.by:t.rowspan&&"number"==typeof t.rowspan.by&&(a=n.state.columnIndexToKeyMap[t.rowspan.by]),this._getGroupingRange(e,a)},At.prototype._getGroupingRangeByData=function(e,t){if(!e)return null;var a=this;if(!a.state.groupingLookupTable||!a.state.groupingLookupTableMapById)return null;var n=null;if(n=a.state.groupingLookupTableMapById[e._state.groupFooter||e._state.groupHeader])return n||null;if(!t)return null;var r=t.key;return t.rowspan&&"string"==typeof t.rowspan.by?r=t.rowspan.by:t.rowspan&&"number"==typeof t.rowspan.by&&(r=a.state.columnIndexToKeyMap[t.rowspan.by]),a._getGroupingRange(e._index.data,r)},At.prototype._getGroupRangeByQuery=function(e,t){var a=this,n=a._dataGet(e);if(!n||!n.length)return null;var r=n[0],o=null;return(o=a.state.groupingLookupTableMapById[r._state.groupFooter||r._state.groupHeader])?o||null:a._getGroupingRange(r._index.data,t)},At.prototype._getGroupDataListByQuery=function(e,t){var a=this,n=a._getGroupRangeByQuery(e,t);return n?n.member:[]},At.prototype.groupRangeGet=function(e,t){return this._getGroupRangeByQuery.apply(this,arguments)},At.prototype.groupDataGet=function(e,t){return this._getGroupDataListByQuery.apply(this,arguments)},At.prototype._isGroupEnabled=function(){return!!(this.option.grouping&&this.option.grouping.useGrouping&&this.option.grouping.by&&this.option.grouping.by.length)},At.prototype._isGroupFooterEnabled=function(){var t=!1;if(this._isGroupEnabled())if(!0===this.option.grouping.useGroupFooter)t=!0;else if(e.isArray(this.option.grouping.useGroupFooter))t=!0;else if(d(this.option.grouping.foldedGroupFooter))for(var a in this.option.grouping.foldedGroupFooter)if(!0===this.option.grouping.foldedGroupFooter[a]){t=!0;break}return t},At.prototype._isGroupHeaderEnabled=function(){var t=!1;if(this._isGroupEnabled())if(!0===this.option.grouping.useGroupHeader)t=!0;else if(e.isArray(this.option.grouping.useGroupHeader))t=!0;else if(d(this.option.grouping.foldedGroupFooter))for(var a in this.option.grouping.foldedGroupFooter)if(!0===this.option.grouping.foldedGroupFooter[a]){t=!0;break}return t},At.prototype._isGroupSummaryEnabled=function(){return!(!this._isGroupFooterEnabled()&&!this._isGroupHeaderEnabled())},At.prototype._renderGroupSummaryValue=function(e,t){var a=this,n=null,r=null;if(e._state.groupHeader&&(n=a._getGroupingRangeByGroupId(e._state.groupHeader),r=t.groupHeader||null),e._state.groupFooter&&(n=a._getGroupingRangeByGroupId(e._state.groupFooter),r=t.groupFooter||null),n&&r)return a._groupSummaryValue(n,r,e,t)},At.prototype._groupSummaryValue=function(t,a,n,r){var o=this;if(!a)return null;if(e.isArray(a)||(a=[a]),!a.length)return null;for(var l=document.createDocumentFragment(),i=0,d=a.length;i<d;i++){var s=a[i],p="",u=!1;if("string"==typeof s){var c=(s.match(/((^\w+)[(].*[)])/i)||[null]).pop(),g=(s.match(/[^(]*\(([^)]*)\)/)||["",null])[1],f=g?g.split(/\W+/):null;if("groupValue"===c)if(f&&f.length){var h=parseInt(f[0])||0;p=t.member[0][o.option.grouping.by[h]]}else p=t.value;else if("getValue"===c&&f)p=n[f[0]];else if("groupFoldingIcon"===c){var m=o._isGroupRangeCollapsed(t),v=m?" group-collapsed":"";p='<span class="alopexgrid-handle alopexgrid-groupfolding-icon'+v+'"',p+=' data-alopexgrid-rangeid="'+t.id+'"',p+="></span>",u=!0}else if(At.aggregateFunction[c]){for(var x=[],y=0,C=t.member.length;y<C;y++)null!=t.member[y]._index.target&&x.push(t.member[y]);var I=At.aggregateFunction.primitive(x,(f?f[0]:null)||r.key);p=At.aggregateFunction[c](I)}else p=s,u=!0}else"number"==typeof s?p=At.renderUtil.addCommas(s):"function"==typeof s&&(p=s.call(o,t,r),null==p&&(p=""),u=!0);if(u){var _=document.createElement("span");_.className="groupsummary-value",_.innerHTML=p,l.appendChild(_)}else{var w=document.createTextNode(String(p)||"");l.appendChild(w)}}return l},At.prototype._makeGroupSummaryAsData=function(t){var a=this;if(!t||!t._state.groupHeader&&!t._state.groupFooter)return t;for(var n=a.state.visibleColumnMappingList,r=0,o=n.length;r<o;r++){var l=n[r];if(l.key){var i=a._renderGroupSummaryValue(t,l);i&&i.nodeType&&(i=e(i).text()),t[l.key]=null==i?"":i}}return t},At.prototype._refreshHeaderCells=function(t){var a=this,n=p(a.state.headerCellList),r=(a.state.visibleColumnMappingList,a.state.visibleColumnCount,a.state.visibleIndexMapByColumnIndex),l={};for(var i in a.state.columnHeaderStackMap)if(a.state.columnHeaderStackMap.hasOwnProperty(i)){var d=a.state.columnHeaderStackMap[i];e.isArray(d)?l[i]=[].concat(d):l[i]=d}a.state.fixupto;t=!0===t,!0===t&&delete a.state.refreshheadercell,a.state.refreshheadercell=a.state.refreshheadercell||{};var u=a.state.renderFromColumnIndex||0,c=a.state.refreshheadercell.prevRenderFrom,g=u,f=(a.state.wrapperWidth,a.state.scrollxEnd),h=0,m=[];if(!1!==a.option.header){var v=a.state.renderTargetMappingInfo;m=v.renderTargetMapping,v.fixedRenderTargetMapping,h=v.renderTargetWidth;var x=v.fitRatio,y=v.columnWidthByIdMap,C=a.state.visibleColumnMappingList[0],I=a.state.visibleColumnMappingList[a.state.visibleColumnMappingList.length-1];g=(m[Math.max(m.length-1,0)]||{}).columnIndex,h<=a.state.wrapperWidth&&(f=!1),!t&&a.option.fitTableWidth&&x!==a.state.refreshheadercell.fitRatio&&(t=!0);var _=-(f?h-a.state.wrapperWidth:0);if(!f&&a.option.useContinuousXScroll){var w=a._getColumnIndexByBlankWidth(a.state.translateX,!0);w&&(_=-Math.min(h-a.state.wrapperWidth,w))}for(var b=[0],M={},S={},E=0,T=m.length;E<T;E++){var D=m[E];S[D.columnIndex]=!0;var F=b[b.length-1];M[D.columnIndex]=F;var R=F+y[D.id];b.push(R)}for(var k={},L=u;L<=g;L++)a.state.columnIndexToMapping[L]&&!S[L]&&(k[L]=!0);for(var F=0,b=[0],A={},E=0,T=m.length;E<T;E++){var D=m[E],O=b[b.length-1];A[D.columnIndex]=O,b.push(O+parseInt(D.width))}for(var P=a.state.columnHeaderDepth,B=0,G=m.length;B<G;B++)for(var D=m[B],H=l[D.columnIndex],N=0,K=H.length;N<K;N++){var W=H[N];if(W&&W.colspan>1)if(W.isGroup)for(var U=1,V=W.groupMappingList.length;U<V;U++){var Y=W.groupMappingList[U].columnIndex;if(!(Y<=D.columnIndex)){var X=l[Y];X&&X[N]&&(X[N]=null)}}else for(var z=r[W.columnIndex],q=z+parseInt(W.colspan)-1,Z=D.columnIndex+1,Q=(a.state.visibleColumnMappingList[q]||a.state.visibleColumnMappingList[a.state.visibleColumnMappingList.length-1]).columnIndex,J=Z,ee=Q;J<=ee;J++){var X=l[J];X&&(X[N]&&(X[N]=null))}}for(var L in l)S[L]||delete l[L];var te={},ae=a.state.visibleIndexMapByColumnIndex,ne=(ae[u],ae[c],[]);n=p(a.state.headerCellList);for(var B=0,G=n.length;B<G;B++)ne.push(n[B]);for(var B=0,G=ne.length;B<G;B++){var re=ne[B],oe=parseInt(re.getAttribute("data-alopexgrid-columnindex")),N=parseInt(re.getAttribute("data-alopexgrid-columndepth"));if(!(oe>=0&&N>=0)||g<oe||N>=P)a.$wrapper[0].removeChild(re);else{var H=l[oe];H&&H[N]?te[oe+","+N]=!0:a.$wrapper[0].removeChild(re)}}for(var B=0,G=m.length;B<G;B++)for(var D=m[B],oe=D.columnIndex,H=l[D.columnIndex],N=0;N<P;N++){var W=H[N];if(!te[oe+","+N]&&W){var re=document.createElement("div");re.className="cell headercell alopexgrid-cell",re.setAttribute("data-alopexgrid-columnindex",oe),re.setAttribute("data-alopexgrid-columndepth",N),a.$wrapper[0].appendChild(re)}}ne=[],n=p(a.state.headerCellList);for(var B=0,G=n.length;B<G;B++)ne.push(n[B]);for(var le=[],ie=[0],N=0;N<a.state.headerDepth;N++)le[N]=(a.option.headerRowHeight?"number"==typeof a.option.headerRowHeight?a.option.headerRowHeight:a.option.headerRowHeight[N]:null)||a.state.headerRowHeight,ie.push(ie[ie.length-1]+le[N]);if(a.option.filteringHeader){var de=e.isNumeric(a.option.filteringHeaderHeight)?a.option.filteringHeaderHeight:a.state.headerRowHeight;ie.push(ie[ie.length-1]+(le[P-1]=de))}for(var B=0,G=ne.length;B<G;B++){var re=ne[B],oe=parseInt(re.getAttribute("data-alopexgrid-columnindex")),N=parseInt(re.getAttribute("data-alopexgrid-columndepth")),H=l[oe],W=H[N],D=W.mapping;t&&(re.className="cell headercell alopexgrid-cell");var se=M[oe];_&&oe>a.state.fixupto&&(se+=_);var pe=ie[N],ue=y[a.state.columnIndexToMapping[oe].id],ce=le[N];if(W.rowspan>1){var me=N,ve=N+parseInt(W.rowspan)-1;ce=0;for(var xe=me;xe<=ve;xe++)ce+=le[xe];ve===P-1&&At.renderUtil.addClass(re,"cell-header-lastrow"),0===me&&At.renderUtil.addClass(re,"cell-header-firstrow")}else N===P-1&&At.renderUtil.addClass(re,"cell-header-lastrow"),0===N&&At.renderUtil.addClass(re,"cell-header-firstrow");if(W.colspan>1&&W.isGroup){ue=0;for(var ye=W.columnIndex;ye<=W.toColumnIndex;ye++){var Ce=a.state.columnIndexToMapping[ye];Ce&&(ue+=y[Ce.id]||0),void 0!==a.state.visibleIndexMapByColumnIndex[ye]&&ye<oe&&Ce&&(se-=y[Ce.id]||0)}}var Ie=se+"px",_e=pe+"px";re.style.left!==Ie&&(re.style.left=Ie),re.style.top!==_e&&(re.style.top=_e);var we=ue+"px",be=ce+"px",Me=ce-4+"px";if(re.style.width!==we&&(re.style.width=we),re.style.height!==be&&(re.style.height=be,re.style.lineHeight=Me),!re.isHeaderCellRendered||t){var Se="",Ee=document.createDocumentFragment(),Te=document.createElement("span"),De=!1,Fe=!1;if(re.id=a.key+"-h-"+N+"-"+oe,re.setAttribute("data-alopexgrid-root",a.key),W.filter){var Re=a.state.columnIndexToMapping[W.columnIndex];if(Re&&Re.key){var ke=a._filterCellRender(Re,!0);Ee.appendChild(ke)}Fe=!0,Se+=" filtercell"}if(oe<=a.state.fixupto&&(Se+=" fixed cell-fixcol",oe===a.state.fixupto&&(Se+=" cell-fixcol-lastcolumn")),W.isGroup?(Se+=" header-group",W.rowspan>1&&(Se+=" header-group-rowspan"),W.colspan>1&&(Se+=" header-group-colspan"),a.state.fixupto>=0&&D.fromIndex<=a.state.fixupto&&D.toIndex>=a.state.fixupto&&(Se+=" cell-fixcol-lastcolumn"),re.setAttribute("data-alopexgrid-tocolumnindex",W.toColumnIndex),re.setAttribute("data-alopexgrid-groupcolumnindexes",W.groupColumnIndexes.join(",")),re.setAttribute("data-alopexgrid-headergroupid",W.mapping.id)):(re.removeAttribute("data-alopexgrid-tocolumnindex"),re.removeAttribute("data-alopexgrid-groupcolumnindexes"),re.removeAttribute("data-alopexgrid-headergroupid")),C&&C.columnIndex===oe&&(Se+=" cell-firstcolumn"),D){e(re);if(D.headerStyleclass){var Le=D.headerStyleclass;s(Le)&&(Le=Le.call(a,D)||""),"string"==typeof Le&&(Se+=" "+Le)}if(W.isGroup&&D.styleclass){var Le=D.styleclass;s(Le)&&(Le=Le.call(a,D)||""),"string"==typeof Le&&(Se+=" "+Le)}if(a.state.headerSelection){var Ae=Math.min(a.state.headerSelection.from,a.state.headerSelection.to),Oe=Math.max(a.state.headerSelection.from,a.state.headerSelection.to);D.columnIndex>=Ae&&D.columnIndex<=Oe?Se+=" header-selected":W.isGroup&&Ae<=W.columnIndex&&W.toColumnIndex<=Oe&&(Se+=" header-selected")}if(I&&(D.columnIndex||D.fromIndex)+(W.colspan||0)>=I.columnIndex&&(Se+=" cell-lastcolumn"),D.selectorColumn&&"string"!=typeof D.title&&(a.state.rowSingleSelect||re.setAttribute("onclick",gt+".run('"+a.key+"','_rowSelectAll',event,this);")),D.selectorColumn&&"string"!=typeof D.title){var Pe=document.createElement("input");Pe.type="checkbox",Pe.name=o(),Pe.className="selector-checkbox selector-column-input";var Be=document.createElement("label");At.renderUtil.addDefaultInputWrapperClass(Be,"checkbox"),a.state.rowSingleSelect&&(At.renderUtil.addClass(Be,"disabled"),Pe.disabled=!0),a.state.selectAll&&(Pe.checked=!0,Be.className+=" checked"),Be.appendChild(Pe),Te.appendChild(Be)}else if(D.columnFoldingColumn)Te.className+=" header-columnfolding-icon alopexgrid-nonsorting-handle",!0===D.columnFolded&&(Te.className+=" folded");else{var Ge=D.title;s(Ge)&&(Ge=Ge.call(a,D)),At.renderUtil.setElementContent(Te,Ge)}D.selectorColumn&&(Se+=" selector-column",a.state.rowSingleSelect&&(Se+=" single-selector-column")),D.rowindexColumn&&(Se+=" rowindex-column"),D.numberingColumn&&(Se+=" numbering-column"),D.columnFoldingColumn&&(Se+=" columnfolding-column"),D.dragdropColumn&&(Se+=" dragdrop-column");var He=D.headerDragDrop,Ne=document.createDocumentFragment();if(He&&!0===He&&(De=!0,He)){var $e=null;Se+=" headerdragdrop",$e=ge(a,D),Ne.appendChild($e)}var Ke=D.sorting,We=j(D,"resizing"),$e=null;if(Ke||We){if(De=!0,Ke&&D.key&&!D.selectorColumn&&(Se+=" sorting",!0!==a.option.disableHeaderClickSorting&&(Se+=" click-sortable"),!0!==a.option.hideSortingHandle)){$e=fe(a),Ee.appendChild($e);var Ue=a._isColumnSorted(D);if(Ue){if(Se+=" "+(Ue.sortingDirection||"asc"),a.state.sortingInfo.length>1){var Ve=document.createElement("span"),Ye=document.createTextNode(Ue.sortedOrder);Ve.className="multi-sorting-order",Ve.appendChild(Ye),$e.appendChild(Ve)}}}if(We&&!W.disableResizing)if(e.isArray(We))for(var Xe=a.state.columnWidthMap,ze=0,je=[],qe=D.toIndex;qe>=D.fromIndex;qe--){var $e=he(a,{columnIndex:qe});qe!==D.toIndex&&($e.style.right=ze+"px"),je.push(qe),ze+=Xe[qe],e.inArray(qe,We)>=0&&Ee.appendChild($e)}else Ee.appendChild(he(a,{columnIndex:oe}))}D.headerAlign&&(Se+=" align-"+D.headerAlign)}for(;re.firstChild;)re.removeChild(re.firstChild);if(De){var Ze=document.createElement("div");Ze.className="relative-wrap",Ze.appendChild(Ne),Fe||Ze.appendChild(Te),Ze.appendChild(Ee),re.appendChild(Ze)}else Fe||re.appendChild(Te),re.appendChild(Ee);if(Fe?re.removeAttribute("title"):(At.renderUtil.addClass(Te,"column-title"),!0!==a.option.disableHeaderTitleAttribute&&re.setAttribute("title",Te.textContent||Te.innerText||"")),D&&D.treeColumnHeader&&a.option.tree&&a.option.tree.useTree){var Qe=document.createElement("span");Qe.className="alopexgrid-treecolumn-icon",a.state.treeHeaderExpandAllState&&(Qe.className+=" expanded"),a.state.treeInfo&&a.state.treeInfo.childCountByIdValueMap&&!e.isEmptyObject(a.state.treeInfo.childCountByIdValueMap)&&(Qe.className+=" expandable"),De?Ze.firstChild?Ze.insertBefore(Qe,Ze.firstChild):Ze.appendChild(Qe):re.firstChild?re.insertBefore(Qe,re.firstChild):re.appendChild(Qe)}if(D&&a.state.groupingLookupTable&&a.state.groupingLookupTable[D.key]&&(Se+=" headercell-grouping","number"==typeof D.groupFoldingHeader||D.groupFoldingHeader)){var Qe=document.createElement("span");Qe.className="alopexgrid-handle alopexgrid-groupfolding-icon alopexgrid-nonsorting-handle",a.state.headerGroupFoldingIconCollapsed&&a.state.headerGroupFoldingIconCollapsed[D.id]&&(Qe.className+=" group-collapsed"),Qe.setAttribute("data-alopexgrid-groupfolding-depth",D.groupFoldingHeader),De?Ze.firstChild?Ze.insertBefore(Qe,Ze.firstChild):Ze.appendChild(Qe):re.firstChild?re.insertBefore(Qe,re.firstChild):re.appendChild(Qe)}if(re.className+=Se,re.isHeaderCellRendered=!0,$(a,re),re.className.indexOf("filtercell")<0&&re.className.indexOf("header-group")<0){var Je=re.clientHeight/2;if(null!=$e){Je-=($e.clientHeight?$e.clientHeight:0)/2}e($e).css("top",Je+"px")}}}if(a.state.refreshheadercell.prevRenderFrom=u,a.state.refreshheadercell.fitRatio=x,a.state.headerHeight=0,le.length)for(var B=0,G=le.length;B<G;B++)a.state.headerHeight+=le[B];l=null}else{a.state.headerHeight=0;for(var ne=[],G=n.length||0,B=0;B<G;B++)ne.push(n[B]);G=ne.length;for(var B=0;B<G;B++){var re=ne[B];re.parentNode&&re.parentNode.removeChild(re)}}},At.prototype._hiddenHeaderDragStart=function(t,a){var n=this,r=e.event.fix(t);if("touchstart"===t.type)r=t.touches[0];else if(1!=t.which)return;t.preventDefault(),n.$wrapper.off(".alopexgridHeaderSelectEngine");var o=".alopexgridhiddenheaderdragdropevent",l=n.$columnhiddenarea,d=e(t.target).closest(".headercell"),s={};s.self=n,s.hiddenHeaderDragDropEventNS=o,s.hiddenColArea=l,s.hiddenAreaHasScroll=l.get(0).scrollWidth>l.innerWidth(),s.headercell=d,s.columnIndex=a,s.wrapperX=n.$wrapper.offset().left,s.atColumnIndex=null,s.targetHiddenColumnIndex=null,s.after=!1,s.$proxy=null,s.$bar=null,s.scrollTimer=null,s.prevX=r.pageX,s.prevY=r.pageY,s.toHideArea=!1,s.canDragDrop=!0,s.groupDragDrop=!1,s.dragColumnMapping=null,s.leftColumn=null,s.leftColumnMapping=null,s.rightColumn=null,s.rightColumnMapping=null,s.toHiddenColumnArea=null,s.targetHiddenColumn=null,s.targetHiddenColumnMapping=null,n.state.hiddenColumnDraging=!0,Ct.off(o+n.key),Ct.on("keydown"+o+n.key+n.eventns,s,function(e){var t=e.data.self,a=e.data.hiddenColArea;switch(e.keyCode){case 27:Ct.off(e.data.hiddenHeaderDragDropEventNS+t.key),t._enableHeaderSelect(!!t.option.enableHeaderSelect),a.removeClass("focused"),e.data.$proxy&&(e.data.$proxy.remove(),delete e.data.$proxy),e.data.$bar&&(e.data.$bar.remove(),delete e.data.$bar),e.data.scrollTimer&&(clearInterval(e.data.scrollTimer),e.data.scrollTimer=null),null!==e.data.atColumnIndex&&(e.data.atColumnIndex=null)}}),Ct.on("mousemove"+o+n.key+n.eventns+" touchmove"+o+n.key+n.eventns,s,function(t){var a=t,n=t.target;if("touchmove"===t.type&&(a=t.originalEvent.touches[0],n=document.elementFromPoint(a.clientX,a.clientY)),t.data.prevX!==a.pageX||t.data.prevY!==a.pageY){t.data.prevX=a.pageX,t.data.prevY=a.pageY;var r=t.data.self,o=t.data.hiddenColArea,l=t.data.headercell,d=t.data.columnIndex;t.preventDefault(),i();var s=t.data.$proxy,p=t.data.$bar;if(null==s){s=e("<div>"),s.addClass(ct+" alopexgrid-proxy alopexgrid-dragdrop-header alopexgrid-refer-"+r.key);var u=e('<div class="columnhiddenarea wrapper"><div>').css("overflow","visible");null!=l&&($cloneHeader=l.clone(),$cloneHeader.css({top:"0px",left:"0px"}),u.append($cloneHeader)),s.append(u),s.appendTo(document.body),t.data.$proxy=s}null==p&&(p=e("<div>"),p.addClass("alopexgrid-dragdrop-header-indicator"),t.data.$bar=p),t.data.$bar.prependTo(r.$wrapper),s.css({top:a.pageY+"px",left:a.pageX+"px"}),t.data.scrollTimer&&(clearInterval(t.data.scrollTimer),t.data.scrollTimer=null);var c=r.state.refreshbodycell.bodyCellStartX;r.state.fixedColumnWidth>0&&(c+=r.state.fixedColumnWidth);var g=r.state.refreshbodycell.bodyCellEndX,f=t.data.hiddenAreaHasScroll,h=o.offset().top+o.height();if(f)var m=o.scrollLeft(),v=o.offset().left,x=v+o.width(),y=1;var C=a.pageX,I=a.pageY;if(C<=t.data.wrapperX+c){var _=Math.ceil(Math.abs(C-(t.data.wrapperX+c))/25),w=function(){I<=h?f&&v-C>0&&(o.scrollLeft(m-(v-C)*y),y+=5):r._scrollLeftEvent(_)};w(),t.data.scrollTimer=setInterval(w,100)}else if(C>t.data.wrapperX+g){var _=Math.ceil(Math.abs(C-(t.data.wrapperX+g))/25),w=function(){I<=h?f&&C-x>0&&(o.scrollLeft(m+(C-x)*y),y+=5):r._scrollRightEvent(_)};w(),t.data.scrollTimer=setInterval(w,100)}var b=r.state.renderTargetMappingInfo,M=b.fixedRenderTargetMapping,S=b.renderTargetWidth,E=b.fitRatio,T=r.state.scrollxEnd,D=0;T&&S>r.state.wrapperWidth&&(D=S-r.state.wrapperWidth);var F=!0,R=e(n),k=R.closest(".columnhiddenarea");if(R.closest(".alopexgrid-dragdrop-header")&&0!==R.closest(".alopexgrid-dragdrop-header").length)return void o.removeClass("focused");if(!At.renderUtil.hasClass(R[0],"alopexgrid-dragdrop-header-indicator")){if(k&&0!==k.length&&"true"===k.attr("data-alopexgrid-columnhiddenarea")){t.data.atColumnIndex=null,t.data.toHideArea=!0,o.addClass("focused");var L=R.closest(".headercell");L&&0!==L.length?t.data.targetHiddenColumnIndex=L.attr("data-alopexgrid-columnindex"):t.data.targetHiddenColumnIndex=null,t.data.dragColumnMapping=r.state.columnIndexToMapping[d];var A=t.data.targetHiddenColumnIndex,O=null;null!=t.data.targetHiddenColumnIndex&&(A=Number(t.data.targetHiddenColumnIndex),O=r.state.columnIndexToMapping[A]);var P=r._triggerGridEvent("hiddenHeaderDragOver",{dragColumn:d,dragColumnMapping:t.data.dragColumnMapping,leftColumn:null,leftColumnMapping:null,rightColumn:null,rightColumnMapping:null,toHiddenColumnArea:t.data.toHideArea,targetHiddenColumn:A,targetHiddenColumnMapping:O});P?(t.data.canDragDrop=!0,t.data.$proxy.removeClass("disabled")):(t.data.canDragDrop=!1,t.data.$proxy.addClass("disabled"))}else{t.data.toHideArea=!1,t.data.targetHiddenColumnIndex=null,o.removeClass("focused");var B=r.state.refreshbodycell.renderedColumnMappingList.length,L=R.closest(".headercell"),G=R.closest(".bodycell"),H=R.closest(".footercell"),N=R.closest(".filtercell"),$=R.closest(".pager"),K=R.closest("."+ct);if(null!=L&&0!==L.length||null!=G&&0!==G.length||null!=H&&0!==H.length||null!=N&&0!==N.length||null!=$&&0!==$.length)for(var W=0;W<B;W++){var U=r.state.refreshbodycell.renderedColumnMappingList[W],V=U.columnIndex,Y=(r.state.columnIndexToMapping[V],r.state.columnWidthMap[V]);1!==E&&(Y*=r.state.refreshbodycell.fitRatio),M.length>0&&r.state.refreshbodycell.renderedColumnMappingList[M.length].columnIndex===V&&(Y-=D);var X=r.state.refreshbodycell.bodyCellPositionXForHeaderDrag[W],z=X+t.data.wrapperX;if(C>=z&&C<=z+Y){t.data.atColumnIndex=V,Math.abs(C-z)>Math.abs(C-(z+Y))?(t.data.after=!0,wt?t.data.$bar.css("left",X+Y+"px"):t.data.$bar.css("transform","translateX("+(X+Y)+"px)")):(t.data.after=!1,wt?t.data.$bar.css("left",X+"px"):t.data.$bar.css("transform","translateX("+X+"px)"));break}}else if(null!=K&&0!==K.length){t.data.after=!0;var V,U=r.state.refreshbodycell.renderedColumnMappingList[B-1];V=null==U?Math.min.apply(null,r.state.hiddenColumnIdxArr):U.columnIndex,d===V?(t.data.atColumnIndex=null,t.data.canDragDrop=!1):(t.data.atColumnIndex=V,F=!1)}else t.data.atColumnIndex=null,t.data.canDragDrop=!1}if(!1===t.data.toHideArea&&null!==t.data.atColumnIndex){F?t.data.$bar.show():t.data.$bar.hide(),t.data.dragColumnMapping=r.state.columnIndexToMapping[d];var j=e.inArray(t.data.atColumnIndex,r.state.visibleColumnIndexArr);t.data.after?(t.data.leftColumn=t.data.atColumnIndex,t.data.leftColumnMapping=r.state.columnIndexToMapping[t.data.atColumnIndex],t.data.rightColumn=r.state.visibleColumnIndexArr[j+1],null==t.data.rightColumn?(t.data.lrightColumn=null,t.data.lrightColumnMapping=null):t.data.rightColumnMapping=r.state.columnIndexToMapping[t.data.rightColumn]):(t.data.leftColumn=r.state.visibleColumnIndexArr[j-1],null==t.data.leftColumn?(t.data.leftColumn=null,t.data.leftColumnMapping=null):t.data.leftColumnMapping=r.state.columnIndexToMapping[t.data.leftColumn],t.data.rightColumn=t.data.atColumnIndex,t.data.rightColumnMapping=r.state.columnIndexToMapping[t.data.rightColumn]);var P=r._triggerGridEvent("hiddenHeaderDragOver",{dragColumn:d,dragColumnMapping:t.data.dragColumnMapping,leftColumn:t.data.leftColumn,leftColumnMapping:t.data.leftColumnMapping,rightColumn:t.data.rightColumn,rightColumnMapping:t.data.rightColumnMapping,toHiddenColumnArea:t.data.toHideArea,targetHiddenColumn:null,targetHiddenColumnMapping:null});if(P&&(t.data.canDragDrop=!0,t.data.$bar.removeClass("disabled"),t.data.$proxy.removeClass("disabled")),r.option.grouping&&r.option.grouping.by.length>0&&!0===r.option.grouping.useGroupColumnRearrange){var q,j=e.inArray(t.data.atColumnIndex,r.state.visibleColumnIndexArr);t.data.after?(j+=1,q=r.state.visibleColumnIndexArr[j]):q=r.state.visibleColumnIndexArr[j];var Z=r.state.groupingColumnIndexToMapping[d],O=r.state.groupingColumnIndexToMapping[q];if(r.option.grouping.useDragDropBetweenGroups)null!=Z&&null!=O?(t.data.canDragDrop=!0,t.data.groupDragDrop=!0,t.data.$bar.removeClass("disabled"),t.data.$proxy.removeClass("disabled")):null==Z&&null==O?(t.data.groupDragDrop=!1,t.data.canDragDrop=!0,t.data.$bar.removeClass("disabled"),t.data.$proxy.removeClass("disabled")):(t.data.groupDragDrop=!1,t.data.canDragDrop=!1,t.data.$bar.addClass("disabled"),t.data.$proxy.addClass("disabled"));else if(null!=Z&&null!=O)t.data.canDragDrop=!0,t.data.groupDragDrop=!0,t.data.$bar.removeClass("disabled"),t.data.$proxy.removeClass("disabled");else if(null!=Z&&null==O){t.data.groupDragDrop=!1;var Q=r.option.grouping.by,J=Q[Q.length-1],ee=(r._getColumnByKey(J)||{}).columnIndex,te=e.inArray(ee,r.state.visibleColumnIndexArr),ae=r.state.visibleColumnIndexArr[te+1],ne=r.state.columnIndexToKeyMap[ae];"undefined"===ne?(t.data.canDragDrop=!1,t.data.$bar.addClass("disabled"),t.data.$proxy.addClass("disabled")):(t.data.canDragDrop=!0,
t.data.$bar.removeClass("disabled"),t.data.$proxy.removeClass("disabled"))}else if(null==Z&&null!=O){t.data.groupDragDrop=!1;var re=r.state.columnIndexToKeyMap[d];"undefined"===re?(t.data.canDragDrop=!1,t.data.$bar.addClass("disabled"),t.data.$proxy.addClass("disabled")):(t.data.canDragDrop=!0,t.data.$bar.removeClass("disabled"),t.data.$proxy.removeClass("disabled"))}else t.data.groupDragDrop=!1,t.data.canDragDrop=!0,t.data.$bar.removeClass("disabled"),t.data.$proxy.removeClass("disabled")}!1===P&&(t.data.canDragDrop=!1,t.data.$bar.addClass("disabled"),t.data.$proxy.addClass("disabled"))}else t.data.$bar.hide()}}}).on("mouseup"+o+n.key+n.eventns+" touchend"+o+n.key+n.eventns+" touchcancel"+o+n.key+n.eventns,s,function(t){function a(e,t){e._triggerGridEvent("hiddenHeaderDragDropEnd",{dropColumn:t.columnIndex,dropColumnMapping:t.dragColumnMapping,leftColumn:t.leftColumn,leftColumnMapping:t.leftColumnMapping,rightColumn:t.rightColumn,rightColumnMapping:t.rightColumnMapping,toHiddenColumnArea:t.toHideArea})}function n(e){return null!=e}var r=t.data.self,o=(t.data.headercell,t.data.hiddenColArea),l=t.data.columnIndex;if(Ct.off(t.data.hiddenHeaderDragDropEventNS+r.key),r._enableHeaderSelect(!!r.option.enableHeaderSelect),o.removeClass("focused"),t.data.$proxy&&(t.data.$proxy.remove(),delete t.data.$proxy),t.data.$bar&&(t.data.$bar.remove(),delete t.data.$bar),t.data.scrollTimer&&(clearInterval(t.data.scrollTimer),t.data.scrollTimer=null),!1!==t.data.canDragDrop&&!1!==r._triggerGridEvent("hiddenHeaderDragDrop",{dropColumn:t.data.columnIndex,dropColumnMapping:t.data.dragColumnMapping,leftColumn:t.data.leftColumn,leftColumnMapping:t.data.leftColumnMapping,rightColumn:t.data.rightColumn,rightColumnMapping:t.data.rightColumnMapping,toHiddenColumnArea:t.data.toHideArea})){if(t.data.toHideArea){var i=e.inArray(l,r.state.hiddenColumnIdxArr);if(null!=t.data.targetHiddenColumnIndex){var d=e.inArray(Number(t.data.targetHiddenColumnIndex),r.state.hiddenColumnIdxArr);null!=d&&-1!==d?(r.option.hiddenColumnOrderList.splice(i,1),r.option.hiddenColumnOrderList.splice(d,0,l),r.state.hiddenColumnIdxArr.splice(i,1),r.state.hiddenColumnIdxArr.splice(d,0,l)):(r.option.hiddenColumnOrderList.splice(i,1),r.option.hiddenColumnOrderList.push(l),r.state.hiddenColumnIdxArr.splice(i,1),r.state.hiddenColumnIdxArr.push(l))}else{if(r.state.hiddenColumnIdxArr&&r.state.hiddenColumnIdxArr.length>0&&r.state.hiddenColumnIdxArr[r.state.hiddenColumnIdxArr.length-1]===l)return;r.option.hiddenColumnOrderList.splice(i,1),r.option.hiddenColumnOrderList.push(l),r.state.hiddenColumnIdxArr.splice(i,1),r.state.hiddenColumnIdxArr.push(l)}return r.calcAndRedraw(),void a(r,t.data)}if(null!==t.data.atColumnIndex){var s=r.state.hiddenColumnIndexToMapping[l];if(null!=s){var p=e.inArray(s.columnIndex,r.state.hiddenColumnIdxArr);r.option.hiddenColumnOrderList.splice(p,1),r.state.hiddenColumnIdxArr.splice(p,1),delete r.state.hiddenColumnIndexToMapping[l]}r.showCol(l);var u=t.data.atColumnIndex,c=e.inArray(l,r.state.visibleColumnIndexArr),g=e.inArray(u,r.state.visibleColumnIndexArr);if(l===u)return void a(r,t.data);if(t.data.after&&c===g+1)return void a(r,t.data);if(!t.data.after&&c+1===g)return void a(r,t.data);var f=r.state.columnIndexToMapping[l],h=r.state.columnIndexToMapping[u];if(r.option.grouping&&r.option.grouping.by.length>0&&!1===r.option.grouping.useDragDropBetweenGroups&&!0===r.option.grouping.useGroupColumnRearrange&&!1===t.data.groupDragDrop){var m=r.state.groupingColumnIndexToMapping[l],v=r._getColumnByKey(h.key);if(null!=m){var x=r.option.grouping.by,y=x[x.length-1],C=(r._getColumnByKey(y)||{}).columnIndex,I=e.inArray(C,r.state.visibleColumnIndexArr),_=r.state.visibleColumnIndexArr[I+1],w=r.state.columnIndexToKeyMap[_],b=e.inArray(f.key,r.option.grouping.by);r.option.grouping.by.splice(b,1),r.option.grouping.by.push(w),r.state.sortingRequired=!0}else if(v){var M=e.inArray(h.key,r.option.grouping.by);r.option.grouping.by.splice(M,0,f.key),r.option.grouping.by.splice(r.option.grouping.by.length-1,1),r.state.sortingRequired=!0}}var S=[],E={};if(null!=r.option.autoColumnIndex&&!0===r.option.autoColumnIndex)if(l>u){t.data.after&&(g+=1,u=r.state.visibleColumnIndexArr[g]);for(var T=u;T<l;T++)h=r.state.columnIndexToMapping[T],h.columnIndex=T+1,V(r,h,T,S,E);Y(r,S,E),f.columnIndex=u,r.option.columnMapping.splice(u,0,f),r.option.columnMapping.splice(l+1,1)}else{t.data.after||(g-=1,u=r.state.visibleColumnIndexArr[g]);for(var T=l+1;T<u+1;T++)h=r.state.columnIndexToMapping[T],h.columnIndex=T-1,V(r,h,T,S,E);Y(r,S,E),f.columnIndex=u,r.option.columnMapping.splice(u+1,0,f),r.option.columnMapping.splice(l,1)}else{if(c>g){t.data.after&&(g+=1,u=r.state.visibleColumnIndexArr[g]);for(var D,T=g;T<c;T++)D=r.state.columnIndexArr[T],h=r.state.columnIndexToMapping[D],h.columnIndex=r.state.columnIndexArr[T+1],V(r,h,T,S,E);Y(r,S,E)}else{t.data.after||(g-=1,u=r.state.visibleColumnIndexArr[g]);for(var D,T=c+1;T<g+1;T++)D=r.state.columnIndexArr[T],h=r.state.columnIndexToMapping[D],h.columnIndex=r.state.columnIndexArr[T-1],V(r,h,T,S,E);Y(r,S,E)}f.columnIndex=u}if(t.data.groupDragDrop){for(var F,R=r.option.grouping.by,k=[],L=0,A=R.length;L<A;L++)F=r._getColumnByKey(R[L]),k[F.columnIndex]=F.key;r.option.grouping.by=k.filter(n),r.state.sortingRequired=!0}r.updateOption(),r.state.hiddenColumnDraging=!1,a(r,t.data)}}})},At.prototype._headerDragStart=function(t,a){var n=this,r=e.event.fix(t);if("touchstart"===t.type)r=t.touches[0];else if(1!=t.which)return;t.preventDefault(),n.$wrapper.off(".alopexgridHeaderSelectEngine");var o=".alopexgridheaderdragdropevent",l=n.$columnhiddenarea,d=e(t.target).closest(".headercell"),s={};s.self=n,s.headerDragDropEventNS=o,s.selfTo=null,s.hiddenColArea=l,s.hiddenColAreaVisible="none"!==l.css("display"),s.headercell=d,s.columnIndex=a,s.wrapperX=n.$wrapper.offset().left,s.atColumnIndex=null,s.targetHiddenColumnIndex=null,s.after=!1,s.$proxy=null,s.$bar=null,s.scrollTimer=null,s.prevX=r.pageX,s.prevY=r.pageY,s.toHideArea=!1,s.canDragDrop=!0,s.groupDragDrop=!1,s.dragColumnMapping=null,s.leftColumn=null,s.leftColumnMapping=null,s.rightColumn=null,s.rightColumnMapping=null,s.toHiddenColumnArea=null,s.targetHiddenColumn=null,s.targetHiddenColumnMapping=null,Ct.off(o+n.key),Ct.on("keydown"+o+n.key+n.eventns,s,function(e){var t=e.data.self,a=e.data.hiddenColArea;switch(e.keyCode){case 27:Ct.off(e.data.headerDragDropEventNS+t.key),t._enableHeaderSelect(!!t.option.enableHeaderSelect),a.removeClass("focused"),e.data.$proxy&&(e.data.$proxy.remove(),delete e.data.$proxy),e.data.$bar&&(e.data.$bar.remove(),delete e.data.$bar),e.data.scrollTimer&&(clearInterval(e.data.scrollTimer),e.data.scrollTimer=null),null!==e.data.atColumnIndex&&(e.data.atColumnIndex=null)}}),Ct.on("mousemove"+o+n.key+n.eventns+" touchmove"+o+n.key+n.eventns,s,function(t){var a=t,n=t.target;if("touchmove"===t.type&&(a=t.originalEvent.touches[0],n=document.elementFromPoint(a.clientX,a.clientY)),t.data.prevX!==a.pageX||t.data.prevY!==a.pageY){t.data.prevX=a.pageX,t.data.prevY=a.pageY;var r=t.data.self,o=t.data.hiddenColArea,l=t.data.headercell,d=t.data.columnIndex;t.preventDefault(),i();var s=t.data.$proxy,p=t.data.$bar;if(null==s){s=e("<div>"),s.addClass(ct+" alopexgrid-proxy alopexgrid-dragdrop-header alopexgrid-refer-"+r.key);var u=e('<div class="'+ct+'"><div>').css("overflow","visible"),c=e('<div class="wrapper"><div>').css("overflow","visible"),g=1,f=1;if(r.option.proxyRatio&&r.option.proxyRatio.column&&(g=r.option.proxyRatio.column.width,f=r.option.proxyRatio.column.height),null!=l){var h=l.clone(),m=h.height()*f,v=h.width()*g;h.css({top:"0px",left:"0px",width:v+"px",height:m+"px",lineHeight:m-4+"px"}),c.append(h)}if(!1===It){var x,y,C,I,_=r.columnInfo(d),w=r.state.refreshbodycell.renderedDataList;C=null==h?0:h.height();for(var b=0,M=w.length;b<M;b++){y=w[b],x=e(r._createCell(y,_));var S;null!=y._index&&(S=r.state.rowHeightMapByDataId[y._index.id]),null==S&&(S=r.state.rowHeight),S*=f,I=r.state.columnFitWidthById[_.id]*g,x.css({top:C+"px",left:"0px",height:S+"px",width:I+"px"}),x.appendTo(c),C+=S}}u.append(c),s.append(u),s.appendTo(document.body),t.data.$proxy=s}null==p&&(p=e("<div>"),p.addClass("alopexgrid-dragdrop-header-indicator"),t.data.$bar=p),t.data.$bar.prependTo(r.$wrapper),t.data.$proxy.css({top:a.pageY+"px",left:a.pageX+"px"}),t.data.scrollTimer&&(clearInterval(t.data.scrollTimer),t.data.scrollTimer=null);var E=r.state.refreshbodycell.bodyCellStartX;r.state.fixedColumnWidth>0&&(E+=r.state.fixedColumnWidth);var T=r.state.refreshbodycell.bodyCellEndX;if(t.data.hiddenColAreaVisible){var D=o.get(0).scrollWidth>o.innerWidth(),F=o.offset().top+o.height();if(D)var R=o.scrollLeft(),k=o.offset().left,L=k+o.width(),A=1}var O=t.data,P=a.pageX,B=a.pageY;if(P<=t.data.wrapperX+E){var G=Math.ceil(Math.abs(P-(t.data.wrapperX+E))/25),H=function(){O.hiddenColAreaVisible&&B<=F?D&&k-P>0&&(o.scrollLeft(R-(k-P)*A),A+=5):r._scrollLeftEvent(G)};H(),t.data.scrollTimer=setInterval(H,100)}else if(P>=t.data.wrapperX+T){var G=Math.ceil(Math.abs(P-(t.data.wrapperX+T))/25),H=function(){O.hiddenColAreaVisible&&B<=F?D&&P-L>0&&(o.scrollLeft(R+(P-L)*A),A+=5):r._scrollRightEvent(G)};H(),t.data.scrollTimer=setInterval(H,100)}var N=r.state.renderTargetMappingInfo,$=N.fixedRenderTargetMapping,K=N.renderTargetWidth,W=N.fitRatio,U=r.state.scrollxEnd,V=0;U&&K>r.state.wrapperWidth&&(V=K-r.state.wrapperWidth);var Y=!0,X=e(n),z=X.closest(".columnhiddenarea");if(X.closest(".alopexgrid-dragdrop-header")&&0!==X.closest(".alopexgrid-dragdrop-header").length)return void o.removeClass("focused");if(!At.renderUtil.hasClass(X[0],"alopexgrid-dragdrop-header-indicator")){if(z&&0!==z.length&&"true"===z.attr("data-alopexgrid-columnhiddenarea")){t.data.atColumnIndex=null,t.data.toHideArea=!0,o.addClass("focused");var j=X.closest(".headercell");j&&0!==j.length?t.data.targetHiddenColumnIndex=j.attr("data-alopexgrid-columnindex"):t.data.targetHiddenColumnIndex=null,t.data.dragColumnMapping=r.state.columnIndexToMapping[d];var q=t.data.targetHiddenColumnIndex,Z=null;null!=t.data.targetHiddenColumnIndex&&(q=Number(t.data.targetHiddenColumnIndex),Z=r.state.columnIndexToMapping[q]);var Q=r._triggerGridEvent("headerDragOver",{dragColumn:d,dragColumnMapping:t.data.dragColumnMapping,leftColumn:null,leftColumnMapping:null,rightColumn:null,rightColumnMapping:null,toHiddenColumnArea:t.data.toHideArea,targetHiddenColumn:q,targetHiddenColumnMapping:Z});Q?(t.data.canDragDrop=!0,t.data.$proxy.removeClass("disabled")):(t.data.canDragDrop=!1,t.data.$proxy.addClass("disabled"))}else{t.data.toHideArea=!1,t.data.targetHiddenColumnIndex=null,o.removeClass("focused");var M=r.state.refreshbodycell.renderedColumnMappingList.length,j=X.closest(".headercell"),J=X.closest(".bodycell"),ee=X.closest(".footercell"),te=X.closest(".filtercell"),ae=X.closest(".pager"),ne=X.closest("."+ct);if(null!=j&&0!==j.length||null!=J&&0!==J.length||null!=ee&&0!==ee.length||null!=te&&0!==te.length||null!=ae&&0!==ae.length)for(var re=0;re<M;re++){var oe=r.state.refreshbodycell.renderedColumnMappingList[re],le=oe.columnIndex,ie=(r.state.columnIndexToMapping[le],r.state.columnWidthMap[le]);1!==W&&(ie*=r.state.refreshbodycell.fitRatio),$.length>0&&r.state.refreshbodycell.renderedColumnMappingList[$.length].columnIndex===le&&(ie-=V);var de=r.state.refreshbodycell.bodyCellPositionXForHeaderDrag[re],se=de+t.data.wrapperX;if(P>=se&&P<=se+ie){t.data.atColumnIndex=le,Math.abs(P-se)>Math.abs(P-(se+ie))?(t.data.after=!0,wt?t.data.$bar.css("left",de+ie+"px"):t.data.$bar.css("transform","translateX("+(de+ie)+"px)")):(t.data.after=!1,wt?t.data.$bar.css("left",de+"px"):t.data.$bar.css("transform","translateX("+de+"px)"));break}}else if(null!=ne&&0!==ne.length){t.data.after=!0;var le,oe=r.state.refreshbodycell.renderedColumnMappingList[M-1];le=null==oe?Math.min.apply(null,r.state.hiddenColumnIdxArr):oe.columnIndex,d===le?(t.data.atColumnIndex=null,t.data.canDragDrop=!1):(t.data.atColumnIndex=le,Y=!1)}else t.data.atColumnIndex=null,t.data.canDragDrop=!1}if(!1===t.data.toHideArea&&null!==t.data.atColumnIndex){Y?t.data.$bar.show():t.data.$bar.hide(),t.data.dragColumnMapping=r.state.columnIndexToMapping[d];var pe=e.inArray(t.data.atColumnIndex,r.state.visibleColumnIndexArr);t.data.after?(t.data.leftColumn=t.data.atColumnIndex,t.data.leftColumnMapping=r.state.columnIndexToMapping[t.data.atColumnIndex],t.data.rightColumn=r.state.visibleColumnIndexArr[pe+1],null==t.data.rightColumn?(t.data.lrightColumn=null,t.data.lrightColumnMapping=null):t.data.rightColumnMapping=r.state.columnIndexToMapping[t.data.rightColumn]):(t.data.leftColumn=r.state.visibleColumnIndexArr[pe-1],null==t.data.leftColumn?(t.data.leftColumn=null,t.data.leftColumnMapping=null):t.data.leftColumnMapping=r.state.columnIndexToMapping[t.data.leftColumn],t.data.rightColumn=t.data.atColumnIndex,t.data.rightColumnMapping=r.state.columnIndexToMapping[t.data.rightColumn]);var Q=r._triggerGridEvent("headerDragOver",{dragColumn:d,dragColumnMapping:t.data.dragColumnMapping,leftColumn:t.data.leftColumn,leftColumnMapping:t.data.leftColumnMapping,rightColumn:t.data.rightColumn,rightColumnMapping:t.data.rightColumnMapping,toHiddenColumnArea:t.data.toHideArea,targetHiddenColumn:null,targetHiddenColumnMapping:null});if(Q&&(t.data.canDragDrop=!0,t.data.$bar.removeClass("disabled"),t.data.$proxy.removeClass("disabled")),r.option.grouping&&r.option.grouping.by.length>0&&!0===r.option.grouping.useGroupColumnRearrange){var ue;t.data.after?(pe+=1,ue=r.state.visibleColumnIndexArr[pe]):ue=r.state.visibleColumnIndexArr[pe];var ce=r.state.groupingColumnIndexToMapping[d],Z=r.state.groupingColumnIndexToMapping[ue];if(r.option.grouping.useDragDropBetweenGroups)null!=ce&&null!=Z?(t.data.canDragDrop=!0,t.data.groupDragDrop=!0,t.data.$bar.removeClass("disabled"),t.data.$proxy.removeClass("disabled")):null==ce&&null==Z?(t.data.groupDragDrop=!1,t.data.canDragDrop=!0,t.data.$bar.removeClass("disabled"),t.data.$proxy.removeClass("disabled")):(t.data.groupDragDrop=!1,t.data.canDragDrop=!1,t.data.$bar.addClass("disabled"),t.data.$proxy.addClass("disabled"));else if(null!=ce&&null!=Z)t.data.canDragDrop=!0,t.data.groupDragDrop=!0,t.data.$bar.removeClass("disabled"),t.data.$proxy.removeClass("disabled");else if(null!=ce&&null==Z){t.data.groupDragDrop=!1;var ge=r.option.grouping.by,fe=ge[ge.length-1],he=(r._getColumnByKey(fe)||{}).columnIndex,me=e.inArray(he,r.state.visibleColumnIndexArr),ve=r.state.visibleColumnIndexArr[me+1],xe=r.state.columnIndexToKeyMap[ve];"undefined"===xe?(t.data.canDragDrop=!1,t.data.$bar.addClass("disabled"),t.data.$proxy.addClass("disabled")):(t.data.canDragDrop=!0,t.data.$bar.removeClass("disabled"),t.data.$proxy.removeClass("disabled"))}else if(null==ce&&null!=Z){t.data.groupDragDrop=!1;var ye=r.state.columnIndexToKeyMap[d];"undefined"===ye?(t.data.canDragDrop=!1,t.data.$bar.addClass("disabled"),t.data.$proxy.addClass("disabled")):(t.data.canDragDrop=!0,t.data.$bar.removeClass("disabled"),t.data.$proxy.removeClass("disabled"))}else t.data.groupDragDrop=!1,t.data.canDragDrop=!0,t.data.$bar.removeClass("disabled"),t.data.$proxy.removeClass("disabled")}!1===Q&&(t.data.canDragDrop=!1,t.data.$bar.addClass("disabled"),t.data.$proxy.addClass("disabled"))}else t.data.$bar.hide()}}}).on("mouseup"+o+n.key+n.eventns+" touchend"+o+n.key+n.eventns+" touchcancel"+o+n.key+n.eventns,s,function(t){function a(e,a){e._triggerGridEvent("headerDragDropEnd",{dropColumn:a.columnIndex,dropColumnMapping:a.dragColumnMapping,leftColumn:a.leftColumn,leftColumnMapping:a.leftColumnMapping,rightColumn:a.rightColumn,rightColumnMapping:a.rightColumnMapping,toHiddenColumnArea:t.data.toHideArea})}function n(e){return null!=e}var r=t.data.self,o=t.data.headercell,l=t.data.hiddenColArea,i=t.data.columnIndex;if(Ct.off(t.data.headerDragDropEventNS+r.key),r._enableHeaderSelect(!!r.option.enableHeaderSelect),l.removeClass("focused"),t.data.$proxy&&(t.data.$proxy.remove(),delete t.data.$proxy),t.data.$bar&&(t.data.$bar.remove(),delete t.data.$bar),t.data.scrollTimer&&(clearInterval(t.data.scrollTimer),t.data.scrollTimer=null),!1!==t.data.canDragDrop&&!1!==r._triggerGridEvent("headerDragDrop",{dropColumn:t.data.columnIndex,dropColumnMapping:t.data.dragColumnMapping,leftColumn:t.data.leftColumn,leftColumnMapping:t.data.leftColumnMapping,rightColumn:t.data.rightColumn,rightColumnMapping:t.data.rightColumnMapping,toHiddenColumnArea:t.data.toHideArea})){if(t.data.toHideArea){if(null==o)return;var d=r.state.columnIndexToMapping[i];if(null!=t.data.targetHiddenColumnIndex){var s=e.inArray(Number(t.data.targetHiddenColumnIndex),r.state.hiddenColumnIdxArr);null!=s&&-1!==s?(r.option.hiddenColumnOrderList.splice(s,0,i),r.state.hiddenColumnIdxArr.splice(s,0,i)):(r.option.hiddenColumnOrderList.push(i),r.state.hiddenColumnIdxArr.push(i))}else r.option.hiddenColumnOrderList.push(i),r.state.hiddenColumnIdxArr.push(i);return r.state.hiddenColumnIndexToMapping[i]=d,r.hideCol(i),void a(r,t.data)}if(null!==t.data.atColumnIndex){var p=t.data.atColumnIndex,u=e.inArray(i,r.state.visibleColumnIndexArr),c=e.inArray(p,r.state.visibleColumnIndexArr);if(i===p)return void a(r,t.data);if(t.data.after&&u===c+1)return void a(r,t.data);if(!t.data.after&&u+1===c)return void a(r,t.data);var d=r.state.columnIndexToMapping[i],g=r.state.columnIndexToMapping[p];if(r.option.grouping&&r.option.grouping.by.length>0&&!1===r.option.grouping.useDragDropBetweenGroups&&!0===r.option.grouping.useGroupColumnRearrange&&!1===t.data.groupDragDrop){var f=r.state.groupingColumnIndexToMapping[i],h=r._getColumnByKey(g.key);if(null!==f&&void 0!==f){var m=r.option.grouping.by,v=m[m.length-1],x=(r._getColumnByKey(v)||{}).columnIndex,y=e.inArray(x,r.state.visibleColumnIndexArr),C=r.state.visibleColumnIndexArr[y+1],I=r.state.columnIndexToKeyMap[C],_=e.inArray(d.key,r.option.grouping.by);r.option.grouping.by.splice(_,1),r.option.grouping.by.push(I),r.state.sortingRequired=!0}else if(h){var w=e.inArray(g.key,r.option.grouping.by);r.option.grouping.by.splice(w,0,d.key),r.option.grouping.by.splice(r.option.grouping.by.length-1,1),r.state.sortingRequired=!0}}var b=[],M={};if(null!=r.option.autoColumnIndex&&!0===r.option.autoColumnIndex)if(i>p){t.data.after&&(c+=1,p=r.state.visibleColumnIndexArr[c]);for(var S=p;S<i;S++)g=r.state.columnIndexToMapping[S],g.columnIndex=S+1,V(r,g,S,b,M);Y(r,b,M),d.columnIndex=p,r.option.columnMapping.splice(p,0,d),r.option.columnMapping.splice(i+1,1)}else{t.data.after||(c-=1,p=r.state.visibleColumnIndexArr[c]);for(var S=i+1;S<p+1;S++)g=r.state.columnIndexToMapping[S],g.columnIndex=S-1,V(r,g,S,b,M);Y(r,b,M),d.columnIndex=p,r.option.columnMapping.splice(p+1,0,d),r.option.columnMapping.splice(i,1)}else{if(u>c){t.data.after&&(c+=1,p=r.state.visibleColumnIndexArr[c]);for(var E,S=c;S<u;S++)E=r.state.columnIndexArr[S],g=r.state.columnIndexToMapping[E],g.columnIndex=r.state.columnIndexArr[S+1],V(r,g,S,b,M);Y(r,b,M)}else{t.data.after||(c-=1,p=r.state.visibleColumnIndexArr[c]);for(var E,S=u+1;S<c+1;S++)E=r.state.columnIndexArr[S],g=r.state.columnIndexToMapping[E],g.columnIndex=r.state.columnIndexArr[S-1],V(r,g,S,b,M);Y(r,b,M)}d.columnIndex=p}if(t.data.groupDragDrop){for(var T,D=r.option.grouping.by,F=[],R=0,k=D.length;R<k;R++)T=r._getColumnByKey(D[R]),F[T.columnIndex]=T.key;r.option.grouping.by=F.filter(n),r.state.sortingRequired=!0}r.updateOption(),a(r,t.data)}}})},At.prototype.headerGroupInfo=function(e){var t=this;return t.state.headerGroupByKey[e]||t.state.headerGroupById[e]||null},At.prototype.headerGroupGet=function(){var t=this,a=t.state.headerGroupArr;if(!arguments.length||!arguments[0])return[].concat(t.state.headerGroupArr);for(var n=e.makeArray(arguments),r=[],o=0;o<a.length;o++){var l=a[o],i=!1;e.each(n,function(e,t){if(d(t)){var a=!0;for(var n in t)t[n]!==l[n]&&(a=!1);a&&(i=!0)}}),i&&r.push(l)}return r},At.prototype.columnInfo=function(e){var t=this,a=t.state.columnIndexToMapping[e]||t._getColumnByKey(e);return!a&&t.state.multiColumnList.length&&"string"==typeof e&&e.indexOf("m")>=0&&(a=t._columnIndexKeyToMappingList(e)[0]),a||null},At.prototype.columnGet=function(){for(var t=this,a=t.option.columnMapping,n=e.makeArray(arguments),r=[],o=0;o<a.length;o++){var l=a[o],i=Number(l.columnIndex),s=!1;e.each(n,function(e,t){if(d(t)){var n=!0;for(var r in t)"columnIndex"===r?i!==t[r]&&(n=!1):"hidden"===r?ve(a,i)!==t[r]&&(n=!1):t[r]!==l[r]&&(n=!1);n&&(s=!0)}}),s&&r.push(l)}return r},At.prototype.isColumnHidden=function(e){return ve(this.option.columnMapping,e)},At.prototype.hideCol=function(e,t,a){var n=this;return null==t&&(t=!0),n.showCol(e,t,a)},At.prototype.showCol=function(t,a,n){var r=this;r.state.showColCalled=!0;var o=r.option,l=o.columnMapping;if(!0===t){for(var i=0;i<l.length;i++){var d=l[i];a?r.hideCol(d.key,a,!0):r.showCol(d.key,a,!0)}return r.updateOption(),Pe(r),void(r.state.showColCalled=!1)}"string"==typeof t?t=t.split(","):e.isArray(t)||(t=[t]);for(var s=!1,i=0;i<l.length;i++){var d=l[i];if(u(d.columnIndex)&&(e.inArray(d.columnIndex,t)>=0||e.inArray(d.key,t)>=0)){if(d.hidden=a||!1,a&&"conceal"!==a&&r.state.sortingInfo&&r.state.sortingInfo.length)for(var p=r.state.sortingInfo.length-1;p>=0;p--)if(r.state.sortingInfo[p].mappingId===d.id){s=!0;break}if((!0===a||"conceal"===a)&&null!=d.filterOption){!0===e.extend(!0,{},o.filter,d.filter).removeFilterOptionByHidden&&delete d.filterOption}}}!0!==n&&(s&&r.sortClear(),r.updateOption(),Pe(r),r.state.showColCalled=!1)},At.prototype._enableHeaderSelect=function(t){function a(e,t){return{from:Math.min(e.from,t.from,e.to,t.to),to:Math.max(e.from,t.from,e.to,t.to)}}function n(e){var t=e.getAttribute("data-alopexgrid-columnindex"),a=e.getAttribute("data-alopexgrid-tocolumnindex")||t;return{from:parseInt(t,10),to:parseInt(a,10)}}var r=this,o=".alopexgridHeaderSelectEngine",l=o+r.key+r.key,d=o+r.key;r.$wrapper.off(o).off(d),Ct.off(d).off(l);var s={self:r,info:null,offset:0,width:0};!0===t&&(r.state.headerSelection=r.state.headerSelection||{timer:{id:null}},s.info=r.state.headerSelection,r.$wrapper.on("mousedown"+o,".headercell",s,function(e){var t=e.data.self;t.$wrapper.off(d),Ct.off(d),1===e.which&&(At.renderUtil.isGridPointerActionProhibited(e.target)||(xe(t),e.data.startRange=n(this),e.data.info.from=e.data.startRange.from,t.$wrapper.on("mouseenter"+d,".headercell",s,function(e){var t=e.data.self;e.data.endRange=n(this);var r=a(e.data.startRange,e.data.endRange),o=e.data.info.from=r.from,l=e.data.info.to=r.to;t.$wrapper.find(".headercell").removeClass("header-selected").filter(function(){if(At.renderUtil.hasClass(this,"filtercell"))return!1;var e=this.getAttribute("data-alopexgrid-columnindex"),t=this.getAttribute("data-alopexgrid-tocolumnindex")||e;return e&&o<=e&&t<=l}).addClass("header-selected"),i(),e.data.preventSelectStartSet||(Ct.on("selectstart"+d+t.eventns,function(e){e.preventDefault()}),e.data.preventSelectStartSet=!0)}),e.data.offset=t.$wrapper.offset(),e.data.width=t.$wrapper.outerWidth(),Ct.on("keydown"+d+t.eventns,s,function(e){var t=e.data.self;switch(e.keyCode){case 27:t.$wrapper.off(d),Ct.off(d);var a=t.state.headerSelection.timer;a.id&&(clearInterval(a.id),a.id=null),xe(e.data.self)}}),Ct.on("mousemove"+d+t.eventns,s,function(e){var t=e.data.self,a=e.data.offset,n=e.data.width,r=t.state.headerSelection.timer;e.preventDefault(),r.id&&(clearInterval(r.id),r.id=null),e.pageX-a.left<50?r.id=setInterval(function(){t._scrollLeftEvent(1)},80):a.left+n-e.pageX<50&&(r.id=setInterval(function(){t._scrollRightEvent(1)},80))}),Ct.on("mouseup"+d+t.eventns,s,function(e){var t=e.data.self;t.$wrapper.off(d),Ct.off(d);var a=t.state.headerSelection.timer;a.id&&(clearInterval(a.id),a.id=null);var n=Math.min(t.state.headerSelection.from,t.state.headerSelection.to),r=Math.max(t.state.headerSelection.from,t.state.headerSelection.to);if(isNaN(n)||isNaN(r)||n===r)return void xe(e.data.self);t.state.headerSelection.from=n,t.state.headerSelection.to=r})))}),Ct.on("mousedown"+l+r.eventns,s,function(t){var a=e(t.target);a.closest("."+ct.split(" ").join(".")).attr("data-alopexgrid")!==t.data.self.key?xe(t.data.self):(a.closest(".bodycell").length||a.closest(".columnhiddenarea").length)&&xe(t.data.self)}))},At.prototype._refreshPagingUnit=function(t){var a=this;if(a._usePager()){var n={},r=a.pageInfo();for(var o in r)n[o]=r[o];if(a.option.paging&&n.pagerTotal){var l=(a.$pager,a.$pagerleft),i=a.$pagerright,d=[];if(s(n.pagerTotal))d.push(n.pagerTotal(n));else if("string"==typeof n.pagerTotal)d.push(n.pagerTotal);else if(n.pagerTotal){var u="<span>"+At.i18n("totalCount")+" : "+n.dataLength+"</span>";d.push(u)}l.html(d.join(""))}else a.$pagerleft.empty();if(a.option.paging&&n.enabled){var i=(a.$pager,a.$pagerright),g=[];if(s(n.pagerSelect))g.push(n.pagerSelect(n));else if("string"==typeof n.pagerSelect)g.push(n.pagerSelect);else if(n.pagerSelect){var f=[];e.isArray(n.pagerSelect)?f=f.concat(n.pagerSelect):f.push(10,20,30,50,100),a.state.userSetPerPage&&(f=f.concat(a.state.userSetPerPage));for(var h=0,m=f.length;h<m;h++)f[h]=Number(f[h]);n.perPage&&-1===e(f).index(Number(n.perPage))&&(f.push(Number(n.perPage)),a.state.userSetPerPage=a.state.userSetPerPage||[],a.state.userSetPerPage.push(Number(n.perPage))),"number"!=typeof n.perPage&&isNaN(Number(n.perPage))?n.perPage=Number(f[0]):n.hasOwnProperty("perPage")&&!isNaN(Number(n.perPage))&&(n.perPage=Number(n.perPage)),f.sort(function(e,t){return e-t}),g.push('<select class="perPage">');for(var v={},x=0;x<f.length;x++){var y=parseInt(f[x]);if(v[y])return;v[y]=!0,g.push('<option value="',y,'"'),Number(y)===Number(n.perPage)&&g.push(' selected="selected"'),g.push(">",String(y),"</option>")}g.push("</select>")}i.html(g.join(""))}else a.$pagerright.empty();var C=p(a.state.paginationList),I=a.option.paging&&!0===a.option.paging.hidePageList;if(!n.rowCount&&a.option.paging&&"auto"===a.option.paging.hidePageList&&(I=!0),I?a.$pagercenter.hide():a.$pagercenter.show(),n.enabled)for(var h=0,m=C.length;h<m;h++){var _=C[h],w=_.getAttribute("data-to-page");switch(w){case"first":case"prev":case"next":case"last":if(!_.children.length||!0===t){var b=document.createElement("a");for(b.className="page-set",b.href="#"+w,b.appendChild(document.createTextNode(a.pageInfo()[w]||""));_.firstChild;)_.removeChild(_.firstChild);_.appendChild(b)}break;case"list":var M=1,S=n.total,E=Number(n.pagerCount)||5,T=a.option.paging.hasOwnProperty("currentPageInCenter")?a.option.paging.currentPageInCenter:a.option.currentPageInCenter;if(T&&S-M>=E)M=n.current-(E/2|0),S=M+E-1,M<1&&(M=1,S=M+E-1),S>n.total&&(S=n.total,M=n.total-E+1);else{for(S=c(S,E);S<n.current;)M+=E,S+=E;S>n.total&&(S=n.total)}for(var D=_.getElementsByTagName("li"),F=[],R=0,k=D.length;R<k;R++)F.push(D[R]);for(var L=null,A=null,O=null,R=0,k=F.length;R<k;R++){var P=F[R];if(P.children.length){var B=parseInt(P.firstChild.getAttribute("href").split("#").pop());B<M?_.removeChild(P):S<B?_.removeChild(P):M<=B&&B<=S&&(L=null===L?B:Math.min(L,B),L===B&&(A=P),O=null===O?B:Math.max(O,B),B===n.current?P.className="page-item page-button current":P.className="page-item page-button")}else _.removeChild(P)}for(var G=M;G<=S;G++)if(!(null!==L&&G>=L&&G<=O)){var P=document.createElement("li");P.setAttribute("data-alopexgrid-pagenumber",G),P.className="page-item page-button",G===n.current&&(P.className+=" current"),P.innerHTML='<a class="page-set" href="#'+G+'">'+G+"</a>",null!==L&&G<L?_.insertBefore(P,A):_.appendChild(P)}}}else for(var h=0,m=C.length;h<m;h++){var _=C[h],w=_.getAttribute("data-to-page");"list"===w&&_.children&&_.children.length&&e(_).empty()}}},At.prototype._usePager=function(){var e=this.option.pager;return"function"==typeof e&&(e=e.call(this,this.pageInfo())),!0===e},At.prototype.pageInfo=function(){return this.state.pagingInfo},At.prototype.pageSet=function(e){var t=this,a=t.pageInfo();if("first"===e)e=1;else if("prev"===e){var n=ye(t,a);e=Math.max(a.current-n,1)}else if("next"===e){var n=ye(t,a);e=Math.min(a.current+n,a.total)}else"last"===e&&(e=a.total);if(e=Math.min(Math.max(1,Number(e)),a.total),e||(e=1),!1===t._triggerGridEvent("pageSet",{page:e,pageinfo:a}))return!1;t.option.paging.current=e,t._rowSelectAllUncheck(),t._scrollerReset(),Re(t),t.calcAndRedraw(),t._triggerGridEvent("pageSetEnd",{page:e,pageinfo:t.pageInfo()})},At.prototype._setProgressPosition=function(){var e=this;if(e.state.$progress&&e.option.absoluteProgressPosition){var t=e.option.absoluteProgressPosition,a={},n=e.$root.outerWidth()/2,r=e.$root.outerHeight()/2,o=e.state.$progress.filter(".progress"),l=o.outerWidth()/2,i=o.outerHeight()/2;if("centerOnly"===t);else if(s(t)){var d=t.call(o,e.$root,o);d&&null!=d.left&&(n=d.left),d&&null!=d.top&&(r=d.top)}else n-=l,r-=i;a.left=n+"px",a.top=r+"px",o.css(a)}},At.prototype._displayProgress=function(t){var a=this;if(!0===t){var n=null==a.option.progressText?At.i18n("progress"):a.option.progressText;if(s(n)&&(n=n.call(a)),a.state.$progress)return void("string"!=typeof n&&"number"!=typeof n||a.state.$progress.filter(".progress").html(n));var r=e("<div></div>").addClass("progress alopexgrid-progress").addClass(a.option.progressStyleclass||"").css(a.option.progressCss||{}),o=e("<div></div>").addClass("modal alopexgrid-progress-modal").css(a.option.modalCss||{});"string"!=typeof n&&"number"!=typeof n||r.html(n),a.$root.append(o,r),a.state.$progress=o.add(r),a._setProgressPosition()}else!1===t&&a.state.$progress&&(a.state.$progress.remove(),a.state.$progress=null)},At.prototype._refreshProgressOptionFromArguments=function(t){var a=this,n=e.makeArray(t),r=e.grep(n,function(e){return d(e)})[0];r&&(r.hasOwnProperty("progressText")&&(a.option.progressText=r.progressText),r.hasOwnProperty("progressStyleclass")&&(a.option.progressStyleclass=r.progressStyleclass))},At.prototype.refreshProgress=function(){var e=this;e._refreshProgressOptionFromArguments(arguments),e.state.$progress&&e._displayProgress(!0)},At.prototype.showProgress=function(e){var t=this;t.state.progressStackCount=t.state.progressStackCount||0,t.state.progressStackCount+=1,t._refreshProgressOptionFromArguments(arguments),t._displayProgress(!0),s(e)&&setTimeout(function(){e.call(t),t.hideProgress()},t.option.progressDelay||10)},At.prototype.hideProgress=function(e){var t=this;t.state.progressStackCount=t.state.progressStackCount||0,t.state.progressStackCount-=1,t._refreshProgressOptionFromArguments(arguments),(!0===e||t.state.progressStackCount<=0)&&(t._displayProgress(!1),t.state.progressStackCount=0)},At.prototype._showProgress=function(e,t,a){var n=this,r=null;"function"==typeof e&&(r=a?function(){e.call(n,function(){n.hideProgress()})}:function(){e.call(n),n.hideProgress()}),t?n.showProgress(r):(n.showProgress(),r?r():n.hideProgress())},At.defaultOption.renderMapping.string={renderer:function(e,t,a,n,r){var o=document.createElement("span");At.renderUtil.addDefaultRendererClass(o);var l=e;At.renderUtil.attributeToElement(a.attr,o);var i=At.renderUtil.renderRuleToArray(e,t,a,n,r);"string"==typeof i&&(i=[i]);var d=!1;if(i&&i.length)for(var s=0,p=i.length;s<p;s++){var u=At.renderUtil.normalizeRuleObject(i[s],r);u&&"object"==typeof u?u.value===e&&(u.hasOwnProperty("html")?(l=u.html,d=!0):l=u.hasOwnProperty("text")?u.text:e):"string"==typeof u&&("comma"===u?l=null==e?"":At.renderUtil.addThousandsSeperator(e):"ellipsis"===u&&(o.style.textOverflow="ellipsis",o.style.whiteSpace="nowrap",o.style.overflow="hidden"))}if(null==l&&(l=""),d)o.innerHTML=l;else{var c=document.createTextNode(l);o.appendChild(c)}return o}},At.defaultOption.renderMapping.text={renderer:function(e,t,a,n,r){var l=document.createElement("input");if(At.renderUtil.addDefaultRendererClass(l),l.type="text",l.name=(r.option.editableNameWithKey?n.key:null)||o(),a.styleclass){var i=a.styleclass;"function"==typeof i&&(i=i.call(r,e,t,a,n,r)||!1),"string"==typeof i&&At.renderUtil.addClass(l,i)}var d=e;At.renderUtil.attributeToElement(a.attr,l),a.readonly&&(l.readOnly=!0,l.className+=" disabled");var s=At.renderUtil.renderRuleToArray(e,t,a,n,r);if(s&&s.length)for(var p=0,u=s.length;p<u;p++){var c=At.renderUtil.normalizeRuleObject(s[p],r)
;c&&"object"==typeof c&&c.value===e&&(d=c.hasOwnProperty("text")?c.text:e)}return l.value=null==d?"":d,l},editedValue:function(e,t,a,n,r){return e.getElementsByTagName("INPUT")[0].value}},At.defaultOption.renderMapping.select={renderer:function(e,t,a,n,r){var l=document.createElement("select");if(At.renderUtil.addDefaultRendererClass(l),At.renderUtil.attributeToElement(a.attr,l),l.name=(r.option.editableNameWithKey?n.key:null)||o(),a.readonly&&(l.disabled=!0,l.className+=" disabled"),a.styleclass){var i=a.styleclass;"function"==typeof i&&(i=i.call(r,e,t,a,n,r)||!1),"string"==typeof i&&At.renderUtil.addClass(l,i)}var d=At.renderUtil.renderRuleToArray(e,t,a,n,r);if(d&&d.length)for(var s=0,p=d.length;s<p;s++){var u=At.renderUtil.normalizeRuleObject(d[s],r),c=document.createElement("option");if(c.value=u.value,u.hasOwnProperty("html"))c.innerHTML=u.html;else{var g=document.createTextNode(u.text||u.value);c.appendChild(g)}u.value===e&&(c.selected=!0),l.appendChild(c)}return l},editedValue:function(e,t,a,n,r){return e.getElementsByTagName("SELECT")[0].value}},At.defaultOption.renderMapping.radio={renderer:function(e,t,a,n,r){var l=document.createDocumentFragment(),i=At.renderUtil.renderRuleToArray(e,t,a,n,r),d=(r.option.editableNameWithKey?n.key:null)||o(),s=!1,p=null,u=null;if(i&&i.length)for(var c=0,g=i.length;c<g;c++){var f=At.renderUtil.normalizeRuleObject(i[c],r),h=document.createElement("label");At.renderUtil.addDefaultInputWrapperClass(h,"radio");var m=document.createElement("input"),v=document.createElement("span");if(At.renderUtil.addDefaultRendererClass(m),0===c&&(p=m,u=h),m.type="radio",m.name=d,m.value=f.value,a.readonly&&(m.disabled=!0,h.className+=" disabled"),a.styleclass){var x=a.styleclass;"function"==typeof x&&(x=x.call(r,e,t,a,n,r)||!1),"string"==typeof x&&At.renderUtil.addClass(m,x)}if(At.renderUtil.attributeToElement(a.attr,m),f.value===e&&(m.checked=!0,At.renderUtil.addClass(h,"checked"),s=!0),f.hasOwnProperty("html"))v.innerHTML=f.html;else{var y=document.createTextNode(f.hasOwnProperty("text")?f.text:f.value);v.appendChild(y)}h.appendChild(m),h.appendChild(v),l.appendChild(h)}return!s&&p&&u&&(p.checked=!0,At.renderUtil.addClass(u,"checked")),l},editedValue:function(e,t,a,n,r){for(var o=e.getElementsByTagName("input"),l=0,i=o.length;l<i;l++)if(o[l].checked)return o[l].value;return""},toggle:function(e,t,a,n,r){for(var o=e.getElementsByTagName("input"),l=e.getElementsByTagName("label"),i=0,d=0,s=l.length;d<s;d++)At.renderUtil.removeClass(l[d],"checked");for(var d=0,s=o.length;d<s;d++)if(o[d].checked){i=d;break}i+=1,i>=o.length&&(i=0),o[i].checked=!0,At.renderUtil.addClass(o[i].parentNode,"checked")}},At.defaultOption.renderMapping.checkbox={renderer:function(e,t,a,n,r){var l=document.createElement("label");At.renderUtil.addDefaultInputWrapperClass(l,"checkbox");var i=document.createElement("input");if(i.type="checkbox",i.name=(r.option.editableNameWithKey?n.key:null)||o(),At.renderUtil.addDefaultRendererClass(i),a.readonly&&(i.disabled=!0,l.className+=" disabled"),a.styleclass){var d=a.styleclass;"function"==typeof d&&(d=d.call(r,e,t,a,n,r)||!1),"string"==typeof d&&At.renderUtil.addClass(i,d)}var s=At.renderUtil.renderRuleToArray(e,t,a,n,r);if(s&&s.length)for(var p=0,u=s.length;p<u;p++){var c=At.renderUtil.normalizeRuleObject(s[p],r);c.checked&&c.value===e&&(i.checked=!0,At.renderUtil.addClass(l,"checked")),!0===c.checked?i.setAttribute("data-checked-value",c.value):!1===c.checked&&i.setAttribute("data-unchecked-value",c.value)}return l.appendChild(i),l},editedValue:function(e,t,a,n,r){var o=e.getElementsByTagName("INPUT")[0];return o.getAttribute(o.checked?"data-checked-value":"data-unchecked-value")||""},toggle:function(e,t,a,n,r){var o=e.getElementsByTagName("input")[0];o.checked=!o.checked,At.renderUtil[o.checked?"addClass":"removeClass"](o.parentNode,"checked")}},At.defaultOption.renderMapping.href={renderer:function(e,t,a,n,r){var o=document.createElement("a");if(At.renderUtil.addDefaultRendererClass(o),At.renderUtil.attributeToElement(a.attr,o),o.value=e,o.href=e||"#",o.text=a.text||e,a.styleclass){var l=a.styleclass;"function"==typeof l&&(l=l.call(r,e,t,a,n,r)||!1),"string"==typeof l&&At.renderUtil.addClass(o,l)}return o}},At.defaultOption.renderMapping.textarea={renderer:function(e,t,a,n,r){var l=document.createElement("textarea");At.renderUtil.addDefaultRendererClass(l);if(At.renderUtil.attributeToElement(a.attr,l),l.value=e,l.name=(r.option.editableNameWithKey?n.key:null)||o(),a.readonly&&(l.setAttribute("readonly",""),l.className+=" disabled"),a.styleclass){var i=a.styleclass;"function"==typeof i&&(i=i.call(r,e,t,a,n,r)||!1),"string"==typeof i&&At.renderUtil.addClass(l,i)}return l},editedValue:function(e,t,a,n,r){return e.getElementsByTagName("TEXTAREA")[0].value}},At.prototype._generateRenderTargetData=function(){var t=this,a=t.state.data,n=[],r=[],o=[],l={enabled:null,current:null,total:null,dataLength:null,rowCount:null,pageRowCount:null,pageDataLength:null,perPage:null,pagerCount:null,pagerSelect:null,pagerTotal:null,first:null,prev:null,next:null,last:null},i=t.option.paging||{};l.pagerSelect=i.pagerSelect,l.pagerTotal=i.pagerTotal,l.first=i.first||null,l.prev=i.prev||null,l.next=i.next||null,l.last=i.last||null;var s=i.customPaging,p=l.enabled=!!i.enabled;i.enabledByPager&&(p=l.enabled=!!t.option.pager),t.option.tree&&t.option.tree.useTree&&(p=l.enabled=!1),s||null!=i.perPage||(p=l.enabled=!1),l.pagerCount=i.pagerCount||10,l.current=(s?s.current:i.current)||1,l.perPage=s?s.perPage:i.perPage,null==l.perPage&&(l.perPage=a.length),l.pageMoveTempo=i.pageMoveTempo,t._generateFilterColumnList();var u=t.option.rowOption&&d(t.option.rowOption.filter)&&!e.isEmptyObject(t.option.rowOption.filter)||t.state.filterColumnMappingList.length,c=t._hasPinnedData(),g=!!(t.option.tree&&t.option.tree.useTree&&t.state.treeInfo),f=t._isGroupEnabled(),h=t._isGroupHeaderEnabled(),m=t._isGroupFooterEnabled(),v=null,x=null,y=null,C=null;if(f){for(var I=[],_=0,w=t.option.grouping.by.length;_<w;_++)I.push({});if(h){v={},y={};var b=null;if(e.isArray(t.option.grouping.useGroupHeader)?b=t.option.grouping.useGroupHeader:!0===t.option.grouping.useGroupHeader&&(b=t.option.grouping.by),b){for(var M=0,w=b.length;M<w;M++)null!=t.state.groupingKeyMap[b[M]]&&(v[b[M]]=!0,y[b[M]]=!0);if(d(t.option.grouping.foldedGroupHeader))for(var S in t.option.grouping.foldedGroupHeader)!0===t.option.grouping.foldedGroupHeader[S]&&(y[S]=!0)}}if(m){x={},C={};var b=null;if(e.isArray(t.option.grouping.useGroupFooter)?b=t.option.grouping.useGroupFooter:!0===t.option.grouping.useGroupFooter&&(b=t.option.grouping.by),b){for(var M=0,w=b.length;M<w;M++)null!=t.state.groupingKeyMap[b[M]]&&(x[b[M]]=!0,C[b[M]]=!0);if(d(t.option.grouping.foldedGroupFooter))for(var S in t.option.grouping.foldedGroupFooter)!0===t.option.grouping.foldedGroupFooter[S]&&(C[S]=!0)}}}var E=t.state.groupHeaderDataMapById=t.state.groupHeaderDataMapById||{},T=t.state.groupFooterDataMapById=t.state.groupFooterDataMapById||{},D=0,F=!(!f||!h&&!m),R=!(!t.option.grouping||!t.option.grouping.useGrouping||!0!==t.option.grouping.showGroupSummaryOnly);null==t.state.removeFilterColumnMapping&&(t.state.removeFilterColumnMapping={});for(var k=0,L=a.length;k<L;k++){var A=a[k];if(delete A._index.row,delete A._index.target,A._state.filtered=!1,u){if(t._doesDataPassFilter(A))continue;r.push(A),A._state.filtered=!0}if((!c||!t.state.pinnedDataIdMap[A._index.id])&&(!g||!A._index.parentid||!0===t._isTreeParentNodeExpanded(A))){if(F){for(var O=[],_=0,w=t.option.grouping.by.length;_<w;_++){var S=t.option.grouping.by[_],P=t._getGroupingRange(k,S);O.push(P)}if(m)for(var _=t.option.grouping.by.length-1;_>=0;_--){var B=I[_];if(B.id&&B.id!==O[_].id&&(x[t.option.grouping.by[_]]||C[t.option.grouping.by[_]]&&t._isGroupRangeCollapsed(B))){var G=T[B.id]||{_index:{},_state:{groupFooter:B.id}};G._index.id||t._giveDataId(G),G._state.filtered=u,T[B.id]=G,n.push(G)}}if(h)for(var _=0,w=t.option.grouping.by.length;_<w;_++)if(O[_].id&&I[_].id!==O[_].id&&(v[t.option.grouping.by[_]]||y[t.option.grouping.by[_]]&&t._isGroupRangeCollapsed(O))){var H=E[O[_].id]||{_index:{},_state:{groupHeader:O[_].id}};H._index.id||t._giveDataId(H),E[O[_].id]=H,H._state.filtered=u,n.push(H)}for(var _=0,w=t.option.grouping.by.length;_<w;_++)I[_]=O[_]}n.push(A),A._index.target=D++}}if(null!=t.state.removeFilterColumnMapping&&null!=t.state.filterColumnMappingList&&t.state.filterColumnMappingList.length>0){var N=Object.keys(t.state.removeFilterColumnMapping).map(function(e){return t.state.removeFilterColumnMapping[e]});-1!==e.inArray(!0,N)&&e.each(t.state.removeFilterColumnMapping,function(e,a){var n=t.state.removeFilterColumnMapping[e];if(null!=n&&!0===n){delete t.state.columnIdToMapping[e].filterOption,delete t.state.removeFilterColumnMapping[e],t.state.filterColumnMappingList=t.state.filterColumnMappingList.filter(function(t){return t.id!==e}),t.state.mergedFilterOptionList=t.state.mergedFilterOptionList.filter(function(t){return t.id!==e})}})}if(m)for(var _=t.option.grouping.by.length-1;_>=0;_--)if(I[_].id&&(x[t.option.grouping.by[_]]||C[t.option.grouping.by[_]]&&t._isGroupRangeCollapsed(I[_]))){var G=T[I[_].id]||{_index:{},_state:{groupFooter:I[_].id}};G._index.id||t._giveDataId(G),T[I[_].id]=G,G._state.filtered=u,n.push(G)}s?l.total=s.total:n.length?l.total=Math.floor(n.length/l.perPage)+(n.length%l.perPage?1:0):l.total=0,(l.total===1/0||isNaN(l.total))&&(l.total=n.length?1:0),l.current=Math.min(l.total,Math.max(1,l.current));var $=null,K=null;p?($=(l.current-1)*l.perPage,K=l.current*l.perPage-1):l.current=1;var W=0,U=0,V=0;if(c)for(var Y=0,X=t.state.pinnedDataIdList.length;Y<X;Y++){var z=t.state.pinnedDataIdList[Y],k=t.state.dataIdToIndexMap[z],A=t.state.data[k];z&&A&&(A._index.row=U++,o.push(A),W++,A._state.groupFooter||A._state.groupHeader||V++)}for(var j={},Y=0,X=n.length;Y<X;Y++)if(!p||s||!(Y<$||K<Y)){var A=n[Y];if(f){if(R&&!A._state.groupFooter&&!A._state.groupHeader)continue;var q=t._getTopmostCollapsedRange(A);if(q){var O=t._getGroupingRangeByData(A),Z=!!(null!=x&&x[q.groupKey]||null!=v&&v[q.groupKey]);if((null!=C&&C[q.groupKey]||null!=y&&y[q.groupKey])&&(Z=!0),O&&O.id===q.id&&Z);else if(Z){if(O&&O.groupDepth>q.groupDepth)continue;if(!O)continue}else{if(j[q.id])continue;j[q.id]=!0}}}A._index.row=U++,o.push(A),A._state.groupFooter||A._state.groupHeader||V++}var Q=D+W,J=n.length+W;t.option.paging&&!0===t.option.paging.countGroupSummary&&(Q=J,V=U),l.dataLength=s?s.dataLength:Q,l.rowCount=J,l.pageDataLength=V,l.pageRowCount=U,l.pageDataList=o,u?t.state.filteredDataList=r:delete t.state.filteredDataList,t.state.targetDataList=n,t.state.renderTargetDataList=o,t.state.pagingInfo=l},At.prototype._getRenderedDataFromRenderedIndex=function(e){return this.state.renderTargetDataList[e]||null},At.prototype._rowDragStart=function(t){function a(e,t){var a=e.self,n=e.selfTo,r=e.dragOverData||null,o=r?e.self._dataGetByIndex({row:r._index.row-1}):null,l=r?e.self._dataGetByIndex({row:r._index.row+1}):null,i=e.atDataIndex<0,d=null;if(e.treeInfo)if(e.center)d=r;else{var s,p,u,c,g=e.atRowIndex+(e.after?1:0);null!==n?(s=n._dataGetByIndex({row:g-1}),p=n._dataGetByIndex({row:g}),u=n._getTreeNodeDepth(s),c=n._getTreeNodeDepth(p)):(s=a._dataGetByIndex({row:g-1}),p=a._dataGetByIndex({row:g}),u=a._getTreeNodeDepth(s),c=a._getTreeNodeDepth(p)),s&&(d=null!==n?n.treeGetParent(s)[0]:a.treeGetParent(s)[0],u>c?d=null!==n?n.treeGetParent(n.treeGetParent(s,{recursive:!0})[0])[0]:a.treeGetParent(a.treeGetParent(s,{recursive:!0})[0])[0]:u<c&&(d=s))}return{dragDataList:e.dragdata,data:r,aboveData:o,belowData:l,insertAbove:!e.center&&!i&&!e.after,insertBelow:!e.center&&!i&&!!e.after,childOf:d,barVisible:i,$grid:e.selfTo?e.selfTo.$root:e.self.$root,toAnotherGrid:!!e.selfTo,cancelled:!0===t}}var n=this,r=e.event.fix(t);"touchstart"===t.type&&(r=t.touches[0]),t.preventDefault();var o=".alopexgriddragdropevent",l=e(t.target).closest(".bodycell"),d=l.attr("data-alopexgrid-dataid"),s=n._dataGetByIndex({id:d});if(null!=s){var p={};if(p.self=n,p.selfTo=null,p.rowDragDropEventNS=o,p.wrapperY=n.$wrapper.offset().top,p.$proxy=null,p.$bar=null,p.dragdata=[s],!0===n.option.multiRowDragDrop){var u=n.dataGet({_state:{selected:!0}});if(null!=u&&0!=u.length)for(var c=u.length-1;c>=0;c--)if(u[c]==s){u=e.map(u,function(e){if(null!=e._index.row)return e}),p.dragdata=u;break}}p.atDataIndex=null,p.canDragDrop=!0,p.after=!1,p.scrollTimer=null,p.lastHoverGrid=null,p.prevX=r.pageX,p.prevY=r.pageY,p.treeInfo=n.state.treeInfo||null,Ct.off(o+n.key),Ct.on("keydown"+o+n.key+n.eventns,p,function(e){switch(e.keyCode){case 27:Ct.off(e.data.rowDragDropEventNS+n.key),e.data.$proxy&&(e.data.$proxy.remove(),delete e.data.$proxy),e.data.$bar&&(e.data.$bar.remove(),delete e.data.$bar),e.data.scrollTimer&&(clearInterval(e.data.scrollTimer),e.data.scrollTimer=null),null!==e.data.atColumnIndex&&(e.data.atColumnIndex=null)}}),Ct.on("mousemove"+o+n.key+n.eventns+" touchmove"+o+n.key+n.eventns,p,function(t){var n=t,r=t.target;if("touchmove"===t.type&&(n=t.originalEvent.touches[0],r=document.elementFromPoint(n.clientX,n.clientY)),t.data.prevX!==n.pageX||t.data.prevY!==n.pageY){t.data.prevX=n.pageX,t.data.prevY=n.pageY,t.preventDefault(),i();var o=t.data.self,l=t.data.$proxy,d=t.data.$bar;if(null==l){l=e("<div>"),l.addClass(ct+" alopexgrid-proxy alopexgrid-dragdrop-row alopexgrid-refer-"+o.key);var s=e('<div class="'+ct+'">').css("overflow","visible"),p=e('<div class="wrapper">').css("overflow","visible"),u=o.state.refreshbodycell.renderedColumnMappingList,c=0,g=0,f=t.data.dragdata.length>10?10:t.data.dragdata.length,h=u.length,m=.5,v=1;o.option.proxyRatio&&o.option.proxyRatio.row&&(m=o.option.proxyRatio.row.width,v=o.option.proxyRatio.row.height);for(var x=0,y=f;x<y;x++){var C=t.data.dragdata[x];c=0;for(var I=0;I<h;I++){var _,w=u[I],b=e(o._createCell(C,w)),M=Math.round(o.state.renderTargetMappingInfo.fitRatio*parseInt(w.width)*m);null!=C._index&&(_=o.state.rowHeightMapByDataId[C._index.id]*v),(isNaN(_)||null==_)&&(_=o.state.rowHeight*v),b.css({top:g+"px",left:c+"px",width:M+"px",height:_+"px","z-index":-1*x}),c+=M,b.appendTo(p)}g+=parseInt(o.state.rowHeight/3)}s.append(p),l.append(s),l.appendTo(document.body),t.data.$proxy=l}null==d&&(d=e("<div>"),d.addClass("alopexgrid-dragdrop-row-indicator"),t.data.$bar=d);var S=e(r),E=S.closest("."+ct);t.data.canDragDrop=!0,t.data.$bar.removeClass("disabled"),t.data.$proxy.removeClass("disabled");var T=!1;if(E&&0!==E.length&&void 0!=E.attr("id")&&E.attr("id")!=o.$root.attr("id")&&0==S.closest(".alopexgrid-enlarge-content").length){var D="#"+E.attr("id");o=e(D).__alopexgrid(),t.data.$bar.prependTo(E.children(".wrapper")),t.data.wrapperY=o.$wrapper.offset().top,!1===o.option.enableDropData?T=!0:t.data.selfTo=o}else o=t.data.self,t.data.$bar.prependTo(o.$wrapper),t.data.wrapperY=o.$wrapper.offset().top,t.data.selfTo=null;l.css({top:n.pageY+"px",left:n.pageX+"px"}),t.data.scrollTimer&&(clearInterval(t.data.scrollTimer),t.data.scrollTimer=null),t.data.treeExpandTimer&&(clearTimeout(t.data.treeExpandTimer),t.data.treeExpandTimer=null);var F=o.state.refreshbodycell.bodyCellStartY,R=o.state.refreshbodycell.bodyCellEndY;t.data.atRowIndex=null,t.data.atDataIndex=null,t.data.dragOverData=null;var k=n.pageY;if(k<=t.data.wrapperY+F){var L=Math.ceil(Math.abs(k-(t.data.wrapperY+F))/25),A=function(){o.state.scrollyMoveable&&o._scrollUpEvent(L)};A(),t.data.scrollTimer=setInterval(A,100)}else if(k>=t.data.wrapperY+R){var L=Math.ceil(Math.abs(k-(t.data.wrapperY+R))/25),A=function(){o.state.scrollyMoveable&&o._scrollDownEvent(L)};A(),t.data.scrollTimer=setInterval(A,100)}else{for(var O=0,P=o.state.refreshbodycell.renderedDataList.length;O<P;O++){var B=o.state.refreshbodycell.renderedDataList[O],G=B._index.data,H=o.state.refreshbodycell.bodyCellPositionY[O],N=H+t.data.wrapperY,$=o.state.rowHeightMapByDataId[B._index.id]||o.state.rowHeight;if(k>=N){if(k<=N+$){t.data.dragOverData=B,t.data.atDataIndex=G,t.data.atRowIndex=B._index.row;var K=Math.abs(k-N),W=Math.abs(k-(N+$)),U=K-W;if(U>0?(t.data.after=!0,wt?t.data.$bar.css("top",H+$+"px"):t.data.$bar.css("transform","translateY("+(H+$)+"px)")):(t.data.after=!1,wt?t.data.$bar.css("top",H+"px"):t.data.$bar.css("transform","translateY("+H+"px)")),t.data.treeInfo){var V=$-Math.min(2*o.state.rowHeight/3,2*$/3);t.data.$bar.css("height",""),t.data.center=Math.abs(U)<V,t.data.center?(wt?t.data.$bar.css("top",H+"px"):t.data.$bar.css("transform","translateY("+H+"px)"),t.data.$bar.css("height",$+"px"),t.data.$bar.addClass("alopexgrid-dragdrop-parentrow-indicator"),o._isTreeLeafNode(B)||o._isTreeNodeExpanded(B)||(t.data.treeExpandTimer=setTimeout(function(){o.expandTreeNode(B)},o.option.tree.dragdropExpandDelay||0))):t.data.$bar.removeClass("alopexgrid-dragdrop-parentrow-indicator");var Y=null;if(t.data.center)Y=o.state.data[t.data.atDataIndex];else{var X=t.data.atRowIndex;t.data.after&&(X+=1);var z=o._dataGetByIndex({row:X-1}),j=o._dataGetByIndex({row:X}),q=o._getTreeNodeDepth(z),Z=o._getTreeNodeDepth(j);Y=null,z&&(Y=o.treeGetParent(z)[0],q<Z&&(Y=z))}var B=t.data.dragdata[0];Y&&(B===Y||o._isTreeNodeIncludeChild(B,Y))&&(T=!0)}break}O==P-1&&(t.data.after=!0,t.data.atDataIndex=G,t.data.atRowIndex=B._index.row,wt?t.data.$bar.css("top",H+$+"px"):t.data.$bar.css("transform","translateY("+(H+$)+"px)"))}}if(0==o.state.refreshbodycell.renderedDataList.length){t.data.after=!1,t.data.atDataIndex=-1,t.data.atRowIndex=-1;var Q=o.state.headerHeight;0==Q&&(Q=1),wt?t.data.$bar.css("top",Q+"px"):t.data.$bar.css("transform","translateY("+Q+"px)")}}null!=t.data.atDataIndex?t.data.$bar.show():t.data.$bar.hide();o._triggerGridEvent("rowDragOver",a(t.data))||(T=!0),T&&(t.data.canDragDrop=!1),t.data.canDragDrop||(t.data.$bar.addClass("disabled"),t.data.$proxy.addClass("disabled"))}}).on("mouseup"+o+n.key+n.eventns+" touchend"+o+n.key+n.eventns+" touchcancel"+o+n.key+n.eventns,p,function(e){var t=e.data.self,n=e.data.selfTo;if(Ct.off(e.data.rowDragDropEventNS+t.key),e.data.$proxy&&(e.data.$proxy.remove(),delete e.data.$proxy),e.data.$bar&&(e.data.$bar.remove(),delete e.data.$bar),e.data.scrollTimer&&(clearInterval(e.data.scrollTimer),e.data.scrollTimer=null),!1!==e.data.canDragDrop)if(t._triggerGridEvent("rowDragDrop",a(e.data)),e.data.center&&null!=e.data.atDataIndex){var r=!1;e.data.atDataIndex<0&&(e.data.atDataIndex=0,r=!0);for(var o=t.state.data[e.data.atDataIndex],l=e.data.dragdata,i=l.length-1;i>0;i--)for(var d=l[i],s=i-1;s>=0;s--){var p=l[s],u=t.treeGetParent(d,{recursive:!0});u.indexOf(p)>-1&&l.splice(i,1)}for(var c=0,i=0;i<l.length;i++){if(m=l[i],null!==n&&(o=n.state.data[e.data.atDataIndex]),o&&(m===o||t._isTreeNodeIncludeChild(m,o)))return void t._triggerGridEvent("rowDragDropEnd",a(e.data,!0));if(null!==n){var g=void 0==o?"":o[n.option.tree.idKey];w=m._index.id,m=t._addTreeChildToList(m);for(var s=0;s<m.length;s++)m[s][n.option.tree.expandedKey]=t.state.treeOption.expandedValue[m[s]._state.expandedTreeNode?0:1];m=At.trimData(m),t.dataDelete({_index:{id:w}}),void 0!==o&&0==r?(m[0][t.option.tree.parentIdKey]=g,n.dataAdd(m,{_index:{id:o._index.id}})):(n.dataAdd(m,{_index:{data:c}}),c+=m.length)}else t.treeDataMove(m,o)}t._triggerGridEvent("rowDragDropEnd",a(e.data,!1))}else if(null!==e.data.atDataIndex){var r=!1;e.data.atDataIndex<0&&e.data.atRowIndex<0&&(e.data.atDataIndex=0,e.data.atRowIndex=0,r=!0);var f=e.data.atDataIndex,h=e.data.atRowIndex,m=e.data.dragdata[0],v=e.data.after;if(v&&(f+=1,h+=1),e.data.treeInfo){for(var l=e.data.dragdata,i=l.length-1;i>0;i--){for(var d=l[i],s=i-1;s>=0;s--){var p=l[s],u=t.treeGetParent(d,{recursive:!0});u.indexOf(p)>-1&&(l[i].flag=!0)}l[i].flag&&l.splice(i,1)}for(var i=l.length-1;i>=0;i--){m=l[i];var x,y,C,I;null!==n?(x=n._dataGetByIndex({row:h-1}),y=n._dataGetByIndex({row:h}),C=n._getTreeNodeDepth(x),I=n._getTreeNodeDepth(y)):(x=t._dataGetByIndex({row:h-1}),y=t._dataGetByIndex({row:h}),C=t._getTreeNodeDepth(x),I=t._getTreeNodeDepth(y));var o=null;if(x&&(o=null!==n?n.treeGetParent(x)[0]:t.treeGetParent(x)[0],C>I?o=null!==n?n.treeGetParent(n.treeGetParent(x,{recursive:!0})[0])[0]:t.treeGetParent(t.treeGetParent(x,{recursive:!0})[0])[0]:C<I&&(o=x)),o&&(m===o||t._isTreeNodeIncludeChild(m,o)))return void t._triggerGridEvent("rowDragDropEnd",a(e.data,!0));if(null!==n){var g=null==o?"":o[n.option.tree.idKey];w=m._index.id,m=t._addTreeChildToList(m);for(var s=0;s<m.length;s++)m[s][n.option.tree.expandedKey]=t.state.treeOption.expandedValue[m[s]._state.expandedTreeNode?0:1];m=At.trimData(m),t.dataDelete({_index:{id:w}}),m[0][t.option.tree.parentIdKey]=g,n.dataAdd(m,{_index:{data:f}})}else t.treeDataMove(m,o,{_index:{row:h}}),m._index.row<h&&(h-=t._addTreeChildToList(m).length)}return void t._triggerGridEvent("rowDragDropEnd",a(e.data,!1))}var _=m._index.data,w=_>f?_+1:_;null!==n?(w=m._index.id,1==e.data.dragdata.length?(m=At.trimData(m),t.dataDelete({_index:{id:w}}),n.dataAdd(m,{_index:{data:f}})):e.data.dragdata.length>1&&(t.dataDelete(e.data.dragdata),m=At.trimData(e.data.dragdata),n.dataAdd(m,{_index:{data:f}}))):1==e.data.dragdata.length?(t.state.data.splice(f,0,m),t.state.data.splice(w,1),Re(t),t.sortClear(),t.calcAndRedraw()):e.data.dragdata.length>1&&(t.dataMove({_state:{selected:!0}},{_index:{data:f}}),t.state.data.length==f?t.dataMove({_state:{selected:!0}},{_index:{data:f-1}},v):t.dataMove({_state:{selected:!0}},{_index:{data:f}})),t._triggerGridEvent("rowDragDropEnd",a(e.data,!1))}})}},At.prototype._rowResizeStart=function(t,a,n){if(t&&t.type){var r=this;if(!r.state.rowResizing&&(t=e.event.fix(t),"dblclick"!==t.type)){var o=e.event.fix(t);"touchstart"===t.type&&(o=t.originalEvent.touches[0]),r.state.$rowResizeBar&&(r.state.$rowResizeBar.remove(),r.state.$rowResizeBar=null);var l=".alopexgridrowresizeevent";r.state.rowHeightMapByDataId=r.state.rowHeightMapByDataId||{};var i=e(t.target),d=i.closest(".bodycell"),s=r._dataGetByIndex({row:a}),p=r.state.columnIndexToMapping[n],u=s._index.id,c=r.state.groupRowspanned&&p.rowspan?r._getGroupingRangeByMapping(s._index.data,p):null;if(c)for(var g=c.member.length;g>0;)if(s=c.member[--g],null!=s._index.row&&r.state.refreshbodycell&&r.state.refreshbodycell.renderedDataIdMap&&r.state.refreshbodycell.renderedDataIdMap[s._index.id]){u=s._index.id,a=s._index.row;break}var f=parseInt(o.pageY),h=d.offset().top-r.$wrapper.offset().top+d.outerHeight()-1,m=e('<div class="resize-align row-resize-align">');wt?m.css("top",h+"px"):m.css("transform","translateY("+h+"px)");var v=m.clone();v.addClass("resize-align-reference"),r.$wrapper.append(v,m),r.state.$rowResizeBar=m;var x=parseInt(r.state.rowHeightMapByDataId[u]||r.state.rowHeight),y={self:r,$bar:m,$pos:v,startPageY:f,startTop:h,rowIndex:a,dataId:u,$cell:d,moveDiff:0,prevHeight:x,rowResizeEventNS:l};r._triggerGridEvent("UIRowResizeStart",{row:a,height:x}),Ct.off(l+r.key+r.eventns),Ct.on("keydown"+l+r.key+r.eventns,y,function(e){switch(e.keyCode){case 27:Ct.off(e.data.rowResizeEventNS+r.key+r.eventns),e.data.$pos&&(e.data.$pos.remove(),delete e.data.$pos),e.data.$bar&&(e.data.$bar.remove(),delete e.data.$bar)}}),Ct.on("mousemove"+l+r.key+r.eventns+" touchmove"+l+r.key+r.eventns,y,Ce).on("mouseup"+l+r.key+r.eventns+" touchend"+l+r.key+r.eventns+" touchcancel"+l+r.key+r.eventns,y,Ie)}}},At.prototype._getContentFitRowHeight=function(t){var a=this,n=a._dataGetByIndex(t&&t._index?t._index:{row:t});if(!n)return null;for(var r=a.state.rowHeight,o=0,l=0,i=a.state.visibleColumnMappingList.length;l<i;l++){var d=a.state.visibleColumnMappingList[l],s=a.state.columnFitWidthById[d.id]||parseInt(d.width),p=a.state.rowHeight;if(d.colspan||d.colspanTo){var u=a._getColspanUpto(n,d);if(u>=d.columnIndex)for(var c=d.columnIndex+1;c<=u;c++){var g=a.state.columnIndexToMapping[c];g&&me(g)&&(s+=a.state.columnFitWidthById[g.id]||0)}}var f=a._createCell(n,d),h=e(f);f.style.overflow="visible",f.style.height="auto",f.style.width=s+"px",f.style.left=2*-s+"px",f.style.top=2*-p+"px",a.$wrapper[0].appendChild(f);var m=f.scrollHeight;if(m&&!isNaN(Number(m))&&(r=Math.max(r,m)),d.multi&&f.children&&f.children.length){for(var v=0,x=0,y=0,C=f.children.length;y<C;y++){var I=f.children[y];"DIV"===I.tagName&&At.renderUtil.hasClass(I,"multicell")&&(I.style.height="auto",x++,v=Math.max(v,e(I).outerHeight()||0))}r=Math.max(r,v*x+(h.outerHeight()-h.height()||0))}if(d.rowspan&&null!==a.state.groupingLookupTable&&a.state.groupingLookupTable.hasOwnProperty(d.key)){var _=a.groupDataGet({_index:{id:n._index.id}},d.key);if(_&&"string"==typeof _[0][d.key]&&_[0][d.key].indexOf("\n")>-1){for(var w=1,b=0;b<_.length;b++)_[b]._index.row&&w++;r=0==o?parseInt(r/w):Math.max(r/w,o),o=r}}h.remove()}return r||null},At.prototype._getRowHeight=function(e){var t=this;return(e?t.state.rowHeightMapByDataId[e._index.id]:null)||t.state.rowHeight},At.prototype._setRowHeight=function(e,t){var a=this;if("content"===t&&a.$wrapper.is(":visible")&&(t=a._getContentFitRowHeight(e)),null!=t&&t>0){var n=a._dataGetByIndex(e&&e._index?e._index:{row:e});a.state.rowHeightMapByDataId[n._index.id]=parseInt(t)}},At.prototype.setRowHeight=function(t,a){if(null!=a||!e.isNumeric(t)&&"content"!==t||(a=t,t={}),null!=a){var n=this,r=n._dataGet(t);if(r&&r.length){for(var o=0,l=r.length;o<l;o++){var i=r[o];n._setRowHeight(i,a)}n.redraw()}}},At.prototype._hasPinnedData=function(t){var a=this;return"string"===e.type(t)?e.inArray(t,a.state.pinnedDataIdList)>=0:e.isArray(a.state.pinnedDataIdList)&&a.state.pinnedDataIdList.length},At.prototype.rowFix=function(e,t){var a=this;a.option.rowFixCount=e,"number"==typeof t&&(a.option.rowFixShowFrom=Math.min(e,t)),a._refreshBoard(!0)},At.prototype.rowUnfix=function(){var e=this;e.option.rowFixCount=0,e.option.rowFixShowFrom=null,e._refreshBoard(!0)},At.prototype.addPin=function(t){var a=this;a.state.pinnedDataIdList=a.state.pinnedDataIdList||[],a.state.pinnedDataIdMap=a.state.pinnedDataIdMap||{};var n=!1;if(t&&!e.isEmptyObject(t)){var r=a._dataGet(t);if(r.length)for(var o=0,l=r.length;o<l;o++){var i=r[o];i&&i._index.id&&!a.state.pinnedDataIdMap[i._index.id]&&(a.state.pinnedDataIdList.push(i._index.id),a.state.pinnedDataIdMap[i._index.id]=!0,n=!0)}}n&&a.calcAndRedraw()},At.prototype.dataPin=function(e){var t=this;return t.state.pinnedDataIdList=null,t.state.pinnedDataIdMap=null,t.addPin(e)},At.prototype.dataUnpin=function(t){var a=this,n=!1;if(!t||e.isEmptyObject(t))a.state.pinnedDataIdList&&a.state.pinnedDataIdList.length&&(a.state.pinnedDataIdList=null,a.state.pinnedDataIdMap=null,n=!0);else{var r=a._dataGet(t);if(r&&r.length&&a.state.pinnedDataIdList&&a.state.pinnedDataIdList.length)for(var o=0,l=r.length;o<l;o++){var i=r[o];if(i&&a.state.pinnedDataIdMap[i._index.id]){var d=e.inArray(i._index.id,a.state.pinnedDataIdList);d>=0&&(a.state.pinnedDataIdList.splice(d,1),delete a.state.pinnedDataIdMap[i._index.id],n=!0)}}}n&&a.calcAndRedraw()},At.prototype._rowUnfocusAll=function(){var t=this;t.state.focusedDataId&&e.each(t.state.focusedDataId,function(e,a){var n=t._dataGetByIndex({id:a});n&&(n._state.focused=!1,t.rowElementGet({_index:{id:a}},Ht.cache).removeClass("focused"))})},At.prototype._rowFocus=function(e){var t=this;t.state.focusedDataId=t.state.focusedDataId||[];var a=null;if(e&&e.nodeType&&e.className.indexOf("bodycell")>=0?a=t._dataGetByIndex({id:e.getAttribute("data-alopexgrid-dataid")}):e&&e.index?a=t._dataGetByIndex(e.index):e&&(a=t._dataGet(e)[0]),a&&!a._state.focused){t._rowUnfocusAll(),t.state.focusedDataId=[];var n=[a];if(t.state.groupRowspanned&&(!0===t.option.rowspanGroupFocus||"number"==typeof t.option.rowspanGroupFocus||"string"==typeof t.option.rowspanGroupFocus)){var r=t.option.grouping.by[0];"number"==typeof t.option.rowspanGroupFocus?r=t.option.grouping.by[t.option.rowspanGroupFocus]:"string"==typeof t.option.rowspanGroupFocus?r=t.option.rowspanGroupFocus:!0===t.option.rowspanGroupFocus&&(r=t.state.topmostGroupRowspanKey);var o=t._getGroupingRange(a._index.data,r);if(o){var l=o.from,i=o.to;n=[];for(var d=l;d<=i;d++)n.push(t.state.data[d])}}for(var s=0,p=n.length;s<p;s++)n[s]._state.focused=!0,t.state.focusedDataId.push(n[s]._index.id),t.rowElementGet({_index:{id:n[s]._index.id}},Ht.cache).addClass("focused")}},At.prototype._rowSelectAllUncheck=function(){var e=this;e.state.selectAll=!1;for(var t=e.$wrapper[0].querySelectorAll(".headercell.selector-column"),a=0,n=t.length;a<n;a++){var r=t[a],o=r.getElementsByTagName("input")[0];if(o&&At.renderUtil.hasClass(o,"selector-column-input")){o.checked=!1;var l=o.parentElement;l&&"LABEL"===String(l.tagName).toUpperCase()&&At.renderUtil.hasClass(l,"alopexgrid-input-checkbox-wrapper")&&At.renderUtil.removeClass(l,"checked")}}},At.prototype._rowSelectAllCheck=function(){var e=this;e.state.selectAll=!0;for(var t=e.$wrapper[0].querySelectorAll(".headercell.selector-column"),a=0,n=t.length;a<n;a++){var r=t[a],o=r.getElementsByTagName("input")[0];if(o&&At.renderUtil.hasClass(o,"selector-column-input")){o.checked=!0;var l=o.parentElement;l&&"LABEL"===String(l.tagName).toUpperCase()&&At.renderUtil.hasClass(l,"alopexgrid-input-checkbox-wrapper")&&At.renderUtil.addClass(l,"checked")}}},At.prototype._rowSelectAll=function(t,a){var n=this;if(n.state.data&&n.state.data.length&&n.state.renderTargetDataList&&n.state.renderTargetDataList.length&&!n.state.rowSingleSelect){if(t){if(t=e.event.fix(t),!e(a||t.currentTarget).hasClass("selector-column"))return;if("INPUT"!==t.target.tagName)return}var r=e(a||t.target),o=a||t.currentTarget?e(a||t.currentTarget):r.closest(".cell"),l=o.find("input"),i=l.prop("checked"),d=[];if(!1===n._triggerGridEvent("dataSelect",{datalist:n.state.renderTargetDataList,select:i}))return!1;for(var s=0,p=n.state.renderTargetDataList.length;s<p;s++){var u=n.state.renderTargetDataList[s];u._state.groupFooter||u._state.groupHeader||(n.state.testRowAllowSelect&&!1===n.option.rowOption.allowSelect(u)?u._state.selected=!1:u._state.selected=i,d.push(u))}n.state.selectAll=i,n.state.selectAll||(n.state.ctrlDataIndexMap={});var c=[],g=n.state.refreshbodycell.renderedDataList;if(n.state.cellCacheEnabled&&(g=n.state.renderTargetDataList),g&&g.length){for(var f=0;f<g.length;f++)c.push(g[f]._index.data);n._refreshClassForSelectedChange(c)}n._triggerGridEvent("dataSelectEnd",{datalist:n.state.renderTargetDataList,select:i}),n._triggerGridEvent("dataChanged",{type:"select",datalist:n.state.renderTargetDataList})}},At.prototype._filterGridRowSelect=function(e,t){var a=this;a.option;if(!a._noData()&&null!=e&&e.length){for(var n=[],r=0,o=e.length;r<o;r++)if(null!=e[r]){var l=e[r]._index.data,i=a.state.data[l];null!=l&&i&&(l=Number(l),i._state.selected=t,n.push(l))}a._refreshClassForSelectedChange(n)}},At.prototype.rowSelect=function(t,a){var n=this;n.option;if(!n._noData()&&(!t||!t.nodeType||e.isNumeric(t.getAttribute("data-alopexgrid-dataindex")))){var r=t.nodeType?[].concat(n.state.data[t.getAttribute("data-alopexgrid-dataindex")]||[]):n._dataGet(t);if(r&&r.length){var o=null,l={},i=n.option.rowSelectOption.disableSelectByKey;if(1==i&&(n.state.ctrlDataIndexMap={},l={}),!n.state.rowSingleSelect||0!=!!t.rowSingleCtrlKey&&1!=!!i||(r=[r[0]],r[0]&&(o=r[0]._index.data)),t.rowSingleShiftKey&&n.state.lastSelectedDataId&&0==!!i){r=[r[0]],r[0]&&(o=r[0]._index.data);var d=n._dataGet({_index:{id:n.state.lastSelectedDataId}})[0],s=d._index.data;r=s>o?n.state.data.slice(o,s+1):n.state.data.slice(s,o+1)}var p=[];if(!1===n._triggerGridEvent("dataSelect",{datalist:r,select:a}))return!1;for(var u=0,c=r.length;u<c;u++)if(null!=r[u]){var g=r[u]._index.data,f=n.state.data[g];if(null!=g&&f&&(g=Number(g),!f._state.groupFooter&&!f._state.groupHeader)){var h=!!f._state.selected,m="toggle"==a?!f._state.selected:!!a,v=n.option.rowSelectOption.allowSingleUnselect;0!=!!i||v&&n.state.rowSingleSelect&&0==!!t.rowSingleShiftKey&&0==!!t.rowSingleCtrlKey||(m=!!(!0==!!t.rowSingleShiftKey&&!1===n.state.rowSingleSelect||(1==!!t.rowSingleShiftKey||0==!!t.rowSingleCtrlKey)&&n.state.rowSingleSelect)||m),1!=!!t.rowSingleShiftKey&&0!=!!t.rowSingleCtrlKey||0!=!!i||(l[g]=!0),h!==m&&p.push(g),n.state.testRowAllowSelect&&!1===n.option.rowOption.allowSelect(f)&&(m=!1)
;var x=n.option.rowSelectOption.groupSelect;if(n.state.columnRowspanned&&x)for(var y=H(n.state.columnRowspanIndex,g),C=y.from,I=y.to,_=C;_<I;_++)n.state.data[_]._state.selected=m,!1===m&&(n.state.selectAll=!1),p.push(_);else if(n.state.groupRowspanned&&(x||"number"==typeof x)&&0==n.state.rowSingleSelect){var w="string"==typeof n.option.rowspanGroupSelect?x:n.option.grouping.by[0];"number"==typeof x?w=n.option.grouping.by[x]:!0===x&&(w=n.state.topmostGroupRowspanKey);var b=n._getGroupingRange(g,w);if(b)for(var C=b.from,I=b.to,_=C;_<=I;_++)n.state.data[_]._state.selected=m,!1===m&&(n.state.selectAll=!1),p.push(_)}else f._state.selected=m,!1===m&&(n.state.selectAll=!1),p.push(g);if(n.state.groupRowspanned){var w=n.state.topmostGroupRowspanKey,b=n._getGroupingRange(g,w);if(b)for(var C=b.from,I=b.to,_=C;_<=I;_++)p.push(_)}n.state.dataCompositor&&n.state.dataCompositor(n,f)}}if(!n.state.rowSingleSelect&&1==!!t.rowSingleShiftKey)for(var M=n.state.ctrlDataIndexMap,u=0;u<n.state.data.length;u++){var S=n.state.data[u];0==!!M[u]&&0==!!l[u]&&0==!!i&&(p.push(Number(u)),S._state.selected=!1,n.state.dataCompositor&&n.state.dataCompositor(n,S))}if(n.state.rowSingleSelect&&(0==!!t.rowSingleCtrlKey||1==!!i)){for(var u=0;u<n.state.data.length;u++){var S=n.state.data[u];!1==!!S._state.selected||u===o||0!=!!t.rowSingleShiftKey&&1!=!!i?1==!!t.rowSingleShiftKey&&0==!!l[u]&&0==!!i&&(p.push(Number(u)),S._state.selected=!1,n.state.dataCompositor&&n.state.dataCompositor(n,S)):(p.push(Number(u)),S._state.selected=!1,n.state.dataCompositor&&n.state.dataCompositor(n,S))}if(n.state.groupRowspanned)if(wt)n.$wrapper.find(".cell-rowspan-contain-selected").removeClass("selected cell-rowspan-contain-selected");else for(var E=n.$wrapper[0].getElementsByClassName("cell-rowspan-contain-selected");E.length;)At.renderUtil.removeClass(E[0],"selected"),At.renderUtil.removeClass(E[0],"cell-rowspan-contain-selected")}n.option.cellRefreshOnRowSelect?n._refreshBoard({dataIndexList:p}):n._refreshClassForSelectedChange(p);var T=t.nodeType?[n.state.data[t.getAttribute("data-alopexgrid-dataindex")]][0]:n._dataGet(t)[0];if(!1===t.rowSingleShiftKey&&0==!!i&&T&&(n.state.lastSelectedDataId=T._index.id),!n.state.rowSingleSelect&&!1===t.rowSingleShiftKey)for(var D=n.dataGet({_state:{selected:!0}}),u=0;u<D.length;u++){var S=D[u]._index.data;0==!!n.state.ctrlDataIndexMap[S]&&(n.state.ctrlDataIndexMap[Number(S)]=!0)}n.state.disableSelectDataIdMap&&n._checkRowSelectAll(),n.state.customCtrlKey=!1,n.state.customShiftKey=!1,n._triggerGridEvent("dataSelectEnd",{datalist:r,select:a}),n._triggerGridEvent("dataChanged",{type:"select",datalist:r})}}},At.prototype._refreshClassForSelectedChange=function(e){for(var t=this,a=[],n={},r={},o=[],l={},i={},d={},s=0,p=e.length;s<p;s++){var u=e[s];if(null!=u){var c=t.state.data[u];if(!d[c._index.id]){d[c._index.id]=!0;var g=t._dataGetByIndex({row:c._index.row-1}),f=t._dataGetByIndex({row:c._index.row+1});c._state.selected?(a.push(c),g&&(n[g._index.id]=g),f&&(r[f._index.id]=f)):(o.push(c),g&&(l[g._index.id]=g),f&&(i[f._index.id]=f))}}}for(var h in l)for(var c=l[h],m=t.rowElementGet({_index:{id:h}},Ht.cache),v=0,x=m.length;v<x;v++)At.renderUtil.removeClass(m[v],"nextrow-selected");for(var h in i)for(var c=i[h],m=t.rowElementGet({_index:{id:h}},Ht.cache),v=0,x=m.length;v<x;v++)At.renderUtil.removeClass(m[v],"prevrow-selected");for(var h in n)for(var c=n[h],m=t.rowElementGet({_index:{id:h}},Ht.cache),v=0,x=m.length;v<x;v++)At.renderUtil.addClass(m[v],"nextrow-selected");for(var h in r)for(var c=r[h],m=t.rowElementGet({_index:{id:h}},Ht.cache),v=0,x=m.length;v<x;v++)At.renderUtil.addClass(m[v],"prevrow-selected");for(var s=0,p=o.length;s<p;s++){var c=o[s];delete t.state.ctrlDataIndexMap[c._index.data];for(var m=t.rowElementGet({_index:{id:c._index.id}},Ht.cache),v=0,x=m.length;v<x;v++)if(At.renderUtil.removeClass(m[v],"selected"),t.state.groupRowspanned&&At.renderUtil.removeClass(m[v],"cell-rowspan-contain-selected"),At.renderUtil.hasClass(m[v],"selector-column")){var y=m[v].getElementsByTagName("input")[0];y&&(y.checked=!1,y.alopexgridChecked=!1,y.removeAttribute("checked"));var C=m[v].getElementsByTagName("label")[0];C&&At.renderUtil.removeClass(C,"checked")}}for(var s=0,p=a.length;s<p;s++)for(var c=a[s],m=t.rowElementGet({_index:{id:c._index.id}},Ht.cache),v=0,x=m.length;v<x;v++)if(At.renderUtil.addClass(m[v],"selected"),t.state.groupRowspanned&&At.renderUtil.hasClass(m[v],"cell-rowspan-column")&&At.renderUtil.addClass(m[v],"cell-rowspan-contain-selected"),At.renderUtil.hasClass(m[v],"selector-column")){var y=m[v].getElementsByTagName("input")[0];y&&(y.checked=!0,y.alopexgridChecked=!0,y.setAttribute("checked","checked"));var C=m[v].getElementsByTagName("label")[0];C&&At.renderUtil.addClass(C,"checked")}},At.prototype._checkRowSelectAll=function(){var t=this,a=e(".headercell .selector-checkbox.selector-column-input").length;if(0==!!t.state.rowSingleSelect&&a){var n=t.option.grouping.useGroupHeader||t.option.grouping.useGroupFooter,r=_e(t.state.renderTargetDataList),o=1==!!n?we(t.state.renderTargetDataList):t.state.renderTargetDataList.length;o-=Object.keys(t.state.disableSelectDataIdMap).length,t.state.selectAll=r==o&&0!=o,1==t.state.selectAll?t._rowSelectAllCheck():t._rowSelectAllUncheck()}},At.prototype._getProcessedPageUpLength=function(e){var t=this,a=t.state.refreshbodycell&&t.state.refreshbodycell.renderedPinnedDataList?t.state.refreshbodycell.renderedPinnedDataList.length:0,n=0,r=t.state.refreshbodycell&&t.state.refreshbodycell.renderedDataList?t.state.refreshbodycell.renderedDataList[a]:t.state.renderTargetDataList[t.state.renderFromRenderedIndex+a],o=t.state.refreshbodycell.bodyCellStartY,l=t.state.refreshbodycell.bodyCellEndY;if(a)for(var i=0,d=t.state.refreshbodycell.renderedPinnedDataList.length;i<d;i++){var s=t.state.refreshbodycell.renderedPinnedDataList[i];o+=t._getRowHeight(s)}for(var p=a,u=t.state.refreshbodycell.renderedDataList.length;p<u;p++){var s=t.state.refreshbodycell.renderedDataList[p],c=t.state.refreshbodycell.bodyCellPositionY[p];if(null!=c){var g=t._getRowHeight(s),f=c+g-1;if(o<=c&&f<=l){r=s;break}}}if(r=t.state.renderTargetDataList[(r?r._index.row:0)-1],t.state.renderFromRenderedIndex){if(r){for(var h=l-o,m=r._index.row,v=m,x=0;m>=0;){var r=t.state.renderFromRenderedIndex[m],g=t._getRowHeight(r);if(x+g>h)break;x+=g,m--}if(m<0)for(m=0,v++;x<=h&&v<t.state.renderTargetDataList.length;){var r=t.state.renderFromRenderedIndex[v],g=t._getRowHeight(r);if(x+g>h)break;x+=g,v++}m=Math.max(0,m),v=Math.min(t.state.renderTargetDataList.length,v),n=Math.abs(v-m)}}else n=(t.state.cellSelection?t.state.cellSelection.focusRenderedIndex:0)||t.state.refreshbodycell.renderedDataList.length;var y=!0===e?null:t.option.verticalScrollMoveTempo;return"function"==typeof y&&(y=y(n,a)),y||n},At.prototype._getProcessedPageDownLength=function(e){var t=this,a=t.state.refreshbodycell&&t.state.refreshbodycell.renderedPinnedDataList?t.state.refreshbodycell.renderedPinnedDataList.length:0,n=t._getFullyRenderedRowLength()-a,r=!0===e?null:t.option.verticalScrollMoveTempo;return"function"==typeof r&&(r=r(n,a)),r||n},At.prototype._getFullyRenderedRowLength=function(e){var t=this,a=0,n=0,r=t.state.refreshbodycell&&t.state.refreshbodycell.renderedPinnedDataList?t.state.refreshbodycell.renderedPinnedDataList.length:0;if(t.state.refreshbodycell&&t.state.refreshbodycell.renderedDataList){var o=t.state.refreshbodycell.bodyCellStartY,l=t.state.refreshbodycell.bodyCellEndY;if(r)for(var i=0,d=t.state.refreshbodycell.renderedPinnedDataList.length;i<d;i++){var s=t.state.refreshbodycell.renderedPinnedDataList[i];o+=t._getRowHeight(s)}for(var p=r,u=t.state.refreshbodycell.renderedDataList.length;p<u;p++){var s=t.state.refreshbodycell.renderedDataList[p],c=t.state.refreshbodycell.bodyCellPositionY[p];if(null!=c){var g=t._getRowHeight(s),f=c+g-1;o<=c&&f<=l?a++:e&&(c<o&&o<=f?n+=1:c<=l&&l<f&&(n+=1))}}}return a+n+r},At.prototype._getProcessedPageLeftLength=function(){var e=this,t=e.state.refreshbodycell&&e.state.refreshbodycell.renderedFixedColumnMappingList?e.state.refreshbodycell.renderedFixedColumnMappingList.length:0,a=0,n=e.state.refreshbodycell.bodyCellStartX,r=e.state.refreshbodycell.bodyCellEndX,o=dt(e,e.state.renderFromColumnIndex,1);if(t){for(var l=0,i=e.state.refreshbodycell.renderedFixedColumnMappingList.length;l<i;l++){var d=e.state.refreshbodycell.renderedFixedColumnMappingList[l];n+=e.state.columnWidthMap[d.columnIndex]}o=dt(e,e.state.refreshbodycell.renderedColumnMappingList[i].columnIndex,1)}if(null!=o){var s=r-n,p=o,u=0,c=e.state.columnWidthMap[o];for(u+c<=s&&(u+=c,a++);u<s;){var g=dt(e,p,1);if(null==g||g<0)break;if(c=e.state.columnWidthMap[g],u+c>s)break;u+=c,p=g,a++}for(;u<s;){var f=st(e,o,1);if(null==f||f>e.state.maxColumnIndex)break;if(c=e.state.columnWidthMap[f],u+c>s)break;u+=c,o=f,a++}}var h=e.option.horizontalScrollMoveTempo;return"function"==typeof h&&(h=h(a,t)),h||a},At.prototype._getProcessedPageRightLength=function(){var e=this,t=e.state.refreshbodycell&&e.state.refreshbodycell.renderedFixedColumnMappingList?e.state.refreshbodycell.renderedFixedColumnMappingList.length:0,a=e._getFullyRenderedColumnLength()-t,n=e.option.horizontalScrollMoveTempo;return"function"==typeof n&&(n=n(a,t)),n||a},At.prototype._getFullyRenderedColumnLength=function(e){var t=this,a=0,n=0,r=t.state.refreshbodycell&&t.state.refreshbodycell.renderedFixedColumnMappingList?t.state.refreshbodycell.renderedFixedColumnMappingList.length:0;if(t.state.refreshbodycell&&t.state.refreshbodycell.renderedColumnMappingList){var o=t.state.refreshbodycell.bodyCellStartX,l=t.state.refreshbodycell.bodyCellEndX;if(r)for(var i=0,d=t.state.refreshbodycell.renderedFixedColumnMappingList.length;i<d;i++){var s=t.state.refreshbodycell.renderedFixedColumnMappingList[i];o+=t.state.columnWidthMap[s.columnIndex]}for(var p=r,u=t.state.refreshbodycell.renderedColumnMappingList.length;p<u;p++){var s=t.state.refreshbodycell.renderedColumnMappingList[p],c=t.state.refreshbodycell.bodyCellPositionX[p];if(null!=c){var g=t.state.columnWidthMap[s.columnIndex],f=c+g-1;o<=c&&f<=l?a++:e&&(c<o&&o<=f?n+=1:c<=l&&l<f&&(n+=1))}}}return a+n+r},At.prototype._generateTranslatex=function(e){var t=this,a=0,n=0;if(null!=t.state.fixedColumnMapping&&(n=t.state.fixedColumnMapping.length),null!=t.state.standardColumnWidthMap){var r,o;for(var l in t.state.standardColumnWidthMap){if(r=t.state.standardColumnWidthMap[l],o=t.state.columnIndexArr[t._columnIndexOrder(l)-n],e<=0||o>=e)break;a+=r}}return a},At.prototype._getColumnIndexByBlankWidth=function(e,t){var a=this,n=0,r=0,o=0;if(null!=a.state.fixedColumnMapping&&(o=a.state.fixedColumnMapping.length),null!=a.state.standardColumnWidthMap)for(var l in a.state.standardColumnWidthMap)if((n+=a.state.standardColumnWidthMap[l])*a.state.scrollxRatio>=e){if(r=a.state.columnIndexArr[a._columnIndexOrder(l)-o],null==r&&(r=a.state.columnIndexArr[0]),!0===t)return-((n-a.state.standardColumnWidthMap[l])*a.state.scrollxRatio-e)/a.state.scrollxRatio;break}return r},At.prototype.__getRenderedIndexByBlankHeight=function(e,t){var a=this,n=a.state,o=n.pagingInfo,l=Math.max(o.pageRowCount,a.option.rowPadding>0?a.option.rowPadding:0),i=n.renderTargetDataList,d=n.rowHeightMapByDataId,s=0,p=n.renderFromRenderedIndex;if(0===(wt?r(d):Object.keys(d).length)){if(p=Math.floor(e/(a.state.scrollyRatio*a.state.rowHeight)),!0===t){var u=e/(a.state.scrollyRatio*a.state.rowHeight)-p;return a.state.rowHeight*u}return p}for(var c=0;c<l;c++){var g=i[c],f=0;if(f=g&&g._index&&d[g._index.id]?d[g._index.id]:n.rowHeight,s+=f,p=c,Math.ceil(n.scrollyRatio*s*n.scrollRatioConst)/n.scrollRatioConst>=e){if(!0===t){var u=f*a.state.scrollyRatio,h=a.state.scrollyRatio*(s-f);return Math.ceil((e-h)/a.state.scrollyRatio)}break}}return p},At.prototype.__getRowHeightByRenderedIdx=function(e){var t=this,a=t.state,n=(t.pageInfo(),e),r=a.rowHeightMapByDataId,o=0;if(e<=0)return o;if(r)for(var l in r){var i=a.dataMapById[l];i&&null!=i._index.row&&i._index.row<e&&(o+=r[l],n-=1)}return n>0&&(o+=n*a.rowHeight),o},At.prototype.__getAllRowHeight=function(){var e=this,t=e.state,a=e.pageInfo(),n=a.pageRowCount,r=t.rowHeightMapByDataId,o=0;if(r)for(var l in r){var i=t.dataMapById[l];i&&null!=i._index.row&&(o+=r[l],n-=1)}return o+=n*t.rowHeight};var Kt={string:!0,number:!0};At.prototype._columnShowFromEnabled=function(){if(!0===this.option.disableScrolledFix)return!1;var e=typeof this.option.columnFixUpto,t=typeof this.option.columnFixShowFrom;return!(!Kt[e]||!Kt[t])},At.prototype._limitRenderFromByFixCount=function(){var e=this;if(e.state.columnFixShowFromColumnIndex=null,!e.option.disableScrolledFix&&(null!=e.option.rowFixShowFrom&&e.option.rowFixCount&&(e.state.renderFromRenderedIndex=Math.max(e.state.renderFromRenderedIndex,e.option.rowFixShowFrom)),e._columnShowFromEnabled())){var t=e._columnIndexKeyToMappingList(e.option.columnFixUpto)[0],a=e._columnIndexKeyToMappingList(e.option.columnFixShowFrom)[0];t&&a&&(e.state.renderFromColumnIndex=Math.max(e.state.renderFromColumnIndex,a.columnIndex),e.state.columnFixShowFromColumnIndex=a.columnIndex)}},At.prototype._refreshTimerActivate=function(t){function a(){d._refreshBoard()}function n(){d._refreshBoard(),d.state.refreshTimer.basic=window.requestAnimationFrame(n)}function r(){d.state.refreshTimer.position.row=d.state.renderFromRenderedIndex,d.state.refreshTimer.position.col=d.state.renderFromRenderedIndex,d.state.refreshTimer.position.tx=d.state.translateX,d.state.refreshTimer.position.ty=d.state.translateY,d.state.refreshTimer.position.sx=d.state.scrollxEnd,d.state.refreshTimer.position.sy=d.state.scrollyEnd}function o(){return d.state.refreshTimer.position.row!=d.state.renderFromRenderedIndex||d.state.refreshTimer.position.col!=d.state.renderFromRenderedIndex||d.state.refreshTimer.position.tx!=d.state.translateX||d.state.refreshTimer.position.ty!=d.state.translateY||d.state.refreshTimer.position.sx!=d.state.scrollxEnd||d.state.refreshTimer.position.sy!=d.state.scrollyEnd}function l(a){e.isArray(a)&&(a="scrollbarx"===t?a[0]:a[1]);var n=o();d._refreshScrollbar(),n&&(d.state.refreshTimer.scroll&&clearTimeout(d.state.refreshTimer.scroll),d.state.refreshTimer.scroll=setTimeout(function(){d.state.refreshTimer.scrollCache&&(clearTimeout(d.state.refreshTimer.scrollCache),d.state.refreshTimer.scrollCache=null),d.state.refreshTimer.scrollCacheWorker&&(clearInterval(d.state.refreshTimer.scrollCacheWorker),d.state.refreshTimer.scrollCacheWorker=null),d._refreshBoard(),d.state.refreshTimer.scroll=null},a),d.state.refreshTimer.scrollCache&&(clearTimeout(d.state.refreshTimer.scrollCache),d.state.refreshTimer.scrollCache=null),d.state.refreshTimer.scrollCacheWorker&&(clearInterval(d.state.refreshTimer.scrollCacheWorker),d.state.refreshTimer.scrollCacheWorker=null),d.option.cellCache.enabled&&(d.state.refreshTimer.scrollCache=setTimeout(function(){d.state.refreshTimer.scrollCache=null,d.state.refreshTimer.cacheWorkerCount=0,d.state.refreshTimer.cacheWorkerLength=(d.state.refreshbodycell&&d.state.refreshbodycell.renderedDataList?d.state.refreshbodycell.renderedDataList.length:0)||20,d.state.refreshTimer.scrollCacheWorker=setInterval(function(){var e=d.state.renderTargetDataList[d.state.renderFromRenderedIndex+d.state.refreshTimer.cacheWorkerCount++];e&&d._cacheCellByData(e),(d.state.refreshTimer.cacheWorkerCount>=d.state.refreshTimer.cacheWorkerLength||!e)&&(clearInterval(d.state.refreshTimer.scrollCacheWorker),d.state.refreshTimer.scrollCacheWorker=null)},d.option.cellCache.timerInterval)},Math.ceil(.35*a)))),r()}function i(){l(d.option.lazyScroll.refreshDelay),d.state.refreshTimer.basic=window.requestAnimationFrame(i)}var d=this,p=wt?80:40,u=!!(d.option.useFrameSyncScroll&&s(window.requestAnimationFrame)&&s(window.cancelAnimationFrame));!0===t?(null!=d.state.refreshTimer.basic||u||(d.state.refreshTimer.basic=setInterval(a,p),d.state.refreshTimer.rafMode=!1),null==d.state.refreshTimer.basic&&u&&(d.state.refreshTimer.basic=window.requestAnimationFrame(n),d.state.refreshTimer.rafMode=!0)):!1===t?(d.state.refreshTimer.basic&&(d._refreshBoard(),d.state.refreshTimer.rafMode?window.cancelAnimationFrame(d.state.refreshTimer.basic):clearInterval(d.state.refreshTimer.basic)),d.state.refreshTimer.basic=null,d.state.refreshTimer.scroll&&clearTimeout(d.state.refreshTimer.scroll),d.state.refreshTimer.scroll=null,d.state.refreshTimer.scrollCache&&(clearTimeout(d.state.refreshTimer.scrollCache),d.state.refreshTimer.scrollCache=null),d.state.refreshTimer.scrollCacheWorker&&(clearInterval(d.state.refreshTimer.scrollCacheWorker),d.state.refreshTimer.scrollCacheWorker=null)):"scrollbarx"!==t&&"scrollbary"!==t||null==d.state.refreshTimer.basic&&(d.state.refreshTimer.position={},r(),u?(d.state.refreshTimer.basic=window.requestAnimationFrame(i),d.state.refreshTimer.rafMode=!0):(d.state.refreshTimer.basic=setInterval(l,p),d.state.refreshTimer.rafMode=!1))},At.prototype._setScrollInfo=function(t){var a=this;if(a.state.renderTargetMappingInfo=a._generateRenderTargetMapping(),0==a.state.renderTargetDataList.length)return a.state.renderFromRenderedIndex=0,void(a.state.translateY=0);a._limitRenderFromByFixCount();var n=0;if(!0===a.state.scrollxEnd){if(a.state.wrapperWidth>=a.state.columnWidth)a.state.scrollxMoveable=!1,a.state.renderFromColumnIndex=a.state.columnIndexArr[0],n=0;else{a.state.scrollxRatio=a.state.wrapperWidth/a.state.columnWidth;var r=a.state.scrollbarxTrackLength*a.state.scrollxRatio;n=a.state.scrollbarxTrackLength-r,a.state.renderFromColumnIndex=a._getColumnIndexByBlankWidth(n)}}else if(a.state.wrapperWidth>=a.state.columnWidth)a.state.renderFromColumnIndex=a.state.columnIndexArr[0],n=0;else{var o=a._columnIndexOrder(a.state.renderFromColumnIndex);for(a.state.scrollxRatio=a.state.wrapperWidth/a.state.columnWidth;o<0&&null!=a.state.prevColumnIndexArr;){if(a.state.renderFromColumnIndex=a.state.prevColumnIndexArr[e.inArray(a.state.renderFromColumnIndex,a.state.prevColumnIndexArr)+1],null==a.state.renderFromColumnIndex){a.state.renderFromColumnIndex=a.state.columnIndexArr[0];break}o=a._columnIndexOrder(a.state.renderFromColumnIndex)}var l=a.state.renderTargetMappingInfo;if(l.renderTargetWidth<a.state.wrapperWidth&&a.state.renderFromColumnIndex!==a.state.columnIndexArr[0]){for(var i=a.state.wrapperWidth-l.renderTargetWidth;--a.state.renderFromColumnIndex>0;)if((i-=a.state.columnWidthMap[a.state.renderFromColumnIndex]||0)<0){a.state.scrollxEnd=!0;break}a.state.renderFromColumnIndex<=0&&(a.state.renderFromColumnIndex=a.state.columnIndexArr[0],a.state.scrollxEnd=!1)}n=a._generateTranslatex(a.state.renderFromColumnIndex)*a.state.scrollxRatio,a.option.useContinuousXScroll&&a.state.refreshbodycell&&!a.state.scrollxEnd&&(n+=Math.abs(a.state.refreshbodycell.scrollEndXOffset||0)*a.state.scrollxRatio)}a.state.translateX=n;var d=0,s=Math.max(a.option.rowPadding>0?a.option.rowPadding:0,a.state.renderTargetDataList.length);if(a.state.renderFromRenderedIndex-1>s)a.state.renderFromRenderedIndex=0,a.state.scrollyEnd=!1;else{if(0===a.state.renderFromRenderedIndex)d=0,a.state.refreshbodycell&&(a.state.refreshbodycell.scrollEndYOffset=0);else if(a.state.scrollyEnd)d=a.state.scrollbaryTrackLength-a.state.scrollbaryHeight;else{if(a.state.refreshbodycell&&a.state.refreshbodycell.scrollyEnd&&a.state.refreshbodycell.scrollEndYOffset<0){if(null==t){var p=a.state.refreshbodycell.renderedPinnedDataList.length,u=a.state.refreshbodycell.bodyCellPositionY[p+1]-a.state.refreshbodycell.bodyCellPositionY[p];if(Math.abs(a.state.refreshbodycell.scrollEndYOffset)>u/2&&(a.state.renderFromRenderedIndex+=1,a.state.renderFromRenderedIndex>=s)){var c=a.state.scrollbaryTrackLength-a.state.scrollbaryHeight;a.state.renderFromRenderedIndex=a.__getRenderedIndexByBlankHeight(c)}}a.state.refreshbodycell.scrollEndYOffset=0}var g=a.__getRowHeightByRenderedIdx(a.state.renderFromRenderedIndex);d=Math.ceil(a.state.scrollyRatio*g*a.state.scrollRatioConst)/a.state.scrollRatioConst,a.option.useContinuousYScroll&&a.state.refreshbodycell&&!a.state.scrollyEnd&&(d=a.state.scrollyRatio*g,d+=Math.abs(a.state.refreshbodycell.scrollEndYOffset||0)*a.state.scrollyRatio),d>=a.state.scrollbaryTrackLength-a.state.scrollbaryHeight&&(a.state.scrollyEnd=!0)}a.state.scrollyEnd&&(d=a.state.scrollbaryTrackLength-a.state.scrollbaryHeight,a._getRenderIndexScrollyEnd(),a.state.renderFromRenderedIndex<=0&&(a.state.scrollyEnd=!1,d=0))}a.state.translateY=d},At.prototype._getRenderIndexScrollyEnd=function(){for(var e=this,t=e.state.renderTargetDataList.length,a=e.state.wrapperHeight-e.state.headerHeight-e.state.footerHeight;a>0&&t>0;){a-=e._getRowHeight(e.state.renderTargetDataList[--t])}e.state.renderFromRenderedIndex=Math.max(0,t)},At.prototype._scrollRightEvent=function(e,t){var a=this;if(a.state.hasHorizontalScrollbar){null==t&&(t=!0);var n=0,r=0;a.state.scrollxEnd||a.state.wrapperWidth>=a.state.standardColumnWidth||(r=a.state.columnIndexArr[a._columnIndexOrder(a.state.renderFromColumnIndex)+e],n=a._generateTranslatex(r)*a.state.scrollxRatio,n>=a.state.scrollbarxTrackLength-a.state.scrollbarxWidth?(a.state.scrollxEnd=!0,n=a.state.scrollbarxTrackLength-a.state.scrollbarxWidth,a.state.renderFromColumnIndex=a._getColumnIndexByBlankWidth(n)):a.state.renderFromColumnIndex=r,a.state.translateX=n,t&&a._refreshBoard())}},At.prototype._scrollLeftMostEvent=function(e){return this._scrollLeftEvent(1/0,e)},At.prototype._scrollLeftEvent=function(e,t){var a=this;if(a.state.hasHorizontalScrollbar){null==t&&(t=!0);var n=0,r=a.state.columnIndexArr[a._columnIndexOrder(a.state.renderFromColumnIndex)-e];null==r||e===1/0?(n=0,a.state.renderFromColumnIndex=a.state.columnIndexArr[0]):(n=a._generateTranslatex(r)*a.state.scrollxRatio,a.state.renderFromColumnIndex=r),a.state.scrollxEnd=!1,a.state.translateX=n,t&&a._refreshBoard()}},At.prototype._scrollTopEvent=function(e){return this._scrollUpEvent(this.state.renderFromRenderedIndex,e)},At.prototype._scrollUpEvent=function(e,t){var a=this;if(null==t&&(t=!0),a.state.hasVerticalScrollbar){if(a.state.scrollyEnd=!1,a.state.renderFromRenderedIndex=Math.max(0,a.state.renderFromRenderedIndex-e),0===a.state.renderFromRenderedIndex)a.state.translateY=0;else{var n=a.__getRowHeightByRenderedIdx(a.state.renderFromRenderedIndex);translateY=Math.ceil(a.state.scrollyRatio*n*a.state.scrollRatioConst)/a.state.scrollRatioConst,a.state.translateY=translateY}t&&a._refreshBoard()}},At.prototype._scrollDownEvent=function(e,t){var a=this,n=0;if(null==t&&(t=!0),!a.state.scrollyEnd&&a.state.hasVerticalScrollbar){var r=a.__getRowHeightByRenderedIdx(a.state.renderFromRenderedIndex+e);n=Math.ceil(a.state.scrollyRatio*r*a.state.scrollRatioConst)/a.state.scrollRatioConst,n>=a.state.scrollbaryTrackLength-a.state.scrollbaryHeight?(a.state.scrollyEnd=!0,n=a.state.scrollbaryTrackLength-a.state.scrollbaryHeight,a.state.renderFromRenderedIndex=a.__getRenderedIndexByBlankHeight(n)):a.state.renderFromRenderedIndex+=e,a.state.translateY=n,t&&a._refreshBoard()}},At.prototype._activateBoardScrollEvent=function(){function t(){var e,t=u.state.columnWidth-u.state.wrapperWidth,a=0;for(var n in u.state.standardColumnWidthMap)if(e=u.state.standardColumnWidthMap[n],(a+=e)>t){a-=e,u.state.lastScrollxPixcel=t-a-u.state.scrollbaryWidth;break}return u.state.lastScrollxPixcel}function a(e,a){var n=Math.ceil(Math.abs(e)/100),r=0,o=0;if(e>=0){if(u.state.scrollxEnd)return;o=u.state.columnIndexArr[u._columnIndexOrder(u.state.renderFromColumnIndex)+n],r=u._generateTranslatex(o)*u.state.scrollxRatio,r>=u.state.scrollbarxTrackLength-a?(u.state.scrollxEnd=!0,r=u.state.scrollbarxTrackLength-a,u.state.renderFromColumnIndex=u._getColumnIndexByBlankWidth(r)):u.state.renderFromColumnIndex=o,u.state.translateX=r}else{if(u.state.scrollxEnd){var l=t();r=u.state.scrollbarxTrackLength-(a+l*u.state.scrollxRatio)}else o=u.state.columnIndexArr[u._columnIndexOrder(u.state.renderFromColumnIndex)-n],null==o?(r=0,u.state.renderFromColumnIndex=u.state.columnIndexArr[0]):(r=u._generateTranslatex(o)*u.state.scrollxRatio,u.state.renderFromColumnIndex=o);u.state.scrollxEnd=!1,u.state.translateX=r}return!0}function n(e,t){var a=Math.ceil(Math.abs(e)/100);if(e>=0){if(u.state.scrollyEnd)return;var n=u.__getRowHeightByRenderedIdx(u.state.renderFromRenderedIndex+a);translateY=Math.ceil(u.state.scrollyRatio*n*u.state.scrollRatioConst)/u.state.scrollRatioConst,translateY>=Math.ceil(u.state.scrollbaryTrackLength-t)?(u.state.scrollyEnd=!0,translateY=Math.ceil(u.state.scrollbaryTrackLength-t),u._getRenderIndexScrollyEnd()):u.state.renderFromRenderedIndex+=a,u.state.translateY=translateY}else{u.state.renderFromRenderedIndex=Math.max(0,u.state.renderFromRenderedIndex-a),u.state.scrollyEnd=!1;var n=u.__getRowHeightByRenderedIdx(u.state.renderFromRenderedIndex);translateY=Math.ceil(u.state.scrollyRatio*n*u.state.scrollRatioConst)/u.state.scrollRatioConst,0===u.state.renderFromRenderedIndex?u.state.translateY=0:u.state.translateY=translateY}return!0}function r(e,t,a,n){var r=n.width(),o=e.data.scrollxHandlePosition;e.data.scrollbarxStartPosition,e.data.startPositionXDff;a.state.scrollxEnd=!1;var l=o+(e.data.startPageX-t.pageX)*a.state.scrollxRatio;l<=0?(a.state.renderFromColumnIndex=a.state.columnIndexArr[0],a.state.translateX=0):l+r>=a.state.scrollbarxTrackLength?(a.state.scrollxEnd=!0,a.state.translateX=a.state.scrollbarxTrackLength-r,a.state.renderFromColumnIndex=a._getColumnIndexByBlankWidth(a.state.translateX)):(a.state.renderFromColumnIndex=a._getColumnIndexByBlankWidth(l),a.state.translateX=l)}function o(e,t,a,n){var r=n.height(),o=e.data.scrollyHandlePosition;e.data.scrollbaryStartPosition,e.data.startPositionYDff;a.state.scrollyEnd=!1;var l=o+(e.data.startPageY-t.pageY)*a.state.scrollyRatio;l<=0?(a.state.renderFromRenderedIndex=0,a.state.translateY=0):l+r>=a.state.scrollbaryTrackLength?(a.state.scrollyEnd=!0,a.state.translateY=Math.ceil(a.state.scrollbaryTrackLength-r),a.state.renderFromRenderedIndex=a.__getRenderedIndexByBlankHeight(a.state.translateY)):(a.state.renderFromRenderedIndex=a.__getRenderedIndexByBlankHeight(l),a.state.translateY=l)}function l(e,t,a,n,r,o){var l,i=0;if(e>t){if(u.state.scrollxEnd)return;l=u._getProcessedPageRightLength()*n;var d=u.state.columnIndexArr[u._columnIndexOrder(u.state.renderFromColumnIndex)+l];d>=r?(i=o,i>=u.state.scrollbarxTrackLength-a?(u.state.scrollxEnd=!0,i=u.state.scrollbarxTrackLength-a,u.state.renderFromColumnIndex=u._getColumnIndexByBlankWidth(i)):u.state.renderFromColumnIndex=r):(i=u._generateTranslatex(d)*u.state.scrollxRatio,i>=u.state.scrollbarxTrackLength-a?(u.state.scrollxEnd=!0,i=u.state.scrollbarxTrackLength-a,u.state.renderFromColumnIndex=u._getColumnIndexByBlankWidth(i)):u.state.renderFromColumnIndex=d),u.state.translateX=i}else{u.state.scrollxEnd=!1,l=u._getProcessedPageLeftLength()*n;var s=Math.max(0,u._columnIndexOrder(u.state.renderFromColumnIndex)-l),p=u.state.columnIndexArr[s];null==p||isNaN(p)?(u.state.renderFromColumnIndex=u.state.columnIndexArr[0],i=0):r>=p?(u.state.renderFromColumnIndex=r,i=o):(u.state.renderFromColumnIndex=p,i=u._generateTranslatex(p)*u.state.scrollxRatio),0===u.state.renderFromColumnIndex?u.state.translateX=0:u.state.translateX=i}var c=u.option.useContinuousXScroll;u.option.useContinuousXScroll=!1,u._refreshBoard(),u.option.useContinuousXScroll=c}function i(e,a){var n=0,r=0;if(-1==e.attr("class").indexOf("leftbutton")){if(u.state.scrollxEnd)return;r=u.state.columnIndexArr[u._columnIndexOrder(u.state.renderFromColumnIndex)+1],n=u._generateTranslatex(r)*u.state.scrollxRatio,n>=u.state.scrollbarxTrackLength-a?(u.state.scrollxEnd=!0,n=u.state.scrollbarxTrackLength-a,u.state.renderFromColumnIndex=u._getColumnIndexByBlankWidth(n)):u.state.renderFromColumnIndex=r,u.state.translateX=n}else{if(u.state.scrollxEnd){var o=t();n=u.state.scrollbarxTrackLength-(a+o*u.state.scrollxRatio)}else r=u.state.columnIndexArr[u._columnIndexOrder(u.state.renderFromColumnIndex)-1],null==r?(n=0,u.state.renderFromColumnIndex=u.state.columnIndexArr[0]):(n=u._generateTranslatex(r)*u.state.scrollxRatio,u.state.renderFromColumnIndex=r);u.state.scrollxEnd=!1,u.state.translateX=n}var l=u.option.useContinuousXScroll;u.option.useContinuousXScroll=!1,u._refreshBoard(),u.option.useContinuousXScroll=l}function d(e,t,a,n,r,o){var l,i=0;if(e>t){if(u.state.scrollyEnd)return;l=u._getProcessedPageDownLength()*n;var d=u.state.renderFromRenderedIndex+l;if(d>=r)i=o,i>=u.state.scrollbaryTrackLength-a?(u.state.scrollyEnd=!0,i=Math.ceil(u.state.scrollbaryTrackLength-a),u._getRenderIndexScrollyEnd()):u.state.renderFromRenderedIndex=r;else{var s=u.__getRowHeightByRenderedIdx(d);i=Math.ceil(u.state.scrollyRatio*s*u.state.scrollRatioConst)/u.state.scrollRatioConst,i>=u.state.scrollbaryTrackLength-a?(u.state.scrollyEnd=!0,i=Math.ceil(u.state.scrollbaryTrackLength-a),u._getRenderIndexScrollyEnd()):u.state.renderFromRenderedIndex=d}u.state.translateY=i}else{u.state.scrollyEnd=!1,l=u._getProcessedPageUpLength()*n;var p=Math.max(0,u.state.renderFromRenderedIndex-l);if(r>=p)u.state.renderFromRenderedIndex=r,i=o;else{u.state.renderFromRenderedIndex=p;var s=u.__getRowHeightByRenderedIdx(u.state.renderFromRenderedIndex);i=Math.ceil(u.state.scrollyRatio*s*u.state.scrollRatioConst)/u.state.scrollRatioConst}0===u.state.renderFromRenderedIndex?u.state.translateY=0:u.state.translateY=i}var c=u.option.useContinuousYScroll;u.option.useContinuousYScroll=!1,u._refreshBoard(),u.option.useContinuousYScroll=c}function s(){for(var e=u.state.wrapperHeight-u.state.headerHeight-u.state.footerHeight+u.state.scrollbarxHeight,t=u.state.refreshbodycell.renderedDataList,a=0,n=u.state.rowHeightMapByDataId,r=0,o=t.length;r<o;r++){var l=t[r],i=n[l._index.id];a+=null!=i?i:u.state.rowHeight}return Math.max(0,a-e)}function p(e,t){var a=0;if(-1==e.attr("class").indexOf("upbutton")){if(u.state.scrollyEnd)return;var n=u.__getRowHeightByRenderedIdx(u.state.renderFromRenderedIndex+1);a=Math.ceil(u.state.scrollyRatio*n*u.state.scrollRatioConst)/u.state.scrollRatioConst,a>=u.state.scrollbaryTrackLength-t?(u.state.scrollyEnd=!0,a=Math.ceil(u.state.scrollbaryTrackLength-t),u._getRenderIndexScrollyEnd()):u.state.renderFromRenderedIndex+=1,u.state.translateY=a}else{if(!u.state.scrollyEnd&&0===u.state.renderFromRenderedIndex)return;if(u.state.scrollyEnd){if(0===s()){var n=u.__getRowHeightByRenderedIdx(u.state.renderFromRenderedIndex-1);u.state.renderFromRenderedIndex=Math.max(0,u.state.renderFromRenderedIndex-1),a=Math.ceil(u.state.scrollyRatio*n*u.state.scrollRatioConst)/u.state.scrollRatioConst}else{var n=u.__getRowHeightByRenderedIdx(u.state.renderFromRenderedIndex);a=Math.ceil(u.state.scrollyRatio*n*u.state.scrollRatioConst)/u.state.scrollRatioConst}}else{var n=u.__getRowHeightByRenderedIdx(u.state.renderFromRenderedIndex-1);u.state.renderFromRenderedIndex=Math.max(0,u.state.renderFromRenderedIndex-1),a=Math.ceil(u.state.scrollyRatio*n*u.state.scrollRatioConst)/u.state.scrollRatioConst}u.state.scrollyEnd=!1,0===u.state.renderFromRenderedIndex?u.state.translateY=0:u.state.translateY=a}var r=u.option.useContinuousYScroll;u.option.useContinuousYScroll=!1,u._refreshBoard(),u.option.useContinuousYScroll=r}var u=this,c=".alopexgridScrollbarEvent";Ct.off(c+u.key),u.$scrollbarx.off(c),u.$scrollbary.off(c),u.$wrapper.off(c);var g=u.$scrollbarx.find(".scrollhandle"),f=u.$scrollbary.find(".scrollhandle"),h=u.$scrollbarLeftButton,m=u.$scrollbarUpButton,v="mousedown";It&&(v="touchstart"),u.$wrapper.on((wt?"mousewheel":"wheel")+c,{self:u},function(e){var t=e.data.self;if(null!=e.originalEvent&&(null==e.target||"SELECT"!==e.target.nodeName)){var r,o,l=e.originalEvent.deltaX,i=wt?parseInt(-.025*e.originalEvent.wheelDelta):e.originalEvent.deltaY;t.state.hasHorizontalScrollbar&&t.state.scrollxMoveable&&0!==l&&(!0===t.option.preventScrollPropagation?(e.preventDefault(),e.stopPropagation()):l>0&&t.state.scrollxEnd||l<0&&0===t.state.renderFromColumnIndex||(e.preventDefault(),e.stopPropagation()),r=a(l,t.state.scrollbarxWidth)),t.state.hasVerticalScrollbar&&t.state.scrollyMoveable&&0!==i&&(!0===t.option.preventScrollPropagation?(e.preventDefault(),
e.stopPropagation()):i>0&&t.state.scrollyEnd||i<0&&0===t.state.renderFromRenderedIndex||(e.preventDefault(),e.stopPropagation()),o=n(i,t.state.scrollbaryHeight)),!0!==r&&!0!==o||t._refreshBoard()}}),It&&u.$wrapper.on("touchstart"+c,{self:u},function(t){if(null!=t.originalEvent){var a=t.target.className;if(!(a.indexOf("scrollbar")>=0||a.indexOf("scrollbutton")>=0||a.indexOf("scrollhandle")>=0||a.indexOf("resizing-handle")>=0||a.indexOf("header-dragdrop-handle")>=0||a.indexOf("row-dragdrop-handle")>=0)){var n=t.data.self;$target=e(t.target),$target.off(c+n.key);var l=t.originalEvent.touches[0],i=l.pageX,d=h.offset().left+h.width(),s=g.offset().left-d,p=i-d,u=l.pageY,v=m.offset().top+m.height(),x=f.offset().top-v,y=u-v,C={};C.self=n,C.startPageX=i,C.scrollxHandlePosition=s,C.scrollbarxStartPosition=d,C.startPositionXDff=p,C.startPageY=u,C.scrollyHandlePosition=x,C.scrollbaryStartPosition=v,C.startPositionYDff=y,n._refreshTimerActivate(!0),$target.on("touchmove"+c+n.key,C,function(e){if(!1!==e.cancelable){var t,a,n=e.data.self,l=e.originalEvent.touches[0],i=l.pageX-e.data.startPageX,d=l.pageY-e.data.startPageY;Math.abs(i)>Math.abs(d)?(t=!0,a=!1):(t=!1,a=!0),t&&n.state.hasHorizontalScrollbar&&n.state.scrollxMoveable&&(!0===n.option.preventScrollPropagation?(e.preventDefault(),e.stopPropagation()):i<0&&n.state.scrollxEnd||i>0&&0===n.state.renderFromColumnIndex||(e.preventDefault(),e.stopPropagation())),a&&n.state.hasVerticalScrollbar&&n.state.scrollyMoveable&&(!0===n.option.preventScrollPropagation?(e.preventDefault(),e.stopPropagation()):d<0&&n.state.scrollyEnd||d>0&&0===n.state.renderFromRenderedIndex||(e.preventDefault(),e.stopPropagation())),t&&l&&n.state.scrollxMoveable&&r(e,l,n,g),a&&l&&n.state.scrollyMoveable&&o(e,l,n,f)}}),$target.on("touchend"+c+n.key+" touchcancel"+c+n.key,{self:n},function(t){var a=t.data.self;a._refreshTimerActivate(!1),e(this).off(c+a.key)})}}}),u.$scrollbarx.on(v+c,{self:u},function(e){var t=e;"touchstart"===e.type&&(t=e.originalEvent.touches[0]);var a=e.data.self;if(a.state.scrollxMoveable&&e.target===this&&(!1!==It||3!==e.which)){Ct.off(c+a.key),a.state.isScrollyMoving=!1;var n=t.pageX;It&&t.pageX===t.clientX&&(n+=Ct.scrollLeft());var r=a.state.scrollbarxWidth,o=h.offset().left+h.width(),i=g.offset().left+r,d=1,s=n-o-r/2,p=a._getColumnIndexByBlankWidth(s);l(n,i,r,d,p,s);var u=null,f=null;u=setTimeout(function(){f=setInterval(function(){return(i=g.offset().left+r)-n>0&&i-n<=r?void clearInterval(f):a.state.renderFromColumnIndex===p?void clearInterval(f):(l(n,i,a.state.scrollbarxWidth,d,p,s),void(!0===a.option.useScrollAcceleration&&d++))},50),u=null},200),Se(function(){setTimeout(function(){Ee(),Ct.trigger("__alopexgridscrollxend"+a.key)},0)}),Ct.on("selectstart"+c+a.key+a.eventns,function(e){e.preventDefault()}),Ct.on("mouseup"+c+a.key+a.eventns+" touchend"+c+a.key+a.eventns+" touchcancel"+c+a.key+a.eventns+" __alopexgridscrollxend"+a.key+c+a.key,{self:a},function(e){var t=e.data.self;u&&(clearTimeout(u),u=null),f&&(clearInterval(f),f=null),Ct.off(c+t.key),Fe(t)&&Ze(t)})}}),u.$scrollbarx.on(v+c,".scrollhandle",{self:u},function(e){var t=e.data.self;if(t.state.scrollxMoveable&&(!1!==It||3!==e.which)){Ct.off(c+t.key),t.state.isScrollyMoving=!1;var a=e;"touchstart"===e.type&&(a=e.originalEvent.touches[0]);var n=a.pageX,r=h.offset().left+h.width(),o=g.offset().left-r,l=n-r;Se(function(){setTimeout(function(){Ee(),Ct.trigger("__alopexgridscrollxend"+t.key)},0)}),t.option.lazyScroll.enabled="string"==typeof t.option.lazyScroll.enabled?t.option.lazyScroll.enabled.toLowerCase():t.option.lazyScroll.enabled,t._refreshTimerActivate(!t.option.lazyScroll||1!=t.option.lazyScroll.enabled&&"x"!=t.option.lazyScroll.enabled||"scrollbarx");var i={self:t,scrollxHandlePosition:o,scrollbarxStartPosition:r,startPositionDff:l};Ct.on("selectstart"+c+t.key+t.eventns,function(e){e.preventDefault()}),Ct.on("mousemove"+c+t.key+t.eventns+" touchmove"+c+t.key+t.eventns,i,function(e){e.preventDefault();var t=e.data.self,a=e;"touchmove"===e.type&&(a=e.originalEvent.touches[0]);var n=g.width(),r=e.data.scrollxHandlePosition,o=e.data.scrollbarxStartPosition,l=e.data.startPositionDff;t.state.scrollxEnd=!1;var i=a.pageX-l-o+r;i<=0?(t.state.renderFromColumnIndex=t.state.columnIndexArr[0],t.state.translateX=0):i+n>=t.state.scrollbarxTrackLength?(t.state.scrollxEnd=!0,t.state.translateX=t.state.scrollbarxTrackLength-n,t.state.renderFromColumnIndex=t._getColumnIndexByBlankWidth(t.state.translateX)):(t.state.renderFromColumnIndex=t._getColumnIndexByBlankWidth(i),t.state.translateX=i)}).on("mouseup"+c+t.key+" touchend"+c+t.key+" touchcancel"+c+t.key+" __alopexgridscrollxend"+t.key+c+t.key,{self:t},function(e){var t=e.data.self;t._refreshTimerActivate(!1),Ct.off(c+t.key),Fe(t)&&Ze(t)})}}),u.$scrollbarx.on(v+c,".scrollbutton",{self:u},function(t){var a=t.data.self;if(a.state.scrollxMoveable&&(!1!==It||3!==t.which)){Ct.off(c+a.key);var n=e(t.target);a.state.isScrollyMoving=!1,i(n,a.state.scrollbarxWidth);var r=null,o=null;r=setTimeout(function(){o=setInterval(function(){i(n,a.state.scrollbarxWidth)},50),r=null},200),Se(function(){setTimeout(function(){Ee(),Ct.trigger("__alopexgridscrollxend"+a.key)},0)}),Ct.on("selectstart"+c+a.key+a.eventns,function(e){e.preventDefault()}),Ct.on("mouseup"+c+a.key+a.eventns+" touchend"+c+a.key+a.eventns+" touchcancel"+c+a.key+a.eventns+" __alopexgridscrollxend"+a.key+c+a.key,{self:a},function(e){r&&(clearTimeout(r),r=null),o&&(clearInterval(o),o=null),Ct.off(c+e.data.self.key),Fe(a)&&Ze(a)})}}),u.$scrollbary.on(v+c,{self:u},function(e){var t=e;"touchstart"===e.type&&(t=e.originalEvent.touches[0]);var a=e.data.self;if(a.state.scrollyMoveable&&e.target===this&&(!1!==It||3!==e.which)){Ct.off(c+a.key),a.state.isScrollyMoving=!1;var n=t.pageY;It&&t.pageY===t.clientY&&(n+=Ct.scrollTop());var r=a.state.scrollbaryHeight,o=m.offset().top+m.height(),l=f.offset().top+r,i=1,s=n-o-r/2,p=a.__getRenderedIndexByBlankHeight(s);d(n,l,r,i,p,s);var u=null,g=null;u=setTimeout(function(){g=setInterval(function(){return(l=f.offset().top+r)-n>0&&l-n<=r?void(g&&clearInterval(g)):a.state.renderFromRenderedIndex===p?void(g&&clearInterval(g)):(d(n,l,r,i,p,s),void(!0===a.option.useScrollAcceleration&&i++))},50),u=null},200),Se(function(){setTimeout(function(){Ee(),Ct.trigger("__alopexgridscrollyend"+a.key)},0)}),Ct.on("selectstart"+c+a.key+a.eventns,function(e){e.preventDefault()}),Ct.on("mouseup"+c+a.key+a.eventns+" touchend"+c+a.key+a.eventns+" touchcancel"+c+a.key+a.eventns+" __alopexgridscrollyend"+a.key+c+a.key,{self:a},function(e){var t=e.data.self;u&&clearTimeout(u),g&&clearInterval(g),Ct.off(c+t.key),Fe(t)&&Ze(t)})}}),u.$scrollbary.on(v+c,".scrollhandle",{self:u},function(e){if(null!=e.originalEvent){var t=e.data.self;if(t.state.scrollyMoveable&&(!1!==It||3!==e.which)){Ct.off(c+t.key),t.state.isScrollyMoving=!0;var a=e;"touchstart"===e.type&&(a=e.originalEvent.touches[0]);var n=a.pageY,r=m.offset().top+m.height(),o=f.offset().top-r,l=n-r,i=Math.ceil(t.state.scrollbaryTrackLength-f.height());Se(function(){setTimeout(function(){Ee(),Ct.trigger("__alopexgridscrollyend"+t.key)},0)}),t.option.lazyScroll.enabled="string"==typeof t.option.lazyScroll.enabled?t.option.lazyScroll.enabled.toLowerCase():t.option.lazyScroll.enabled,t._refreshTimerActivate(!t.option.lazyScroll||1!=t.option.lazyScroll.enabled&&"y"!=t.option.lazyScroll.enabled||"scrollbary");var d={self:t,scrollyHandlePosition:o,scrollbaryStartPosition:r,startPositionDff:l,maxBlankHeight:i};Ct.on("selectstart"+c+t.key+t.eventns,function(e){e.preventDefault()}),Ct.on("mousemove"+c+t.key+t.eventns+" touchmove"+c+t.key+t.eventns,d,function(e){e.preventDefault();var t=e.data.self,a=e;"touchmove"===e.type&&(a=e.originalEvent.touches[0]);var n=f.height(),r=e.data.scrollyHandlePosition,o=e.data.scrollbaryStartPosition,l=e.data.startPositionDff,i=e.data.maxBlankHeight;t.state.scrollyEnd=!1;var d=a.pageY-l-o+r;d<=0?(t.state.renderFromRenderedIndex=0,t.state.translateY=0):d+n>=t.state.scrollbaryTrackLength?(t.state.scrollyEnd=!0,t.state.translateY=i,t._getRenderIndexScrollyEnd()):(t.state.renderFromRenderedIndex=t.__getRenderedIndexByBlankHeight(d),t.state.translateY=d)}).on("mouseup"+c+t.key+" touchend"+c+t.key+" touchcancel"+c+t.key+" __alopexgridscrollyend"+t.key+c+t.key,{self:t},function(e){var t=e.data.self;t._refreshTimerActivate(!1),Ct.off(c+t.key),Fe(t)&&Ze(t)})}}}),u.$scrollbary.on(v+c,".scrollbutton",{self:u},function(t){var a=t.data.self;if(a.state.scrollyMoveable&&t.target===this&&(!1!==It||2!==t.button)){var n=e(t.target);Ct.off(c+a.key),a.state.isScrollyMoving=!0,p(n,a.state.scrollbaryHeight);var r=null,o=null;r=setTimeout(function(){o=setInterval(function(){p(n,a.state.scrollbaryHeight)},wt?80:40),r=null},200),Se(function(){setTimeout(function(){Ee(),Ct.trigger("__alopexgridscrollyend"+a.key)},0)}),Ct.on("selectstart"+c+a.key+a.eventns,function(e){e.preventDefault()}),Ct.on("mouseup"+c+a.key+a.eventns+" touchend"+c+a.key+a.eventns+" touchcancel"+c+a.key+a.eventns+" __alopexgridscrollyend"+a.key+c+a.key+a.eventns,{self:a},function(e){var t=e.data.self;r&&(clearTimeout(r),r=null),o&&(clearInterval(o),o=null),Ct.off(c+t.key),Fe(t)&&Ze(t)})}})},At.prototype._refreshScrollbar=function(t){var a=this;a.state.scrollRatioConst=1e3,a._limitRenderFromByFixCount();var n=a.$scrollbarx.find(".scrollhandle"),r=a.$scrollbarx.find(".leftbutton");if(a.state.scrollxMoveable=!0,a.state.columnWidth<=a.state.wrapperWidth)n.width(a.state.scrollbarxTrackLength),a.state.scrollbarxWidth=n.width(),a.state.scrollxMoveable=!1,a.state.translateX=0,a.state.scrollxRatio=0,a.state.renderFromColumnIndex=a.state.columnIndexArr[0];else{a.state.scrollxRatio=a.state.wrapperWidth/a.state.columnWidth;var o=a.state.scrollbarxTrackLength*a.state.scrollxRatio,l=2*r.width();if(l>o){var i=l-o;o=l,a.state.scrollxRatio=(a.state.wrapperWidth-i)/a.state.columnWidth}n.width(o),a.state.scrollbarxWidth=o}var d=a.$scrollbary.find(".scrollhandle"),s=a.$scrollbary.find(".upbutton");a.state.scrollyMoveable=!0;var p=a.state.wrapperHeight-a.state.headerHeight-a.state.footerHeight,u=a.__getAllRowHeight(),c=a.state.renderTargetDataList.length;if(!c&&a.option.message&&(a.option.message.nodata||null!=a.state.filteredDataList&&0===a.state.filteredDataList.length&&a.option.message.noFilteredData)&&(u+=a.state.rowHeight,c+=1),a.option.rowPadding>0&&c<a.option.rowPadding&&(u+=a.state.rowHeight*(a.option.rowPadding-c)),u<=p)d.height(a.state.scrollbaryTrackLength),a.state.scrollbaryHeight=d.height(),a.state.scrollyMoveable=!1,a.state.translateY=0,a.state.scrollyRatio=0;else{var g=u+a.state.headerHeight+a.state.footerHeight-2*s.height();a.state.scrollyRatio=a.state.scrollbaryTrackLength/g;var f=a.state.scrollbaryTrackLength*a.state.scrollyRatio,h=2*s.height();if(h>f)if(h>=a.state.scrollbaryTrackLength){var m=.6*a.state.scrollbaryTrackLength;a.state.scrollyRatio=(a.state.scrollbaryTrackLength-(m-f))/g,f=m}else{var v=h-f;f=h,a.state.scrollyRatio=(a.state.scrollbaryTrackLength-v)/g}f=Math.ceil(Math.min(a.state.scrollbaryTrackLength,f)),d.height(f),a.state.scrollbaryHeight=Math.ceil(f*a.state.scrollRatioConst)/a.state.scrollRatioConst}a.state.data.length===a.state.scrollbarRefreshLastDatalength&&a.option.columnMapping.length===a.state.scrollbarRefreshLastColumnLength||a._setScrollInfo();var x=a.state.translateX;if(a._columnShowFromEnabled()&&null!=a.state.columnFixShowFromColumnIndex){var y=a._generateTranslatex(a.state.columnFixShowFromColumnIndex);x=Math.max(x,y*a.state.scrollxRatio)}x=Math.max(0,x),wt?n.css("left",a.state.scrollbarxTrackLeft+x+"px"):n.css("transform","translateX("+x+"px)");var C=a.state.translateY;if(null!=a.option.rowFixShowFrom&&a.option.rowFixCount&&!a.option.disableScrolledFix){var I=a.__getRowHeightByRenderedIdx(a.option.rowFixShowFrom);C=Math.max(C,I*a.state.scrollyRatio)}if(C=Math.max(0,C),wt?d.css("top",a.state.scrollbaryTrackTop+C+"px"):d.css("transform","translateY("+C+"px)"),a.state.scrollbarRefreshLastDatalength=a.state.data.length,a.state.scrollbarRefreshLastColumnLength=a.option.columnMapping.length,a.option.scrollbarPreview&&1==a.option.scrollbarPreview.enabled){if(a.state.scrollbarPreview=a.state.scrollbarPreview||{},null!=a.state.scrollbarLastRow&&a.state.scrollbarLastRow!=a.state.renderFromRenderedIndex&&a.option.scrollbarPreview.row){a.state.scrollbarPreview.rowPreviewElement||(a.state.scrollbarPreview.rowPreviewElement=document.createElement("div"),a.state.scrollbarPreview.rowPreviewElement.className="preview row",a.$scrollbary[0].appendChild(a.state.scrollbarPreview.rowPreviewElement));var _=a.state.renderFromRenderedIndex;a.state.refreshbodycell&&a.state.refreshbodycell.renderedPinnedDataList.length&&(_=a.state.renderFromRenderedIndex+a.state.refreshbodycell.renderedPinnedDataList.length);var w=a.state.renderTargetDataList[_],b=a.state.columnIndexToMapping[a.state.renderFromColumnIndex];if(a.state.renderTargetMappingInfo&&a.state.renderTargetMappingInfo.renderTargetMapping)for(var M=0,S=a.state.renderTargetMappingInfo.renderTargetMapping.length;M<S;M++)if(!a.state.renderTargetMappingInfo.renderTargetMapping[M].selectorColumn&&a.state.renderTargetMappingInfo.renderTargetMapping[M].key){b=a.state.renderTargetMappingInfo.renderTargetMapping[M];break}"default"===a.option.scrollbarPreview.row?At.renderUtil.setElementContent(a.state.scrollbarPreview.rowPreviewElement,document.createTextNode(At.i18n("row")+(w._index.row+(a.option.scrollbarPreview.rowDefaultFromZero?0:1)))):"function"==typeof a.option.scrollbarPreview.row&&At.renderUtil.setElementContent(a.state.scrollbarPreview.rowPreviewElement,a.option.scrollbarPreview.row(w,b)),a.state.scrollbarPreview.rowPreviewTimer&&(clearTimeout(a.state.scrollbarPreview.rowPreviewTimer),a.state.scrollbarPreview.rowPreviewTimer=null),a.state.scrollbarPreview.rowPreviewTimer=setTimeout(function(){a.state&&a.option&&(a.state.scrollbarPreview.rowPreviewElement&&a.$scrollbary[0].removeChild(a.state.scrollbarPreview.rowPreviewElement),a.state.scrollbarPreview.rowPreviewElement=null,a.state.scrollbarPreview.rowPreviewTimer=null)},a.option.scrollbarPreview.closeDelay)}if(null!=a.state.scrollbarLastColumn&&a.state.scrollbarLastColumn!=a.state.renderFromColumnIndex&&a.option.scrollbarPreview.column){a.state.scrollbarPreview.columnPreviewElement||(a.state.scrollbarPreview.columnPreviewElement=document.createElement("div"),a.state.scrollbarPreview.columnPreviewElement.className="preview column",a.$scrollbarx[0].appendChild(a.state.scrollbarPreview.columnPreviewElement));var w=a.state.renderTargetDataList[a.state.renderFromRenderedIndex],b=a.state.columnIndexToMapping[a.state.renderFromColumnIndex];if(a.state.refreshbodycell&&a.state.refreshbodycell.renderedPinnedDataList.length&&(w=a.state.refreshbodycell.renderedPinnedDataList[0]),a.state.renderTargetMappingInfo&&a.state.renderTargetMappingInfo.fixedRenderTargetMapping.length){var E=a._columnIndexOrder(a.state.renderFromColumnIndex);E+=a.state.renderTargetMappingInfo.fixedRenderTargetMapping.length,b=a.state.columnIndexToMapping[a.state.columnIndexArr[E]]}if("default"===a.option.scrollbarPreview.column)if(b.title){var T=document.createElement("div");At.renderUtil.setElementContent(T,"function"==typeof b.title?b.title.call(a,b):b.title),a.state.scrollbarPreview.columnPreviewElement.innerHTML=At.renderUtil.escapeHTMLString(e(T).text())}else b.key||null!=b.key?At.renderUtil.setElementContent(a.state.scrollbarPreview.columnPreviewElement,document.createTextNode(b.key)):At.renderUtil.setElementContent(a.state.scrollbarPreview.columnPreviewElement,document.createTextNode(At.i18n("column")+b.columnIndex));else"function"==typeof a.option.scrollbarPreview.column&&At.renderUtil.setElementContent(a.state.scrollbarPreview.columnPreviewElement,a.option.scrollbarPreview.column(w,b));a.state.scrollbarPreview.columnPreviewTimer&&(clearTimeout(a.state.scrollbarPreview.columnPreviewTimer),a.state.scrollbarPreview.columnPreviewTimer=null),a.state.scrollbarPreview.columnPreviewTimer=setTimeout(function(){a.state&&a.option&&(a.state.scrollbarPreview.columnPreviewElement&&a.$scrollbarx[0].removeChild(a.state.scrollbarPreview.columnPreviewElement),a.state.scrollbarPreview.columnPreviewElement=null,a.state.scrollbarPreview.columnPreviewTimer=null)},a.option.scrollbarPreview.closeDelay)}if(a.state.scrollbarPreview.rowPreviewElement){a.state.scrollbarPreview.rowPreviewElement.style.right=a.state.scrollbaryWidth+"px";var D=a.state.scrollbaryTrackTop+C,F=a.state.scrollbarPreview.rowPreviewElement.offsetHeight||a.state.scrollbarPreview.rowPreviewElement.clientHeight;D+F>=a.state.wrapperHeight&&(D-=D+F-a.state.wrapperHeight),a.state.scrollbarPreview.rowPreviewElement.style.top=Math.ceil(D)+"px"}if(a.state.scrollbarPreview.columnPreviewElement){a.state.scrollbarPreview.columnPreviewElement.style.bottom=a.state.scrollbarxHeight+"px";var R=a.state.scrollbarxTrackLeft+x,k=a.state.scrollbarPreview.columnPreviewElement.offsetWidth||a.state.scrollbarPreview.columnPreviewElement.clientWidth;R+k>=a.state.wrapperWidth&&(R-=R+k-a.state.wrapperWidth),a.state.scrollbarPreview.columnPreviewElement.style.left=Math.ceil(R)+"px"}}a.state.scrollbarLastRow=a.state.renderFromRenderedIndex,a.state.scrollbarLastColumn=a.state.renderFromColumnIndex},At.prototype.setScroll=function(e){var t=this;null!=e&&(null!=e.column&&(t.state.renderFromColumnIndex=e.column),null!=e.columnScrollEnd&&(t.state.scrollxEnd=e.columnScrollEnd),null!=e.row&&(t.state.renderFromRenderedIndex=e.row),null!=e.rowScrollEnd&&(t.state.scrollyEnd=e.rowScrollEnd),t.viewUpdate(!1,!0))},At.prototype.scrollOffset=function(){var e=this,t={};return t.row=e.state.renderFromRenderedIndex,t.column=e.state.renderFromColumnIndex,t.rowScrollEnd=e.state.scrollyEnd,t.columnScrollEnd=e.state.scrollxEnd,t},At.prototype._generateXOffsetOnContinuousScroll=function(){var e=this;e.option.useContinuousXScroll&&e.state.refreshbodycell&&(e.state.refreshbodycell.scrollEndXOffset=-Math.abs((e.state.translateX-e._generateTranslatex(e.state.renderFromColumnIndex)*e.state.scrollxRatio)/e.state.scrollxRatio))},At.prototype._generateYOffsetOnContinuousScroll=function(){var e=this;if(e.option.useContinuousYScroll&&e.state.refreshbodycell){var t=e.__getRowHeightByRenderedIdx(e.state.renderFromRenderedIndex);e.state.refreshbodycell.scrollEndYOffset=-Math.abs((e.state.translateY-t*e.state.scrollyRatio)/e.state.scrollyRatio)}},At.prototype.dataScroll=function(t,a,n){function r(e,t,a){var n={left:0,center:50,right:100,middle:50};a&&(n={top:0,middle:50,bottom:100});var r=null;return n.hasOwnProperty(t)?r=n[t]:"string"==typeof t&&t.indexOf("%")>=0?r=Number(t.split("%")[0]):isNaN(Number(t))||(r=Number(t)),r}var o=this;s(a)&&(n=a,a=null);var l=0,i=0,p=!1,c=!1;if(d(t)&&t._index){var g=t._index.column;if("string"==typeof g?(l=o.state.columnKeyToIndexMap[g],p=!0):e.isNumeric(g)&&(l=parseInt(g),p=!0),i=t._index.row,u(i))c=!0;else{var f=t._index.data;null==f&&t._index.id&&(f=o.state.dataIdToIndexMap[t._index.id]);var h=o.state.data[f];h&&(i=h._index.row,c=!0)}}else if("string"!=typeof t)return;var m=0,v=0;null!=a&&(m=null!=a.scrollX?r(o,a.scrollX):0,v=null!=a.scrollY?r(o,a.scrollY,!0):0),"string"==typeof t&&("left"==t||"right"==t||"center"==t?p=!0:("top"==t||"middle"==t||"bottom"==t||t.indexOf("%")>0)&&(c=!0)),o.state.scrollxMoveable&&p&&function(e,t,a,n){var r=e.state.fixedColumnMapping.length;e.state.scrollxEnd=!1;var o=0;if("string"==typeof n)"left"===n?(o=0,e.state.renderFromColumnIndex=e.state.visibleColumnIndexArr[0]):"center"===n?(o=.5*(e.state.scrollbarxTrackLength-e.state.scrollbarxWidth),e.state.renderFromColumnIndex=e._getColumnIndexByBlankWidth(o)):"right"===n&&(e.state.scrollxEnd=!0,o=e.state.scrollbarxTrackLength-e.state.scrollbarxWidth,e.state.renderFromColumnIndex=e._getColumnIndexByBlankWidth(o));else if(100===a||50===a){for(var l=e.state.wrapperWidth*(a/100),i=r>0?e.state.fixedColumnWidth:0,d=t;d>=0;d--)if(null!=e.state.columnWidthMap[d]&&(e.state.renderFromColumnIndex=d,(i+=e.state.columnWidthMap[d])>l)){100===a&&(e.state.renderFromColumnIndex=d+1);break}r>0&&(e.state.renderFromColumnIndex=e.state.renderFromColumnIndex-r),(o=e._generateTranslatex(e.state.renderFromColumnIndex)*e.state.scrollxRatio)>=e.state.scrollbarxTrackLength-e.state.scrollbarxWidth&&(e.state.scrollxEnd=!0,o=e.state.scrollbarxTrackLength-e.state.scrollbarxWidth,e.state.renderFromColumnIndex=e._getColumnIndexByBlankWidth(o))}else e.state.renderFromColumnIndex=Math.max(0,e.state.columnIndexArr[e._columnIndexOrder(t)-r]),(o=e._generateTranslatex(0)*e.state.scrollxRatio)>=e.state.scrollbarxTrackLength-e.state.scrollbarxWidth&&(e.state.scrollxEnd=!0,o=e.state.scrollbarxTrackLength-e.state.scrollbarxWidth,e.state.renderFromColumnIndex=e._getColumnIndexByBlankWidth(o));e.state.translateX=o,e.option.useContinuousXScroll&&e._generateXOffsetOnContinuousScroll()}(o,l,m,t),o.state.scrollyMoveable&&c&&function(e,t,a,n){var r=e.option.rowFixCount;e.state.scrollyEnd=!1;var o=0;if(e.state.refreshbodycell.scrollEndYOffset=0,"string"==typeof n){if("top"===n)o=0,e.state.renderFromRenderedIndex=0,e.state.scrollyEnd=!1;else if("middle"===n)o=.5*(e.state.scrollbaryTrackLength-e.state.scrollbaryHeight),e.state.renderFromRenderedIndex=e.__getRenderedIndexByBlankHeight(o);else if("bottom"===n)e.state.scrollyEnd=!0,o=e.state.scrollbaryTrackLength-e.state.scrollbaryHeight,e.state.renderFromRenderedIndex=e.__getRenderedIndexByBlankHeight(o);else if(n.indexOf("%")>0){var l=parseInt(n.split("%")[0]);o=(e.state.scrollbaryTrackLength-e.state.scrollbaryHeight)*(l/100),e.state.renderFromRenderedIndex=e.__getRenderedIndexByBlankHeight(o)}}else if(100===a||50===a){var i=Math.ceil(e.state.refreshbodycell.renderedDataList.length*(a/100));e.state.renderFromRenderedIndex=Math.max(0,t-i),100===a&&(e.state.renderFromRenderedIndex+=1);var d=e.__getRowHeightByRenderedIdx(e.state.renderFromRenderedIndex);((o=Math.ceil(e.state.scrollyRatio*d*e.state.scrollRatioConst)/e.state.scrollRatioConst)>=e.state.scrollbaryTrackLength-e.state.scrollbaryHeight||e.state.pagingInfo.pageRowCount-1===t)&&(e.state.scrollyEnd=!0,o=e.state.scrollbaryTrackLength-e.state.scrollbaryHeight,e.state.renderFromRenderedIndex=e.__getRenderedIndexByBlankHeight(o))}else{e.state.renderFromRenderedIndex=Math.max(0,t-r);var d=e.__getRowHeightByRenderedIdx(e.state.renderFromRenderedIndex);(o=Math.ceil(e.state.scrollyRatio*d*e.state.scrollRatioConst)/e.state.scrollRatioConst)>=e.state.scrollbaryTrackLength-e.state.scrollbaryHeight&&(e.state.scrollyEnd=!0,o=e.state.scrollbaryTrackLength-e.state.scrollbaryHeight,e.state.renderFromRenderedIndex=e.__getRenderedIndexByBlankHeight(o))}e.state.translateY=o,e.option.useContinuousYScroll&&e._generateYOffsetOnContinuousScroll()}(o,i,v,t),(p||c)&&o.redraw(),s(n)&&setTimeout(function(){n()},10)},At.prototype._scrollerReset=function(){var e=this;e.state.renderFromRenderedIndex=0,e.state.renderFromColumnIndex=0,e.state.translateY=0,e.state.translateX=0,e.state.scrollxEnd=!1,e.state.scrollyEnd=!1,e.state.refreshbodycell&&(e.state.refreshbodycell.scrollEndYOffset=0,e.state.refreshbodycell.scrollEndXOffset=0),e.state.scrollbarLastRow=0,e.state.scrollbarLastColumn=0},At.prototype._startSearch=function(t,a,n){var r=this,o=!0===a.useFilter,l=!0===a.caseSensitive,i=!0===a.ignoreWhiteSpace,d=!0===a.useRegex,s=!0===a.useRenderToSearch,p=!0===a.byColumn,u="function"==typeof t;u||(t=t.toString());var c=u?"":t.toLowerCase(),g=a.filterName?a.filterName:"alopexGridSearch";o&&r._hasFilterNamed(g)&&!r.state.alreadyUseFiltered&&r.deleteFilter(g);var f=[];if(null!=a.targetColumn&&a.targetColumn.length>0)for(var h,m,v=0,x=a.targetColumn.length;v<x;v++)h=a.targetColumn[v],null!=(m=isNaN(parseInt(h))?r.state.columnKeyToMapping[h]:r.state.columnIndexToMapping[parseInt(h)])&&!0!==m.hidden&&f.push(m);else f=e.grep(r.state.visibleColumnMappingList,function(e){return s||!e.key&&!e.multi?s?e:void 0:e});f.sort(function(e,t){return e.columnIndex-t.columnIndex});var y=f.length,C=l?t:c;!u&&i&&(C=C.replace(/\s/g,""));for(var I=function(e){if(null==e||null==e._index)return!1;for(var a=[],n=0;n<y;n++){var o=f[n];if(o.rowspan){var p=r._getRowspanInfoForCell(e._index.row,o.columnIndex);if(p&&e._index.row!==p.from)continue}if(r.state.hasColspan){var c=r._getColspanInfoForCell(e._index.row,o.columnIndex);if(c&&o.columnIndex!==c.from)continue}var g=e[o.key];s?g=At.renderUtil.getTextFromElement(r._createCell(e,o)):null==g&&(g="",o.multi&&r._iterateMultiMapping(e,o,function(t,a){a.key&&(g+=e[a.key])})),g=g.toString();var h=!1;u?h=!0===t(g):(i&&(g=g.replace(/\s/g,"")),d&&g.match(new RegExp(t,"i"))?h=!0:l&&g.indexOf(C)>=0?h=!0:g.toLowerCase().indexOf(C)>=0&&(h=!0)),h&&a.push(o)}return!!a.length&&a},_=((new Date).getTime(),[]),w=[],b={},M={},S=o?r.state.targetDataList:r.state.renderTargetDataList,E=0,T=S.length;E<T;E++){var D=I(S[E]);if(!1!==D){var F=S[E];_.push(F),w.push(D),b[F._index.id]=b[F._index.id]||{};for(var R=0,k=D.length;R<k;R++)M[F._index.id]=M[F._index.id]||{},M[F._index.id][D[R].id]=!0}}o&&(null==r.option.rowOption?r.option.rowOption={filter:{}}:null==r.option.rowOption.filter&&(r.option.rowOption.filter={}),r.option.rowOption.filter[g]=function(e){return!!I(e)},r.state.alreadyUseFiltered||(r.calcAndRedraw(),_=r.state.renderTargetDataList,r.state.alreadyUseFiltered=!0)),r.state.searchStatus={},r.state.searchStatus.useFilter=o,r.state.searchStatus.filterName=g,r.state.searchStatus.highlightRowClassName="cell-search-highlight-row",r.state.searchStatus.highlightColumnClassName="cell-search-highlight-column",r.state.searchStatus.matchRowClassName="cell-search-match-row",r.state.searchStatus.matchColumnClassName="cell-search-match-column",r.state.searchStatus.keyword=t,r.state.searchStatus.caseSensitive=l,r.state.searchStatus.ignoreWhiteSpace=i,r.state.searchStatus.useRegex=d,r.state.searchStatus.useRenderToSearch=s,r.state.searchStatus.matchDataList=_,r.state.searchStatus.matchMappingList=w,r.state.searchStatus.highlightAtMatchDataList=null,r.state.searchStatus.highlightAtMatchMappingList=null,r.state.searchStatus.byColumn=p,r.state.searchStatus.option=a,r.state.searchStatus.userOption=n,r.state.searchStatus.matchCount=r._getFocusableSearchMatchCount(),r.state.searchStatus.highlightPointer=null,r.state.searchStatus.accumulatedMappingCountList=null,r.state.searchStatus.targetColumn=f,r.state.searchStatus.matchDataIdMap=b,r.state.searchStatus.matchMappingIdMapByDataId=M,r.state.searchStatus.showProgress=a.showProgress,r.state.searchStatus.prevPage=r.option.paging.current,r._refreshBoard(!0);var L=r.searchNext();return r._triggerGridEvent("searchStart",L),r._triggerGridEvent("startSearchEnd",L),L},At.prototype.startSearch=function(t,a,n){var r=this;if(null==t)return!1;if("string"!=typeof t&&"number"!=typeof t&&"function"!=typeof t)return!1;r.state.searchStatus&&t!=r.state.searchStatus.keyword&&(r.state.alreadyUseFiltered=!1),r.state.alreadyUseFiltered||r.endSearch();var o=e.extend({},At.defaultOption.searchOption,r.option.searchOption);if(d(a))for(var l in a)a.hasOwnProperty(l)&&(o[l]=a[l]);if(r._triggerGridEvent("startSearch",o),r.state.searchStatus&&t==r.state.searchStatus.keyword){var i=r.searchNext();return r._triggerGridEvent("searchStart",i),r._triggerGridEvent("startSearchEnd",i),i}if(null==o||!o.showProgress||r.state.alreadyUseFiltered)return r._startSearch(t,o,a);r.showProgress(function(){return r._startSearch(t,o,a),n()})},At.prototype.endSearch=function(){var e=this;return!!e.state.searchStatus&&(e._removeSearchRowHighlight(),e.state.searchStatus.filterName&&e._hasFilterNamed(e.state.searchStatus.filterName)&&e.deleteFilter(e.state.searchStatus.filterName),e.state.searchStatus=null,e._refreshBoard(!0),e._triggerGridEvent("searchEnd"),!0)},At.prototype.searchInfo=function(){var e=this;return e.state.searchStatus?{keyword:e.state.searchStatus.keyword,matchCount:e.state.searchStatus.matchCount,highlightPointer:e._getSearchHighlightPointer(),highlightAtMatchDataList:e.state.searchStatus.highlightAtMatchDataList,highlightAtMatchMappingList:e.state.searchStatus.highlightAtMatchMappingList,matchDataList:e.state.searchStatus.matchDataList,matchMappingList:e.state.searchStatus.matchMappingList,highlightedData:e._getSearchFocusedData(),highlightedMappingList:e._getSearchFocusedMappingList(),byColumn:e.state.searchStatus.byColumn,useFilter:e.state.searchStatus.useFilter,useRegex:e.state.searchStatus.useRegex,useRenderToSearch:e.state.searchStatus.useRenderToSearch,caseSensitive:e.state.searchStatus.caseSensitive,ignoreWhiteSpace:e.state.searchStatus.ignoreWhiteSpace,timeStamp:(new Date).getTime(),targetColumn:e.state.searchStatus.targetColumn,filterName:e.state.searchStatus.filterName,showProgress:e.state.searchStatus.showProgress,prevPage:e.state.searchStatus.prevPage}:null},At.prototype._highlightAtSearchFocus=function(e,t,a){var n=this;if(!n.state.searchStatus)return!1;if(!e)return!1;var r=n._dataGetByIndex(e._index);if(at(n,r._index.row,t[0].columnIndex),n._removeSearchRowHighlight(),n.rowElementGet(e,Ht.cache).addClass(n.state.searchStatus.highlightRowClassName),t&&t.length)for(var o=0,l=t.length;o<l;o++){var i=t[o],d=n._cellElementGet(r,i);d&&At.renderUtil.addClass(d,n.state.searchStatus.highlightColumnClassName)}},At.prototype._getSearchHighlightClassName=function(e,t){var a=this;if(!a.state.searchStatus||!e||!t)return"";var n=[],r=a._getSearchFocusedData(),o=a._getSearchFocusedMappingList();if(e&&r&&e._index.id===r._index.id){n.push(a.state.searchStatus.highlightRowClassName),null==o&&(o=a._getSearchFocusedMappingList(r._index.id));for(var l=0,i=o.length;l<i;l++)if(o[l]&&t.id===o[l].id){n.push(a.state.searchStatus.highlightColumnClassName);break}}if(e&&a.state.searchStatus.matchDataIdMap&&a.state.searchStatus.matchDataIdMap[e._index.id]){n.push(a.state.searchStatus.matchRowClassName);var d=null;a.state.searchStatus.matchMappingIdMapByDataId&&(d=a.state.searchStatus.matchMappingIdMapByDataId[e._index.id])&&d[t.id]&&n.push(a.state.searchStatus.matchColumnClassName)}return n.join(" ")},At.prototype._removeSearchRowHighlight=function(){var e=this;if(!e.state.searchStatus)return!1;if(wt)e.$wrapper.find("."+e.state.searchStatus.highlightRowClassName+",."+e.state.searchStatus.highlightColumnClassName).removeClass(e.state.searchStatus.highlightRowClassName);else{for(var t=e.$wrapper[0].getElementsByClassName(e.state.searchStatus.highlightRowClassName);t.length;)At.renderUtil.removeClass(t[0],e.state.searchStatus.highlightRowClassName);for(t=e.$wrapper[0].getElementsByClassName(e.state.searchStatus.highlightColumnClassName);t.length;)At.renderUtil.removeClass(t[0],e.state.searchStatus.highlightColumnClassName)}},At.prototype._getSearchFocusedData=function(){var e=this;return e.state.searchStatus?e.state.searchStatus.matchDataList[e.state.searchStatus.highlightAtMatchDataList]||null:null},At.prototype._getSearchFocusedMappingList=function(e){var t=this;if(!t.state.searchStatus)return null;var a=t._getMatchMappingListOfSearchFocusedData(e);if(null==t.state.searchStatus.highlightAtMatchMappingList)return a;var n=null;return a&&a.length&&(n=a[t.state.searchStatus.highlightAtMatchMappingList]),n?[n]:null},At.prototype._getFocusableSearchMatchCount=function(){var e=this;if(!e.state.searchStatus)return 0;if(e.state.searchStatus.byColumn){for(var t=0,a=!e.state.searchStatus.hasOwnProperty("prevPage")||e.pageInfo().current==e.state.searchStatus.prevPage,n=a?e.state.searchStatus.matchMappingList:e.state.searchStatus.matchMappingIdMapByDataId,r=0,o=e.state.searchStatus.matchDataList.length;r<o;r++){var l=e.state.searchStatus.matchDataList[r],i=a?n[r]:n[l._index.id];t+=Object.keys(i).length}return t}return e.state.searchStatus.matchDataList.length},At.prototype._getSearchHighlightPointer=function(){var e=this;if(!e.state.searchStatus)return null;if(e.state.searchStatus.byColumn){var t=e.pageInfo().current!=e.state.searchStatus.prevPage;if(!e.state.searchStatus.accumulatedMappingCountList||t){e.state.searchStatus.accumulatedMappingCountList=[]
;for(var a=0,n=e.state.searchStatus.matchMappingIdMapByDataId,r=0,o=e.state.searchStatus.matchDataList.length;r<o;r++){var l=e.state.searchStatus.matchDataList[r];e.state.searchStatus.accumulatedMappingCountList[r]=a;var i=n[l._index.id];i&&Object.keys(i).length&&(a+=Object.keys(i).length)}}var d=e.state.searchStatus.accumulatedMappingCountList[e.state.searchStatus.highlightAtMatchDataList]||0;return d+=e.state.searchStatus.highlightAtMatchMappingList||0}return e.state.searchStatus.highlightAtMatchDataList},At.prototype._getMatchMappingListOfSearchFocusedData=function(e){var t=this;if(!t.state.searchStatus)return null;if(null==t.state.searchStatus.highlightAtMatchDataList)return null;if(e){for(var a=[],n=t.state.searchStatus.matchMappingIdMapByDataId[e],r=n?Object.keys(n):[],o=r.length,l=0;l<o;l++)a.push(t.state.columnIdToMapping[r[l]]);return a||null}return t.state.searchStatus.matchMappingList[t.state.searchStatus.highlightAtMatchDataList]||null},At.prototype._highlightCurrentSearchFocus=function(){var e=this;if(!e.state.searchStatus)return!1;var t=e._getSearchFocusedData();t&&e._highlightAtSearchFocus(t,e._getSearchFocusedMappingList(t._index.id),e.state.searchStatus.byColumn)},At.prototype._setSearchHighlightAtStart=function(){var e=this;if(!e.state.searchStatus)return!1;e.state.searchStatus.highlightAtMatchDataList=0},At.prototype._setSearchHighlightAtMappingStart=function(){var e=this;if(!e.state.searchStatus)return!1;e.state.searchStatus.highlightAtMatchMappingList=0},At.prototype._setSearchHighlightAtEnd=function(){var e=this;if(!e.state.searchStatus)return!1;e.state.searchStatus.highlightAtMatchDataList=e.state.searchStatus.matchDataList.length-1},At.prototype._setSearchHighlightAtMappingEnd=function(){var e=this;if(!e.state.searchStatus)return!1;var t=e._getMatchMappingListInWholeDataList();e.state.searchStatus.highlightAtMatchMappingList=t.length-1},At.prototype._getMatchMappingListInWholeDataList=function(){var e=this;if(!e.state.searchStatus)return null;for(var t=[],a=e.state.searchStatus.matchMappingIdMapByDataId[e._getSearchFocusedData()._index.id],n=Object.keys(a),r=0;r<n.length;r++)t.push(e.state.columnIdToMapping[n[r]]);return t},At.prototype._increaseSearchHighlightAt=function(){var e=this;if(!e.state.searchStatus)return!1;e.state.searchStatus.highlightAtMatchDataList;return e.state.searchStatus.highlightAtMatchDataList++,e.state.searchStatus.highlightAtMatchDataList>=e.state.searchStatus.matchDataList.length&&e._setSearchHighlightAtStart(),!0},At.prototype._getCurrentSearchHighlightData=function(){var e=this;return e.state.searchStatus?e.state.searchStatus.matchDataList[e.state.searchStatus.highlightAtMatchDataList]||null:null},At.prototype._increaseSearchHighlightAtMapping=function(){var e=this;if(!e.state.searchStatus)return!1;var t=e._getMatchMappingListInWholeDataList();++e.state.searchStatus.highlightAtMatchMappingList>=t.length&&(e._increaseSearchHighlightAt(),e._setSearchHighlightAtMappingStart())},At.prototype._decreseSearchHighlightAt=function(){var e=this;if(!e.state.searchStatus)return!1;e.state.searchStatus.highlightAtMatchDataList;return e.state.searchStatus.highlightAtMatchDataList--,e.state.searchStatus.highlightAtMatchDataList<0&&e._setSearchHighlightAtEnd(),!0},At.prototype._decreseSearchHighlightAtMapping=function(){var e=this;if(!e.state.searchStatus)return!1;--e.state.searchStatus.highlightAtMatchMappingList<0&&(e._decreseSearchHighlightAt(),e._setSearchHighlightAtMappingEnd())},At.prototype.searchNext=function(){var e=this;if(!e.state.searchStatus)return!1;var t=e.state.searchStatus.byColumn;if(e.pageInfo().current!=e.state.searchStatus.prevPage){if(!e.state.alreadyUseFiltered)return e.startSearch(e.state.searchStatus.keyword);e.state.searchStatus.matchDataList=e.state.renderTargetDataList,e.state.searchStatus.matchCount=e._getFocusableSearchMatchCount(),e.state.searchStatus.highlightAtMatchDataList=null}null==e.state.searchStatus.highlightAtMatchDataList?(e._setSearchHighlightAtStart(),t&&e._setSearchHighlightAtMappingStart()):t?e._increaseSearchHighlightAtMapping():e._increaseSearchHighlightAt(),e._highlightCurrentSearchFocus();var a=e.searchInfo();return e.state.searchStatus.prevPage=e.option.paging.current,e._triggerGridEvent("searchNext",a),e._triggerGridEvent("searchHighlighted",a),a},At.prototype.searchPrevious=function(){var t=this;if(!t.state.searchStatus)return!1;var a=t.state.searchStatus.byColumn;if(t.pageInfo().current!=t.state.searchStatus.prevPage){var n=e.extend({},At.defaultOption.searchOption,t.option.searchOption),r=t.state.searchStatus.userOption;if(d(r))for(var o in r)r.hasOwnProperty(o)&&(n[o]=r[o]);t.state.alreadyUseFiltered?(t.state.searchStatus.matchDataList=t.state.renderTargetDataList,t.state.searchStatus.matchCount=t._getFocusableSearchMatchCount(),t.state.searchStatus.highlightAtMatchDataList=null):t._startSearch(t.state.searchStatus.keyword,n)}null==t.state.searchStatus.highlightAtMatchDataList?(t._setSearchHighlightAtEnd(),a&&t._setSearchHighlightAtMappingEnd()):a?t._decreseSearchHighlightAtMapping():t._decreseSearchHighlightAt(),t._highlightCurrentSearchFocus();var l=t.searchInfo();return t.state.searchStatus.prevPage=t.option.paging.current,t._triggerGridEvent("searchPrevious",l),t._triggerGridEvent("searchHighlighted",l),l},At.prototype._focusInfo=function(){var e=this,t=e.$focusfixture.prop("renderedIndex"),a=e.$focusfixture.prop("columnIndex"),n=null,r=null;return void 0===t||null===t?t=null:n=e._getRenderedDataFromRenderedIndex(t),void 0===a||null===a?a=null:r=e.state.columnIndexToMapping[a]||null,{row:t,column:a,data:n,mapping:r}},At.prototype._focusRestore=function(e){var t=this;e&&u(e.row)&&u(e.column)&&(at(t,e.row,e.column),Ze(t,e.row,e.column))},At.prototype.focusInfo=function(){var t=this,a={},n=e(document.activeElement),r=n.closest(t.$root).length?n.closest(".alopexgrid-cell"):null,o=t.$focusfixture.prop("renderedIndex"),l=t.$focusfixture.prop("columnIndex");return a.cellFocus={},t.option.cellSelectable&&null!=o&&null!=l?(a.cellFocus.row=o,a.cellFocus.columnIndex=l,a.cellFocus.data=t._getRenderedDataFromRenderedIndex(o)||null,a.cellFocus.mapping=t.state.columnIndexToMapping[l]||null,a.cellFocus.rowSelectionFrom=t.state.cellSelection.topBoundaryRenderedIndex,a.cellFocus.rowSelectionTo=t.state.cellSelection.bottomBoundaryRenderedIndex,a.cellFocus.columnSelectionFrom=t.state.cellSelection.leftBoundaryColumnIndex,a.cellFocus.columnSelectionTo=t.state.cellSelection.rightBoundaryColumnIndex):a.cellFocus=null,r&&r.length&&At.regex.inputControls.test(document.activeElement.tagName)?(a.inputFocus={},a.inputFocus.row=parseInt(r.attr("data-alopexgrid-rowindex")),a.inputFocus.columnIndex=parseInt(r.attr("data-alopexgrid-columnindex")),a.inputFocus.data=t._getRenderedDataFromRenderedIndex(a.inputFocus.row)||null,a.inputFocus.mapping=t.state.columnIndexToMapping[a.inputFocus.columnIndex]||null,a.inputFocus.caretPostion=At.regex.caretAvailableType.test(document.activeElement.type)?Q(document.activeElement):null,a.inputFocus.tagName=document.activeElement.tagName,a.inputFocus.tagOrder=r.find(a.inputFocus.tagName).index(n)):a.inputFocus=null,a},At.prototype.focusRestore=function(e){var t=this;if(e&&(e.cellFocus&&(null==e.cellFocus.rowSelectionFrom||null==e.cellFocus.columnSelectionFrom||null==e.cellFocus.rowSelectionTo||null==e.cellFocus.columnSelectionTo||t.option.disableCellSelectionRestore||e.disableCellSelectionRestore?Ue(t,e.cellFocus.row,e.cellFocus.columnIndex,e.cellFocus.row,e.cellFocus.columnIndex):Ue(t,e.cellFocus.rowSelectionFrom,e.cellFocus.columnSelectionFrom,e.cellFocus.rowSelectionTo,e.cellFocus.columnSelectionTo,e.cellFocus.row,e.cellFocus.columnIndex),Ze(t,e.cellFocus.row,e.cellFocus.columnIndex)),e.inputFocus)){var a=t.cellElementGet({_index:{row:e.inputFocus.row}},e.inputFocus.columnIndex),n=a.find(e.inputFocus.tagName).eq(e.inputFocus.tagOrder).focus().get(0);if(n&&null!=e.inputFocus.caretPostion&&At.regex.caretAvailableType.test(n.type)){e.inputFocus.caretPostion;Z(n,e.inputFocus.caretPostion,null)}}},At.prototype.focusCell=function(e,t,a){var n=this,r=n.cellElementGet(e,t);if(!r||!r.length){var o=n._dataGet(e)[0],e={_index:{row:o._index.row}},l=t;if("string"==typeof l){var i=n._getColumnByKey(l);i&&(l=i.columnIndex)}(l<n.state.renderFromColumnIndex||l>n.state.renderToColumnIndex)&&(e._index.column=l),n.dataScroll(e),r=n.cellElementGet(e,t)}return r&&r.length&&(r.eq(0).mousedown().mouseup(),s(a)&&a.call(n.$root,r)),r};var Wt=["cell-selected","cell-selected-topline","cell-selected-bottomline","cell-selected-leftline","cell-selected-rightline","cell-selected-focus"].join(" ");At.prototype._getRowspanInfoForCell=function(e,t){var a=this,n=W(a,t);if(!n)return null;if(a.option.grouping&&!0!==a.option.grouping.useGroupRowspan)return null;var r=null;!0===n.rowspan?r=n.key:n.rowspan&&"string"==typeof n.rowspan.by&&(r=n.rowspan.by);var o=a.state.groupingLookupTable;if(null===o||void 0===o)return null;var l=o[r];if(null===l||void 0===l||0===l.length)return null;var i=a.state.renderTargetDataList[e];if(null==i||null==i._index)return null;if(a.option.grouping.groupRowspanMode){for(var d=i,s=i,p=a.option.grouping.groupRowspanMode;d;){var u=a.state.renderTargetDataList[d._index.row-1];if(!u||!a._allowGroupMerge(u,d,n,p))break;d=u}for(;s;){var c=a.state.renderTargetDataList[s._index.row+1];if(!c||!a._allowGroupMerge(s,c,n,p))break;s=c}return{from:d._index.row,to:s._index.row}}var g=l[i._index.data];if(!g)return null;for(var f=g.from,h=g.to,m=void 0,v=void 0,x=f;x<=h;x++){var y=a.state.data[x],C=y?y._index.row:null;null!=C&&(m=void 0===m?C:Math.min(C,m),v=void 0===v?C:Math.max(C,v))}return void 0!==m&&void 0!==v?{from:m,to:v}:null},At.prototype._getColspanInfoForCell=function(e,t){var a=this,n=a.state.renderTargetDataList[e];if(n)for(var r=t;r>=0;r--){var o=W(a,r);if(o&&me(o)){var l=a._getColspanUpto(n,o);if(l>r&&t<=l)return{from:r,to:l}}}return null},At.prototype._getColspanUpto=function(e,t){var a=this,n="number"==typeof t?a.state.columnIndexToMapping[t]:t;if(n.colspan){var r=Ye(a,e,n);if(r){var o=a.state.visibleIndexMapByColumnIndex[n.columnIndex],l=Math.min(a.state.visibleColumnCount-1,o+r-1);return a.state.visibleColumnMappingList[l]?a.state.visibleColumnMappingList[l].columnIndex:null}}else if(n.colspanTo){if("string"==typeof n.colspanTo){var o=a.state.visibleIndexMapByColumnIndex[n.columnIndex],l=a.state.visibleIndexMapByKey[n.colspanTo];return a.state.visibleColumnMappingList[l]?a.state.visibleColumnMappingList[l].columnIndex:null}if(!e)return null;var i=s(n.colspanTo)?n.colspanTo(e[n.key],e,n,a._getGroupingRangeByData(e,n)):n.colspanTo,d=i;if("string"==typeof d){var l=a.state.visibleIndexMapByKey[d];if(!a.state.visibleColumnMappingList[l])return null;d=a.state.visibleColumnMappingList[l].columnIndex}return Math.min(a.state.maxColumnIndex,d)}return null};var Ut="__AlopexGridCopiedMarkup"+o()+"__",Vt="__AlopexGridCopiedMarkupText"+o()+"__",Yt=window.top;try{Yt[Ut]=null,Yt[Vt]=null}catch(e){Yt=window}At.prototype._startCellSelectEngine=function(t){function a(t){var a="",n=e(t).find("tr"),r=[];return n.each(function(t,n){var o=[],l=e(n).find("td");l.each(function(t,a){if(o.push(e(a).text()),a.colSpan&&parseInt(a.colSpan,10)>1)for(var n=1;n<parseInt(a.colSpan,10);n++)o.push("")});for(var i=0,d=r.length;i<d;i++)r[i]>0&&(o.splice(i,0,""),r[i]--);var s=[];l.each(function(e,t){if(t.rowSpan&&parseInt(t.rowSpan,10)>1){for(var a=0,n=0,o=0,l=r.length;o<l;o++)if(r[o]>0)a++;else if(++n>e)break;s[e+a]=parseInt(t.rowSpan,10)-1}});for(var p=0,u=s.length;p<u;p++)s[p]&&(r[p]=s[p]);a+=o.join("\t"),a+="\r\n"}),a}function n(t){var a="\n";return t.indexOf("\r\n")>=0&&(a="\r\n"),t.slice(-a.length)===a&&(t=t.slice(0,-a.length)),"<table><tbody>"+e.map(t.split(a),function(e){return"<tr><td>"+e.split("\t").join("</td><td>")+"</td></tr>"}).join("")+"</tbody></table>"}function r(e){for(var t=e.split("\n"),a=0,n=t.length-2;a<n;a++)if(null!=t[a]&&null!=t[a+1]&&t[a].split("\t").length!==t[a+1].split("\t").length)return!1;return!0}var o=this,l=".alopexgridCellSelectEngine",d=".alopexgridCellSelectEngineMouseenter";if(o.$root.off(l),o.$wrapper.off(l),o.$wrapper.off(d),o.$focusfixture.off(l),Ct.off(l+o.key),Ct.off(d+o.key),t){var s=null;this.$focusfixture.on("keydown"+l,{self:this,keytimer:{id:null}},function(e){var t=e.data.self;if(!s){var a=t.$focusfixture[0],n=e.shiftKey,r=(e.altKey,e.metaKey),o=e.ctrlKey,l=e.keyCode,d=String.fromCharCode(96<=e.keyCode&&e.keyCode<=105?e.keyCode-48:e.keyCode),p=a.renderedIndex,u=a.columnIndex;if(null!=p&&!isNaN(p)&&null!=u&&!isNaN(u)){var c=t.state.renderTargetDataList[p],g=t.state.columnIndexToMapping[u],f=t._isEditingCell(p,u),h=!(!t.option.cellSelectableOption||!t.option.cellSelectableOption.ignoreVerticalScrollMoveTempo),m=null;if(27===l)f&&t.option.cellInlineEdit&&t.option.instantInlineEditType&&t.option.instantInlineEditType.length>0&&t.cancelCellEdit({_index:{row:p}},u);else if(13===l)f?t.option.cellInlineEditOption&&!0===t.option.cellInlineEditOption.focusMoveAtEditEnd&&et(t,n?-1:1,0):et(t,n?-1:1,0);else if(9===l)f?t.option.cellInlineEditOption&&!0===t.option.cellInlineEditOption.focusMoveAtEditEnd&&et(t,0,n?-1:1):et(t,0,n?-1:1),e.preventDefault();else if(113===l||32===l)if(!f&&t._isCellEditable(c,g)){var v=t._getRowspanInfoForCell(p,u);v&&(p=v.from);var x=null;t.option.cellInlineEdit?x=t.state.__cellInlineEndEdit():t.option.rowInlineEdit&&(x=t.state.__rowInlineEndEdit(t));var y=t.option.cellInlineEditOption.allowStartEditWithInvalid;if(!1!==x||!0===y){t.option.cellInlineEdit?t.state.__cellInlineStartEdit(c,g):t.option.rowInlineEdit&&t.state.__rowInlineStartEdit(t,c);var C=je(t,p,u),I=C.find("input, select, textarea").eq(0),_=I.prop("type");if("radio"===_){var w=C.find('input[type="radio"]:checked');w&&w.length>0&&(I=w)}if(I.focus(),"text"===_){var b=I.val();I.val("").val(b),32===l&&e.preventDefault()}else"checkbox"===_||"radio"===_?e.preventDefault():bt&&"select-one"===_&&(t.state.selectElOpenFlag=!0)}}else{var M=je(t,p,u),S=M.find("input,select,textarea"),_=S.prop("type"),E=t._extractRenderObject(c,g),T=E?E.type:null;if(M.hasClass("selector-column")){var D=c._state.selected;if(t.rowSelect({_index:{row:p}},"toggle"),t.state.hasSelectorColumn&&c._state.selected!==D){var F={data:c,mapping:g,value:c._state.selected,prevValue:D};t._triggerGridEvent("cellValueEditing",F,M),t._triggerGridEvent("cellValueChanged",F,M),M.change()}}else if(32===l&&t.option.renderMapping[T]&&"function"==typeof t.option.renderMapping[T].toggle){var R=t.option.renderMapping[T].toggle;R.call(t,M[0],c,E,g,t),t._updateEditingCell(M),M.change()}else bt&&32===l&&"select-one"===_?(t.state.selectElOpenFlag=!0,S.eq(0).focus()):S.eq(0).focus()}else if(39===l)if(n)tt(t,!1,!0,!1,!1);else{m="right";for(var k=st(t,u,1),c=t._getRenderedDataFromRenderedIndex(p),L=u;L>=0;L--){var g=W(t,L);if(g&&me(g)){var A=t._getColspanUpto(c,g);if(A>L&&u<=A){k=st(t,A,1);break}}}null==k&&(k=u),Je(t,p,k,m),nt(t,"cellSelectionStart")}else if(37===l)if(n)tt(t,!0,!1,!1,!1);else{m="left";for(var k=dt(t,u,1),c=t._getRenderedDataFromRenderedIndex(p),L=u;L>=0;L--){var g=W(t,L);if(g&&me(g)){var A=t._getColspanUpto(c,g);if(u<=A){k=dt(t,g.columnIndex,1);break}}}null==k&&(k=u),Je(t,p,k,m),nt(t,"cellSelectionStart")}else if(38===l||33===l){var v=t._getRowspanInfoForCell(p,u);v&&(p=v.from);var O=33===l?t._getProcessedPageUpLength(h):1;if(n)tt(t,!1,!1,O,!1);else{m="up";var P=Math.max(p-O,0);t.option.cellSelectableOption&&t.option.cellSelectableOption.useMinPageUpDownScroll||33!==l||(t.state.scrollyEnd,t._scrollUpEvent(O)),Je(t,P,u,m),nt(t,"cellSelectionStart")}e.preventDefault()}else if(40===l||34===l){var v=t._getRowspanInfoForCell(p,u);v&&(p=v.to);var O=1;if(34===l&&(O=t._getProcessedPageDownLength(h),t.state.refreshbodycell&&t.state.refreshbodycell.renderedPinnedDataList))for(var B=0,G=t.state.refreshbodycell.renderedPinnedDataList.length;B<G;B++){var H=t.state.refreshbodycell.renderedPinnedDataList[B];if(H&&H._index.row===p){O+=G-B;break}}if(n)tt(t,!1,!1,!1,O);else{m="down";var P=p+O;t.option.cellSelectableOption&&t.option.cellSelectableOption.useMinPageUpDownScroll||34!==l||t._scrollDownEvent(O),Je(t,P,u,m),nt(t,"cellSelectionStart")}e.preventDefault()}else if((o||r)&&"V"===d.toUpperCase())return void(e.data.keytimer.id&&clearTimeout(e.data.keytimer.id));if(nt(t),t.state.cellSelection){33!==l&&34!==l&&38!==l&&40!==l||e.preventDefault();var N=t.state.cellSelection.focusRenderedIndex,$=t.state.cellSelection.focusColumnIndex,M=je(t,N,$);e.data.keytimer.id&&clearTimeout(e.data.keytimer.id),e.data.keytimer.id=setTimeout(function(){var e=At.trimString(a.innerText||a.textContent);a.innerHTML="";var n=W(t,$);if(e&&n&&n.editable&&t.option.cellInlineEdit){if(!t._isEditingCell(N,$)){var r=t.state.__cellInlineEndEdit(),o=t.option.cellInlineEditOption.allowStartEditWithInvalid;!1===r&&!0!==o||t.state.__cellInlineStartEdit(c,n)}if(M=t.cellElementGet({_index:{row:N}},$),i(),M&&M.length){var l=M.find("input,textarea");if(l.length){var d=l.prop("type");if("radio"===d)l.filter(":checked").focus();else if("checkbox"===d)l.focus();else{l[0].focus(),l.val("");var p=e.charCodeAt(0);p<256&&l.val(e)}t._updateEditingCell(M)}else M.find("select").focus();s=null}}else setTimeout(function(){s=null},1)},50)}}}}),this.$focusfixture.on("copy"+l,{self:this},function(t){var n=t.data.self,r=rt(n);u(r)||(r=""),r=String(r);var o="",l=!1,i=!(!n.option.cellSelectableOption||!n.option.cellSelectableOption.copyTextformOnly);if(r.indexOf("<table")>=0?(l=!0,o=a(r)):o=r,Yt[Ut]=r,Yt[Vt]=o,(t.originalEvent||t).clipboardData){t.preventDefault();var d=(t.originalEvent||t).clipboardData;"string"==typeof r&&(l&&!i&&d.setData("text/html",r),d.setData("text/plain",o))}else window.clipboardData&&window.clipboardData.setData&&(l?(window.clipboardData.setData("Text",o),i||(n.$focusfixture.empty().append(e(r)),J(n.$focusfixture.get(0),!0),setTimeout(function(){Ze(n)},0))):window.clipboardData.setData("Text",o))}),this.$focusfixture.on("paste"+l,{self:this},function(e){var t=e.data.self,a="",o=!(!t.option.cellSelectableOption||!t.option.cellSelectableOption.copyTextformOnly);if((e.originalEvent||e).clipboardData){if(a=(e.originalEvent||e).clipboardData.getData("text/html"),!it(t,a)){if(a=(e.originalEvent||e).clipboardData.getData("text/plain"),a&&a.length||(a=""),o&&a===Yt[Vt]&&it(t,n(a)))return t.$focusfixture.empty(),void e.preventDefault();if(t.option.cellSelectableOption&&t.option.cellSelectableOption.detectTSV&&r(a)&&it(t,n(a)))return t.$focusfixture.empty(),void e.preventDefault();var l=t.state.cellSelection.focusRenderedIndex,i=t.state.cellSelection.focusColumnIndex;return!1!==lt(t,l,i,a)&&t.cellEdit(a,{_index:{row:l}},i),void e.preventDefault()}t.$focusfixture.empty(),e.preventDefault()}else setTimeout(function(){a=t.$focusfixture.html();var e=t.$focusfixture.text();if(t.$focusfixture.empty(),!it(t,a)){if(e&&e.length||(e=""),o&&(window.clipboardData&&window.clipboardData.getData&&(e=window.clipboardData.getData("Text")||e),e===Yt[Vt]?a=n(e):a===Yt[Vt]&&(a=n(a)),it(t,a)))return;if(t.option.cellSelectableOption&&t.option.cellSelectableOption.detectTSV){var l=window.clipboardData.getData("Text")||e;if(r(l)&&it(t,n(l)))return}var i=t.state.cellSelection.focusRenderedIndex,d=t.state.cellSelection.focusColumnIndex;return void(!1!==lt(t,i,d,e)&&t.cellEdit(e,{_index:{row:i}},d))}},5)});var p={id:null};this.$root.on("mousedown"+l,".bodycell",{self:this},function(t){function a(e,t,a){return parseInt(Math.max(Math.min(500,Math.abs(e-t)/(5*(a||1))),1))}var n=t.data.self,r=e(this);if(!At.renderUtil.isGridPointerActionProhibited(t.target)){if(At.renderUtil.hasClass(this,"emptycell")){var o=!!n.state.cellSelection;return Re(n),void(o&&Oe(n))}var l=parseInt(r.attr("data-alopexgrid-rowindex")),s=parseInt(r.attr("data-alopexgrid-columnindex"));if(/(INPUT)|(SELECT)|(TEXTAREA)|(OPTION)/.test(t.target.tagName))return void(n.option.disableCellFocusAtInput||Je(n,l,s,null,!0));if(!r.hasClass("cell-unselectable")){Se(function(){setTimeout(function(){Ee(),Ct.trigger("__alopexgridcellselectdragend")},0)}),n.state.customShiftKey=t.shiftKey,Je(n,l,s);var u=n.$wrapper.width(),c=n.$wrapper.height(),g=n.$wrapper.offset(),f={x:t.pageX,y:t.pageY,moved:!1};p.id&&(clearInterval(p.id),p.id=null),nt(n,"cellSelectionStart"),nt(n),n.$wrapper.off(d),Ct.off(d+n.key),Ct.on("mouseup"+d+n.key+n.eventns+" touchend"+d+n.key+n.eventns+" __alopexgridcellselectdragend"+d+n.key+n.eventns,{self:n,timer:p,pointer:f},function(e){var t=e.data.self;e.data.timer.id&&(clearInterval(e.data.timer.id),e.data.timer.id=null),e.data.self.$wrapper.off(d),Ct.off(d+e.data.self.key),nt(t,"cellSelectionEnd");var a=e.target.tagName;setTimeout(function(){if("INPUT"!==a&&"SELECT"!==a&&"TEXTAREA"!==a){var e=document.activeElement?document.activeElement.tagName:null;"INPUT"!==e&&"SELECT"!==e&&"TEXTAREA"!==e&&Ze(t,null,null)}},0)}),Ct.on("mousemove"+d+n.key+n.eventns,{self:n,height:c,width:u,offset:g,timer:p,pointer:f},function(e){var t=e.data.self,n=e.data.width,r=e.data.height,o=e.data.offset,i=o.left,d=o.top,p=e.pageX,u=e.pageY,c=null,g=e.data.timer,f=t.state.headerHeight||0,h=t.option.rowFixCount;t.state.fixedColumnMapping;p===e.data.pointer.x&&u===e.data.pointer.y||(e.data.pointer.moved=!0);var m=0,v=t.state.fixedColumnWidth||0;if(h)for(var x=0;x<h;x++){var y=t.state.renderTargetDataList[x];y&&(m+=t.state.rowHeightMapByDataId[y._index.id]||t.state.rowHeight)}else{var C=t.state.pinnedDataIdList;if(C&&C.length)for(var x=0,I=C.length;x<I;x++){var _=C[x],w=t.state.dataIdToIndexMap[_];if(w>=0){var y=t.state.data[w];m+=t.state.rowHeightMapByDataId[_]||t.state.rowHeight}}}var b=d+f,M=b+m,S=i+v,E=80,T=He(t),D=Ge(t),F=(Ke(t,l),We(t,s),Ne(t),$e(t),be(t),Me(t),!1),R=!1;g.id&&(clearInterval(g.id),g.id=null),T&&u<M&&(F=!0),D&&p<S&&(R=!0),t.state.hasVerticalScrollbar||(F=!0),t.state.hasHorizontalScrollbar||(R=!0),p<o.left+v+25&&!R?(c=function(){var e=a(p,o.left+v+25,8);t._scrollLeftEvent(1*e)},E=160):p>o.left+n-25&&!R?(c=function(){var e=a(p,o.left+n-25,8);t._scrollRightEvent(1*e)},E=160):u<o.top+25+f+m&&!F?c=function(){var e=a(u,o.top+25+f+m,1.5);t._scrollUpEvent(1*e)}:u>o.top+r-25&&!F&&(c=function(){var e=a(u,o.top+r-25,1.5);t._scrollDownEvent(1*e)}),c||(c=function(){g.id&&(clearInterval(g.id),g.id=null)}),e.preventDefault(),c(),g.id=setInterval(c,E)}),n.$wrapper.on("mouseenter"+d,".bodycell",{self:n,pointer:f},function(t){if(!At.renderUtil.hasClass(this,"emptycell")&&t.data.pointer.moved){var a=t.data.self,n=a.state.cellSelection.focusColumnIndex,r=a.state.cellSelection.focusRenderedIndex,o=e(this),l=parseInt(o.attr("data-alopexgrid-rowindex")),d=parseInt(o.attr("data-alopexgrid-columnindex")),s=(a._getRowspanInfoForCell(l,d),He(a)),p=Ge(a),u=Ke(a,l),c=We(a,d),g=Ne(a),f=$e(a),h=be(a),m=Me(a),v=!1;i(),!s||u||f||(l=a.option.rowFixCount,a._scrollTopEvent(!0),v=!0),!p||c||g||(a._scrollLeftEvent(void 0,!0),d=a.state.visibleColumnMappingList[a.state.visibleIndexMapByColumnIndex[a.state.fixupto]+1].columnIndex||a.state.maxColumnIndex,v=!0),s||!u||f||h||(l=a.state.refreshbodycell.renderedDataList[a.option.rowFixCount]._index.row),p||!c||g||m||(d=a.state.refreshbodycell.renderedColumnMappingList[a.state.refreshbodycell.renderedFixedColumnMappingList.length].columnIndex),v&&a._refreshBoard(),Ue(a,r,n,l,d)}})}}})}else Re(this)},At.prototype._addTreeChildToList=function(t,a,n){var r=this;t&&d(t)&&(t=[t]),t=[].concat(t);var o=[];if(r.option.tree&&r.option.tree.useTree&&e.isArray(t)&&t.length){for(var l={},i=0,s=t.length;i<s;i++)l[t[i]._index.id]=!0;for(var i=t.length-1;i>=0;i--){for(var p=t[i],u=p._state.treeNodeDepth,c=p._index.data+1,g=[];c<r.state.data.length;){var f=parseInt(r.state.data[c]._state.treeNodeDepth)-u;if(f<=0)break;l[r.state.data[c]._index.id]||(!a||a&&1===f)&&(l[r.state.data[c]._index.id]=!0,g.push(r.state.data[c])),c++}n||g.unshift(p),Array.prototype.unshift.apply(o,g)}}return o},At.prototype._addTreeParentToList=function(t,a,n){var r=this;if(!r.option.tree||!r.option.tree.useTree)return t;t&&d(t)&&(t=[t]),t=[].concat(t);var o=[];if(e.isArray(t)&&t.length){for(var l={},i=0,s=t.length;i<s;i++)l[t[i]._index.id]=!0;for(var i=t.length-1;i>=0;i--){var p=t[i];if(p._index.parentid){for(var u=r._dataGetByIndex({id:p._index.parentid}),c=[];u&&(l[u._index.id]||(l[u._index.id]=!0,c.unshift(u)),u._index.parentid)&&!a;)u=r._dataGetByIndex({id:u._index.parentid});n||c.push(p),Array.prototype.unshift.apply(o,c)}}}return o},At.prototype._getTreeNodeDepth=function(e){return this.state.treeInfo&&e?this.state.treeInfo.depthByIdValueMap[e[this.option.tree.idKey]]||0:null},At.prototype._isTreeParentNodeExpanded=function(e){for(var t=this,a=e,n=!0;(a=t._dataGetByIndex({id:a._index.parentid}))&&a._index.id!==a._index.parentid;)if(!a._state.expandedTreeNode){n=!1;break}return n},At.prototype._isTreeNodeExpanded=function(e){return!!e._state.expandedTreeNode},At.prototype._isTreeLeafNode=function(e){return e._state.treeNodeLeaf},At.prototype._toggleTreeNode=function(e){this._isTreeLeafNode(e)||(e._state.expandedTreeNode=!e._state.expandedTreeNode)},At.prototype._setExpandedTreeNodeState=function(e){"boolean"!=typeof e._state.expandedTreeNode&&(e._state.expandedTreeNode=!(!this.option.tree.expandedKey||!e[this.option.tree.expandedKey]||String(e[this.option.tree.expandedKey])===String(this.state.treeOption.expandedValue[1])))},At.prototype._expandTreeNode=function(e){e&&!this._isTreeLeafNode(e)&&(e._state.expandedTreeNode=!0,e._index.parentid&&this._expandTreeNode(this._dataGetByIndex({id:e._index.parentid})))},At.prototype._collapseTreeNode=function(e){this._isTreeLeafNode(e)||(e._state.expandedTreeNode=!1)},At.prototype.expandTreeNode=function(t){for(var a=this._dataGet(t),n=0,r=a.length;n<r;n++)this._expandTreeNode(a[n]);(!t||e.isEmptyObject(t)||t._index&&!0===t._index.row)&&(this.state.treeHeaderExpandAllState=!0),this.filterAndRedraw()},At.prototype.collapseTreeNode=function(t){for(var a=this._dataGet(t),n=0,r=a.length;n<r;n++)this._collapseTreeNode(a[n]);(!t||e.isEmptyObject(t)||t._index&&!0===t._index.row)&&(this.state.treeHeaderExpandAllState=!1),this.filterAndRedraw()},At.prototype.toggleTreeNode=function(e){for(var t=this,a=this._dataGet(e),n=0,r=a.length;n<r;n++)this._toggleTreeNode(a[n]);this.filterAndRedraw(),t._triggerGridEvent("toggleTreeNode",{toggleTreeNodeList:a})},At.prototype._getUniqueIdValueForTreeNode=function(t){var a=this,n=t[a.option.tree.idKey];if(!a.state.treeInfo)return n;var r=s(a.option.tree.idGenerator);null!=n||r||(n=a.option.tree.initialIdValue);var o=null,l=null;r&&(t._index.parentid||null!=t[a.option.tree.parentIdKey])&&(o=a._dataGetByIndex({id:t._index.parentid}),o||(o=a._dataGetByIndex({id:a.state.treeInfo.idValueToDataIdMap[t[a.option.tree.parentIdKey]]})),o&&(l=o[a.option.tree.idKey]));for(var i=0;null==n||a.state.treeInfo.idValueToDataIdMap[n];){if(r){var d=a.option.tree.idGenerator.call(a,n,l,t,o,a.state.treeInfo.idValueToDataIdMap);if(d===n||null==d)throw new Error("option.tree.idGenerator function should return modified id value("+n+"->"+d+").");n=d}else{var p=n.split("_");(p.length<=1||!e.isNumeric(p[p.length-1]))&&p.push(0),p[p.length-1]=parseInt(p[p.length-1])+1,n=p.join("_")}if(++i>a.state.data.length)throw new Error("option.tree.idGenerator runs more than data length.")}return n},At.prototype.treeDataMove=function(e,t,a,n){var r=this;if(!r._noData()&&r.state.treeInfo){var o=r._dataGet(e);if(o&&o.length){o.sort(function(e,t){return e._index.data-t._index.data});var l=t?r._dataGet(t)[0]:null,i=null,d="number"===r.option.tree.depthValueType?0:"",s=r.state.treeOption.expandedValue[r.state.treeOption.initialExpandedValue?0:1];l&&(i=l[r.option.tree.idKey]);var p=r.state.data.length;if(a){var u=r._dataGet(a)[0];u&&(p=u._index.data,null!=n&&!0===n&&p++)}var c=0,g=[],f={};l?(f[r.option.tree.parentIdKey]=i,r.option.tree.depthKey&&(f[r.option.tree.depthKey]=parseInt(l[r.option.tree.depthKey])+1+d),r.option.tree.leafKey&&(f[r.option.tree.leafKey]=r.state.treeOption.leafValue[0]),r.option.tree.expandedKey&&(f[r.option.tree.expandedKey]=s)):(f[r.option.tree.parentIdKey]=r.option.tree.rootNodeParentIdValue,r.option.tree.depthKey&&(f[r.option.tree.depthKey]=0+d),r.option.tree.leafKey&&(f[r.option.tree.leafKey]=r.state.treeOption.leafValue[0]),r.option.tree.expandedKey&&(f[r.option.tree.expandedKey]=s));for(var h=0,m=o.length;h<m;h++){o[h]._index.data<p&&(c-=1);if(r._isTreeNodeIncludeChild(o[h],l))return!1;var v=r.state.data.splice(o[h]._index.data,1)[0];v&&(r._dataEdit(v,f),g.push(v))}p+=c,p=Math.min(p,r.state.data.length),g.unshift(p,0),Array.prototype.splice.apply(r.state.data,g),r.sortClear(),r.calcAndRedraw()}}},At.prototype.treeGetParent=function(t,a){var n=this,r=n._treeGetParent.apply(n,arguments);return n.option.deepCopyOnDataGet&&e.isArray(r)&&(r=e.extend(!0,[],r)),r},At.prototype.treeGetChild=function(t,a){var n=this,r=n._treeGetChild.apply(n,arguments);return n.option.deepCopyOnDataGet&&e.isArray(r)&&(r=e.extend(!0,[],r)),r},At.prototype._isTreeNodeIncludeChild=function(e,t){var a=this;if(!t)return!1;for(var n=a._treeGetChild(e,{recursive:!0,inclusive:!0}),r=0,o=n.length;r<o;r++)if(n[r]._index.id===t._index.id)return!0;return!1},At.prototype._treeGetParent=function(e,t){var a=this;if(!a.state.treeInfo)return[];var n=a._dataGet(e);if(!n||!n.length)return[];var r=!(!t||!0!==t.recursive),o=!(!t||!0!==t.inclusive);return a._addTreeParentToList(n,!r,!o)},At.prototype._treeGetChild=function(e,t){var a=this,n=null;if(!a.state.treeInfo)return[];if(!e){if(!a.state.treeInfo.rootChildIdValueList||!a.state.treeInfo.rootChildIdValueList.length)return[];n=[];for(var r=0,o=a.state.treeInfo.rootChildIdValueList.length;r<o;r++){var l=a.state.treeInfo.rootChildIdValueList[r],i=a.state.treeInfo.idValueToDataIdMap[l],d=a._dataGetByIndex({id:i});d&&n.push(d)}var s=!(!t||!0!==t.recursive);return s?a._addTreeChildToList(n,!1,!1):n}if(!(n=a._dataGet(e))||!n.length)return[];var s=!(!t||!0!==t.recursive),p=!(!t||!0!==t.inclusive);return a._addTreeChildToList(n,!s,!p)},At.prototype._isInstanceValid=function(){return!!(this&&this.key&&this.option&&this.state)},e.fn.__alopexgrid=function(){return pt(this)};var Xt=function(){var t=e(this);return t.attr("data-alopexgrid")||(t=t.find("."+ct.split(" ").join("."))),t.each(function(){var t=pt(this);if(t){var a=t.key;t.removeFilterDropdown(),t._viewEventRemove(),t._clearData(),yt.off(t.eventns),Ct.off(t.eventns),e(document.body).off(t.eventns),e(".alopexgrid-refer-"+a).remove();for(var n in t.state)t.state.hasOwnProperty(n)&&delete t.state[n];for(var n in t.option)t.option.hasOwnProperty(n)&&delete t.option[n];for(var n in t)t.hasOwnProperty(n)&&delete t[n];e(this).removeData(At.KEY_NAME).empty().removeAttr("data-alopexgrid").css("height","").css("width",""),delete At.instances[a]}}),this},zt=/<(?:script|style|link)/i,jt=function(a){if(!this.length)return this;if("string"==typeof a){if(!w(t))return;if(!At.prototype[a])throw new Error("[AlopexGrid] AlopexGrid has no method ["+a+"]");var n=void 0,r=void 0,o=e.makeArray(arguments).slice(1);return r=this.each(function(e,t){if(!zt.test(this.tagName)){var r=pt(this);return r||(r=new At(this)),void 0===(n=r[a].apply(r,o))&&void 0}}),void 0!==n?n:r}return this.each(function(e,t){var n=pt(this);n?n.updateOption(a):n=new At(this,a)})};if(e.fn[ht]){var qt=e.fn[ht];e.fn[ht]=function(){this.each(function(){var t=pt(this);return t&&t.version===ut?Xt.apply(e(this),arguments):qt.apply(e(this),arguments)})}}else e.fn[ht]=Xt;if(e.fn[ft]){var Zt=e.fn[ft];e.fn[ft]=function(){var e=pt(this);return!e&&d(arguments[0])?arguments[0].version===ut?jt.apply(this,arguments):Zt.apply(this,arguments):e&&e.version===ut?jt.apply(this,arguments):Zt.apply(this,arguments)}}else e.fn[ft]=jt;if(e[ft]){var Qt=e[ft];e[ft]=function(){return window[gt].version===ut?At.setup.apply(this,arguments):Qt.apply(this,arguments)}}else e[ft]=At.setup;e.alopex&&(e.alopex[ft]=At.setup,s(e.alopex.registerSetup)&&e.alopex.registerSetup(vt,At.setup)),window[gt]=At}(jQuery);
//# sourceMappingURL=alopex-grid.min.js.map
